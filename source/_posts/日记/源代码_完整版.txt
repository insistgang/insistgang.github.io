// ===== src/app.jsx =====
/**
 * AI è¯­æ–‡åŠ©æ‰‹ - åº”ç”¨å…¥å£
 */
import Taro from '@tarojs/taro'
import { useLaunch } from '@tarojs/taro'
import { AuthProvider } from './context/AuthContext'
import './app.less'

// åœ¨æ¨¡å—åŠ è½½æ—¶ç«‹å³åˆå§‹åŒ–äº‘å¼€å‘ï¼ˆå¿…é¡»åœ¨ä»»ä½•ä½¿ç”¨äº‘ API ä¹‹å‰ï¼‰
if (process.env.TARO_ENV === 'weapp') {
  try {
    Taro.cloud.init({
      // ä¸æŒ‡å®š envï¼Œä½¿ç”¨å½“å‰äº‘ç¯å¢ƒï¼ˆå¯åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­åˆ‡æ¢ï¼‰
      traceUser: true
    })
    console.log('äº‘å¼€å‘åˆå§‹åŒ–æˆåŠŸ')
  } catch (e) {
    console.error('äº‘å¼€å‘åˆå§‹åŒ–å¤±è´¥:', e)
  }
}

function App({ children }) {

  useLaunch(() => {
    console.log('App launched')
  })

  return (
    <AuthProvider>
      {children}
    </AuthProvider>
  )
}

export default App


// ===== src/app.config.js =====
/**
 * å…¨å±€é¡µé¢é…ç½®
 */
export default {
  pages: [
    'pages/login/index',
    'pages/home/index',
    'pages/vocabulary/index',
    'pages/idiom/index',
    'pages/pinyin/index',
    'pages/correction/index',
    'pages/exercise/index',
    'pages/exercise-detail/index',
    'pages/mock-exam/index',
    'pages/exam-result/index',
    'pages/chat/index',
    'pages/study-record/index',
    'pages/study-report/index',
    'pages/study-analysis/index',
    'pages/wrong-practice/index',
    'pages/favorite-practice/index',
    'pages/profile/index',
    'pages/admin/index',
    'pages/admin/user-detail/index',
    'pages/admin-import/index'
  ],

  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#4A90E2',
    navigationBarTitleText: 'AIè¯­æ–‡åŠ©æ‰‹',
    navigationBarTextStyle: 'white',
    backgroundColor: '#F5F5F5'
  },

  tabBar: {
    color: '#999999',
    selectedColor: '#4A90E2',
    backgroundColor: '#FFFFFF',
    borderStyle: 'white',
    list: [
      {
        pagePath: 'pages/home/index',
        text: 'é¦–é¡µ',
        iconPath: 'images/tabbar/home.png',
        selectedIconPath: 'images/tabbar/home-active.png'
      },
      {
        pagePath: 'pages/exercise/index',
        text: 'ç»ƒä¹ ',
        iconPath: 'images/tabbar/exercise.png',
        selectedIconPath: 'images/tabbar/exercise-active.png'
      },
      {
        pagePath: 'pages/chat/index',
        text: 'AI',
        iconPath: 'images/tabbar/chat.png',
        selectedIconPath: 'images/tabbar/chat-active.png'
      },
      {
        pagePath: 'pages/profile/index',
        text: 'æˆ‘çš„',
        iconPath: 'images/tabbar/profile.png',
        selectedIconPath: 'images/tabbar/profile-active.png'
      }
    ]
  },

  cloud: true,
  permission: {
    'scope.userLocation': {
      desc: 'ä½ çš„ä½ç½®ä¿¡æ¯å°†ç”¨äºå°ç¨‹åºä½ç½®æ¥å£çš„æ•ˆæœå±•ç¤º'
    }
  }
}


// ===== src/pages/home/index.jsx =====
/**
 * é¦–é¡µ - AIè¯­æ–‡åŠ©æ‰‹
 */
import { useState, useEffect } from 'react'
import { View, Text, ScrollView, Image } from '@tarojs/components'
import { useDidShow, navigateTo, switchTab } from '@tarojs/taro'
import { useAuth } from '../../context/AuthContext'
import studyService from '../../services/study'
import eventBus, { EVENTS } from '../../utils/eventBus'
import './index.less'

// åè¨€è­¦å¥åº“
const QUOTES = [
  { text: 'å­¦è€Œæ—¶ä¹ ä¹‹ï¼Œä¸äº¦è¯´ä¹ï¼Ÿ', author: 'ã€Šè®ºè¯­ã€‹' },
  { text: 'è¯»ä¹¦ç ´ä¸‡å·ï¼Œä¸‹ç¬”å¦‚æœ‰ç¥ã€‚', author: 'æœç”«' },
  { text: 'ä¹¦å±±æœ‰è·¯å‹¤ä¸ºå¾„ï¼Œå­¦æµ·æ— æ¶¯è‹¦ä½œèˆŸã€‚', author: 'éŸ©æ„ˆ' },
  { text: 'æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºå¸ˆçŸ£ã€‚', author: 'ã€Šè®ºè¯­ã€‹' },
  { text: 'ä¸šç²¾äºå‹¤ï¼Œè’äºå¬‰ï¼›è¡Œæˆäºæ€ï¼Œæ¯äºéšã€‚', author: 'éŸ©æ„ˆ' },
  { text: 'å°‘å£®ä¸åŠªåŠ›ï¼Œè€å¤§å¾’ä¼¤æ‚²ã€‚', author: 'ã€Šé•¿æ­Œè¡Œã€‹' },
  { text: 'å®å‰‘é”‹ä»ç£¨ç ºå‡ºï¼Œæ¢…èŠ±é¦™è‡ªè‹¦å¯’æ¥ã€‚', author: 'ä½šå' },
  { text: 'åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚', author: 'ã€Šè€å­ã€‹' }
]

function Home() {
  const { userInfo } = useAuth()
  const [stats, setStats] = useState({
    todayScore: 0,
    totalQuestions: 0,
    accuracy: 0
  })
  const [quoteIndex, setQuoteIndex] = useState(0)
  const [examCountdown, setExamCountdown] = useState(0)

  // è®¡ç®—è·ç¦»2026å¹´3æœˆ30æ—¥çš„è€ƒè¯•å€’è®¡æ—¶
  const getExamCountdown = () => {
    const examDate = new Date('2026-03-30T00:00:00')
    const today = new Date()
    today.setHours(0, 0, 0, 0)
    const diffTime = examDate.getTime() - today.getTime()
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))
    return diffDays > 0 ? diffDays : 0
  }

  // ç»„ä»¶æŒ‚è½½æ—¶è®¡ç®—å€’è®¡æ—¶
  useEffect(() => {
    setExamCountdown(getExamCountdown())
  }, [])

  // åŠ è½½é¦–é¡µç»Ÿè®¡æ•°æ®
  const loadStats = async () => {
    try {
      const data = await studyService.getHomeStatistics()
      setStats({
        todayScore: data.todayScore || 0,
        totalQuestions: data.totalQuestions || data.todayQuestionCount || 0,
        accuracy: data.accuracy || 0
      })
    } catch (err) {
      console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', err)
    }
  }

  // ç›‘å¬å­¦ä¹ è®°å½•æ›´æ–°äº‹ä»¶
  useEffect(() => {
    const unsubscribe = eventBus.on(EVENTS.STUDY_RECORD_UPDATED, () => {
      loadStats()
    })
    return unsubscribe
  }, [])

  useDidShow(() => {
    loadStats()
  })

  // åè¨€è½®æ’­
  useEffect(() => {
    const timer = setInterval(() => {
      setQuoteIndex((prev) => (prev + 1) % QUOTES.length)
    }, 5000)
    return () => clearInterval(timer)
  }, [])

  // è·å–é—®å€™è¯­
  const getGreeting = () => {
    const hour = new Date().getHours()
    if (hour < 6) return 'å¤œæ·±äº†'
    if (hour < 9) return 'æ—©ä¸Šå¥½'
    if (hour < 12) return 'ä¸Šåˆå¥½'
    if (hour < 14) return 'ä¸­åˆå¥½'
    if (hour < 18) return 'ä¸‹åˆå¥½'
    if (hour < 22) return 'æ™šä¸Šå¥½'
    return 'å¤œæ·±äº†'
  }

  // å­¦ä¹ æ¨¡å—é…ç½®ï¼ˆå¸¦é¢œè‰²ä¸»é¢˜ï¼‰
  const studyModules = [
    { id: 'vocabulary', name: 'è¯æ±‡å­¦ä¹ ', icon: 'ğŸ“–', desc: 'è¯è¯­é‡Šä¹‰ä¸è¿ç”¨', theme: 'blue', path: '/pages/vocabulary/index' },
    { id: 'idiom', name: 'æˆè¯­ç†Ÿè¯­', icon: 'ğŸ¦Š', desc: 'æˆè¯­ç§¯ç´¯ä¸ç»ƒä¹ ', theme: 'orange', path: '/pages/idiom/index' },
    { id: 'pinyin', name: 'æ‹¼éŸ³ç»ƒä¹ ', icon: 'ğŸ”¤', desc: 'æ‹¼éŸ³å£°è°ƒå­¦ä¹ ', theme: 'green', path: '/pages/pinyin/index' },
    { id: 'correction', name: 'ç—…å¥ä¿®æ”¹', icon: 'âœï¸', desc: 'è¯­æ³•ç—…å¥åˆ†æ', theme: 'yellow', path: '/pages/correction/index' }
  ]

  // å¿«æ·åŠŸèƒ½é…ç½®
  const quickActions = [
    { id: 'mock', name: 'æ¨¡æ‹Ÿè€ƒè¯•', icon: 'ğŸ“', desc: 'çœŸé¢˜æ¨¡æ‹Ÿæµ‹è¯•', path: '/pages/mock-exam/index' },
    { id: 'chat', name: 'AIåŠ©æ‰‹', icon: 'ğŸ¤–', desc: 'æ™ºèƒ½ç­”ç–‘è§£æƒ‘', path: '/pages/chat/index' },
    { id: 'record', name: 'å­¦ä¹ è®°å½•', icon: 'ğŸ“Š', desc: 'æŸ¥çœ‹å­¦ä¹ å†å²', path: '/pages/study-record/index' },
    { id: 'report', name: 'å­¦ä¹ æŠ¥å‘Š', icon: 'ğŸ“ˆ', desc: 'å­¦ä¹ æ•°æ®åˆ†æ', path: '/pages/study-report/index' }
  ]

  const handleNavigate = (path) => {
    // chatæ˜¯tabBaré¡µé¢ï¼Œéœ€è¦ä½¿ç”¨switchTab
    if (path.includes('/pages/chat/index')) {
      switchTab({ url: path })
    } else {
      navigateTo({ url: path })
    }
  }

  return (
    <View className="home-page">
      <ScrollView scrollY className="content-scroll">
        {/* å¤´éƒ¨é—®å€™åŒº - è“è‰²æ¸å˜èƒŒæ™¯ */}
        <View className="header-section">
          <View className="header-content">
            {/* å·¦ä¾§å¤´åƒ */}
            <View className="avatar-wrapper">
              {userInfo?.avatar ? (
                <Image src={userInfo.avatar} className="avatar-img" />
              ) : (
                <View className="avatar-default">
                  <Text className="avatar-text">{(userInfo?.nickname || 'åŒå­¦')[0] || 'åŒ'}</Text>
                </View>
              )}
            </View>

            {/* å³ä¾§é—®å€™ */}
            <View className="greeting-wrapper">
              <Text className="greeting-text">{getGreeting()}ï¼Œ{userInfo?.nickname || 'åŒå­¦'}ï¼</Text>
              <Text className="greeting-subtitle">ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å­¦ä¹ å“¦ï¼</Text>
            </View>
          </View>

          {/* è€ƒè¯•å€’è®¡æ—¶æ¨ªå¹… */}
          <View className="study-days-banner">
            <Text className="days-icon">ğŸ“…</Text>
            <Text className="days-text">è·ç¦»è€ƒè¯•è¿˜å‰© {examCountdown} å¤©</Text>
          </View>
        </View>

        {/* ä»Šæ—¥ç»Ÿè®¡å¡ç‰‡ - ç™½è‰²åœ†è§’é˜´å½± */}
        <View className="stats-section">
          <View className="stats-card">
            <View className="stat-item stat-blue">
              <Text className="stat-value">{stats.todayScore}</Text>
              <Text className="stat-label">ä»Šæ—¥å¾—åˆ†</Text>
            </View>
            <View className="stat-divider" />
            <View className="stat-item stat-orange">
              <Text className="stat-value">{stats.totalQuestions}</Text>
              <Text className="stat-label">åšé¢˜æ•°</Text>
            </View>
            <View className="stat-divider" />
            <View className="stat-item stat-green">
              <Text className="stat-value">{stats.accuracy}%</Text>
              <Text className="stat-label">æ­£ç¡®ç‡</Text>
            </View>
          </View>
        </View>

        {/* å­¦ä¹ æ¨¡å— - 2x2ç½‘æ ¼ï¼Œå½©è‰²é¡¶è¾¹ */}
        <View className="section">
          <View className="section-header">
            <Text className="section-title">å­¦ä¹ æ¨¡å—</Text>
            <Text className="section-more">æŸ¥çœ‹å…¨éƒ¨ {'>'}</Text>
          </View>
          <View className="module-grid">
            {studyModules.map((module) => (
              <View
                key={module.id}
                className={`module-item module-${module.theme}`}
                onClick={() => handleNavigate(module.path)}
              >
                <View className="module-border" />
                <View className="module-icon">{module.icon}</View>
                <Text className="module-name">{module.name}</Text>
                <Text className="module-desc">{module.desc}</Text>
              </View>
            ))}
          </View>
        </View>

        {/* å¿«æ·åŠŸèƒ½ - æ¨ªå‘4ä¸ªå…¥å£ */}
        <View className="section">
          <View className="section-header">
            <Text className="section-title">å¿«æ·åŠŸèƒ½</Text>
          </View>
          <View className="quick-grid">
            {quickActions.map((action) => (
              <View
                key={action.id}
                className="quick-item"
                onClick={() => handleNavigate(action.path)}
              >
                <View className="quick-icon">{action.icon}</View>
                <Text className="quick-name">{action.name}</Text>
              </View>
            ))}
          </View>
        </View>

        {/* åè¨€è­¦å¥ - ç´«è‰²æ¸å˜ */}
        <View className="quote-section">
          <View className="quote-card">
            <Text className="quote-icon">ğŸ’­</Text>
            <Text className="quote-text">"{QUOTES[quoteIndex].text}"</Text>
            <Text className="quote-author">â€”â€” {QUOTES[quoteIndex].author}</Text>
            {/* è½®æ’­æŒ‡ç¤ºç‚¹ */}
            <View className="quote-dots">
              {QUOTES.map((_, index) => (
                <View
                  key={index}
                  className={`dot ${index === quoteIndex ? 'dot-active' : ''}`}
                />
              ))}
            </View>
          </View>
        </View>

        {/* åº•éƒ¨ç•™ç™½ */}
        <View style={{ height: '100rpx' }} />
      </ScrollView>
    </View>
  )
}

export default Home


// ===== src/pages/exercise/index.jsx =====
/**
 * ç»ƒä¹ ä¸­å¿ƒ - AIè¯­æ–‡åŠ©æ‰‹
 */
import { useState, useEffect } from 'react'
import { View, Text, ScrollView } from '@tarojs/components'
import { useDidShow, navigateTo } from '@tarojs/taro'
import studyService from '../../services/study'
import eventBus, { EVENTS } from '../../utils/eventBus'
import './index.less'

// é¢˜å‹é…ç½®
const QUESTION_TYPES = [
  { id: 'pinyin', name: 'æ‹¼éŸ³ç»ƒä¹ ', icon: 'ğŸ”¤', desc: 'æ±‰è¯­æ‹¼éŸ³å­¦ä¹ ', color: '#10B981', path: '/pages/pinyin/index' },
  { id: 'idiom', name: 'æˆè¯­ç†Ÿè¯­', icon: 'ğŸ¦Š', desc: 'æˆè¯­ç§¯ç´¯è¿ç”¨', color: '#F59E0B', path: '/pages/idiom/index' },
  { id: 'vocabulary', name: 'è¯æ±‡å­¦ä¹ ', icon: 'ğŸ“–', desc: 'è¯è¯­é‡Šä¹‰è¾¨æ', color: '#4A90E2', path: '/pages/vocabulary/index' },
  { id: 'correction', name: 'ç—…å¥ä¿®æ”¹', icon: 'âœï¸', desc: 'è¯­æ³•ç—…å¥åˆ†æ', color: '#EF4444', path: '/pages/correction/index' }
]

function Exercise() {
  const [questionCounts, setQuestionCounts] = useState({
    pinyin: 0,
    idiom: 0,
    vocabulary: 0,
    correction: 0,
    total: 0
  })
  const [wrongCount, setWrongCount] = useState(0)
  const [favoriteCount, setFavoriteCount] = useState(0)

  // åŠ è½½é¢˜ç›®æ•°é‡ç»Ÿè®¡
  const loadStats = async () => {
    try {
      // è·å–é¢˜åº“æ•°é‡ç»Ÿè®¡
      const stats = await studyService.getHomeStatistics()
      if (stats.progress) {
        setQuestionCounts({
          pinyin: stats.progress.pinyin || 0,
          idiom: stats.progress.idiom || 0,
          vocabulary: stats.progress.vocabulary || 0,
          correction: stats.progress.correction || 0,
          total: (stats.progress.pinyin || 0) + (stats.progress.idiom || 0) +
                 (stats.progress.vocabulary || 0) + (stats.progress.correction || 0)
        })
      }

      // é”™é¢˜æ•°
      setWrongCount(stats.wrongCount || 0)

      // TODO: è·å–æ”¶è—æ•°é‡ï¼ˆå¯ä»¥ä» favorites é›†åˆè·å–ï¼‰
      setFavoriteCount(0)
    } catch (err) {
      console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', err)
    }
  }

  // ç›‘å¬å­¦ä¹ è®°å½•æ›´æ–°äº‹ä»¶
  useEffect(() => {
    const unsubscribe = eventBus.on(EVENTS.STUDY_RECORD_UPDATED, () => {
      loadStats()
    })
    return unsubscribe
  }, [])

  useDidShow(() => {
    loadStats()
  })

  // ç¢ç‰‡åŒ–å­¦ä¹  - 2x2å½©è‰²å¡ç‰‡ï¼ˆä¼ é€’æ­£ç¡®çš„é¢˜ç›®æ•°é‡å‚æ•°ï¼‰
  const fragmentCards = [
    { id: 'speed3', name: 'æé€Ÿ3é¢˜', icon: 'âš¡', duration: '1åˆ†é’Ÿ', gradient: 'orange-red', action: () => navigateTo({ url: '/pages/exercise-detail/index?count=3' }) },
    { id: 'quick5', name: 'å¿«é€Ÿ5é¢˜', icon: 'ğŸš€', duration: '2åˆ†é’Ÿ', gradient: 'cyan-green', action: () => navigateTo({ url: '/pages/exercise-detail/index?count=5' }) },
    { id: 'random10', name: 'éšæœº10é¢˜', icon: 'ğŸ²', duration: '5åˆ†é’Ÿ', gradient: 'green', action: () => navigateTo({ url: '/pages/exercise-detail/index?count=10' }) },
    { id: 'mock', name: 'æ¨¡æ‹Ÿè€ƒè¯•', icon: 'ğŸ“Š', duration: '120åˆ†é’Ÿ', gradient: 'orange-yellow', action: () => navigateTo({ url: '/pages/mock-exam/index' }) }
  ]

  // æ›´å¤šåŠŸèƒ½ - æŒ‡å‘ä¸“é—¨é¡µé¢
  const moreFeatures = [
    { id: 'record', name: 'åšé¢˜è®°å½•', icon: 'ğŸ“‹', desc: 'æŸ¥çœ‹å†å²è®°å½•', path: '/pages/study-record/index' },
    { id: 'wrong', name: 'é”™é¢˜é›†', icon: 'âŒ', desc: 'é”™é¢˜é‡åšç»ƒä¹ ', path: '/pages/wrong-practice/index' },
    { id: 'favorite', name: 'æ”¶è—å¤¹', icon: 'â­', desc: 'æ”¶è—é¢˜ç›®ç»ƒä¹ ', path: '/pages/favorite-practice/index' }
  ]

  return (
    <View className="exercise-page">
      <ScrollView scrollY className="content-scroll">
        {/* ç¢ç‰‡åŒ–å­¦ä¹  - 2x2å½©è‰²å¡ç‰‡ */}
        <View className="fragment-section">
          <View className="section-title-row">
            <Text className="section-icon">ğŸ²</Text>
            <Text className="section-title">ç¢ç‰‡åŒ–å­¦ä¹ </Text>
          </View>
          <View className="fragment-grid">
            {fragmentCards.map((card) => (
              <View
                key={card.id}
                className={`fragment-card fragment-${card.gradient}`}
                onClick={card.action}
              >
                <Text className="fragment-icon">{card.icon}</Text>
                <Text className="fragment-name">{card.name}</Text>
                <Text className="fragment-duration">{card.duration}</Text>
              </View>
            ))}
          </View>
        </View>

        {/* å¤ä¹ ä¸“åŒº */}
        <View className="review-section">
          <View className="section-title-row">
            <Text className="section-icon">ğŸ“š</Text>
            <Text className="section-title">å¤ä¹ ä¸“åŒº</Text>
          </View>
          <View className="review-grid">
            <View
              className="review-item review-wrong"
              onClick={() => navigateTo({ url: '/pages/wrong-practice/index' })}
            >
              <Text className="review-icon">âŒ</Text>
              <Text className="review-name">é”™é¢˜é‡åš</Text>
            </View>
            <View
              className="review-item review-favorite"
              onClick={() => navigateTo({ url: '/pages/favorite-practice/index' })}
            >
              <Text className="review-icon">â­</Text>
              <Text className="review-name">æ”¶è—ç»ƒä¹ </Text>
            </View>
          </View>
        </View>

        {/* é¢˜å‹åˆ†ç±» */}
        <View className="type-section">
          <View className="section-title-row">
            <Text className="section-icon">ğŸ“‹</Text>
            <Text className="section-title">é¢˜å‹åˆ†ç±»</Text>
          </View>
          <View className="type-list">
            {QUESTION_TYPES.map((type) => {
              const count = questionCounts[type.id] || 0
              return (
                <View
                  key={type.id}
                  className="type-item"
                  onClick={() => navigateTo({ url: type.path })}
                >
                  <View className="type-icon-wrapper" style={{ backgroundColor: type.color + '20' }}>
                    <Text className="type-icon">{type.icon}</Text>
                  </View>
                  <View className="type-info">
                    <Text className="type-name">{type.name}</Text>
                    <Text className="type-desc">{type.desc}</Text>
                  </View>
                  <View className="type-badge" style={{ backgroundColor: type.color }}>
                    <Text className="badge-count">{count}</Text>
                  </View>
                  <Text className="type-arrow">â€º</Text>
                </View>
              )
            })}
          </View>
        </View>

        {/* æ›´å¤šåŠŸèƒ½ */}
        <View className="more-section">
          <View className="section-title-row">
            <Text className="section-icon">âš¡</Text>
            <Text className="section-title">æ›´å¤šåŠŸèƒ½</Text>
          </View>
          <View className="more-grid">
            {moreFeatures.map((feature) => (
              <View
                key={feature.id}
                className="more-item"
                onClick={() => navigateTo({ url: feature.path })}
              >
                <View className="more-icon">{feature.icon}</View>
                <Text className="more-name">{feature.name}</Text>
                <Text className="more-desc">{feature.desc}</Text>
              </View>
            ))}
          </View>
        </View>

        {/* åº•éƒ¨ç•™ç™½ */}
        <View style={{ height: '100rpx' }} />
      </ScrollView>
    </View>
  )
}

export default Exercise


// ===== src/pages/exercise-detail/index.jsx =====
/**
 * ç»ƒä¹ è¯¦æƒ…é¡µé¢
 * æ”¯æŒä»é¢˜åº“ä¸­éšæœºæŠ½å–é¢˜ç›®ï¼Œæ¯æ¬¡ç»ƒä¹ é¢˜ç›®ä¸åŒ
 */
import { useState, useEffect } from 'react'
import { View, Text, ScrollView, Radio, Checkbox } from '@tarojs/components'
import Taro, { getCurrentInstance, navigateBack, useDidShow } from '@tarojs/taro'
import questionService from '../../services/question'
import studyService from '../../services/study'
import { QUESTION_TYPES } from '../../utils/constants'
import './index.less'

// æ”¶è—çŠ¶æ€ç¼“å­˜ï¼ˆç”¨äºå­˜å‚¨å½“å‰ç”¨æˆ·å·²æ”¶è—çš„é¢˜ç›®IDï¼‰
let FAVORITES_CACHE = new Set()

// é¢˜åº“æ•°æ®ç¼“å­˜
let ALL_QUESTIONS_CACHE = null

// è·å–æ‰€æœ‰é¢˜ç›®ï¼ˆä»question serviceæˆ–æœ¬åœ°ç”Ÿæˆï¼‰
const getAllQuestions = () => {
  if (ALL_QUESTIONS_CACHE) {
    return ALL_QUESTIONS_CACHE
  }

  // åŸºç¡€é¢˜ç›®
  const baseQuestions = [
    // æ‹¼éŸ³é¢˜
    { id: 'py001', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç‹¡ç‹(nÃ­ng)', 'B. æœºæ¢°(jiÃ¨)', 'C. åŒä»‡æ•Œå¿¾(kÃ i)', 'D. ç·æ±¡(zhÄ“n)'], correctAnswer: 2, explanation: 'Cé¡¹æ³¨éŸ³å®Œå…¨æ­£ç¡®ã€‚' },
    { id: 'py002', type: 'pinyin', question: 'ä¸‹åˆ—è¯è¯­ä¸­åŠ ç‚¹å­—çš„è¯»éŸ³ï¼Œä¸æ‰€ç»™æ³¨éŸ³å…¨éƒ¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¾› gÃ²ng ä¾›ç»™ ä¾›è®¤ ä¾›å“', 'B. è§’ juÃ© è§’è‰² å£è§’ è§’é€', 'C. å¼º qiÃ¡ng å¼ºè¿« å€”å¼º å¼ºå£®', 'D. å¤„ chÇ” å¤„ç† å¤„åˆ† å¤„æ‰€'], correctAnswer: 1, explanation: 'Bé¡¹å…¨éƒ¨è¯»juÃ©ã€‚' },
    { id: 'py003', type: 'pinyin', question: '"å‚"åœ¨"å‚åŠ "ä¸­è¯»ï¼š', options: ['A. cÄ“n', 'B. shÄ“n', 'C. cÄn', 'D. cÄ«'], correctAnswer: 2, explanation: '"å‚"åœ¨"å‚åŠ "ä¸­è¯»cÄnã€‚' },
    { id: 'py004', type: 'pinyin', question: '"è–„"åœ¨"è–„é›¾"ä¸­è¯»ï¼š', options: ['A. bÃ¡o', 'B. bÃ³', 'C. bÃ²', 'D. bÄ“'], correctAnswer: 0, explanation: '"è–„"åœ¨"è–„é›¾"ä¸­è¯»bÃ¡oã€‚' },
    { id: 'py005', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è´®è“„(zhÃ¹) è¡è(hÃ n) é…é…¿(niÃ ng)', 'B. ç²—ç³™(cÄo) ç¡®å‡¿(zÃ¡o) å”¯å¦™å”¯è‚–(xiÃ o)', 'C. è®ªç¬‘(shÃ n) æŒ‘è¡…(xÃ¬n) å“‚ç¬‘(xÄ«)', 'D. åª²ç¾(pÃ¬) ç¼„é»˜(jiÄn) é…·è‚–(xiÃ o)'], correctAnswer: 0, explanation: 'Aé¡¹æ­£ç¡®ã€‚' },
    { id: 'py006', type: 'pinyin', question: '"ç¿˜"åœ¨"ç¿˜é¦–"ä¸­è¯»ï¼š', options: ['A. qiÃ o', 'B. qiÃ¡o', 'C. qiÄo', 'D. qiÃ¼'], correctAnswer: 1, explanation: '"ç¿˜"åœ¨"ç¿˜é¦–"ä¸­è¯»qiÃ¡oã€‚' },
    { id: 'py007', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. èœç•¦(qÃ­) ç¡®å‡¿(zÃ¡o)', 'B. è„‘é«“(suÇ) ä¼›å»(lÇš)', 'C. ç›”ç”²(kuÄ«) éªŠæ­Œ(lÃ­)', 'D. é€¾è¶Š(yÃ¹) æ –æ¯(qÄ«)'], correctAnswer: 1, explanation: 'Bé¡¹"ä¼›å»"çš„"å»"åº”è¯»lÇšã€‚' },
    { id: 'py008', type: 'pinyin', question: '"æ¨¡"åœ¨"æ¨¡æ ·"ä¸­è¯»ï¼š', options: ['A. mÃ³', 'B. mÃº', 'C. mÇ’', 'D. mÃ¹'], correctAnswer: 1, explanation: '"æ¨¡"åœ¨"æ¨¡æ ·"ä¸­è¯»mÃºã€‚' },
    { id: 'py009', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¤¶çš±(zhÄ›) ç‹©çŒ(shÃ²u) èœ·ç¼©(juÇn)', 'B. å—”è§†(chÄ“n) å¨´ç†Ÿ(xiÃ¡n) æƒ©ç½š(chÄ›ng)', 'C. å‰½æ‚(piÄo) æ—–æ—(yÇ) ç•¸å½¢(qÃ­)', 'D. æ°›å›´(fÃ¨n) æ®·çº¢(yÄ«n) é¾Ÿè£‚(jÅ«n)'], correctAnswer: 2, explanation: 'Cé¡¹æ­£ç¡®ã€‚' },
    { id: 'py010', type: 'pinyin', question: '"å’½"åœ¨"ç‹¼åè™å’½"ä¸­è¯»ï¼š', options: ['A. yÃ n', 'B. yÄn', 'C. yÃ¨', 'D. yÄ«n'], correctAnswer: 0, explanation: '"å’½"åœ¨"ç‹¼åè™å’½"ä¸­è¯»yÃ nã€‚' },
    // æˆè¯­é¢˜
    { id: 'cy001', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä¸­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç”µå½±æƒ…èŠ‚è‡ªç›¸çŸ›ç›¾', 'B. æ–‡ç« è§è§£ä¸åŒå‡¡å“', 'C. ç»æµå‘å±•ä¸¾ä¸–ç©ç›®', 'D. å¤±åˆ©åé‡æ•´æ——é¼“'], correctAnswer: 3, explanation: 'Dé¡¹"é‡æ•´æ——é¼“"ä½¿ç”¨æ­£ç¡®ã€‚' },
    { id: 'cy002', type: 'idiom', question: '"ç”»è›‡æ·»è¶³"æ¯”å–»ï¼š', options: ['A. åšäº‹è¦è®¤çœŸ', 'B. åšå¤šä½™çš„äº‹åä¸å¥½', 'C. æŠ“ä½æœºä¼š', 'D. åšæŒåˆ°åº•'], correctAnswer: 1, explanation: '"ç”»è›‡æ·»è¶³"æ¯”å–»åšäº†å¤šä½™çš„äº‹ã€‚' },
    { id: 'cy003', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä½¿ç”¨ä¸æ°å½“çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è„±é¢–è€Œå‡º', 'B. æ„Ÿäººè‚ºè…‘', 'C. åŠé€”è€ŒåºŸã€åšæŒä¸æ‡ˆ', 'D. ç‹¬å…·åŒ å¿ƒ'], correctAnswer: 2, explanation: 'Cé¡¹"åšæŒä¸æ‡ˆ"ä¸èƒ½å½¢å®¹"åŠé€”è€ŒåºŸ"ã€‚' },
    { id: 'cy004', type: 'idiom', question: '"å®ˆæ ªå¾…å…”"æ¯”å–»ï¼š', options: ['A. å–„äºè§‚å¯Ÿ', 'B. æ­»å®ˆä¸çŸ¥å˜é€š', 'C. æœ‰è€å¿ƒ', 'D. è¿æ°”é‡è¦'], correctAnswer: 1, explanation: '"å®ˆæ ªå¾…å…”"æ¯”å–»æ­»å®ˆç»éªŒä¸çŸ¥å˜é€šã€‚' },
    { id: 'cy005', type: 'idiom', question: '"äº¡ç¾Šè¡¥ç‰¢"çš„æ„æ€æ˜¯ï¼š', options: ['A. ç¾Šä¸¢äº†ä¸æ‰¾', 'B. å‡ºé—®é¢˜åè¡¥æ•‘', 'C. ä¿®ç†ç¾Šåœˆ', 'D. é¢„é˜²é—®é¢˜'], correctAnswer: 1, explanation: '"äº¡ç¾Šè¡¥ç‰¢"æ¯”å–»å‡ºäº†é—®é¢˜åŠæ—¶è¡¥æ•‘ã€‚' },
    { id: 'cy006', type: 'idiom', question: '"å¤¸å¤¸å…¶è°ˆ"çš„æ„æ€æ˜¯ï¼š', options: ['A. è¯´è¯å¥½å¬', 'B. æµ®å¤¸ä¸å®é™…', 'C. å¤¸å¥–åˆ«äºº', 'D. è°ˆè®ºå¤¸å¤¸'], correctAnswer: 1, explanation: '"å¤¸å¤¸å…¶è°ˆ"å½¢å®¹è¯´è¯æµ®å¤¸ã€‚' },
    { id: 'cy007', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å·§å¤ºå¤©å…¬', 'B. è¿«ä¸æ€¥å¾…', 'C. è°ˆç¬‘é£ç”Ÿ', 'D. å†æ¥å†åŠ±'], correctAnswer: 2, explanation: 'Cé¡¹æ­£ç¡®ã€‚' },
    { id: 'cy008', type: 'idiom', question: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»ï¼š', options: ['A. å¿ƒé‡Œæœ‰ç«¹å­', 'B. åšäº‹æœ‰æŠŠæ¡', 'C. å–œæ¬¢ç”»ç”»', 'D. èƒ¸éƒ¨å®½å¹¿'], correctAnswer: 1, explanation: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»åšäº‹æœ‰æŠŠæ¡ã€‚' },
    { id: 'cy009', type: 'idiom', question: 'ä¸‹åˆ—åŠ ç‚¹æˆè¯­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä»–åšäº‹ä¸€ä¸ä¸è‹Ÿ', 'B. è¿™æ¬¡ä¼šè®®ä¸‡äººç©ºå··', 'C. ä»–æ€»æ˜¯è¢–æ‰‹æ—è§‚', 'D. è¿™ç¯‡æ–‡ç« åˆ«å‡ºå¿ƒè£'], correctAnswer: 0, explanation: 'Aé¡¹"ä¸€ä¸ä¸è‹Ÿ"ä½¿ç”¨æ­£ç¡®ã€‚' },
    { id: 'cy010', type: 'idiom', question: '"æ´¥æ´¥æœ‰å‘³"çš„æ„æ€æ˜¯ï¼š', options: ['A. å‘³é“å¥½', 'B. å…´è¶£æµ“åš', 'C. æ´¥æ´¥æœ‰å‘³', 'D. å¾ˆæœ‰å‘³é“'], correctAnswer: 1, explanation: '"æ´¥æ´¥æœ‰å‘³"å½¢å®¹å…´è¶£æµ“åšã€‚' },
    // è¯æ±‡é¢˜
    { id: 'vo001', type: 'vocabulary', question: '"å§¹ç´«å«£çº¢"çš„æ„æ€æ˜¯ï¼š', options: ['A. é¢œè‰²å•ä¸€', 'B. å„ç§èŠ±æœµå¨‡è‰³', 'C. ç´«è‰²çº¢è‰²', 'D. èŠ±æœµå‡‹é›¶'], correctAnswer: 1, explanation: '"å§¹ç´«å«£çº¢"å½¢å®¹å„ç§é¢œè‰²èŠ±æœµå¨‡è‰³ã€‚' },
    { id: 'vo002', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å†æ¥å†åŠ±', 'B. è°ˆç¬‘é£ç”Ÿ', 'C. å·§å¤ºå¤©å…¬', 'D. è¿«ä¸æ€¥å¾…'], correctAnswer: 1, explanation: 'Bé¡¹æ­£ç¡®ã€‚' },
    { id: 'vo003', type: 'vocabulary', question: '"ç¾è½®ç¾å¥‚"å½¢å®¹ï¼š', options: ['A. ç¾ä¸½é£æ™¯', 'B. é«˜å¤§åä¸½å»ºç­‘', 'C. ç¾ä¸½çš„äºº', 'D. ç¾å¥½éŸ³ä¹'], correctAnswer: 1, explanation: '"ç¾è½®ç¾å¥‚"å½¢å®¹æˆ¿å±‹é«˜å¤§åä¸½ã€‚' },
    { id: 'vo004', type: 'vocabulary', question: '"é³æ¬¡æ ‰æ¯”"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ’åˆ—å¯†', 'B. é±¼å’Œæ¢³å­', 'C. æ¬¡åºæ··ä¹±', 'D. æ•´é½ç¨€ç–'], correctAnswer: 0, explanation: '"é³æ¬¡æ ‰æ¯”"å½¢å®¹å»ºç­‘ç‰©æ’åˆ—å¯†æ•´ã€‚' },
    { id: 'vo005', type: 'vocabulary', question: '"å·æµä¸æ¯"çš„"å·"æ„æ€æ˜¯ï¼š', options: ['A. å±±å·', 'B. æ²³æµ', 'C. å¹³åŸ', 'D. é“è·¯'], correctAnswer: 1, explanation: '"å·"æŒ‡æ²³æµã€‚' },
    { id: 'vo006', type: 'vocabulary', question: '"å› åœ°åˆ¶å®œ"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ ¹æ®å½“åœ°åˆ¶å®šæªæ–½', 'B. æ”¹é€ ç¯å¢ƒ', 'C. é€‚åº”ç¯å¢ƒ', 'D. æ”¹å˜åˆ¶åº¦'], correctAnswer: 0, explanation: '"å› åœ°åˆ¶å®œ"æŒ‡æ ¹æ®æƒ…å†µåˆ¶å®šåŠæ³•ã€‚' },
    { id: 'vo007', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­è§£é‡Šæœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‡›å†½ï¼šå¯’å†·', 'B. é€¶è¿¤ï¼šå¼¯æ›²', 'C. å¦¥å¸–ï¼šæ°å½“', 'D. ä¿¨ç„¶ï¼šä¸¥è‚ƒ'], correctAnswer: 3, explanation: 'Dé¡¹"ä¿¨ç„¶"ä¸»è¦æŒ‡å¾ˆåƒã€‚' },
    { id: 'vo008', type: 'vocabulary', question: '"ä¸å¯æ€è®®"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ— æ³•æƒ³è±¡', 'B. ä¸å¯è®®è®º', 'C. å¾ˆç¥å¥‡', 'D. ä¸è®²ç†'], correctAnswer: 0, explanation: '"ä¸å¯æ€è®®"å½¢å®¹éš¾ä»¥æƒ³è±¡ã€‚' },
    { id: 'vo009', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç„•ç„¶ä¸€æ–°', 'B. è°ˆç¬‘é£å£°', 'C. è¿«ä¸æ€¥å¾…', 'D. å†æ¥å†åŠ±'], correctAnswer: 0, explanation: 'Aé¡¹æ­£ç¡®ã€‚' },
    { id: 'vo010', type: 'vocabulary', question: '"æŠ‘æ‰¬é¡¿æŒ«"å½¢å®¹ï¼š', options: ['A. å£°éŸ³é«˜ä½èµ·ä¼', 'B. æŠ‘åˆ¶', 'C. æŒ«æŠ˜', 'D. åœé¡¿'], correctAnswer: 0, explanation: '"æŠ‘æ‰¬é¡¿æŒ«"å½¢å®¹å£°éŸ³é«˜ä½èµ·ä¼å’Œè°ã€‚' },
    // ç—…å¥é¢˜
    { id: 'bc001', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é€šè¿‡æ´»åŠ¨ï¼Œä½¿æˆ‘æ˜ç™½', 'B. æ€åº¦ç«¯æ­£ï¼Œæˆç»©æé«˜', 'C. æ‰“æ‰«æ•™å®¤å«ç”Ÿ', 'D. æ”¹è¿›æ–¹æ³•ï¼Œå¢åŠ æ•ˆç‡'], correctAnswer: 1, explanation: 'Bé¡¹æ— è¯­ç—…ã€‚' },
    { id: 'bc002', type: 'correction', question: '"å¢åŠ æ•ˆç‡"çš„é”™è¯¯ç±»å‹æ˜¯ï¼š', options: ['A. è¯­åºä¸å½“', 'B. æ­é…ä¸å½“', 'C. æˆåˆ†æ®‹ç¼º', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, explanation: '"å¢åŠ "ä¸"æ•ˆç‡"æ­é…ä¸å½“ã€‚' },
    { id: 'bc003', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŒ—äº¬ç§‹å¤©ç¾ä¸½', 'B. æ–‡ç« è§‚ç‚¹æ·±åˆ»', 'C. ç©¿ç€ä¸Šè¡£æˆ´å¸½å­', 'D. å…»æˆå­¦ä¹ ä¹ æƒ¯'], correctAnswer: 2, explanation: 'Cé¡¹æ­é…ä¸å½“ã€‚' },
    { id: 'bc004', type: 'correction', question: '"é€šè¿‡å­¦ä¹ ï¼Œä½¿æˆ‘å—ç›Š"ç—…å› æ˜¯ï¼š', options: ['A. æˆåˆ†æ®‹ç¼º', 'B. æ­é…ä¸å½“', 'C. è¯­åºä¸å½“', 'D. ç»“æ„æ··ä¹±'], correctAnswer: 0, explanation: 'æ»¥ç”¨ä»‹è¯å¯¼è‡´ä¸»è¯­ç¼ºå¤±ã€‚' },
    { id: 'bc005', type: 'correction', question: 'ä¿®æ”¹"ç¨»ç±³æ˜¯ä¸»è¦ç²®é£Ÿ"æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. ç¨»ç±³æ˜¯ç²®é£Ÿ', 'B. ç¨»ç±³æ˜¯ç²®é£Ÿä½œç‰©', 'C. ç²®é£Ÿæ˜¯ç¨»ç±³', 'D. ç¨»ç±³æ˜¯ä¸»è¦'], correctAnswer: 1, explanation: 'åº”æ”¹ä¸º"ç¨»ç±³æ˜¯ç²®é£Ÿä½œç‰©"ã€‚' },
    { id: 'bc006', type: 'correction', question: 'ä¸‹åˆ—æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ–‡ç« å¯¹æˆ‘æœ‰å…´è¶£', 'B. æˆ‘å¯¹æ–‡ç« æœ‰å…´è¶£', 'C. æ–‡ç« å¼•èµ·å…´è¶£', 'D. æ–‡ç« è®©æˆ‘æ„Ÿå…´è¶£'], correctAnswer: 2, explanation: 'Cé¡¹æ— è¯­ç—…ã€‚' },
    { id: 'bc007', type: 'correction', question: '"å³ä½¿é‡åˆ°æŒ«æŠ˜ï¼Œä¹Ÿè¦åšæŒ"ï¼š', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…', 'C. ç¼ºä¸»è¯­', 'D. æ­é…ä¸å½“'], correctAnswer: 1, explanation: 'è¿™å¥è¯æ— è¯­ç—…ã€‚' },
    { id: 'bc008', type: 'correction', question: 'ä¸‹åˆ—æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŸ¹å…»ä¹ æƒ¯', 'B. æ˜ç™½é“ç†', 'C. åŠªåŠ›å–å¾—æˆç»©', 'D. ä½œè€…æ˜¯é²è¿…å†™çš„'], correctAnswer: 3, explanation: 'Dé¡¹å¥å¼æ‚ç³…ã€‚' },
    { id: 'bc009', type: 'correction', question: 'ä¸‹åˆ—å¥å­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é€šè¿‡å­¦ä¹ ä½¿æˆ‘è¿›æ­¥', 'B. ä»–è¿›æ­¥äº†', 'C. ä»–ç©¿ç€è¡£æœå’Œå¸½å­', 'D. æé«˜å·¥ä½œæ•ˆç‡'], correctAnswer: 3, explanation: 'Dé¡¹æ— è¯­ç—…ã€‚' },
    { id: 'bc010', type: 'correction', question: '"è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯é²è¿…å†™çš„"ç—…å› æ˜¯ï¼š', options: ['A. æˆåˆ†æ®‹ç¼º', 'B. å¥å¼æ‚ç³…', 'C. æ­é…ä¸å½“', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, explanation: 'å¥å¼æ‚ç³…ã€‚' },
    // å¤è¯—è¯é¢˜
    { id: 'gs001', type: 'literature', question: '"é‡‡èŠä¸œç¯±ä¸‹ï¼Œæ‚ ç„¶è§å—å±±"å‡ºè‡ªè°ï¼š', options: ['A. æç™½', 'B. æœç”«', 'C. é™¶æ¸Šæ˜', 'D. ç‹ç»´'], correctAnswer: 2, explanation: 'é™¶æ¸Šæ˜ã€Šé¥®é…’ã€‹ã€‚' },
    { id: 'gs002', type: 'literature', question: '"æµ·å†…å­˜çŸ¥å·±ï¼Œå¤©æ¶¯è‹¥æ¯”é‚»"å‡ºè‡ªï¼š', options: ['A. ç‹å‹ƒ', 'B. æç™½', 'C. ç‹ç»´', 'D. æœç”«'], correctAnswer: 0, explanation: 'ç‹å‹ƒã€Šé€æœå°‘åºœä¹‹ä»»èœ€å·ã€‹ã€‚' },
    { id: 'gs003', type: 'literature', question: '"æ˜¥çœ ä¸è§‰æ™“"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. èŠ±è½çŸ¥å¤šå°‘', 'B. å¤„å¤„é—»å•¼é¸Ÿ', 'C. å¤œæ¥é£é›¨å£°', 'D. æ±Ÿæ¸…æœˆè¿‘äºº'], correctAnswer: 1, explanation: '"æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿ"ã€‚' },
    { id: 'gs004', type: 'literature', question: '"ä½†æ„¿äººé•¿ä¹…"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. åƒé‡Œå…±å©µå¨Ÿ', 'B. æ˜æœˆå‡ æ—¶æœ‰', 'C. æŠŠé…’é—®é’å¤©', 'D. ä½•ä¼¼åœ¨äººé—´'], correctAnswer: 0, explanation: '"ä½†æ„¿äººé•¿ä¹…ï¼Œåƒé‡Œå…±å©µå¨Ÿ"ã€‚' },
    { id: 'gs005', type: 'literature', question: '"ä¼šå½“å‡Œç»é¡¶"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. ä¸€è§ˆä¼—å±±å°', 'B. é€ åŒ–é’Ÿç¥ç§€', 'C. å†³çœ¦å…¥å½’é¸Ÿ', 'D. è¡èƒ¸ç”Ÿå±‚äº‘'], correctAnswer: 0, explanation: '"ä¼šå½“å‡Œç»é¡¶ï¼Œä¸€è§ˆä¼—å±±å°ã€‹ã€‚' },
    { id: 'gs006', type: 'literature', question: '"äººç”Ÿè‡ªå¤è°æ— æ­»"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. ç•™å–ä¸¹å¿ƒç…§æ±—é’', 'B. èº«ä¸–æµ®æ²‰é›¨æ‰“è', 'C. æƒ¶ææ»©å¤´è¯´æƒ¶æ', 'D. å¹²æˆˆå¯¥è½å››å‘¨æ˜Ÿ'], correctAnswer: 0, explanation: 'æ–‡å¤©ç¥¥ã€Šè¿‡é›¶ä¸æ´‹ã€‹ã€‚' },
    { id: 'gs007', type: 'literature', question: '"è½çº¢ä¸æ˜¯æ— æƒ…ç‰©"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. åŒ–ä½œæ˜¥æ³¥æ›´æŠ¤èŠ±', 'B. æµ©è¡ç¦»æ„ç™½æ—¥æ–œ', 'C. åŸé­ä¸œæŒ‡å³å¤©æ¶¯', 'D. ä¼´æˆ‘ç›´åˆ° Subcommittee'], correctAnswer: 0, explanation: 'é¾šè‡ªçã€Šå·±äº¥æ‚è¯—ã€‹ã€‚' },
    { id: 'gs008', type: 'literature', question: '"å¤§æ¼ å­¤çƒŸç›´"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. é•¿æ²³è½æ—¥åœ†', 'B. è§å…³é€¢å€™éª‘', 'C. éƒ½æŠ¤åœ¨ç‡•ç„¶', 'D. å¾è“¬å‡ºæ±‰å¡'], correctAnswer: 0, explanation: 'ç‹ç»´ã€Šä½¿è‡³å¡ä¸Šã€‹ã€‚' },
    { id: 'gs009', type: 'literature', question: '"å•†å¥³ä¸çŸ¥äº¡å›½æ¨"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. éš”æ±ŸçŠ¹å”±ååº­èŠ±', 'B. çƒŸç¬¼å¯’æ°´æœˆç¬¼æ²™', 'C. å¤œæ³Šç§¦æ·®è¿‘é…’å®¶', 'D. ä¸‰å±±åŠè½é’å¤©å¤–'], correctAnswer: 0, explanation: 'æœç‰§ã€Šæ³Šç§¦æ·®ã€‹ã€‚' },
    { id: 'gs010', type: 'literature', question: '"å±±é‡æ°´å¤ç–‘æ— è·¯"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. æŸ³æš—èŠ±æ˜åˆä¸€æ‘', 'B. ä¸°å¹´ç•™å®¢è¶³é¸¡è±š', 'C. å±±é‡æ°´å¤ç–‘æ— è·¯', 'D. æŸ³æš—èŠ±æ˜'], correctAnswer: 0, explanation: 'é™†æ¸¸ã€Šæ¸¸å±±è¥¿æ‘ã€‹ã€‚' }
  ]

  // ç”Ÿæˆæ‰©å±•é¢˜ç›®
  const extendedQuestions = generateExtendedQuestions()

  ALL_QUESTIONS_CACHE = [...baseQuestions, ...extendedQuestions]
  return ALL_QUESTIONS_CACHE
}

// ç”Ÿæˆæ‰©å±•é¢˜ç›®ï¼ˆå¸¦çœŸå®å¹²æ‰°é¡¹ï¼‰
const generateExtendedQuestions = () => {
  const questions = []
  let id = 200

  // å¤šéŸ³å­—é¢˜åº“
  const polyphones = [
    { char: 'å®¿', words: ['å®¿èˆ', 'æ˜Ÿå®¿', 'ä¿ç•™'], readings: ['sÃ¹', 'xiÃ¹', 'xiÇ”'] },
    { char: 'èˆ', words: ['å®¿èˆ', 'èˆå¼ƒ', 'æ–½èˆ'], readings: ['shÃ¨', 'shÄ›', 'shÄ›'] },
    { char: 'å¼º', words: ['åšå¼º', 'å€”å¼º', 'å¼ºè¿«'], readings: ['qiÃ¡ng', 'jiÃ ng', 'qiÇng'] },
    { char: 'å‚', words: ['å‚åŠ ', 'äººå‚', 'å‚å·®'], readings: ['cÄn', 'shÄ“n', 'cÄ“n'] },
    { char: 'è–„', words: ['è–„å¼±', 'è–„è·', 'è–„é›¾'], readings: ['bÃ³', 'bÃ²', 'bÃ¡o'] },
    { char: 'æ¨¡', words: ['æ¨¡èŒƒ', 'æ¨¡æ ·', 'æ¨¡å…·'], readings: ['mÃ³', 'mÃº', 'mÃº'] },
    { char: 'å’½', words: ['å’½å–‰', 'åå’½', 'å‘œå’½'], readings: ['yÄn', 'yÃ n', 'yÃ¨'] },
    { char: 'æ³Š', words: ['åœæ³Š', 'æ¹–æ³Š', 'æ¼‚æ³Š'], readings: ['bÃ³', 'pÅ', 'bÃ³'] },
    { char: 'è§’', words: ['è§’è‰²', 'å£è§’', 'è§’é€'], readings: ['juÃ©', 'jiÇo', 'juÃ©'] },
    { char: 'ç››', words: ['ç››å¤§', 'ç››é¥­', 'ç››æ»¡'], readings: ['shÃ¨ng', 'chÃ©ng', 'chÃ©ng'] }
  ]

  polyphones.forEach(p => {
    questions.push({
      id: `py${id++}`,
      type: 'pinyin',
      question: `"${p.char}"åœ¨"${p.words[1]}"ä¸­è¯»ï¼š`,
      options: [`A. ${p.readings[0]}`, `B. ${p.readings[1]}`, `C. ${p.readings[2]}`, `D. ${p.readings[0]}`],
      correctAnswer: 1,
      explanation: `"${p.char}"åœ¨"${p.words[1]}"ä¸­è¯»${p.readings[1]}ã€‚`
    })
  })

  // æˆè¯­é¢˜åº“
  const idioms = [
    { name: 'é”¦ä¸Šæ·»èŠ±', meaning: 'æ¯”å–»å¥½ä¸ŠåŠ å¥½ï¼Œç¾ä¸ŠåŠ ç¾' },
    { name: 'é›ªä¸­é€ç‚­', meaning: 'æ¯”å–»åœ¨æ€¥éœ€æ—¶ç»™ä»¥ç‰©è´¨ä¸Šæˆ–ç²¾ç¥ä¸Šçš„å¸®åŠ©' },
    { name: 'çº¸ä¸Šè°ˆå…µ', meaning: 'æ¯”å–»ç©ºè°ˆç†è®ºï¼Œä¸èƒ½è§£å†³å®é™…é—®é¢˜' },
    { name: 'åˆ»èˆŸæ±‚å‰‘', meaning: 'æ¯”å–»æ‹˜æ³¥æˆæ³•ï¼Œä¸çŸ¥é“å˜é€š' },
    { name: 'å—è¾•åŒ—è¾™', meaning: 'æ¯”å–»è¡ŒåŠ¨å’Œç›®çš„æ­£å¥½ç›¸å' },
    { name: 'ä¸€é¸£æƒŠäºº', meaning: 'æ¯”å–»å¹³æ—¶æ²¡æœ‰ç‰¹æ®Šè¡¨ç°ï¼Œä¸€åšèµ·æ¥å°±æœ‰æƒŠäººçš„æˆç»©' },
    { name: 'ä¸‰é¡¾èŒ…åº', meaning: 'æ¯”å–»è¯šå¿ƒè¯šæ„åœ°é‚€è¯·äººå®¶' },
    { name: 'è´Ÿè†è¯·ç½ª', meaning: 'è¡¨ç¤ºå‘äººè®¤é”™èµ”ç½ª' },
    { name: 'å®Œç’§å½’èµµ', meaning: 'æ¯”å–»æŠŠç‰©å“å®Œå¥½åœ°å½’è¿˜ç»™ç‰©å“çš„ä¸»äºº' },
    { name: 'ç¨‹é—¨ç«‹é›ª', meaning: 'å½¢å®¹å°Šå¸ˆé‡é“ï¼Œè™”è¯šæ±‚æ•™' },
    { name: 'é—»é¸¡èµ·èˆ', meaning: 'æ¯”å–»æœ‰å¿—æŠ¥å›½çš„äººåŠæ—¶å¥‹èµ·' },
    { name: 'å…¥æœ¨ä¸‰åˆ†', meaning: 'å½¢å®¹ä¹¦æ³•ææœ‰ç¬”åŠ›ï¼Œç°å¤šæ¯”å–»åˆ†æé—®é¢˜å¾ˆæ·±åˆ»' },
    { name: 'æœ›æ´‹å…´å¹', meaning: 'æ¯”å–»åšäº‹æ—¶å› åŠ›ä¸èƒœä»»æˆ–æ²¡æœ‰æ¡ä»¶è€Œæ„Ÿåˆ°æ— å¯å¥ˆä½•' },
    { name: 'å¶å…¬å¥½é¾™', meaning: 'æ¯”å–»å£å¤´ä¸Šè¯´çˆ±å¥½æŸäº‹ç‰©ï¼Œå®é™…ä¸Šå¹¶ä¸çœŸçˆ±å¥½' },
    { name: 'é»”é©´æŠ€ç©·', meaning: 'æ¯”å–»æœ‰é™çš„ä¸€ç‚¹æœ¬é¢†ä¹Ÿå·²ç»ç”¨å®Œäº†' },
    { name: 'æäººå¿§å¤©', meaning: 'æ¯”å–»ä¸å¿…è¦çš„æˆ–ç¼ºä¹æ ¹æ®çš„å¿§è™‘å’Œæ‹…å¿ƒ' },
    { name: 'æ¯å¼“è›‡å½±', meaning: 'æ¯”å–»å› ç–‘ç¥ç–‘é¬¼è€Œå¼•èµ·ææƒ§' },
    { name: 'å¯¹ç‰›å¼¹ç´', meaning: 'æ¯”å–»å¯¹ä¸è®²é“ç†çš„äººè®²é“ç†' },
    { name: 'æŒ‡é¹¿ä¸ºé©¬', meaning: 'æ¯”å–»æ•…æ„é¢ å€’é»‘ç™½ï¼Œæ··æ·†æ˜¯é' },
    { name: 'ç”»é¾™ç‚¹ç›', meaning: 'æ¯”å–»åœ¨å…³é”®å¤„åŠ ä¸Šä¸€ç¬”ï¼Œä½¿å†…å®¹æ›´ç”ŸåŠ¨ä¼ ç¥' }
  ]

  idioms.forEach(i => {
    // ç”Ÿæˆæ··æ·†é€‰é¡¹
    const wrongOptions = idioms
      .filter(x => x.name !== i.name)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.meaning)

    // æ‰“ä¹±é€‰é¡¹é¡ºåº
    const allOptions = [i.meaning, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(i.meaning)

    questions.push({
      id: `cy${id++}`,
      type: 'idiom',
      question: `"${i.name}"çš„æ„æ€æ˜¯ï¼š`,
      options: allOptions.map((opt, idx) => `ABCD`[idx] + `. ${opt}`),
      correctAnswer: correctIndex,
      explanation: i.meaning
    })
  })

  // è¯æ±‡é¢˜åº“
  const vocabWords = [
    { word: 'ç„•ç„¶ä¸€æ–°', error: 'æ¢ç„¶ä¸€æ–°' },
    { word: 'è°ˆç¬‘é£ç”Ÿ', error: 'è°ˆç¬‘é£å£°' },
    { word: 'è¿«åœ¨çœ‰ç«', error: 'è¿«åœ¨çœ‰æ·' },
    { word: 'å†æ¥å†å‰', error: 'å†æ¥å†åŠ±' },
    { word: 'ç›¸å¾—ç›Šå½°', error: 'ç›¸å¾—ç›Šç« ' },
    { word: 'éœ‡è€³æ¬²è‹', error: 'æŒ¯è€³æ¬²è‹' },
    { word: 'éƒ‘é‡å…¶äº‹', error: 'éƒ‘é‡å…¶æ˜¯' },
    { word: 'æ¼«ä¸ç»å¿ƒ', error: 'æ…¢ä¸ç»å¿ƒ' },
    { word: 'æƒŠæ…Œå¤±æª', error: 'æƒŠæ…Œå¤±é”™' },
    { word: 'åˆ«å‡ºå¿ƒè£', error: 'åˆ«å‡ºæ–°è£' },
    { word: 'å†å†åœ¨ç›®', error: 'å†å†åœ¨æœ¨' },
    { word: 'ç»œç»ä¸ç»', error: 'è½ç»ä¸ç»' },
    { word: 'éšå£°é™„å’Œ', error: 'éšå£°é™„åˆ' },
    { word: 'å› åœ°åˆ¶å®œ', error: 'å› è‡³åˆ¶å®œ' },
    { word: 'é³æ¬¡æ ‰æ¯”', error: 'é³æ¬¡æ ‰æ­¤' },
    { word: 'æŠ‘æ‰¬é¡¿æŒ«', error: 'æŠ‘æ‰¬é¡¿æª' },
    { word: 'ç›¸æ¿¡ä»¥æ²«', error: 'ç›¸å„’ä»¥æ²«' },
    { word: 'ä¸å¯æ€è®®', error: 'ä¸å¯æ€ä¹‰' },
    { word: 'å§¹ç´«å«£çº¢', error: 'è¯§ç´«å«£çº¢' },
    { word: 'æµè¿å¿˜è¿”', error: 'ç•™è¿å¿˜è¿”' }
  ]

  vocabWords.forEach((v, idx) => {
    // ç”Ÿæˆæ··æ·†é€‰é¡¹
    const wrongOptions = vocabWords
      .filter((x, i) => i !== idx)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.word)

    // æ‰“ä¹±é€‰é¡¹é¡ºåº
    const allOptions = [v.word, v.error, ...wrongOptions.slice(0, 2)].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(v.word)

    questions.push({
      id: `vo${id++}`,
      type: 'vocabulary',
      question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š',
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      explanation: `${`ABCD`[correctIndex]}é¡¹"${v.word}"æ­£ç¡®ã€‚`
    })
  })

  // ç—…å¥é¢˜åº“
  const errorTypes = [
    { type: 'æˆåˆ†æ®‹ç¼º', example: 'é€šè¿‡å­¦ä¹ ï¼Œä½¿æˆ‘å—ç›Š' },
    { type: 'æ­é…ä¸å½“', example: 'å¢åŠ æ•ˆç‡' },
    { type: 'å¥å¼æ‚ç³…', example: 'è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯é²è¿…å†™çš„' },
    { type: 'è¡¨æ„ä¸æ˜', example: 'ä¸¤ä¸ªå­¦æ ¡çš„è€å¸ˆéƒ½æ¥äº†' },
    { type: 'è¯­åºä¸å½“', example: 'åšç‰©é¦†å±•å‡ºäº†ä¸¤åƒå¤šå¹´å‰æ–°å‡ºåœŸçš„æ–‡ç‰©' },
    { type: 'å¦å®šå¤±å½“', example: 'é˜²æ­¢ä¸è¦å‘ç”Ÿäº‹æ•…' },
    { type: 'æˆåˆ†èµ˜ä½™', example: 'å¤§çº¦10ä¸ªå·¦å³' },
    { type: 'ä¸»å®¢é¢ å€’', example: 'è¿™ç¯‡æ–‡ç« å¯¹æˆ‘å¾ˆæ„Ÿå…´è¶£' }
  ]

  errorTypes.forEach((e, idx) => {
    // ç”Ÿæˆæ··æ·†é€‰é¡¹
    const wrongOptions = errorTypes
      .filter((x, i) => i !== idx)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.type)

    // æ‰“ä¹±é€‰é¡¹é¡ºåº
    const allOptions = [e.type, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(e.type)

    questions.push({
      id: `bc${id++}`,
      type: 'correction',
      question: `"${e.example}"çš„ç—…å› æ˜¯ï¼š`,
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      explanation: `${e.type}ã€‚`
    })
  })

  // å¤è¯—è¯é¢˜åº“
  const poems = [
    { q: 'ç™½æ—¥ä¾å±±å°½', a: 'é»„æ²³å…¥æµ·æµ', author: 'ç‹ä¹‹æ¶£', title: 'ç™»é¹³é›€æ¥¼' },
    { q: 'æ¬²ç©·åƒé‡Œç›®', a: 'æ›´ä¸Šä¸€å±‚æ¥¼', author: 'ç‹ä¹‹æ¶£', title: 'ç™»é¹³é›€æ¥¼' },
    { q: 'åºŠå‰æ˜æœˆå…‰', a: 'ç–‘æ˜¯åœ°ä¸Šéœœ', author: 'æç™½', title: 'é™å¤œæ€' },
    { q: 'ä¸¾å¤´æœ›æ˜æœˆ', a: 'ä½å¤´æ€æ•…ä¹¡', author: 'æç™½', title: 'é™å¤œæ€' },
    { q: 'åŠå›æ›´å°½ä¸€æ¯é…’', a: 'è¥¿å‡ºé˜³å…³æ— æ•…äºº', author: 'ç‹ç»´', title: 'é€å…ƒäºŒä½¿å®‰è¥¿' },
    { q: 'æ¡ƒèŠ±æ½­æ°´æ·±åƒå°º', a: 'ä¸åŠæ±ªä¼¦é€æˆ‘æƒ…', author: 'æç™½', title: 'èµ æ±ªä¼¦' },
    { q: 'è«æ„å‰è·¯æ— çŸ¥å·±', a: 'å¤©ä¸‹è°äººä¸è¯†å›', author: 'é«˜é€‚', title: 'åˆ«è‘£å¤§' },
    { q: 'å¤œæ¥é£é›¨å£°', a: 'èŠ±è½çŸ¥å¤šå°‘', author: 'å­Ÿæµ©ç„¶', title: 'æ˜¥æ™“' },
    { q: 'å›½ç ´å±±æ²³åœ¨', a: 'åŸæ˜¥è‰æœ¨æ·±', author: 'æœç”«', title: 'æ˜¥æœ›' },
    { q: 'æ„Ÿæ—¶èŠ±æº…æ³ª', a: 'æ¨åˆ«é¸ŸæƒŠå¿ƒ', author: 'æœç”«', title: 'æ˜¥æœ›' },
    { q: 'çƒ½ç«è¿ä¸‰æœˆ', a: 'å®¶ä¹¦æŠµä¸‡é‡‘', author: 'æœç”«', title: 'æ˜¥æœ›' },
    { q: 'å­¤å¸†è¿œå½±ç¢§ç©ºå°½', a: 'å”¯è§é•¿æ±Ÿå¤©é™…æµ', author: 'æç™½', title: 'é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶ä¹‹å¹¿é™µ' },
    { q: 'æ˜æœˆå‡ æ—¶æœ‰', a: 'æŠŠé…’é—®é’å¤©', author: 'è‹è½¼', title: 'æ°´è°ƒæ­Œå¤´' },
    { q: 'æˆ‘æ¬²ä¹˜é£å½’å»', a: 'åˆæç¼æ¥¼ç‰å®‡', author: 'è‹è½¼', title: 'æ°´è°ƒæ­Œå¤´' },
    { q: 'äººæœ‰æ‚²æ¬¢ç¦»åˆ', a: 'æœˆæœ‰é˜´æ™´åœ†ç¼º', author: 'è‹è½¼', title: 'æ°´è°ƒæ­Œå¤´' }
  ]

  poems.forEach((p, idx) => {
    // ç”Ÿæˆæ··æ·†é€‰é¡¹
    const wrongOptions = poems
      .filter((x, i) => i !== idx)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.a)

    // æ‰“ä¹±é€‰é¡¹é¡ºåº
    const allOptions = [p.a, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(p.a)

    questions.push({
      id: `gs${id++}`,
      type: 'literature',
      question: `"${p.q}"ä¸‹ä¸€å¥æ˜¯ï¼š`,
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      explanation: `${p.author}ã€Š${p.title}ã€‹ã€‚`
    })
  })

  return questions
}

function ExerciseDetail() {
  const instance = getCurrentInstance()
  const params = instance.router.params
  const type = params.type || QUESTION_TYPES.SINGLE_CHOICE
  const mode = params.mode || 'type'
  const count = parseInt(params.count) || 10  // æ”¯æŒè‡ªå®šä¹‰é¢˜ç›®æ•°é‡

  const [questions, setQuestions] = useState([])
  const [currentIndex, setCurrentIndex] = useState(0)
  const [answers, setAnswers] = useState({})
  const [showResult, setShowResult] = useState(false)
  const [score, setScore] = useState(0)
  const [loading, setLoading] = useState(true)
  const [startTime, setStartTime] = useState(Date.now())
  const [isFavorited, setIsFavorited] = useState(false)
  const [favoriteLoading, setFavoriteLoading] = useState(false)

  // ä½¿ç”¨ useDidShow ç¡®ä¿é¢˜ç›®åœ¨é¡µé¢æ˜¾ç¤ºæ—¶åŠ è½½
  useDidShow(() => {
    setStartTime(Date.now())
    loadQuestions()
    loadFavorites()
  })

  /**
   * åŠ è½½ç”¨æˆ·çš„æ”¶è—åˆ—è¡¨ï¼ˆç¼“å­˜åˆ° FAVORITES_CACHEï¼‰
   */
  const loadFavorites = async () => {
    try {
      const favorites = await questionService.getFavorites(1, 1000)
      FAVORITES_CACHE = new Set(favorites.map(f => f.id || f._id))
      // æ›´æ–°å½“å‰é¢˜ç›®æ”¶è—çŠ¶æ€
      updateCurrentFavoriteStatus()
    } catch (err) {
      console.error('åŠ è½½æ”¶è—åˆ—è¡¨å¤±è´¥:', err)
    }
  }

  /**
   * æ›´æ–°å½“å‰é¢˜ç›®çš„æ”¶è—çŠ¶æ€
   */
  const updateCurrentFavoriteStatus = () => {
    if (currentQuestion) {
      const questionId = currentQuestion.id || currentQuestion._id
      setIsFavorited(FAVORITES_CACHE.has(questionId))
    }
  }

  /**
   * åˆ‡æ¢æ”¶è—çŠ¶æ€
   */
  const handleToggleFavorite = async () => {
    if (!currentQuestion || favoriteLoading) return

    const questionId = currentQuestion.id || currentQuestion._id
    setFavoriteLoading(true)

    try {
      // ä¼ é€’å®Œæ•´çš„é¢˜ç›®æ•°æ®
      const questionData = {
        id: questionId,
        type: currentQuestion.type || 'vocabulary',
        question: currentQuestion.question || currentQuestion.questionText || '',
        options: currentQuestion.options || [],
        correctAnswer: currentQuestion.correctAnswer,
        explanation: currentQuestion.explanation || ''
      }

      const success = await questionService.toggleFavorite(questionId, questionData)
      if (success) {
        // æ›´æ–°ç¼“å­˜
        if (isFavorited) {
          FAVORITES_CACHE.delete(questionId)
          Taro.showToast({ title: 'å·²å–æ¶ˆæ”¶è—', icon: 'none' })
        } else {
          FAVORITES_CACHE.add(questionId)
          Taro.showToast({ title: 'å·²æ”¶è—', icon: 'success' })
        }
        setIsFavorited(!isFavorited)
      }
    } catch (err) {
      console.error('æ”¶è—æ“ä½œå¤±è´¥:', err)
      Taro.showToast({ title: 'æ“ä½œå¤±è´¥', icon: 'none' })
    } finally {
      setFavoriteLoading(false)
    }
  }

  // å½“å‰é¢˜ç›®å˜åŒ–æ—¶æ›´æ–°æ”¶è—çŠ¶æ€
  useEffect(() => {
    updateCurrentFavoriteStatus()
  }, [currentIndex, questions])

  /**
   * è§£æé€‰é¡¹å­—ç¬¦ä¸²ä¸ºæ•°ç»„
   * æ”¯æŒå¤šç§æ ¼å¼:
   * 1. JSONå¯¹è±¡å­—ç¬¦ä¸²: '{"A":"xxx","B":"xxx","C":"xxx","D":"xxx"}'
   * 2. æ™®é€šæ ¼å¼: "A. xxx  B. xxx  C. xxx" æˆ– "A.xxx B.xxx C.xxx"
   */
  const parseOptions = (optionsStr) => {
    if (Array.isArray(optionsStr)) return optionsStr
    if (typeof optionsStr !== 'string') return []

    // å°è¯•è§£æ JSON å¯¹è±¡æ ¼å¼: {"A":"xxx","B":"xxx","C":"xxx","D":"xxx"}
    if (optionsStr.trim().startsWith('{')) {
      try {
        const obj = JSON.parse(optionsStr)
        const keys = Object.keys(obj).sort()
        return keys.map(key => `${key}. ${obj[key]}`)
      } catch (e) {
        // JSON è§£æå¤±è´¥ï¼Œç»§ç»­å°è¯•å…¶ä»–æ ¼å¼
      }
    }

    // å°è¯•åŒ¹é… A.  B.  C.  æˆ– A. B. C. æ ¼å¼
    const matches = optionsStr.match(/[A-D][.ã€]\s*[^A-D]+/g)
    if (matches) {
      return matches.map(s => s.trim())
    }
    // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œè¿”å›æ•´ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå•ä¸ªé€‰é¡¹
    return [optionsStr]
  }

  /**
   * å°†ç­”æ¡ˆå­—æ¯è½¬æ¢ä¸ºç´¢å¼• (A->0, B->1, C->2, D->3)
   */
  const normalizeAnswer = (answer) => {
    if (typeof answer === 'number') return answer
    if (typeof answer === 'string') {
      const upper = answer.toUpperCase()
      const index = upper.charCodeAt(0) - 'A'.charCodeAt(0)
      if (index >= 0 && index <= 3) return index
    }
    return 0
  }

  /**
   * æ ‡å‡†åŒ–é¢˜ç›®æ•°æ®æ ¼å¼
   * æ•°æ®åº“æ ¼å¼: { content, options, answer } -> å‰ç«¯æ ¼å¼: { question, options, correctAnswer }
   */
  const normalizeQuestion = (q) => {
    return {
      ...q,
      question: q.question || q.content || '',
      options: Array.isArray(q.options) ? q.options : parseOptions(q.options || ''),
      correctAnswer: normalizeAnswer(q.correctAnswer || q.answer || 0)
    }
  }

  const loadQuestions = async () => {
    setLoading(true)

    // å†…ç½®é¢˜ç›®åº“ - ç¡®ä¿ç¦»çº¿ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨
    const BUILTIN_QUESTIONS = {
      pinyin: [
        { id: 'py001', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç‹¡ç‹(nÃ­ng)', 'B. æœºæ¢°(jiÃ¨)', 'C. åŒä»‡æ•Œå¿¾(kÃ i)', 'D. ç·æ±¡(zhÄ“n)'], correctAnswer: 2, explanation: 'Cé¡¹æ³¨éŸ³å®Œå…¨æ­£ç¡®ã€‚' },
        { id: 'py002', type: 'pinyin', question: 'ä¸‹åˆ—è¯è¯­ä¸­åŠ ç‚¹å­—çš„è¯»éŸ³ï¼Œä¸æ‰€ç»™æ³¨éŸ³å…¨éƒ¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¾› gÃ²ng ä¾›ç»™ ä¾›è®¤ ä¾›å“', 'B. è§’ juÃ© è§’è‰² å£è§’ è§’é€', 'C. å¼º qiÃ¡ng å¼ºè¿« å€”å¼º å¼ºå£®', 'D. å¤„ chÇ” å¤„ç† å¤„åˆ† å¤„æ‰€'], correctAnswer: 1, explanation: 'Bé¡¹å…¨éƒ¨è¯»juÃ©ã€‚' },
        { id: 'py003', type: 'pinyin', question: '"å‚"åœ¨"å‚åŠ "ä¸­è¯»ï¼š', options: ['A. cÄ“n', 'B. shÄ“n', 'C. cÄn', 'D. cÄ«'], correctAnswer: 2, explanation: '"å‚"åœ¨"å‚åŠ "ä¸­è¯»cÄnã€‚' },
        { id: 'py004', type: 'pinyin', question: '"è–„"åœ¨"è–„é›¾"ä¸­è¯»ï¼š', options: ['A. bÃ¡o', 'B. bÃ³', 'C. bÃ²', 'D. bÄ“'], correctAnswer: 0, explanation: '"è–„"åœ¨"è–„é›¾"ä¸­è¯»bÃ¡oã€‚' },
        { id: 'py005', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è´®è“„(zhÃ¹) è¡è(hÃ n) é…é…¿(niÃ ng)', 'B. ç²—ç³™(cÄo) ç¡®å‡¿(zÃ¡o) å”¯å¦™å”¯è‚–(xiÃ o)', 'C. è®ªç¬‘(shÃ n) æŒ‘è¡…(xÃ¬n) å“‚ç¬‘(xÄ«)', 'D. åª²ç¾(pÃ¬) ç¼„é»˜(jiÄn) é…·è‚–(xiÃ o)'], correctAnswer: 0, explanation: 'Aé¡¹æ­£ç¡®ã€‚' },
        { id: 'py006', type: 'pinyin', question: '"ç¿˜"åœ¨"ç¿˜é¦–"ä¸­è¯»ï¼š', options: ['A. qiÃ o', 'B. qiÃ¡o', 'C. qiÄo', 'D. qiÃ¼'], correctAnswer: 1, explanation: '"ç¿˜"åœ¨"ç¿˜é¦–"ä¸­è¯»qiÃ¡oã€‚' },
        { id: 'py007', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. èœç•¦(qÃ­) ç¡®å‡¿(zÃ¡o)', 'B. è„‘é«“(suÇ) ä¼›å»(lÇš)', 'C. ç›”ç”²(kuÄ«) éªŠæ­Œ(lÃ­)', 'D. é€¾è¶Š(yÃ¹) æ –æ¯(qÄ«)'], correctAnswer: 1, explanation: 'Bé¡¹"ä¼›å»"çš„"å»"åº”è¯»lÇšã€‚' },
        { id: 'py008', type: 'pinyin', question: '"æ¨¡"åœ¨"æ¨¡æ ·"ä¸­è¯»ï¼š', options: ['A. mÃ³', 'B. mÃº', 'C. mÇ’', 'D. mÃ¹'], correctAnswer: 1, explanation: '"æ¨¡"åœ¨"æ¨¡æ ·"ä¸­è¯»mÃºã€‚' },
        { id: 'py009', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¤¶çš±(zhÄ›) ç‹©çŒ(shÃ²u) èœ·ç¼©(juÇn)', 'B. å—”è§†(chÄ“n) å¨´ç†Ÿ(xiÃ¡n) æƒ©ç½š(chÄ›ng)', 'C. å‰½æ‚(piÄo) æ—–æ—(yÇ) ç•¸å½¢(qÃ­)', 'D. æ°›å›´(fÃ¨n) æ®·çº¢(yÄ«n) é¾Ÿè£‚(jÅ«n)'], correctAnswer: 2, explanation: 'Cé¡¹æ­£ç¡®ã€‚' },
        { id: 'py010', type: 'pinyin', question: '"å’½"åœ¨"ç‹¼åè™å’½"ä¸­è¯»ï¼š', options: ['A. yÃ n', 'B. yÄn', 'C. yÃ¨', 'D. yÄ«n'], correctAnswer: 0, explanation: '"å’½"åœ¨"ç‹¼åè™å’½"ä¸­è¯»yÃ nã€‚' },
      ],
      idiom: [
        { id: 'cy001', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä¸­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç”µå½±æƒ…èŠ‚è‡ªç›¸çŸ›ç›¾', 'B. æ–‡ç« è§è§£ä¸åŒå‡¡å“', 'C. ç»æµå‘å±•ä¸¾ä¸–ç©ç›®', 'D. å¤±åˆ©åé‡æ•´æ——é¼“'], correctAnswer: 3, explanation: 'Dé¡¹"é‡æ•´æ——é¼“"ä½¿ç”¨æ­£ç¡®ã€‚' },
        { id: 'cy002', type: 'idiom', question: '"ç”»è›‡æ·»è¶³"æ¯”å–»ï¼š', options: ['A. åšäº‹è¦è®¤çœŸ', 'B. åšå¤šä½™çš„äº‹åä¸å¥½', 'C. æŠ“ä½æœºä¼š', 'D. åšæŒåˆ°åº•'], correctAnswer: 1, explanation: '"ç”»è›‡æ·»è¶³"æ¯”å–»åšäº†å¤šä½™çš„äº‹ã€‚' },
        { id: 'cy003', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä½¿ç”¨ä¸æ°å½“çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è„±é¢–è€Œå‡º', 'B. æ„Ÿäººè‚ºè…‘', 'C. åŠé€”è€ŒåºŸã€åšæŒä¸æ‡ˆ', 'D. ç‹¬å…·åŒ å¿ƒ'], correctAnswer: 2, explanation: 'Cé¡¹"åšæŒä¸æ‡ˆ"ä¸èƒ½å½¢å®¹"åŠé€”è€ŒåºŸ"ã€‚' },
        { id: 'cy004', type: 'idiom', question: '"å®ˆæ ªå¾…å…”"æ¯”å–»ï¼š', options: ['A. å–„äºè§‚å¯Ÿ', 'B. æ­»å®ˆä¸çŸ¥å˜é€š', 'C. æœ‰è€å¿ƒ', 'D. è¿æ°”é‡è¦'], correctAnswer: 1, explanation: '"å®ˆæ ªå¾…å…”"æ¯”å–»æ­»å®ˆç»éªŒä¸çŸ¥å˜é€šã€‚' },
        { id: 'cy005', type: 'idiom', question: '"äº¡ç¾Šè¡¥ç‰¢"çš„æ„æ€æ˜¯ï¼š', options: ['A. ç¾Šä¸¢äº†ä¸æ‰¾', 'B. å‡ºé—®é¢˜åè¡¥æ•‘', 'C. ä¿®ç†ç¾Šåœˆ', 'D. é¢„é˜²é—®é¢˜'], correctAnswer: 1, explanation: '"äº¡ç¾Šè¡¥ç‰¢"æ¯”å–»å‡ºäº†é—®é¢˜åŠæ—¶è¡¥æ•‘ã€‚' },
        { id: 'cy006', type: 'idiom', question: '"å¤¸å¤¸å…¶è°ˆ"çš„æ„æ€æ˜¯ï¼š', options: ['A. è¯´è¯å¥½å¬', 'B. æµ®å¤¸ä¸å®é™…', 'C. å¤¸å¥–åˆ«äºº', 'D. è°ˆè®ºå¤¸å¤¸'], correctAnswer: 1, explanation: '"å¤¸å¤¸å…¶è°ˆ"å½¢å®¹è¯´è¯æµ®å¤¸ã€‚' },
        { id: 'cy007', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å·§å¤ºå¤©å…¬', 'B. è¿«ä¸æ€¥å¾…', 'C. è°ˆç¬‘é£ç”Ÿ', 'D. å†æ¥å†åŠ±'], correctAnswer: 2, explanation: 'Cé¡¹æ­£ç¡®ã€‚' },
        { id: 'cy008', type: 'idiom', question: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»ï¼š', options: ['A. å¿ƒé‡Œæœ‰ç«¹å­', 'B. åšäº‹æœ‰æŠŠæ¡', 'C. å–œæ¬¢ç”»ç”»', 'D. èƒ¸éƒ¨å®½å¹¿'], correctAnswer: 1, explanation: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»åšäº‹æœ‰æŠŠæ¡ã€‚' },
        { id: 'cy009', type: 'idiom', question: 'ä¸‹åˆ—åŠ ç‚¹æˆè¯­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä»–åšäº‹ä¸€ä¸ä¸è‹Ÿ', 'B. è¿™æ¬¡ä¼šè®®ä¸‡äººç©ºå··', 'C. ä»–æ€»æ˜¯è¢–æ‰‹æ—è§‚', 'D. è¿™ç¯‡æ–‡ç« åˆ«å‡ºå¿ƒè£'], correctAnswer: 0, explanation: 'Aé¡¹"ä¸€ä¸ä¸è‹Ÿ"ä½¿ç”¨æ­£ç¡®ã€‚' },
        { id: 'cy010', type: 'idiom', question: '"æ´¥æ´¥æœ‰å‘³"çš„æ„æ€æ˜¯ï¼š', options: ['A. å‘³é“å¥½', 'B. å…´è¶£æµ“åš', 'C. æ´¥æ´¥æœ‰å‘³', 'D. å¾ˆæœ‰å‘³é“'], correctAnswer: 1, explanation: '"æ´¥æ´¥æœ‰å‘³"å½¢å®¹å…´è¶£æµ“åšã€‚' },
      ],
      vocabulary: [
        { id: 'vo001', type: 'vocabulary', question: '"å§¹ç´«å«£çº¢"çš„æ„æ€æ˜¯ï¼š', options: ['A. é¢œè‰²å•ä¸€', 'B. å„ç§èŠ±æœµå¨‡è‰³', 'C. ç´«è‰²çº¢è‰²', 'D. èŠ±æœµå‡‹é›¶'], correctAnswer: 1, explanation: '"å§¹ç´«å«£çº¢"å½¢å®¹å„ç§é¢œè‰²èŠ±æœµå¨‡è‰³ã€‚' },
        { id: 'vo002', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å†æ¥å†åŠ±', 'B. è°ˆç¬‘é£ç”Ÿ', 'C. å·§å¤ºå¤©å…¬', 'D. è¿«ä¸æ€¥å¾…'], correctAnswer: 1, explanation: 'Bé¡¹æ­£ç¡®ã€‚' },
        { id: 'vo003', type: 'vocabulary', question: '"ç¾è½®ç¾å¥‚"å½¢å®¹ï¼š', options: ['A. ç¾ä¸½é£æ™¯', 'B. é«˜å¤§åä¸½å»ºç­‘', 'C. ç¾ä¸½çš„äºº', 'D. ç¾å¥½éŸ³ä¹'], correctAnswer: 1, explanation: '"ç¾è½®ç¾å¥‚"å½¢å®¹æˆ¿å±‹é«˜å¤§åä¸½ã€‚' },
        { id: 'vo004', type: 'vocabulary', question: '"é³æ¬¡æ ‰æ¯”"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ’åˆ—å¯†', 'B. é±¼å’Œæ¢³å­', 'C. æ¬¡åºæ··ä¹±', 'D. æ•´é½ç¨€ç–'], correctAnswer: 0, explanation: '"é³æ¬¡æ ‰æ¯”"å½¢å®¹å»ºç­‘ç‰©æ’åˆ—å¯†æ•´ã€‚' },
        { id: 'vo005', type: 'vocabulary', question: '"å·æµä¸æ¯"çš„"å·"æ„æ€æ˜¯ï¼š', options: ['A. å±±å·', 'B. æ²³æµ', 'C. å¹³åŸ', 'D. é“è·¯'], correctAnswer: 1, explanation: '"å·"æŒ‡æ²³æµã€‚' },
        { id: 'vo006', type: 'vocabulary', question: '"å› åœ°åˆ¶å®œ"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ ¹æ®å½“åœ°åˆ¶å®šæªæ–½', 'B. æ”¹é€ ç¯å¢ƒ', 'C. é€‚åº”ç¯å¢ƒ', 'D. æ”¹å˜åˆ¶åº¦'], correctAnswer: 0, explanation: '"å› åœ°åˆ¶å®œ"æŒ‡æ ¹æ®æƒ…å†µåˆ¶å®šåŠæ³•ã€‚' },
        { id: 'vo007', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­è§£é‡Šæœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‡›å†½ï¼šå¯’å†·', 'B. é€¶è¿¤ï¼šå¼¯æ›²', 'C. å¦¥å¸–ï¼šæ°å½“', 'D. ä¿¨ç„¶ï¼šä¸¥è‚ƒ'], correctAnswer: 3, explanation: 'Dé¡¹"ä¿¨ç„¶"ä¸»è¦æŒ‡å¾ˆåƒã€‚' },
        { id: 'vo008', type: 'vocabulary', question: '"ä¸å¯æ€è®®"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ— æ³•æƒ³è±¡', 'B. ä¸å¯è®®è®º', 'C. å¾ˆç¥å¥‡', 'D. ä¸è®²ç†'], correctAnswer: 0, explanation: '"ä¸å¯æ€è®®"å½¢å®¹éš¾ä»¥æƒ³è±¡ã€‚' },
        { id: 'vo009', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç„•ç„¶ä¸€æ–°', 'B. è°ˆç¬‘é£å£°', 'C. è¿«ä¸æ€¥å¾…', 'D. å†æ¥å†åŠ±'], correctAnswer: 0, explanation: 'Aé¡¹æ­£ç¡®ã€‚' },
        { id: 'vo010', type: 'vocabulary', question: '"æŠ‘æ‰¬é¡¿æŒ«"å½¢å®¹ï¼š', options: ['A. å£°éŸ³é«˜ä½èµ·ä¼', 'B. æŠ‘åˆ¶', 'C. æŒ«æŠ˜', 'D. åœé¡¿'], correctAnswer: 0, explanation: '"æŠ‘æ‰¬é¡¿æŒ«"å½¢å®¹å£°éŸ³é«˜ä½èµ·ä¼å’Œè°ã€‚' },
      ],
      correction: [
        { id: 'bc001', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é€šè¿‡æ´»åŠ¨ï¼Œä½¿æˆ‘æ˜ç™½', 'B. æ€åº¦ç«¯æ­£ï¼Œæˆç»©æé«˜', 'C. æ‰“æ‰«æ•™å®¤å«ç”Ÿ', 'D. æ”¹è¿›æ–¹æ³•ï¼Œå¢åŠ æ•ˆç‡'], correctAnswer: 1, explanation: 'Bé¡¹æ— è¯­ç—…ã€‚' },
        { id: 'bc002', type: 'correction', question: '"å¢åŠ æ•ˆç‡"çš„é”™è¯¯ç±»å‹æ˜¯ï¼š', options: ['A. è¯­åºä¸å½“', 'B. æ­é…ä¸å½“', 'C. æˆåˆ†æ®‹ç¼º', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, explanation: '"å¢åŠ "ä¸"æ•ˆç‡"æ­é…ä¸å½“ã€‚' },
        { id: 'bc003', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŒ—äº¬ç§‹å¤©ç¾ä¸½', 'B. æ–‡ç« è§‚ç‚¹æ·±åˆ»', 'C. ç©¿ç€ä¸Šè¡£æˆ´å¸½å­', 'D. å…»æˆå­¦ä¹ ä¹ æƒ¯'], correctAnswer: 2, explanation: 'Cé¡¹æ­é…ä¸å½“ã€‚' },
        { id: 'bc004', type: 'correction', question: '"é€šè¿‡å­¦ä¹ ï¼Œä½¿æˆ‘å—ç›Š"ç—…å› æ˜¯ï¼š', options: ['A. æˆåˆ†æ®‹ç¼º', 'B. æ­é…ä¸å½“', 'C. è¯­åºä¸å½“', 'D. ç»“æ„æ··ä¹±'], correctAnswer: 0, explanation: 'æ»¥ç”¨ä»‹è¯å¯¼è‡´ä¸»è¯­ç¼ºå¤±ã€‚' },
        { id: 'bc005', type: 'correction', question: 'ä¿®æ”¹"ç¨»ç±³æ˜¯ä¸»è¦ç²®é£Ÿ"æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. ç¨»ç±³æ˜¯ç²®é£Ÿ', 'B. ç¨»ç±³æ˜¯ç²®é£Ÿä½œç‰©', 'C. ç²®é£Ÿæ˜¯ç¨»ç±³', 'D. ç¨»ç±³æ˜¯ä¸»è¦'], correctAnswer: 1, explanation: 'åº”æ”¹ä¸º"ç¨»ç±³æ˜¯ç²®é£Ÿä½œç‰©"ã€‚' },
        { id: 'bc006', type: 'correction', question: 'ä¸‹åˆ—æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ–‡ç« å¯¹æˆ‘æœ‰å…´è¶£', 'B. æˆ‘å¯¹æ–‡ç« æœ‰å…´è¶£', 'C. æ–‡ç« å¼•èµ·å…´è¶£', 'D. æ–‡ç« è®©æˆ‘æ„Ÿå…´è¶£'], correctAnswer: 2, explanation: 'Cé¡¹æ— è¯­ç—…ã€‚' },
        { id: 'bc007', type: 'correction', question: '"å³ä½¿é‡åˆ°æŒ«æŠ˜ï¼Œä¹Ÿè¦åšæŒ"ï¼š', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…', 'C. ç¼ºä¸»è¯­', 'D. æ­é…ä¸å½“'], correctAnswer: 1, explanation: 'è¿™å¥è¯æ— è¯­ç—…ã€‚' },
        { id: 'bc008', type: 'correction', question: 'ä¸‹åˆ—æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŸ¹å…»ä¹ æƒ¯', 'B. æ˜ç™½é“ç†', 'C. åŠªåŠ›å–å¾—æˆç»©', 'D. ä½œè€…æ˜¯é²è¿…å†™çš„'], correctAnswer: 3, explanation: 'Dé¡¹å¥å¼æ‚ç³…ã€‚' },
        { id: 'bc009', type: 'correction', question: 'ä¸‹åˆ—å¥å­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é€šè¿‡å­¦ä¹ ä½¿æˆ‘è¿›æ­¥', 'B. ä»–è¿›æ­¥äº†', 'C. ä»–ç©¿ç€è¡£æœå’Œå¸½å­', 'D. æé«˜å·¥ä½œæ•ˆç‡'], correctAnswer: 3, explanation: 'Dé¡¹æ— è¯­ç—…ã€‚' },
        { id: 'bc010', type: 'correction', question: '"è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯é²è¿…å†™çš„"ç—…å› æ˜¯ï¼š', options: ['A. æˆåˆ†æ®‹ç¼º', 'B. å¥å¼æ‚ç³…', 'C. æ­é…ä¸å½“', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, explanation: 'å¥å¼æ‚ç³…ã€‚' },
      ]
    }

    // è·å–æ‰€æœ‰é¢˜ç›®å¹¶æ‰“ä¹±
    const getAllQuestions = () => {
      const all = [
        ...BUILTIN_QUESTIONS.pinyin,
        ...BUILTIN_QUESTIONS.idiom,
        ...BUILTIN_QUESTIONS.vocabulary,
        ...BUILTIN_QUESTIONS.correction
      ]
      // Fisher-Yates æ´—ç‰Œ
      for (let i = all.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [all[i], all[j]] = [all[j], all[i]]
      }
      return all
    }

    try {
      let data
      if (mode === 'single') {
        // å•é¢˜æ¨¡å¼ï¼šç›´æ¥æ˜¾ç¤ºä¼ å…¥çš„é¢˜ç›®
        console.log('=== å•é¢˜æ¨¡å¼ ===')
        try {
          const questionDataStr = params.questionData
          if (questionDataStr) {
            const parsedQuestion = JSON.parse(decodeURIComponent(questionDataStr))
            console.log('è§£æåˆ°çš„é¢˜ç›®:', parsedQuestion)
            data = [normalizeQuestion(parsedQuestion)]
          } else {
            console.error('å•é¢˜æ¨¡å¼ç¼ºå°‘ questionData å‚æ•°')
            data = []
          }
        } catch (err) {
          console.error('è§£æå•é¢˜æ•°æ®å¤±è´¥:', err)
          data = []
        }
      } else if (mode === 'favorite') {
        // æ”¶è—ç»ƒä¹ æ¨¡å¼ï¼šä»äº‘å‡½æ•°è·å–æ”¶è—çš„é¢˜ç›®åˆ—è¡¨
        console.log('=== æ”¶è—ç»ƒä¹ æ¨¡å¼ï¼Œä»äº‘å‡½æ•°è·å–æ”¶è—é¢˜ç›® ===')
        try {
          const favoriteQuestions = await questionService.getFavorites(1, count)
          console.log('ä»äº‘å‡½æ•°è·å–åˆ°æ”¶è—é¢˜ç›®:', favoriteQuestions?.length || 0, 'é¢˜')
          if (favoriteQuestions && favoriteQuestions.length > 0) {
            // æ ‡å‡†åŒ–æ”¶è—é¢˜ç›®æ•°æ®æ ¼å¼
            data = favoriteQuestions.map(q => normalizeQuestion({
              id: q.id || q._id,
              type: q.type || q.questionType || 'vocabulary',
              question: q.question || q.questionText || '',
              options: q.options || [],
              correctAnswer: q.correctAnswer || 0,
              explanation: q.explanation || ''
            }))
          } else {
            // æ²¡æœ‰æ”¶è—é¢˜ç›®
            data = []
          }
        } catch (err) {
          console.error('è·å–æ”¶è—é¢˜ç›®å¤±è´¥ï¼Œä½¿ç”¨ç©ºæ•°ç»„:', err)
          data = []
        }
      } else if (mode === 'wrong') {
        // é”™é¢˜é‡åšæ¨¡å¼ï¼šä»äº‘å‡½æ•°è·å–çœŸå®çš„é”™é¢˜åˆ—è¡¨
        console.log('=== é”™é¢˜é‡åšæ¨¡å¼ï¼Œä»äº‘å‡½æ•°è·å–é”™é¢˜ ===')
        try {
          const wrongQuestions = await questionService.getWrongQuestions(1, count)
          console.log('ä»äº‘å‡½æ•°è·å–åˆ°é”™é¢˜:', wrongQuestions?.length || 0, 'é¢˜')
          if (wrongQuestions && wrongQuestions.length > 0) {
            // æ ‡å‡†åŒ–é”™é¢˜æ•°æ®æ ¼å¼
            data = wrongQuestions.map(q => normalizeQuestion({
              id: q.id || q._id,
              type: q.type,
              question: q.question || q.questionText,
              options: q.options || [],
              correctAnswer: q.answer || q.correctAnswer || 0,
              explanation: q.explanation || ''
            }))
          } else {
            // æ²¡æœ‰é”™é¢˜ï¼Œä½¿ç”¨ç©ºæ•°ç»„
            data = []
          }
        } catch (err) {
          console.error('è·å–é”™é¢˜å¤±è´¥ï¼Œä½¿ç”¨ç©ºæ•°ç»„:', err)
          data = []
        }
      } else if (mode === 'random') {
        // éšæœºæ¨¡å¼ï¼šä»æ‰€æœ‰é¢˜ç›®ä¸­æŠ½å–
        const all = getAllQuestions()
        data = all.slice(0, Math.min(count, all.length))
      } else {
        // æŒ‰ç±»å‹æ¨¡å¼ï¼šä»æŒ‡å®šç±»å‹ä¸­æŠ½å–
        const typedQuestions = BUILTIN_QUESTIONS[type] || getAllQuestions()
        // æ‰“ä¹±é¡ºåº
        const shuffled = [...typedQuestions].sort(() => Math.random() - 0.5)
        data = shuffled.slice(0, Math.min(count, shuffled.length))
      }
      // æ ‡å‡†åŒ–é¢˜ç›®æ•°æ®æ ¼å¼
      if (data && data.length > 0 && mode !== 'wrong') {
        data = data.map(normalizeQuestion)
      }
      console.log('æˆåŠŸåŠ è½½é¢˜ç›®ï¼Œæ•°é‡:', data?.length || 0, 'æ¨¡å¼:', mode, 'ç±»å‹:', type)
      setQuestions(data || [])
    } catch (err) {
      console.error('åŠ è½½é¢˜ç›®å¤±è´¥:', err)
      // æœ€å°fallback
      setQuestions([
        { id: 'f1', type: QUESTION_TYPES.SINGLE_CHOICE, question: 'ä¸‹åˆ—è¯è¯­ä¸­ï¼Œæ²¡æœ‰é”™åˆ«å­—çš„ä¸€ç»„æ˜¯ï¼š', options: ['A. è¯¡è®¡å¤šç«¯', 'B. èµ°æŠ•æ— è·¯', 'C. è°ˆç¬‘é£ç”Ÿ', 'D. æ±—æµæµƒèƒŒ'], correctAnswer: 2, explanation: 'Cé¡¹æ­£ç¡®ã€‚' },
        { id: 'f2', type: QUESTION_TYPES.SINGLE_CHOICE, question: '"æ˜¥é£åˆç»¿æ±Ÿå—å²¸"ä¸­çš„"ç»¿"å­—è¿ç”¨äº†ä»€ä¹ˆä¿®è¾æ‰‹æ³•ï¼Ÿ', options: ['A. æ¯”å–»', 'B. æ‹Ÿäºº', 'C. å¤¸å¼ ', 'D. å€Ÿä»£'], correctAnswer: 1, explanation: 'æ‹Ÿäººã€‚' },
        { id: 'f3', type: QUESTION_TYPES.SINGLE_CHOICE, question: '"ç”»è›‡æ·»è¶³"æ¯”å–»ï¼š', options: ['A. åšäº‹è¦è®¤çœŸ', 'B. åšå¤šä½™çš„äº‹', 'C. æŠ“ä½æœºä¼š', 'D. åšæŒåˆ°åº•'], correctAnswer: 1, explanation: 'åšäº†å¤šä½™çš„äº‹ã€‚' }
      ].slice(0, count))
    } finally {
      setLoading(false)
    }
  }

  const currentQuestion = questions[currentIndex]

  // è°ƒè¯•ï¼šæ‰“å°å½“å‰é¢˜ç›®ä¿¡æ¯
  if (currentQuestion && mode === 'wrong') {
    console.log('=== å½“å‰é”™é¢˜ä¿¡æ¯ ===')
    console.log('é¢˜ç›®ID:', currentQuestion.id)
    console.log('é¢˜ç›®ç±»å‹:', currentQuestion.type)
    console.log('é¢˜ç›®å†…å®¹:', currentQuestion.question?.substring(0, 50))
    console.log('é€‰é¡¹æ•°é‡:', currentQuestion.options?.length || 0)
    console.log('é€‰é¡¹ç¤ºä¾‹:', currentQuestion.options?.[0])
    console.log('å®Œæ•´é¢˜ç›®æ•°æ®:', currentQuestion)
  }

  const handleAnswer = (value) => {
    console.log('handleAnswer è¢«è°ƒç”¨', { questionId: currentQuestion.id, value })
    const newAnswers = {
      ...answers,
      [currentQuestion.id]: value
    }
    console.log('æ–°ç­”æ¡ˆçŠ¶æ€', newAnswers)
    setAnswers(newAnswers)
  }

  // å¤„ç†å¤šé€‰é¢˜çš„é€‰æ‹©ï¼ˆåˆ‡æ¢é€‰ä¸­çŠ¶æ€ï¼‰
  const handleMultiSelectAnswer = (index) => {
    const currentAnswers = answers[currentQuestion.id] || []
    const isSelected = currentAnswers.includes(index)

    let newAnswers
    if (isSelected) {
      // å–æ¶ˆé€‰ä¸­
      newAnswers = currentAnswers.filter(i => i !== index)
    } else {
      // æ·»åŠ é€‰ä¸­
      newAnswers = [...currentAnswers, index]
    }

    setAnswers({
      ...answers,
      [currentQuestion.id]: newAnswers
    })
  }

  // æ£€æŸ¥å½“å‰é¢˜ç›®æ˜¯å¦å·²ä½œç­”ï¼ˆç”¨äºæŒ‰é’®ç¦ç”¨çŠ¶æ€ï¼‰
  const hasAnswer = () => {
    const answer = answers[currentQuestion.id]
    if (answer === undefined || answer === null) return false
    // å¤šé€‰é¢˜æ£€æŸ¥æ•°ç»„æ˜¯å¦æœ‰å…ƒç´ 
    if (Array.isArray(answer)) return answer.length > 0
    // å•é€‰é¢˜æ£€æŸ¥æ˜¯å¦æœ‰å€¼
    return true
  }

  // åˆ¤æ–­æ˜¯å¦ä¸ºå¤šé€‰é¢˜ï¼ˆåªæœ‰ type ä¸º 'multiple_choice' æ‰æ˜¯å¤šé€‰é¢˜ï¼‰
  const isMultipleChoice = () => {
    return currentQuestion?.type === QUESTION_TYPES.MULTIPLE_CHOICE
  }

  const handleNext = () => {
    if (currentIndex < questions.length - 1) {
      setCurrentIndex(currentIndex + 1)
      setShowResult(false)
    } else {
      handleSubmit()
    }
  }

  const handleSubmit = async () => {
    // è®¡ç®—åˆ†æ•°å¹¶è®°å½•ç­”å¯¹çš„é¢˜ç›®
    let correct = 0
    const correctQuestionIds = [] // è®°å½•ç­”å¯¹çš„é¢˜ç›®ID

    questions.forEach(q => {
      const userAnswer = answers[q.id]
      const correctAnswer = q.correctAnswer

      // åˆ¤æ–­ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
      let isAnswerCorrect = false
      if (Array.isArray(userAnswer)) {
        // å¤šé€‰é¢˜ï¼šéœ€è¦æ’åºåæ¯”è¾ƒæ•°ç»„å†…å®¹
        const sortedUser = [...userAnswer].sort()
        const sortedCorrect = Array.isArray(correctAnswer)
          ? [...correctAnswer].sort()
          : [correctAnswer]
        isAnswerCorrect = JSON.stringify(sortedUser) === JSON.stringify(sortedCorrect)
      } else {
        // å•é€‰é¢˜ï¼šç›´æ¥æ¯”è¾ƒ
        isAnswerCorrect = userAnswer === correctAnswer
      }

      if (isAnswerCorrect) {
        correct++
        correctQuestionIds.push(q.id)
      }
    })
    const finalScore = Math.round((correct / questions.length) * 100)
    setScore(finalScore)
    setShowResult(true)

    // è®°å½•å­¦ä¹ åˆ° study_records
    try {
      await studyService.addRecord({
        type: 'exercise',
        title: 'ç»ƒä¹ ',
        score: finalScore,
        totalQuestions: questions.length,
        correctAnswers: correct,
        duration: Math.round((Date.now() - startTime) / 1000 / 60) || 5
      })
    } catch (err) {
      console.error('è®°å½•å­¦ä¹ å¤±è´¥:', err)
    }

    // æ‰¹é‡å†™å…¥ç­”é¢˜è®°å½•åˆ° answer_historyï¼ˆä½¿ç”¨ question äº‘å‡½æ•°ï¼‰
    try {
      // è®¡ç®—æ¯é“é¢˜æ˜¯å¦æ­£ç¡®
      const answerData = questions.map(q => {
        const userAnswer = answers[q.id]
        const correctAnswer = q.correctAnswer

        let isAnswerCorrect = false
        if (Array.isArray(userAnswer)) {
          const sortedUser = [...userAnswer].sort()
          const sortedCorrect = Array.isArray(correctAnswer)
            ? [...correctAnswer].sort()
            : [correctAnswer]
          isAnswerCorrect = JSON.stringify(sortedUser) === JSON.stringify(sortedCorrect)
        } else {
          isAnswerCorrect = userAnswer === correctAnswer
        }

        return {
          questionId: q.id,
          answer: answers[q.id],
          questionType: q.type,
          isCorrect: isAnswerCorrect,
          // åŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯ï¼Œä»¥ä¾¿é”™é¢˜é‡åšæ—¶ä½¿ç”¨
          questionText: q.question || q.questionText || '',
          options: q.options || [],
          correctAnswer: correctAnswer
        }
      })

      console.log('=== æäº¤ç­”é¢˜æ•°æ® ===')
      console.log('ç­”é¢˜æ•°æ®ç¤ºä¾‹:', answerData[0])

      await Taro.cloud.callFunction({
        name: 'question',
        data: {
          action: 'submitBatch',
          answers: answerData
        }
      })
    } catch (err) {
      console.error('è®°å½•ç­”é¢˜å†å²å¤±è´¥:', err)
    }

    // å¦‚æœæ˜¯é”™é¢˜é‡åšæ¨¡å¼ï¼Œå°†ç­”å¯¹çš„é¢˜ç›®ä»é”™é¢˜é›†ä¸­ç§»é™¤
    if (mode === 'wrong' && correctQuestionIds.length > 0) {
      console.log('=== é”™é¢˜é‡åšæ¨¡å¼ï¼Œå‡†å¤‡ç§»é™¤ç­”å¯¹çš„é¢˜ç›® ===')
      console.log('ç­”å¯¹çš„é¢˜ç›®ID:', correctQuestionIds)
      console.log('å½“å‰ mode:', mode)

      try {
        // é€ä¸ªç§»é™¤ç­”å¯¹çš„é”™é¢˜
        for (const questionId of correctQuestionIds) {
          console.log('æ­£åœ¨ç§»é™¤é”™é¢˜:', questionId)
          const res = await Taro.cloud.callFunction({
            name: 'question',
            data: {
              action: 'removeWrong',
              questionId: questionId
            }
          })
          console.log('ç§»é™¤ç»“æœ:', res)
        }
        console.log(`=== æˆåŠŸç§»é™¤ ${correctQuestionIds.length} é“é”™é¢˜ ===`)
      } catch (err) {
        console.error('=== ç§»é™¤é”™é¢˜å¤±è´¥ ===:', err)
        Taro.showToast({ title: 'ç§»é™¤å¤±è´¥: ' + (err.errMsg || err.message || 'unknown'), icon: 'none', duration: 3000 })
      }
    } else {
      console.log('=== ä¸æ˜¯é”™é¢˜é‡åšæ¨¡å¼ æˆ– æ²¡æœ‰ç­”å¯¹çš„é¢˜ç›® ===')
      console.log('mode:', mode, 'correctQuestionIds:', correctQuestionIds)
    }
  }

  const isCorrect = (questionId) => {
    const userAnswer = answers[questionId]
    const question = questions.find(q => q.id === questionId)
    if (!question) return false

    const correctAnswer = question.correctAnswer

    if (Array.isArray(userAnswer)) {
      // å¤šé€‰é¢˜æ¯”è¾ƒ
      const sortedUser = [...userAnswer].sort()
      const sortedCorrect = Array.isArray(correctAnswer)
        ? [...correctAnswer].sort()
        : [correctAnswer]
      return JSON.stringify(sortedUser) === JSON.stringify(sortedCorrect)
    }
    // å•é€‰é¢˜æ¯”è¾ƒ
    return userAnswer === correctAnswer
  }

  if (loading) {
    return (
      <View className="loading-page">
        <Text>åŠ è½½ä¸­...</Text>
      </View>
    )
  }

  if (showResult) {
    // è®¡ç®—ç­”å¯¹é¢˜æ•°
    const correctCount = questions.filter(q => {
      const userAnswer = answers[q.id]
      const correctAnswer = q.correctAnswer

      if (Array.isArray(userAnswer)) {
        const sortedUser = [...userAnswer].sort()
        const sortedCorrect = Array.isArray(correctAnswer)
          ? [...correctAnswer].sort()
          : [correctAnswer]
        return JSON.stringify(sortedUser) === JSON.stringify(sortedCorrect)
      }
      return userAnswer === correctAnswer
    }).length

    return (
      <View className="result-page">
        <View className="result-card">
          <Text className="result-score">{score}</Text>
          <Text className="result-label">å¾—åˆ†</Text>
          <View className="result-detail">
            <Text className="detail-text">ç­”å¯¹ {correctCount} é¢˜</Text>
            <Text className="detail-text">å…± {questions.length} é¢˜</Text>
          </View>
        </View>

        <View className="result-actions">
          <View className="action-btn" onClick={() => navigateBack()}>è¿”å›</View>
          <View className="action-btn primary" onClick={() => {
            setAnswers({})
            setCurrentIndex(0)
            setShowResult(false)
          }}>å†ç»ƒä¸€æ¬¡</View>
        </View>
      </View>
    )
  }

  return (
    <View className="exercise-detail-page">
      {/* è¿›åº¦æ¡ */}
      <View className="progress-header">
        <View className="progress-bar">
          <View
            className="progress-fill"
            style={{ width: `${((currentIndex + 1) / questions.length) * 100}%` }}
          />
        </View>
        <Text className="progress-text">{currentIndex + 1} / {questions.length}</Text>
      </View>

      <ScrollView scrollY className="content-scroll">
        <View className="question-card">
          <View className="question-header">
            <View className="question-type">
              {isMultipleChoice() ? 'å¤šé€‰é¢˜' : 'å•é€‰é¢˜'}
            </View>
            <View
              className={`favorite-btn ${isFavorited ? 'favorited' : ''} ${favoriteLoading ? 'loading' : ''}`}
              onClick={handleToggleFavorite}
            >
              <Text className="favorite-icon">{isFavorited ? 'â˜…' : 'â˜†'}</Text>
            </View>
          </View>

          <Text className="question-text">{currentQuestion?.question}</Text>

          {!isMultipleChoice() ? (
            <View className="options-list">
              {currentQuestion.options.map((option, index) => {
                const isSelected = answers[currentQuestion.id] === index
                return (
                  <View
                    key={index}
                    className={`option-item ${isSelected ? 'selected' : ''}`}
                    onClick={() => handleAnswer(index)}
                  >
                    <Radio checked={isSelected} />
                    <Text className="option-text">{option}</Text>
                  </View>
                )
              })}
            </View>
          ) : (
            <View className="options-list">
              {currentQuestion?.options?.map((option, index) => {
                const currentAnswers = answers[currentQuestion.id] || []
                const isSelected = currentAnswers.includes(index)
                return (
                  <View
                    key={index}
                    className={`option-item ${isSelected ? 'selected' : ''}`}
                    onClick={() => handleMultiSelectAnswer(index)}
                  >
                    <Checkbox checked={isSelected} />
                    <Text className="option-text">{option}</Text>
                  </View>
                )
              })}
            </View>
          )}
        </View>

        {currentQuestion?.explanation && answers[currentQuestion.id] !== undefined && (
          <View className="explanation-card">
            <Text className="explanation-title">è§£æ</Text>
            <Text className="explanation-text">{currentQuestion.explanation}</Text>
          </View>
        )}
      </ScrollView>

      <View className="footer-btn">
        <View
          className={`btn ${!hasAnswer() ? 'disabled' : ''}`}
          onClick={() => {
            // åªæœ‰é€‰æ‹©äº†ç­”æ¡ˆæ‰èƒ½ç‚¹ä¸‹ä¸€é¢˜
            if (hasAnswer()) {
              handleNext()
            }
          }}
        >
          {currentIndex < questions.length - 1 ? 'ä¸‹ä¸€é¢˜' : 'æäº¤'}
        </View>
      </View>
    </View>
  )
}

export default ExerciseDetail


// ===== src/pages/pinyin/index.jsx =====
/**
 * æ‹¼éŸ³å­¦ä¹ é¡µé¢ - é€‰æ‹©é¢˜æ¨¡å¼
 */
import { useState, useRef, useEffect } from 'react'
import { View, Text, ScrollView } from '@tarojs/components'
import Taro from '@tarojs/taro'
import { useDidShow } from '@tarojs/taro'
import studyService from '../../services/study'
import questionService from '../../services/question'
import eventBus, { EVENTS } from '../../utils/eventBus'
import './index.less'

// æ”¶è—çŠ¶æ€ç¼“å­˜
let FAVORITES_CACHE = new Set()

// æ‹¼éŸ³é€‰æ‹©é¢˜åº“
const PINYIN_QUESTIONS = [
  // é€‰æ‹©æ­£ç¡®è¯»éŸ³
  { id: 'p001', type: 'pronunciation', question: '"ä¸­"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. zÅng', 'B. zhÅng', 'C. zÃ²ng'], correctAnswer: 1, explanation: '"ä¸­"è¯» zhÅngï¼Œè¡¨ç¤ºä¸­é—´ã€ä¸­å¿ƒã€‚' },
  { id: 'p002', type: 'pronunciation', question: '"å›½"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. guÃ³', 'B. guÅ', 'C. gÃºo'], correctAnswer: 0, explanation: '"å›½"è¯» guÃ³ï¼Œç¬¬äºŒå£°ã€‚' },
  { id: 'p003', type: 'pronunciation', question: '"äºº"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. lÃ©n', 'B. rÃ¨n', 'C. rÃ©n'], correctAnswer: 2, explanation: '"äºº"è¯» rÃ©nï¼Œç¬¬äºŒå£°ã€‚' },
  { id: 'p004', type: 'pronunciation', question: '"å¤§"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. dÃ ', 'B. dÃ i', 'C. dÃ¡'], correctAnswer: 0, explanation: '"å¤§"è¯» dÃ ï¼Œç¬¬å››å£°ã€‚' },
  { id: 'p005', type: 'pronunciation', question: '"å°"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. xiÇu', 'B. xiÇo', 'C. xÇo'], correctAnswer: 1, explanation: '"å°"è¯» xiÇoï¼Œç¬¬ä¸‰å£°ã€‚' },
  { id: 'p006', type: 'pronunciation', question: '"æ°´"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. suÇ', 'B. shÃ¹i', 'C. shuÇ'], correctAnswer: 2, explanation: '"æ°´"è¯» shuÇï¼Œç¬¬ä¸‰å£°ã€‚' },
  { id: 'p007', type: 'pronunciation', question: '"ç«"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. huÇ’', 'B. hÇ’', 'C. huÃ²'], correctAnswer: 0, explanation: '"ç«"è¯» huÇ’ï¼Œç¬¬ä¸‰å£°ã€‚' },
  { id: 'p008', type: 'pronunciation', question: '"å±±"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. sÄn', 'B. shÃ¡n', 'C. shÄn'], correctAnswer: 2, explanation: '"å±±"è¯» shÄnï¼Œç¬¬ä¸€å£°ã€‚' },
  { id: 'p009', type: 'pronunciation', question: '"ä¹¦"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. sÅ«', 'B. shÅ«', 'C. shÃ¹'], correctAnswer: 1, explanation: '"ä¹¦"è¯» shÅ«ï¼Œç¬¬ä¸€å£°ã€‚' },
  { id: 'p010', type: 'pronunciation', question: '"å­¦"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. xÃ¼Ã©', 'B. xuÃ©', 'C. xÄ›'], correctAnswer: 1, explanation: '"å­¦"è¯» xuÃ©ï¼Œç¬¬äºŒå£°ã€‚' },
  { id: 'p011', type: 'pronunciation', question: '"åƒ"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. cÄ«', 'B. chÄ«', 'C. chÃ­'], correctAnswer: 1, explanation: '"åƒ"è¯» chÄ«ï¼Œç¬¬ä¸€å£°ã€‚' },
  { id: 'p012', type: 'pronunciation', question: '"ç¡"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. suÃ¬', 'B. shÃ¹i', 'C. shuÃ¬'], correctAnswer: 2, explanation: '"ç¡"è¯» shuÃ¬ï¼Œç¬¬å››å£°ã€‚' },
  { id: 'p013', type: 'pronunciation', question: '"èµ°"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. zhÇ’u', 'B. zÇ’u', 'C. zÃ²u'], correctAnswer: 1, explanation: '"èµ°"è¯» zÇ’uï¼Œç¬¬ä¸‰å£°ã€‚' },
  { id: 'p014', type: 'pronunciation', question: '"é£"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. fÄ“Ä«', 'B. fÄ“i', 'C. fÃ©i'], correctAnswer: 1, explanation: '"é£"è¯» fÄ“iï¼Œç¬¬ä¸€å£°ã€‚' },
  { id: 'p015', type: 'pronunciation', question: '"çˆ±"çš„æ­£ç¡®è¯»éŸ³æ˜¯ï¼š', options: ['A. Äi', 'B. aÃ¬', 'C. Ã i'], correctAnswer: 2, explanation: '"çˆ±"è¯» Ã iï¼Œç¬¬å››å£°ã€‚' },

  // å¤šéŸ³å­—è¾¨æ
  { id: 'p016', type: 'multi', question: '"é•¿"åœ¨"é•¿é«˜"ä¸­è¯»ï¼š', options: ['A. chÃ¡ng', 'B. zhÇng', 'C. cÇng'], correctAnswer: 1, explanation: '"é•¿"åœ¨è¡¨ç¤ºç”Ÿé•¿æ—¶è¯» zhÇngï¼Œåœ¨è¡¨ç¤ºé•¿çŸ­æ—¶è¯» chÃ¡ngã€‚' },
  { id: 'p017', type: 'multi', question: '"å¥½"åœ¨"å¥½äºº"ä¸­è¯»ï¼š', options: ['A. hÇo', 'B. hÃ o', 'C. hÃ¡o'], correctAnswer: 0, explanation: '"å¥½"åœ¨è¡¨ç¤ºä¼˜ç‚¹æ—¶è¯» hÇoï¼Œåœ¨è¡¨ç¤ºçˆ±å¥½æ—¶è¯» hÃ oã€‚' },
  { id: 'p018', type: 'multi', question: '"ä¹"åœ¨"å¿«ä¹"ä¸­è¯»ï¼š', options: ['A. lÃ¨', 'B. yuÃ¨', 'C. luÃ¨'], correctAnswer: 0, explanation: '"ä¹"åœ¨è¡¨ç¤ºå¿«ä¹æ—¶è¯» lÃ¨ï¼Œåœ¨è¡¨ç¤ºéŸ³ä¹æ—¶è¯» yuÃ¨ã€‚' },
  { id: 'p019', type: 'multi', question: '"è¡Œ"åœ¨"è¡Œèµ°"ä¸­è¯»ï¼š', options: ['A. xÃ­ng', 'B. hÃ¡ng', 'C. hÃ©ng'], correctAnswer: 0, explanation: '"è¡Œ"åœ¨è¡¨ç¤ºè¡Œèµ°æ—¶è¯» xÃ­ngï¼Œåœ¨è¡¨ç¤ºè¡Œä¸šæ—¶è¯» hÃ¡ngã€‚' },
  { id: 'p020', type: 'multi', question: '"å°‘"åœ¨"å°‘å¹´"ä¸­è¯»ï¼š', options: ['A. shÇo', 'B. shÃ o', 'C. sÇo'], correctAnswer: 1, explanation: '"å°‘"åœ¨è¡¨ç¤ºå¹´è½»æ—¶è¯» shÃ oï¼Œåœ¨è¡¨ç¤ºä¸å¤šæ—¶è¯» shÇoã€‚' },
  { id: 'p021', type: 'multi', question: '"é‡"åœ¨"é‡è¦"ä¸­è¯»ï¼š', options: ['A. zhÃ²ng', 'B. chÃ³ng', 'C. zÃ²ng'], correctAnswer: 0, explanation: '"é‡"åœ¨è¡¨ç¤ºé‡è¦/é‡é‡æ—¶è¯» zhÃ²ngï¼Œåœ¨è¡¨ç¤ºé‡å¤æ—¶è¯» chÃ³ngã€‚' },
  { id: 'p022', type: 'multi', question: '"éƒ½"åœ¨"éƒ½æ˜¯"ä¸­è¯»ï¼š', options: ['A. dÅ«', 'B. dÅu', 'C. dÃ¹'], correctAnswer: 1, explanation: '"éƒ½"åœ¨è¡¨ç¤ºå…¨éƒ¨æ—¶è¯» dÅuï¼Œåœ¨è¡¨ç¤ºé¦–éƒ½æ—¶è¯» dÅ«ã€‚' },
  { id: 'p023', type: 'multi', question: '"åª"åœ¨"åªæœ‰"ä¸­è¯»ï¼š', options: ['A. zhÄ«', 'B. zhÇ', 'C. zÇ'], correctAnswer: 1, explanation: '"åª"åœ¨è¡¨ç¤ºåªæœ‰æ—¶è¯» zhÇï¼Œåœ¨è¡¨ç¤ºä¸€åªæ—¶è¯» zhÄ«ã€‚' },
  { id: 'p024', type: 'multi', question: '"ç§"åœ¨"ç§æ ‘"ä¸­è¯»ï¼š', options: ['A. zhÇ’ng', 'B. zhÃ²ng', 'C. zÇ’ng'], correctAnswer: 1, explanation: '"ç§"åœ¨è¡¨ç¤ºç§æ¤æ—¶è¯» zhÃ²ngï¼Œåœ¨è¡¨ç¤ºç§å­æ—¶è¯» zhÇ’ngã€‚' },
  { id: 'p025', type: 'multi', question: '"åˆ†"åœ¨"åˆ†å¤–"ä¸­è¯»ï¼š', options: ['A. fÄ“n', 'B. fÃ¨n', 'C. fÄ“ng'], correctAnswer: 1, explanation: '"åˆ†"åœ¨è¡¨ç¤ºæ ¼å¤–/åˆ†å†…æ—¶è¯» fÃ¨nï¼Œåœ¨è¡¨ç¤ºåˆ†å¼€æ—¶è¯» fÄ“nã€‚' },
  { id: 'p026', type: 'multi', question: '"å¾—"åœ¨"å¾—åˆ°"ä¸­è¯»ï¼š', options: ['A. de', 'B. dÃ©', 'C. dÄ›i'], correctAnswer: 1, explanation: '"å¾—"åœ¨è¡¨ç¤ºå¾—åˆ°æ—¶è¯» dÃ©ï¼Œä½œåŠ©è¯æ—¶è¯» deã€‚' },
  { id: 'p027', type: 'multi', question: '"äº†"åœ¨"äº†è§£"ä¸­è¯»ï¼š', options: ['A. le', 'B. liÇo', 'C. lÃ¨'], correctAnswer: 1, explanation: '"äº†"åœ¨è¡¨ç¤ºæ˜ç™½/ç»“æŸæ—¶è¯» liÇoï¼Œä½œåŠ©è¯æ—¶è¯» leã€‚' },
  { id: 'p028', type: 'multi', question: '"æ²¡"åœ¨"æ²¡æœ‰"ä¸­è¯»ï¼š', options: ['A. mÃ©i', 'B. mÃ²', 'C. mÃ¨i'], correctAnswer: 0, explanation: '"æ²¡"åœ¨è¡¨ç¤ºæ²¡æœ‰æ—¶è¯» mÃ©iï¼Œåœ¨è¡¨ç¤ºæ·¹æ²¡æ—¶è¯» mÃ²ã€‚' },
  { id: 'p029', type: 'multi', question: '"çœ‹"åœ¨"çœ‹å®ˆ"ä¸­è¯»ï¼š', options: ['A. kÃ n', 'B. kÄn', 'C. kÃ¡n'], correctAnswer: 1, explanation: '"çœ‹"åœ¨è¡¨ç¤ºçœ‹å®ˆæ—¶è¯» kÄnï¼Œåœ¨è¡¨ç¤ºçœ‹è§æ—¶è¯» kÃ nã€‚' },
  { id: 'p030', type: 'multi', question: '"åœ°"åœ¨"åœŸåœ°"ä¸­è¯»ï¼š', options: ['A. de', 'B. dÃ¬', 'C. dÃ­'], correctAnswer: 1, explanation: '"åœ°"åœ¨è¡¨ç¤ºåœŸåœ°æ—¶è¯» dÃ¬ï¼Œä½œåŠ©è¯æ—¶è¯» deã€‚' },

  // å£°è°ƒåˆ¤æ–­
  { id: 'p031', type: 'tone', question: '"é£"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬ä¸‰å£°'], correctAnswer: 0, explanation: '"é£"è¯» fÄ“ngï¼Œæ˜¯ç¬¬ä¸€å£°ï¼ˆé˜´å¹³ï¼‰ã€‚' },
  { id: 'p032', type: 'tone', question: '"äº‘"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬ä¸‰å£°'], correctAnswer: 1, explanation: '"äº‘"è¯» yÃºnï¼Œæ˜¯ç¬¬äºŒå£°ï¼ˆé˜³å¹³ï¼‰ã€‚' },
  { id: 'p033', type: 'tone', question: '"é›¨"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬äºŒå£°', 'B. ç¬¬ä¸‰å£°', 'C. ç¬¬å››å£°'], correctAnswer: 1, explanation: '"é›¨"è¯» yÇ”ï¼Œæ˜¯ç¬¬ä¸‰å£°ï¼ˆä¸Šå£°ï¼‰ã€‚' },
  { id: 'p034', type: 'tone', question: '"æ ‘"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬äºŒå£°', 'B. ç¬¬ä¸‰å£°', 'C. ç¬¬å››å£°'], correctAnswer: 2, explanation: '"æ ‘"è¯» shÃ¹ï¼Œæ˜¯ç¬¬å››å£°ï¼ˆå»å£°ï¼‰ã€‚' },
  { id: 'p035', type: 'tone', question: '"èŠ±"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬ä¸‰å£°'], correctAnswer: 0, explanation: '"èŠ±"è¯» huÄï¼Œæ˜¯ç¬¬ä¸€å£°ï¼ˆé˜´å¹³ï¼‰ã€‚' },
  { id: 'p036', type: 'tone', question: '"è‰"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬ä¸‰å£°'], correctAnswer: 2, explanation: '"è‰"è¯» cÇoï¼Œæ˜¯ç¬¬ä¸‰å£°ï¼ˆä¸Šå£°ï¼‰ã€‚' },
  { id: 'p037', type: 'tone', question: '"é¸Ÿ"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬äºŒå£°', 'B. ç¬¬ä¸‰å£°', 'C. ç¬¬å››å£°'], correctAnswer: 1, explanation: '"é¸Ÿ"è¯» niÇoï¼Œæ˜¯ç¬¬ä¸‰å£°ï¼ˆä¸Šå£°ï¼‰ã€‚' },
  { id: 'p038', type: 'tone', question: '"é±¼"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬ä¸‰å£°'], correctAnswer: 1, explanation: '"é±¼"è¯» yÃºï¼Œæ˜¯ç¬¬äºŒå£°ï¼ˆé˜³å¹³ï¼‰ã€‚' },
  { id: 'p039', type: 'tone', question: '"é©¬"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬äºŒå£°', 'B. ç¬¬ä¸‰å£°', 'C. ç¬¬å››å£°'], correctAnswer: 1, explanation: '"é©¬"è¯» mÇï¼Œæ˜¯ç¬¬ä¸‰å£°ï¼ˆä¸Šå£°ï¼‰ã€‚' },
  { id: 'p040', type: 'tone', question: '"ç‰›"æ˜¯ç¬¬å‡ å£°ï¼Ÿ', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬ä¸‰å£°'], correctAnswer: 1, explanation: '"ç‰›"è¯» niÃºï¼Œæ˜¯ç¬¬äºŒå£°ï¼ˆé˜³å¹³ï¼‰ã€‚' },

  // æ˜“é”™è¯»éŸ³
  { id: 'p041', type: 'error', question: '"æ¯”è¾ƒ"çš„"è¾ƒ"è¯»ï¼š', options: ['A. jiÇo', 'B. jiÃ o', 'C. jiÄo'], correctAnswer: 1, explanation: '"è¾ƒ"åœ¨æ¯”è¾ƒä¸­è¯» jiÃ oï¼Œç¬¬å››å£°ã€‚' },
  { id: 'p042', type: 'error', question: '"å› ä¸º"çš„"ä¸º"è¯»ï¼š', options: ['A. wÃ©i', 'B. wÃ¨i', 'C. wÃ¨i'], correctAnswer: 1, explanation: '"å› ä¸º"è¯» yÄ«n wÃ¨iï¼Œ"ä¸º"è¯»ç¬¬å››å£°ã€‚' },
  { id: 'p043', type: 'error', question: '"è™½ç„¶"çš„"è™½"è¯»ï¼š', options: ['A. suÄ«', 'B. suÃ­', 'C. shuÄ«'], correctAnswer: 0, explanation: '"è™½"è¯» suÄ«ï¼Œç¬¬ä¸€å£°ã€‚' },
  { id: 'p044', type: 'error', question: '"è€Œä¸”"çš„"è€Œ"è¯»ï¼š', options: ['A. Ä›r', 'B. Ã©r', 'C. Ã¨r'], correctAnswer: 1, explanation: '"è€Œ"è¯» Ã©rï¼Œç¬¬äºŒå£°ã€‚' },
  { id: 'p045', type: 'error', question: '"ç”šè‡³"çš„"ç”š"è¯»ï¼š', options: ['A. shÃ¨n', 'B. shÃ©ng', 'C. sÃ¨n'], correctAnswer: 0, explanation: '"ç”š"è¯» shÃ¨nï¼Œç¬¬å››å£°ã€‚' },
  { id: 'p046', type: 'error', question: '"æš‚æ—¶"çš„"æš‚"è¯»ï¼š', options: ['A. zÃ n', 'B. zhÃ n', 'C. zhÇn'], correctAnswer: 0, explanation: '"æš‚"è¯» zÃ nï¼Œç¬¬å››å£°ã€‚' },
  { id: 'p047', type: 'error', question: '"å³ä½¿"çš„"å³"è¯»ï¼š', options: ['A. jÃ­', 'B. jÃ¬', 'C. jÄ«'], correctAnswer: 0, explanation: '"å³"è¯» jÃ­ï¼Œç¬¬äºŒå£°ã€‚' },
  { id: 'p048', type: 'error', question: '"æ°”æ°›"çš„"æ°›"è¯»ï¼š', options: ['A. fÄ“n', 'B. fÃ¨n', 'C. fÃ¨n'], correctAnswer: 0, explanation: '"æ°›"è¯» fÄ“nï¼Œç¬¬ä¸€å£°ã€‚' },
  { id: 'p049', type: 'error', question: '"å¬å¼€"çš„"å¬"è¯»ï¼š', options: ['A. zhÃ o', 'B. zhÄo', 'C. zÃ o'], correctAnswer: 0, explanation: '"å¬"è¯» zhÃ oï¼Œç¬¬å››å£°ã€‚' },
  { id: 'p050', type: 'error', question: '"å¤„ç†"çš„"å¤„"è¯»ï¼š', options: ['A. chÇ”', 'B. chÃ¹', 'C. cÇ”'], correctAnswer: 0, explanation: '"å¤„"åœ¨å¤„ç†ä¸­è¯» chÇ”ï¼Œç¬¬ä¸‰å£°ã€‚' },

  // æ›´å¤šæ˜“é”™è¯»éŸ³
  { id: 'p051', type: 'error', question: '"æ¨¡æ ·"çš„"æ¨¡"è¯»ï¼š', options: ['A. mÃ³', 'B. mÃº', 'C. mÃ²'], correctAnswer: 1, explanation: '"æ¨¡"åœ¨æ¨¡æ ·ä¸­è¯» mÃºï¼Œç¬¬äºŒå£°ã€‚' },
  { id: 'p052', type: 'error', question: '"è–„å¼±"çš„"è–„"è¯»ï¼š', options: ['A. bÃ³', 'B. bÃ¡o', 'C. bÃ²'], correctAnswer: 0, explanation: '"è–„"åœ¨è–„å¼±ä¸­è¯» bÃ³ï¼Œç¬¬äºŒå£°ã€‚' },
  { id: 'p053', type: 'error', question: '"å‰¥å‰Š"çš„"å‰Š"è¯»ï¼š', options: ['A. xiÄo', 'B. xuÄ“', 'C. xiÃ o'], correctAnswer: 1, explanation: '"å‰Š"åœ¨å‰¥å‰Šä¸­è¯» xuÄ“ï¼Œç¬¬ä¸€å£°ã€‚' },
  { id: 'p054', type: 'error', question: '"è¡€æ³Š"çš„"æ³Š"è¯»ï¼š', options: ['A. bÃ³', 'B. pÅ', 'C. pÃ²'], correctAnswer: 1, explanation: '"æ³Š"åœ¨è¡€æ³Šä¸­è¯» pÅï¼Œç¬¬ä¸€å£°ã€‚' },
  { id: 'p055', type: 'error', question: '"å‚å·®"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. cÄn chÄ', 'B. cÄ“n cÄ«', 'C. shÄ“n chÃ '], correctAnswer: 1, explanation: '"å‚å·®"è¯» cÄ“n cÄ«ï¼Œæ˜¯ç‰¹æ®Šè¯»éŸ³ã€‚' },
  { id: 'p056', type: 'error', question: '"è›¤èœŠ"çš„"è›¤"è¯»ï¼š', options: ['A. gÃ©', 'B. hÃ¡', 'C. gÃ¡'], correctAnswer: 1, explanation: '"è›¤"åœ¨è›¤èœŠä¸­è¯» hÃ¡ï¼Œç¬¬äºŒå£°ã€‚' },
  { id: 'p057', type: 'error', question: '"è„Šæ¢"çš„"è„Š"è¯»ï¼š', options: ['A. jÃ­', 'B. jÇ', 'C. jÇ'], correctAnswer: 1, explanation: '"è„Š"åœ¨è„Šæ¢ä¸­è¯» jÇï¼Œç¬¬ä¸‰å£°ã€‚' },
  { id: 'p058', type: 'error', question: '"å°½å¿«"çš„"å°½"è¯»ï¼š', options: ['A. jÃ¬n', 'B. jÇn', 'C. jÄ«n'], correctAnswer: 1, explanation: '"å°½"åœ¨å°½å¿«ä¸­è¯» jÇnï¼Œç¬¬ä¸‰å£°ã€‚' },
  { id: 'p059', type: 'error', question: '"ç»™äºˆ"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. gÄ›i yÇ”', 'B. jÇ yÇ”', 'C. gÄ›i yÇ”'], correctAnswer: 1, explanation: '"ç»™äºˆ"è¯» jÇ yÇ”ï¼Œæ˜¯ç‰¹æ®Šè¯»éŸ³ã€‚' },
  { id: 'p060', type: 'error', question: '"æ‹®æ®"çš„"æ®"è¯»ï¼š', options: ['A. jÃ¹', 'B. jÅ«', 'C. jÇ”'], correctAnswer: 1, explanation: '"æ®"åœ¨æ‹®æ®ä¸­è¯» jÅ«ï¼Œç¬¬ä¸€å£°ã€‚' },

  // æ›´å¤šå¤šéŸ³å­—
  { id: 'p061', type: 'multi', question: '"å’Œ"åœ¨"å’Œæ°”"ä¸­è¯»ï¼š', options: ['A. hÃ©', 'B. hÃ¨', 'C. huÃ³'], correctAnswer: 0, explanation: '"å’Œ"åœ¨è¡¨ç¤ºå’Œæ°”æ—¶è¯» hÃ©ï¼Œåœ¨é™„å’Œæ—¶è¯» hÃ¨ï¼Œåœ¨å’Œé¢æ—¶è¯» huÃ³ã€‚' },
  { id: 'p062', type: 'multi', question: '"å’Œ"åœ¨"å’Œé¢"ä¸­è¯»ï¼š', options: ['A. hÃ©', 'B. hÃ¨', 'C. huÃ³'], correctAnswer: 2, explanation: '"å’Œ"åœ¨å’Œé¢æ—¶è¯» huÃ³ï¼Œç¬¬äºŒå£°ã€‚' },
  { id: 'p063', type: 'multi', question: '"å·®"åœ¨"å·®åˆ«"ä¸­è¯»ï¼š', options: ['A. chÄ', 'B. chÃ ', 'C. chÄi'], correctAnswer: 0, explanation: '"å·®"åœ¨è¡¨ç¤ºå·®åˆ«æ—¶è¯» chÄï¼Œåœ¨è¡¨ç¤ºä¸å¥½æ—¶è¯» chÃ ï¼Œåœ¨å‡ºå·®æ—¶è¯» chÄiã€‚' },
  { id: 'p064', type: 'multi', question: '"å·®"åœ¨"å·®ä¸å¤š"ä¸­è¯»ï¼š', options: ['A. chÄ', 'B. chÃ ', 'C. chÄi'], correctAnswer: 1, explanation: '"å·®"åœ¨å·®ä¸å¤šä¸­è¡¨ç¤ºç¨‹åº¦ï¼Œè¯» chÃ ï¼Œç¬¬å››å£°ã€‚' },
  { id: 'p065', type: 'multi', question: '"å®¿"åœ¨"ä½å®¿"ä¸­è¯»ï¼š', options: ['A. sÃ¹', 'B. xiÇ”', 'C. xiÃ¹'], correctAnswer: 0, explanation: '"å®¿"åœ¨ä½å®¿ä¸­è¯» sÃ¹ï¼Œåœ¨è¡¨ç¤ºä¸€å®¿æ—¶è¯» xiÇ”ï¼Œåœ¨æ˜Ÿå®¿æ—¶è¯» xiÃ¹ã€‚' },
  { id: 'p066', type: 'multi', question: '"å’½"åœ¨"å’½ä¸‹"ä¸­è¯»ï¼š', options: ['A. yÄn', 'B. yÃ n', 'C. yÃ¨'], correctAnswer: 1, explanation: '"å’½"åœ¨å’½ä¸‹æ—¶è¯» yÃ nï¼Œåœ¨å’½å–‰æ—¶è¯» yÄnï¼Œåœ¨å‘œå’½æ—¶è¯» yÃ¨ã€‚' },
  { id: 'p067', type: 'multi', question: '"ç››"åœ¨"èŒ‚ç››"ä¸­è¯»ï¼š', options: ['A. shÃ¨ng', 'B. chÃ©ng', 'C. shÃ©n'], correctAnswer: 0, explanation: '"ç››"åœ¨èŒ‚ç››ä¸­è¯» shÃ¨ngï¼Œåœ¨ç››é¥­æ—¶è¯» chÃ©ngã€‚' },
  { id: 'p068', type: 'multi', question: '"å‡"åœ¨"æ”¾å‡"ä¸­è¯»ï¼š', options: ['A. jiÇ', 'B. jiÃ ', 'C. jiÄ'], correctAnswer: 1, explanation: '"å‡"åœ¨æ”¾å‡ä¸­è¯» jiÃ ï¼Œç¬¬å››å£°ï¼›åœ¨çœŸå‡ä¸­è¯» jiÇã€‚' },
  { id: 'p069', type: 'multi', question: '"éš¾"åœ¨"å›°éš¾"ä¸­è¯»ï¼š', options: ['A. nÃ¡n', 'B. nÃ n', 'C. nÇn'], correctAnswer: 0, explanation: '"éš¾"åœ¨å›°éš¾ä¸­è¯» nÃ¡nï¼Œç¬¬äºŒå£°ï¼›åœ¨ç¾éš¾ä¸­è¯» nÃ nã€‚' },
  { id: 'p070', type: 'multi', question: '"å¼º"åœ¨"åšå¼º"ä¸­è¯»ï¼š', options: ['A. qiÃ¡ng', 'B. qiÇng', 'C. jiÃ ng'], correctAnswer: 0, explanation: '"å¼º"åœ¨åšå¼ºä¸­è¯» qiÃ¡ngï¼Œåœ¨å‹‰å¼ºä¸­è¯» qiÇngï¼Œåœ¨å€”å¼ºä¸­è¯» jiÃ ngã€‚' },

  // Ã¼æ‹¼å†™è§„åˆ™
  { id: 'p071', type: 'rule', question: '"jÃ¼"çš„æ­£ç¡®æ‹¼å†™æ˜¯ï¼š', options: ['A. jÃ¼', 'B. ju', 'C. ju'], correctAnswer: 1, explanation: 'Ã¼ä¸jã€qã€xç›¸æ‹¼æ—¶ï¼ŒÃ¼ä¸Šä¸¤ç‚¹çœç•¥ï¼Œå†™æˆjuã€‚' },
  { id: 'p072', type: 'rule', question: '"qÃ¼"çš„æ­£ç¡®æ‹¼å†™æ˜¯ï¼š', options: ['A. qÃ¼', 'B. qu', 'C. qÃ¹'], correctAnswer: 1, explanation: 'Ã¼ä¸jã€qã€xç›¸æ‹¼æ—¶ï¼ŒÃ¼ä¸Šä¸¤ç‚¹çœç•¥ï¼Œå†™æˆquã€‚' },
  { id: 'p073', type: 'rule', question: '"xÃ¼"çš„æ­£ç¡®æ‹¼å†™æ˜¯ï¼š', options: ['A. xÃ¼', 'B. xu', 'C. xÃ¹'], correctAnswer: 1, explanation: 'Ã¼ä¸jã€qã€xç›¸æ‹¼æ—¶ï¼ŒÃ¼ä¸Šä¸¤ç‚¹çœç•¥ï¼Œå†™æˆxuã€‚' },
  { id: 'p074', type: 'rule', question: '"lÃ¼"çš„æ­£ç¡®æ‹¼å†™æ˜¯ï¼š', options: ['A. lÃ¼', 'B. lu', 'C. lv'], correctAnswer: 0, explanation: 'Ã¼ä¸lã€nç›¸æ‹¼æ—¶ï¼ŒÃ¼ä¸Šä¸¤ç‚¹ä¸èƒ½çœç•¥ï¼Œå†™æˆlÃ¼ã€‚' },
  { id: 'p075', type: 'rule', question: '"nÃ¼"çš„æ­£ç¡®æ‹¼å†™æ˜¯ï¼š', options: ['A. nÃ¼', 'B. nu', 'C. nv'], correctAnswer: 0, explanation: 'Ã¼ä¸lã€nç›¸æ‹¼æ—¶ï¼ŒÃ¼ä¸Šä¸¤ç‚¹ä¸èƒ½çœç•¥ï¼Œå†™æˆnÃ¼ã€‚' },
  { id: 'p076', type: 'rule', question: '"å¥³"çš„æ­£ç¡®æ‹¼éŸ³æ˜¯ï¼š', options: ['A. nÇš', 'B. nÇ”', 'C. nÃ¼'], correctAnswer: 0, explanation: '"å¥³"è¯» nÇšï¼ŒÃ¼ä¸nç›¸æ‹¼æ—¶ä¸¤ç‚¹ä¿ç•™ã€‚' },
  { id: 'p077', type: 'rule', question: '"ç»¿"çš„æ­£ç¡®æ‹¼éŸ³æ˜¯ï¼š', options: ['A. lÇœ', 'B. lÇ”', 'C. lÃ¹'], correctAnswer: 0, explanation: '"ç»¿"è¯» lÇœï¼ŒÃ¼ä¸lç›¸æ‹¼æ—¶ä¸¤ç‚¹ä¿ç•™ã€‚' },
  { id: 'p078', type: 'rule', question: '"å»"çš„æ­£ç¡®æ‹¼éŸ³æ˜¯ï¼š', options: ['A. qÃ¹', 'B. qÇœ', 'C. qÃ¼'], correctAnswer: 0, explanation: '"å»"è¯» qÃ¹ï¼ŒÃ¼ä¸qç›¸æ‹¼æ—¶ä¸¤ç‚¹çœç•¥ã€‚' },
  { id: 'p079', type: 'rule', question: '"å¥"çš„æ­£ç¡®æ‹¼éŸ³æ˜¯ï¼š', options: ['A. jÃ¹', 'B. jÇœ', 'C. jÃ¼'], correctAnswer: 0, explanation: '"å¥"è¯» jÃ¹ï¼ŒÃ¼ä¸jç›¸æ‹¼æ—¶ä¸¤ç‚¹çœç•¥ã€‚' },
  { id: 'p080', type: 'rule', question: '"å­¦"çš„æ­£ç¡®æ‹¼éŸ³æ˜¯ï¼š', options: ['A. xÃ¼Ã©', 'B. xuÃ©', 'C. xÃ©'], correctAnswer: 1, explanation: '"å­¦"è¯» xuÃ©ï¼ŒÃ¼ä¸xç›¸æ‹¼æ—¶ä¸¤ç‚¹çœç•¥ã€‚' },

  // æ•´ä½“è®¤è¯»éŸ³èŠ‚
  { id: 'p081', type: 'overall', question: '"çŸ¥"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"çŸ¥"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚zhiï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },
  { id: 'p082', type: 'overall', question: '"åƒ"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"åƒ"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚chiï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },
  { id: 'p083', type: 'overall', question: '"æ—¥"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"æ—¥"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚riï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },
  { id: 'p084', type: 'overall', question: '"å­"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"å­"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚ziï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },
  { id: 'p085', type: 'overall', question: '"è¯"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"è¯"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚ciï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },
  { id: 'p086', type: 'overall', question: '"æ€"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"æ€"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚siï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },
  { id: 'p087', type: 'overall', question: '"è¡£"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"è¡£"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚yiï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },
  { id: 'p088', type: 'overall', question: '"ä¹Œ"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"ä¹Œ"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚wuï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },
  { id: 'p089', type: 'overall', question: '"é›¨"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"é›¨"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚yuï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },
  { id: 'p090', type: 'overall', question: '"è¿œ"æ˜¯ï¼š', options: ['A. æ•´ä½“è®¤è¯»éŸ³èŠ‚', 'B. æ‹¼è¯»éŸ³èŠ‚', 'C. ä¸‰æ‹¼éŸ³èŠ‚'], correctAnswer: 0, explanation: '"è¿œ"æ˜¯æ•´ä½“è®¤è¯»éŸ³èŠ‚yuanï¼Œä¸ç”¨æ‹¼è¯»ã€‚' },

  // å˜è°ƒè§„åˆ™
  { id: 'p091', type: 'tone_change', question: '"ä¸€"åœ¨"ä¸€å¤©"ä¸­è¯»ï¼š', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬å››å£°'], correctAnswer: 0, explanation: '"ä¸€"åœ¨ç¬¬ä¸€å£°å‰è¯»åŸå£°ï¼ˆç¬¬ä¸€å£°ï¼‰ï¼Œå¦‚"ä¸€å¤©"ã€‚' },
  { id: 'p092', type: 'tone_change', question: '"ä¸€"åœ¨"ä¸€å¹´"ä¸­è¯»ï¼š', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬å››å£°'], correctAnswer: 0, explanation: '"ä¸€"åœ¨ç¬¬äºŒå£°å‰è¯»åŸå£°ï¼ˆç¬¬ä¸€å£°ï¼‰ï¼Œå¦‚"ä¸€å¹´"ã€‚' },
  { id: 'p093', type: 'tone_change', question: '"ä¸€"åœ¨"ä¸€èµ·"ä¸­è¯»ï¼š', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬å››å£°'], correctAnswer: 1, explanation: '"ä¸€"åœ¨ç¬¬ä¸‰å£°å‰è¯»ç¬¬äºŒå£°ï¼Œå¦‚"ä¸€èµ·"ã€‚' },
  { id: 'p094', type: 'tone_change', question: '"ä¸€"åœ¨"ä¸€åŠ"ä¸­è¯»ï¼š', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬å››å£°'], correctAnswer: 1, explanation: '"ä¸€"åœ¨ç¬¬å››å£°å‰è¯»ç¬¬äºŒå£°ï¼Œå¦‚"ä¸€åŠ"ã€‚' },
  { id: 'p095', type: 'tone_change', question: '"ä¸"åœ¨"ä¸æ˜¯"ä¸­è¯»ï¼š', options: ['A. ç¬¬äºŒå£°', 'B. ç¬¬å››å£°', 'C. ç¬¬ä¸€å£°'], correctAnswer: 1, explanation: '"ä¸"åœ¨ç¬¬å››å£°å‰è¯»ç¬¬äºŒå£°ï¼Œå¦‚"ä¸æ˜¯"ã€‚' },
  { id: 'p096', type: 'tone_change', question: '"ä¸"åœ¨"ä¸å»"ä¸­è¯»ï¼š', options: ['A. ç¬¬äºŒå£°', 'B. ç¬¬å››å£°', 'C. ç¬¬ä¸€å£°'], correctAnswer: 0, explanation: '"ä¸"åœ¨ç¬¬å››å£°"å»"å‰è¯»ç¬¬äºŒå£°ã€‚' },
  { id: 'p097', type: 'tone_change', question: '"ä¸"åœ¨"ä¸å¥½"ä¸­è¯»ï¼š', options: ['A. ç¬¬äºŒå£°', 'B. ç¬¬å››å£°', 'C. ç¬¬ä¸€å£°'], correctAnswer: 0, explanation: '"ä¸"åœ¨ç¬¬ä¸‰å£°å‰è¯»ç¬¬äºŒå£°ï¼Œå¦‚"ä¸å¥½"ã€‚' },
  { id: 'p098', type: 'tone_change', question: '"ä¸"åœ¨"ä¸å¤š"ä¸­è¯»ï¼š', options: ['A. ç¬¬äºŒå£°', 'B. ç¬¬å››å£°', 'C. ç¬¬ä¸€å£°'], correctAnswer: 0, explanation: '"ä¸"åœ¨ç¬¬ä¸€å£°å‰è¯»åŸå£°ï¼ˆç¬¬å››å£°ï¼‰ï¼Œä½†"ä¸å¤š"ç‰¹æ®Šå¤„ç†ã€‚' },
  { id: 'p099', type: 'tone_change', question: '"ä¸€ä¸ª"ä¸­"ä¸€"è¯»ï¼š', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬å››å£°'], correctAnswer: 1, explanation: '"ä¸€"åœ¨ç¬¬å››å£°"ä¸ª"å‰è¯»ç¬¬äºŒå£°ï¼Œå¦‚"ä¸€ä¸ª"ã€‚' },
  { id: 'p100', type: 'tone_change', question: '"ä¸‰å£°å˜è°ƒ"ä¸­ï¼Œä¸¤ä¸ªä¸‰å£°è¿è¯»æ—¶ï¼Œç¬¬ä¸€ä¸ªå˜æˆï¼š', options: ['A. ç¬¬ä¸€å£°', 'B. ç¬¬äºŒå£°', 'C. ç¬¬å››å£°'], correctAnswer: 1, explanation: 'ä¸¤ä¸ªä¸‰å£°è¿è¯»ï¼Œç¬¬ä¸€ä¸ªå˜æˆç¬¬äºŒå£°ï¼Œå¦‚"ä½ å¥½"ä¸­"ä½ "è¯»äºŒå£°ã€‚' }
]

function Pinyin() {
  const [questions, setQuestions] = useState([])
  const [currentIndex, setCurrentIndex] = useState(0)
  const [selectedAnswer, setSelectedAnswer] = useState(null)
  const [showResult, setShowResult] = useState(false)
  const [score, setScore] = useState(0)
  const [completed, setCompleted] = useState(false)
  const [isFavorited, setIsFavorited] = useState(false)
  const [favoriteLoading, setFavoriteLoading] = useState(false)
  // è®°å½•æ¯é“é¢˜çš„ç­”æ¡ˆï¼Œç”¨äºä¿å­˜åˆ° answer_history
  const userAnswers = useRef({})

  const currentQuestion = questions[currentIndex]

  useDidShow(() => {
    startPractice()
    loadFavorites()
  })

  /**
   * åŠ è½½ç”¨æˆ·çš„æ”¶è—åˆ—è¡¨
   */
  const loadFavorites = async () => {
    try {
      const favorites = await questionService.getFavorites(1, 1000)
      FAVORITES_CACHE = new Set(favorites.map(f => f.id || f._id))
      updateFavoriteStatus()
    } catch (err) {
      console.error('åŠ è½½æ”¶è—å¤±è´¥:', err)
    }
  }

  /**
   * æ›´æ–°å½“å‰é¢˜ç›®çš„æ”¶è—çŠ¶æ€
   */
  const updateFavoriteStatus = () => {
    if (currentQuestion) {
      setIsFavorited(FAVORITES_CACHE.has(currentQuestion.id))
    }
  }

  /**
   * åˆ‡æ¢æ”¶è—çŠ¶æ€
   */
  const handleToggleFavorite = async () => {
    if (!currentQuestion || favoriteLoading) return

    setFavoriteLoading(true)
    try {
      // ä¼ é€’å®Œæ•´çš„é¢˜ç›®æ•°æ®
      const questionData = {
        id: currentQuestion.id,
        type: currentQuestion.type || 'pinyin',
        question: currentQuestion.question,
        options: currentQuestion.options,
        correctAnswer: currentQuestion.correctAnswer,
        explanation: currentQuestion.explanation || ''
      }

      const success = await questionService.toggleFavorite(currentQuestion.id, questionData)
      if (success) {
        if (isFavorited) {
          FAVORITES_CACHE.delete(currentQuestion.id)
        } else {
          FAVORITES_CACHE.add(currentQuestion.id)
        }
        setIsFavorited(!isFavorited)
        Taro.showToast({
          title: isFavorited ? 'å·²å–æ¶ˆæ”¶è—' : 'å·²æ”¶è—',
          icon: isFavorited ? 'none' : 'success',
          duration: 1500
        })
      }
    } catch (err) {
      console.error('æ”¶è—å¤±è´¥:', err)
      Taro.showToast({ title: 'æ“ä½œå¤±è´¥', icon: 'none' })
    } finally {
      setFavoriteLoading(false)
    }
  }

  // é¢˜ç›®å˜åŒ–æ—¶æ›´æ–°æ”¶è—çŠ¶æ€
  useEffect(() => {
    updateFavoriteStatus()
  }, [currentIndex, questions])

  const startPractice = () => {
    // éšæœºæ‰“ä¹±é¢˜ç›®ï¼Œå–10é“
    const shuffled = [...PINYIN_QUESTIONS].sort(() => Math.random() - 0.5)
    setQuestions(shuffled.slice(0, 10))
    setCurrentIndex(0)
    setSelectedAnswer(null)
    setShowResult(false)
    setScore(0)
    setCompleted(false)
    userAnswers.current = {} // æ¸…ç©ºç­”æ¡ˆè®°å½•
  }

  const handleAnswer = (index) => {
    if (selectedAnswer !== null) return
    setSelectedAnswer(index)

    const currentQuestion = questions[currentIndex]
    // è®°å½•ç”¨æˆ·ç­”æ¡ˆ
    userAnswers.current[currentQuestion.id] = index

    if (index === currentQuestion.correctAnswer) {
      setScore(score + 1)
    }
    setShowResult(true)
  }

  const handleNext = () => {
    if (currentIndex < questions.length - 1) {
      setCurrentIndex(currentIndex + 1)
      setSelectedAnswer(null)
      setShowResult(false)
    } else {
      finishPractice()
    }
  }

  const finishPractice = async () => {
    setCompleted(true)

    // å‡†å¤‡ç­”é¢˜æ•°æ®ï¼ŒåŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯
    const answerData = questions.map(q => {
      const userAnswer = userAnswers.current[q.id] ?? -1
      const isCorrect = userAnswer === q.correctAnswer
      return {
        questionId: q.id,
        answer: userAnswer,
        isCorrect,
        questionType: 'pinyin',
        // åŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯ï¼Œä»¥ä¾¿é”™é¢˜é‡åšæ—¶ä½¿ç”¨
        questionText: q.question || '',
        options: q.options || [],
        correctAnswer: q.correctAnswer
      }
    })

    // 1. ä¿å­˜ç­”é¢˜å†å²åˆ° answer_history
    try {
      await Taro.cloud.callFunction({
        name: 'question',
        data: {
          action: 'submitBatch',
          answers: answerData
        }
      })
    } catch (err) {
      Taro.showToast({ title: 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', icon: 'none', duration: 2000 })
    }

    // 2. ä¿å­˜å­¦ä¹ è®°å½•åˆ° study_records
    try {
      await studyService.addRecord({
        type: 'pinyin',
        title: 'æ‹¼éŸ³å­¦ä¹ ',
        score: Math.round((score / questions.length) * 100),
        totalQuestions: questions.length,
        correctAnswers: score,
        duration: 5
      })

      // 3. è§¦å‘ç»Ÿè®¡æ›´æ–°äº‹ä»¶ï¼ˆå®ç°å®æ—¶åˆ·æ–°ï¼‰
      eventBus.emit(EVENTS.STUDY_RECORD_UPDATED, {
        type: 'pinyin',
        score: Math.round((score / questions.length) * 100),
        correctCount: score,
        totalCount: questions.length
      })
    } catch (err) {
      console.error('ä¿å­˜å­¦ä¹ è®°å½•å¤±è´¥:', err)
    }
  }

  if (questions.length === 0) {
    return <View className="pinyin-page"><Text>åŠ è½½ä¸­...</Text></View>
  }

  if (completed) {
    return (
      <View className="pinyin-page">
        <View className="result-page">
          <View className="result-card">
            <Text className="result-title">ç»ƒä¹ å®Œæˆï¼</Text>
            <Text className="result-score">{score} / {questions.length}</Text>
            <Text className="result-desc">
              {score >= questions.length * 0.8 ? 'å¤ªæ£’äº†ï¼' :
               score >= questions.length * 0.6 ? 'ç»§ç»­åŠ æ²¹ï¼' : 'å†ç»ƒä¹ ä¸€ä¸‹å§ï¼'}
            </Text>
            <View className="result-actions">
              <View className="action-btn secondary" onClick={startPractice}>å†ç»ƒä¸€æ¬¡</View>
              <View className="action-btn" onClick={() => Taro.navigateBack()}>è¿”å›</View>
            </View>
          </View>
        </View>
      </View>
    )
  }

  return (
    <View className="pinyin-page">
      {/* è¿›åº¦æ¡ */}
      <View className="progress-bar">
        <View
          className="progress-fill"
          style={{ width: `${((currentIndex + 1) / questions.length) * 100}%` }}
        />
      </View>

      <ScrollView scrollY className="content-scroll">
        {/* é¢˜ç›®å¡ç‰‡ */}
        <View className="question-card">
          <View className="question-header">
            <Text className="question-num">ç¬¬ {currentIndex + 1} / {questions.length} é¢˜</Text>
            <View className="question-tag">æ‹¼éŸ³ç»ƒä¹ </View>
            <View
              className={`favorite-btn ${isFavorited ? 'favorited' : ''} ${favoriteLoading ? 'loading' : ''}`}
              onClick={handleToggleFavorite}
            >
              <Text className="favorite-icon">{isFavorited ? 'â˜…' : 'â˜†'}</Text>
            </View>
          </View>

          <View className="question-content">
            <Text className="question-text">{currentQuestion?.question}</Text>
          </View>

          {/* é€‰é¡¹åˆ—è¡¨ */}
          <View className="options-list">
            {currentQuestion?.options.map((option, index) => {
              const isSelected = selectedAnswer === index
              const isCorrect = index === currentQuestion.correctAnswer
              const showCorrect = showResult && isCorrect

              return (
                <View
                  key={index}
                  className={`option-item ${isSelected ? (isCorrect ? 'correct' : 'wrong') : ''} ${showCorrect ? 'correct' : ''}`}
                  onClick={() => handleAnswer(index)}
                >
                  <Text className="option-text">{option}</Text>
                  {showCorrect && <Text className="option-icon">âœ“</Text>}
                  {isSelected && !isCorrect && <Text className="option-icon">Ã—</Text>}
                </View>
              )
            })}
          </View>

          {/* è§£æ */}
          {showResult && currentQuestion?.explanation && (
            <View className="explanation-box">
              <Text className="explanation-label">è§£æ</Text>
              <Text className="explanation-text">{currentQuestion.explanation}</Text>
            </View>
          )}

          {/* ä¸‹ä¸€é¢˜æŒ‰é’® */}
          {showResult && (
            <View className="next-btn" onClick={handleNext}>
              <Text>{currentIndex < questions.length - 1 ? 'ä¸‹ä¸€é¢˜' : 'æŸ¥çœ‹ç»“æœ'}</Text>
            </View>
          )}
        </View>
      </ScrollView>
    </View>
  )
}

export default Pinyin


// ===== src/pages/idiom/index.jsx =====
/**
 * æˆè¯­å­¦ä¹ é¡µé¢ - é€‰æ‹©é¢˜æ¨¡å¼
 */
import { useState, useRef, useEffect } from 'react'
import { View, Text, ScrollView } from '@tarojs/components'
import Taro from '@tarojs/taro'
import { useDidShow } from '@tarojs/taro'
import studyService from '../../services/study'
import questionService from '../../services/question'
import eventBus, { EVENTS } from '../../utils/eventBus'
import './index.less'

// æ”¶è—çŠ¶æ€ç¼“å­˜
let FAVORITES_CACHE = new Set()

// æˆè¯­é€‰æ‹©é¢˜åº“ï¼ˆåŸºäºK12çœŸé¢˜ï¼‰
const IDIOM_QUESTIONS = [
  // æˆè¯­å¡«ç©º
  { id: 'i001', type: 'fill', question: 'ç”»___æ·»è¶³', options: ['A. è›‡', 'B. é¾™', 'C. é±¼', 'D. é¸Ÿ'], correctAnswer: 0, explanation: '"ç”»è›‡æ·»è¶³"æ¯”å–»åšäº†å¤šä½™çš„äº‹ï¼Œéä½†æ— ç›Šï¼Œåè€Œä¸åˆé€‚ã€‚' },
  { id: 'i002', type: 'fill', question: 'å®ˆ___å¾…å…”', options: ['A. çŒª', 'B. æ ª', 'C. ç ', 'D. ç«¹'], correctAnswer: 1, explanation: '"å®ˆæ ªå¾…å…”"æ¯”å–»æ­»å®ˆç‹­éš˜ç»éªŒï¼Œä¸çŸ¥å˜é€šã€‚' },
  { id: 'i003', type: 'fill', question: 'æ©___ç›—é“ƒ', options: ['A. è€³', 'B. ç›®', 'C. æ‰‹', 'D. å£'], correctAnswer: 0, explanation: '"æ©è€³ç›—é“ƒ"æ¯”å–»è‡ªå·±æ¬ºéª—è‡ªå·±ã€‚' },
  { id: 'i004', type: 'fill', question: 'äº¡ç¾Š___ç‰¢', options: ['A. è¡¥', 'B. æ•', 'C. ä¸', 'D. ä¿®'], correctAnswer: 0, explanation: '"äº¡ç¾Šè¡¥ç‰¢"æ¯”å–»å‡ºäº†é—®é¢˜ä»¥åæƒ³åŠæ³•è¡¥æ•‘ï¼Œå¯ä»¥é˜²æ­¢ç»§ç»­å—æŸå¤±ã€‚' },
  { id: 'i005', type: 'fill', question: 'åˆ»èˆŸæ±‚___', options: ['A. å‰‘', 'B. ç®­', 'C. å¥', 'D. è§'], correctAnswer: 0, explanation: '"åˆ»èˆŸæ±‚å‰‘"æ¯”å–»æ‹˜æ³¥æˆæ³•ï¼Œä¸çŸ¥é“å˜é€šã€‚' },
  { id: 'i006', type: 'fill', question: 'äº•åº•ä¹‹___', options: ['A. è›™', 'B. è™¾', 'C. é±¼', 'D. èŸ¹'], correctAnswer: 0, explanation: '"äº•åº•ä¹‹è›™"æ¯”å–»è§è¯†ç‹­çª„çš„äººã€‚' },
  { id: 'i007', type: 'fill', question: 'ç‹å‡___å¨', options: ['A. è™', 'B. ç‹¼', 'C. ç‹®', 'D. è±¹'], correctAnswer: 0, explanation: '"ç‹å‡è™å¨"æ¯”å–»ä¾ä»—åˆ«äººçš„åŠ¿åŠ›æ¥æ¬ºå‹äººã€‚' },
  { id: 'i008', type: 'fill', question: 'è‡ªç›¸___', options: ['A. çŸ›ç›¾', 'B. çŸ›é¡¿', 'C. èŒ…ç›¾', 'D. çŸ›æ¥¯'], correctAnswer: 0, explanation: '"è‡ªç›¸çŸ›ç›¾"æ¯”å–»è‡ªå·±è¯´è¯åšäº‹å‰åæŠµè§¦ã€‚' },
  { id: 'i009', type: 'fill', question: 'æ‹”è‹—___é•¿', options: ['A. åŠ©', 'B. ä¿ƒ', 'C. é©»', 'D. æ³¨'], correctAnswer: 0, explanation: '"æ‹”è‹—åŠ©é•¿"æ¯”å–»è¿åäº‹ç‰©å‘å±•çš„å®¢è§‚è§„å¾‹ï¼Œæ€¥äºæ±‚æˆï¼Œåè€ŒæŠŠäº‹æƒ…å¼„ç³Ÿã€‚' },
  { id: 'i010', type: 'fill', question: 'æ»¥ç«½___æ•°', options: ['A. å……', 'B. å†²', 'C. é‡', 'D. å® '], correctAnswer: 0, explanation: '"æ»¥ç«½å……æ•°"æ¯”å–»æ²¡æœ‰çœŸæ‰å®å­¦çš„äººæ··åœ¨è¡Œå®¶é‡Œé¢å……æ•°ã€‚' },
  { id: 'i011', type: 'fill', question: 'æ¯å¼“___å½±', options: ['A. è›‡', 'B. é¾™', 'C. è™«', 'D. é¸Ÿ'], correctAnswer: 0, explanation: '"æ¯å¼“è›‡å½±"æ¯”å–»å› ç–‘ç¥ç–‘é¬¼è€Œå¼•èµ·ææƒ§ã€‚' },
  { id: 'i012', type: 'fill', question: 'å¯¹ç‰›å¼¹___', options: ['A. ç´', 'B. èŠ¹', 'C. å‹¤', 'D. ç§¦'], correctAnswer: 0, explanation: '"å¯¹ç‰›å¼¹ç´"æ¯”å–»å¯¹ä¸è®²é“ç†çš„äººè®²é“ç†ã€‚' },
  { id: 'i013', type: 'fill', question: 'æäºº___å¤©', options: ['A. å¿§', 'B. ä¼˜', 'C. å¹½', 'D. æ‚ '], correctAnswer: 0, explanation: '"æäººå¿§å¤©"æ¯”å–»ä¸å¿…è¦çš„æˆ–ç¼ºä¹æ ¹æ®çš„å¿§è™‘å’Œæ‹…å¿ƒã€‚' },
  { id: 'i014', type: 'fill', question: 'èƒ¸æœ‰æˆ___', options: ['A. ç«¹', 'B. è¶³', 'C. ç­‘', 'D. é€'], correctAnswer: 0, explanation: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»åšäº‹ä¹‹å‰å·²ç»æœ‰é€šç›˜çš„è€ƒè™‘ã€‚' },
  { id: 'i015', type: 'fill', question: 'æœ›___æ­¢æ¸´', options: ['A. æ¢…', 'B. ç…¤', 'C. çœ‰', 'D. æ²¡'], correctAnswer: 0, explanation: '"æœ›æ¢…æ­¢æ¸´"æ¯”å–»ç”¨ç©ºæƒ³å®‰æ…°è‡ªå·±ã€‚' },

  // æˆè¯­é‡Šä¹‰é€‰æ‹©
  { id: 'i016', type: 'meaning', question: '"æŒ‡é¹¿ä¸ºé©¬"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ•…æ„é¢ å€’é»‘ç™½', 'B. åˆ†ä¸æ¸…åŠ¨ç‰©', 'C. å–œæ¬¢åŠ¨ç‰©', 'D. çœ¼åŠ›ä¸å¥½'], correctAnswer: 0, explanation: '"æŒ‡é¹¿ä¸ºé©¬"æ¯”å–»æ•…æ„é¢ å€’é»‘ç™½ï¼Œæ··æ·†æ˜¯éã€‚' },
  { id: 'i017', type: 'meaning', question: '"è‰æœ¨çš†å…µ"å½¢å®¹ï¼š', options: ['A. æ¤ç‰©å¾ˆå¤š', 'B. å†›é˜Ÿå¼ºå£®', 'C. æƒŠæ…Œæ—¶ç–‘ç¥ç–‘é¬¼', 'D. è‡ªç„¶ç¯å¢ƒå¥½'], correctAnswer: 2, explanation: '"è‰æœ¨çš†å…µ"å½¢å®¹äººåœ¨æƒŠæ…Œæ—¶ç–‘ç¥ç–‘é¬¼ã€‚' },
  { id: 'i018', type: 'meaning', question: '"çº¸ä¸Šè°ˆå…µ"æ¯”å–»ï¼š', options: ['A. çº¸ä¸Šç”»ç”»', 'B. ç©ºè°ˆç†è®º', 'C. ç ”ç©¶å†›äº‹', 'D. å†™å­—å¾ˆå¥½'], correctAnswer: 1, explanation: '"çº¸ä¸Šè°ˆå…µ"æ¯”å–»ç©ºè°ˆç†è®ºï¼Œä¸èƒ½è§£å†³å®é™…é—®é¢˜ã€‚' },
  { id: 'i019', type: 'meaning', question: '"ç ´é‡œæ²‰èˆŸ"æ¯”å–»ï¼š', options: ['A. æ‘”åä¸œè¥¿', 'B. ä¸‹å†³å¿ƒå¹²åˆ°åº•', 'C. ç ´èˆ¹æ²‰æ°´', 'D. å¤±è´¥äº†'], correctAnswer: 1, explanation: '"ç ´é‡œæ²‰èˆŸ"æ¯”å–»ä¸‹å†³å¿ƒä¸é¡¾ä¸€åˆ‡åœ°å¹²åˆ°åº•ã€‚' },
  { id: 'i020', type: 'meaning', question: '"å§è–ªå°èƒ†"å½¢å®¹ï¼š', options: ['A. ç”Ÿæ´»è‰°è‹¦', 'B. åˆ»è‹¦è‡ªåŠ±', 'C. ç¡ä¸å¥½è§‰', 'D. åƒè‹¦èƒ†'], correctAnswer: 1, explanation: '"å§è–ªå°èƒ†"å½¢å®¹äººåˆ»è‹¦è‡ªåŠ±ï¼Œå‘æ„¤å›¾å¼ºã€‚' },
  { id: 'i021', type: 'meaning', question: '"ä¸‰é¡¾èŒ…åº"æ¯”å–»ï¼š', options: ['A. å‚è§‚èŒ…å±‹', 'B. è¯šå¿ƒé‚€è¯·', 'C. æ—…æ¸¸è§‚å…‰', 'D. ä¸‰æ¬¡å‡ºé—¨'], correctAnswer: 1, explanation: '"ä¸‰é¡¾èŒ…åº"æ¯”å–»è¯šå¿ƒè¯šæ„åœ°é‚€è¯·äººå®¶ã€‚' },
  { id: 'i022', type: 'meaning', question: '"è´Ÿè†è¯·ç½ª"è¡¨ç¤ºï¼š', options: ['A. èƒŒç€è†æ¡', 'B. æ‰¿è®¤é”™è¯¯', 'C. è¯·äººåƒé¥­', 'D. æ¢æœ›ç—…äºº'], correctAnswer: 1, explanation: '"è´Ÿè†è¯·ç½ª"è¡¨ç¤ºå‘äººè®¤é”™èµ”ç½ªã€‚' },
  { id: 'i023', type: 'meaning', question: '"å®Œç’§å½’èµµ"æ¯”å–»ï¼š', options: ['A. å®Œæ•´çš„ç‰', 'B. ç‰©å½’åŸä¸»', 'C. é€ç»™åˆ«äºº', 'D. å€Ÿä¸œè¥¿'], correctAnswer: 1, explanation: '"å®Œç’§å½’èµµ"æ¯”å–»æŠŠç‰©å“å®Œå¥½åœ°å½’è¿˜ç»™ç‰©å“çš„ä¸»äººã€‚' },
  { id: 'i024', type: 'meaning', question: '"ç¨‹é—¨ç«‹é›ª"å½¢å®¹ï¼š', options: ['A. é›ªå¤©ç©è€', 'B. å°Šå¸ˆé‡é“', 'C. ç«™ç€ä¼‘æ¯', 'D. å†¬å¤©å¯’å†·'], correctAnswer: 1, explanation: '"ç¨‹é—¨ç«‹é›ª"å½¢å®¹å°Šå¸ˆé‡é“ï¼Œè™”è¯šæ±‚æ•™ã€‚' },
  { id: 'i025', type: 'meaning', question: '"é—»é¸¡èµ·èˆ"æ¯”å–»ï¼š', options: ['A. æ—©æ™¨è·³èˆ', 'B. å…»é¸¡ä¸ºä¸š', 'C. åŠæ—¶å¥‹èµ·', 'D. å–œæ¬¢éŸ³ä¹'], correctAnswer: 2, explanation: '"é—»é¸¡èµ·èˆ"æ¯”å–»æœ‰å¿—æŠ¥å›½çš„äººåŠæ—¶å¥‹èµ·ã€‚' },
  { id: 'i026', type: 'meaning', question: '"å…¥æœ¨ä¸‰åˆ†"å½¢å®¹ï¼š', options: ['A. æœ¨å·¥æŠ€æœ¯', 'B. åˆ†ææ·±åˆ»', 'C. é›•åˆ»è‰ºæœ¯', 'D. åŠ›æ°”å¾ˆå¤§'], correctAnswer: 1, explanation: '"å…¥æœ¨ä¸‰åˆ†"å½¢å®¹ä¹¦æ³•ææœ‰ç¬”åŠ›ï¼Œç°å¤šæ¯”å–»åˆ†æé—®é¢˜å¾ˆæ·±åˆ»ã€‚' },
  { id: 'i027', type: 'meaning', question: '"æœ›æ´‹å…´å¹"æ¯”å–»ï¼š', options: ['A. çœ‹æµ·æ„Ÿå¹', 'B. æ— å¯å¥ˆä½•', 'C. æ¬£èµé£æ™¯', 'D. æƒ³è¦æ¸¸æ³³'], correctAnswer: 1, explanation: '"æœ›æ´‹å…´å¹"æ¯”å–»åšäº‹æ—¶å› åŠ›ä¸èƒœä»»æˆ–æ²¡æœ‰æ¡ä»¶è€Œæ„Ÿåˆ°æ— å¯å¥ˆä½•ã€‚' },
  { id: 'i028', type: 'meaning', question: '"å¶å…¬å¥½é¾™"æ¯”å–»ï¼š', options: ['A. å–œæ¬¢åŠ¨ç‰©', 'B. å£å¤´çˆ±å¥½å®é™…ä¸çœŸ', 'C. çˆ±å¥½å¹¿æ³›', 'D. æ”¶è—é¾™'], correctAnswer: 1, explanation: '"å¶å…¬å¥½é¾™"æ¯”å–»å£å¤´ä¸Šè¯´çˆ±å¥½æŸäº‹ç‰©ï¼Œå®é™…ä¸Šå¹¶ä¸çœŸçˆ±å¥½ã€‚' },
  { id: 'i029', type: 'meaning', question: '"é»”é©´æŠ€ç©·"æ¯”å–»ï¼š', options: ['A. é©´å­æŠ€ç©·', 'B. æœ¬é¢†ç”¨å°½', 'C. åŠ¨ç‰©æœ‰è¶£', 'D. æŠ€èƒ½ä¸è¶³'], correctAnswer: 1, explanation: '"é»”é©´æŠ€ç©·"æ¯”å–»æœ‰é™çš„ä¸€ç‚¹æœ¬é¢†ä¹Ÿå·²ç»ç”¨å®Œäº†ã€‚' },
  { id: 'i030', type: 'meaning', question: '"å—è¾•åŒ—è¾™"æ¯”å–»ï¼š', options: ['A. å—åŒ—æ–¹å‘', 'B. è¡ŒåŠ¨ç›®çš„ç›¸å', 'C. è·¯é€”é¥è¿œ', 'D. æ–¹å‘æ­£ç¡®'], correctAnswer: 1, explanation: '"å—è¾•åŒ—è¾™"æ¯”å–»è¡ŒåŠ¨å’Œç›®çš„æ­£å¥½ç›¸åã€‚' },
  { id: 'i031', type: 'meaning', question: '"ä¸€é¸£æƒŠäºº"æ¯”å–»ï¼š', options: ['A. å«å£°å¾ˆå¤§', 'B. çªç„¶æˆåŠŸ', 'C. å¹³æ—¶ä¸çªå‡ºä¸€åšæƒŠäºº', 'D. ä»¤äººæƒŠè®¶'], correctAnswer: 2, explanation: '"ä¸€é¸£æƒŠäºº"æ¯”å–»å¹³æ—¶æ²¡æœ‰ç‰¹æ®Šè¡¨ç°ï¼Œä¸€åšèµ·æ¥å°±æœ‰æƒŠäººçš„æˆç»©ã€‚' },
  { id: 'i032', type: 'meaning', question: '"é‚¯éƒ¸å­¦æ­¥"æ¯”å–»ï¼š', options: ['A. å­¦ä¹ èµ°è·¯', 'B. æ¨¡ä»¿åˆ«äººå¤±æœ¬é¢†', 'C. å»é‚¯éƒ¸æ—…æ¸¸', 'D. ä½“è‚²è®­ç»ƒ'], correctAnswer: 1, explanation: '"é‚¯éƒ¸å­¦æ­¥"æ¯”å–»æ¨¡ä»¿åˆ«äººä¸åˆ°å®¶ï¼Œåè€ŒæŠŠè‡ªå·±åŸæœ‰çš„ä¸œè¥¿å¿˜äº†ã€‚' },
  { id: 'i033', type: 'meaning', question: '"ä¸œæ–½æ•ˆé¢¦"æ¯”å–»ï¼š', options: ['A. ç¾å¥³æ¨¡ä»¿', 'B. ç›²ç›®æ¨¡ä»¿é€‚å¾—å…¶å', 'C. å­¦ä¹ ç¾å®¹', 'D. å–œæ¬¢è¡¨æ¼”'], correctAnswer: 1, explanation: '"ä¸œæ–½æ•ˆé¢¦"æ¯”å–»ç›²ç›®æ¨¡ä»¿ï¼Œæ•ˆæœé€‚å¾—å…¶åã€‚' },
  { id: 'i034', type: 'meaning', question: '"æ»¥ç«½å……æ•°"çš„æ„æ€æ˜¯ï¼š', options: ['A. éŸ³ä¹æ¼”å¥', 'B. æ²¡çœŸæ‰å®å­¦æ··å……æ•°', 'C. äººå¤šçƒ­é—¹', 'D. æ¬ºéª—è¡Œä¸º'], correctAnswer: 1, explanation: '"æ»¥ç«½å……æ•°"æ¯”å–»æ²¡æœ‰çœŸæ‰å®å­¦çš„äººæ··åœ¨è¡Œå®¶é‡Œé¢å……æ•°ã€‚' },
  { id: 'i035', type: 'meaning', question: '"æŒ‰éƒ¨å°±ç­"çš„æ„æ€æ˜¯ï¼š', options: ['A. éƒ¨åˆ†ä¸Šç­', 'B. æŒ‰æ­¥éª¤åŠäº‹', 'C. ç­‰å¾…ä¸Šç­', 'D. éµå®ˆçºªå¾‹'], correctAnswer: 1, explanation: '"æŒ‰éƒ¨å°±ç­"æŒ‡æŒ‰ç…§ä¸€å®šçš„æ¡ç†ã€æ­¥éª¤åšäº‹ã€‚' },

  // æˆè¯­æ”¹é”™
  { id: 'i036', type: 'correct', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. è¿«ä¸æ€¥å¾…', 'B. è¿«ä¸åŠå¾…', 'C. æ³Šä¸åŠå¾…', 'D. è¿«ä¸æ—¢å¾…'], correctAnswer: 1, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"è¿«ä¸åŠå¾…"ï¼Œæ„æ€æ˜¯æ€¥è¿«å¾—ä¸èƒ½ç­‰å¾…ã€‚' },
  { id: 'i037', type: 'correct', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. è°ˆç¬‘é£ç”Ÿ', 'B. è°ˆç¬‘é£å£°', 'C. è°ˆç¬‘é£æ£®', 'D. è°ˆç¬‘é”‹å£°'], correctAnswer: 0, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"è°ˆç¬‘é£ç”Ÿ"ï¼Œå½¢å®¹è°ˆè¯æ—¶æœ‰è¯´æœ‰ç¬‘ï¼Œå…´è‡´å¾ˆé«˜ã€‚' },
  { id: 'i038', type: 'correct', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. ç¾ä»‘ç¾å¥‚', 'B. ç¾è½®ç¾å¥‚', 'C. ç¾ä¼¦ç¾å¥‚', 'D. ç¾è®ºç¾å¥‚'], correctAnswer: 1, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"ç¾è½®ç¾å¥‚"ï¼Œå½¢å®¹æˆ¿å±‹é«˜å¤§åä¸½ã€‚' },
  { id: 'i039', type: 'correct', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. å·§å¤ºå¤©åŠŸ', 'B. å·§å¤ºå¤©å·¥', 'C. å·§å¤ºå¤©å·¥', 'D. å·§å¤ºå¤©æ”»'], correctAnswer: 1, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"å·§å¤ºå¤©å·¥"ï¼Œå½¢å®¹æŠ€è‰ºé«˜è¶…ã€‚' },
  { id: 'i040', type: 'correct', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. å†æ¥å†åŠ±', 'B. å†æ¥å†å‰', 'C. å†æ¥å†åŠ›', 'D. å†æ¥å†åˆ©'], correctAnswer: 1, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"å†æ¥å†å‰"ï¼Œæ¯”å–»ç»§ç»­åŠªåŠ›ã€‚' },
  { id: 'i041', type: 'correct', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. æ¢å¿ƒå£®å¿—', 'B. ç°å¿ƒå£®å¿—', 'C. è¯²äººä¸å€¦', 'D. è¯²äººä¸å·'], correctAnswer: 2, explanation: '"è¯²äººä¸å€¦"æ„æ€æ˜¯æ•™å¯¼äººç‰¹åˆ«è€å¿ƒï¼Œä»ä¸åŒå€¦ã€‚' },
  { id: 'i042', type: 'correct', question: '"æ¢ç„¶ä¸€æ–°"çš„æ­£ç¡®å†™æ³•æ˜¯ï¼š', options: ['A. æ¢ç„¶ä¸€æ–°', 'B. ç„•ç„¶ä¸€æ–°', 'C. æ¶£ç„¶ä¸€æ–°', 'D. å¹»ç„¶ä¸€æ–°'], correctAnswer: 1, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"ç„•ç„¶ä¸€æ–°"ï¼Œå½¢å®¹å‡ºç°äº†å´­æ–°çš„é¢è²Œã€‚' },
  { id: 'i043', type: 'correct', question: '"ç›´æ¥äº†å½“"çš„æ­£ç¡®å†™æ³•æ˜¯ï¼š', options: ['A. ç›´æ¥äº†å½“', 'B. ç›´æˆªäº†å½“', 'C. ç›´èŠ‚äº†å½“', 'D. ç›´æ·äº†å½“'], correctAnswer: 1, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"ç›´æˆªäº†å½“"ï¼Œå½¢å®¹è¯´è¯åšäº‹çˆ½å¿«ã€‚' },
  { id: 'i044', type: 'correct', question: '"ä¸€æ„è«å±•"çš„æ­£ç¡®å†™æ³•æ˜¯ï¼š', options: ['A. ä¸€æ„è«å±•', 'B. ä¸€ç­¹è«å±•', 'C. ä¸€æ„è«å±•', 'D. ä¸€é…¬è«å±•'], correctAnswer: 1, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"ä¸€ç­¹è«å±•"ï¼Œä¸€ç‚¹è®¡ç­–ä¹Ÿæ–½å±•ä¸å‡ºã€‚' },
  { id: 'i045', type: 'correct', question: '"åç¬¦å…¶å®"çš„æ­£ç¡®å†™æ³•æ˜¯ï¼š', options: ['A. åç¬¦å…¶å®', 'B. åå‰¯å…¶å®', 'C. åä»˜å…¶å®', 'D. åå¼—å…¶å®'], correctAnswer: 1, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"åå‰¯å…¶å®"ï¼Œåç§°æˆ–åå£°ä¸å®é™…ç›¸ç¬¦åˆã€‚' },
  { id: 'i046', type: 'correct', question: '"ä¸å¯æ€æ„"çš„æ­£ç¡®å†™æ³•æ˜¯ï¼š', options: ['A. ä¸å¯æ€æ„', 'B. ä¸å¯æ€è®®', 'C. ä¸æ€æ„è®®', 'D. ä¸å¯æ€å¼‚'], correctAnswer: 1, explanation: 'æ­£ç¡®å†™æ³•æ˜¯"ä¸å¯æ€è®®"ï¼Œä¸å¯æƒ³è±¡ï¼Œéš¾ä»¥ç†è§£ã€‚' },
  { id: 'i047', type: 'correct', question: '"äº‹å€åŠŸåŠ"çš„åä¹‰è¯æ˜¯ï¼š', options: ['A. äº‹åŠå·¥å€', 'B. äº‹åŠåŠŸå€', 'C. äº‹åŠåŠŸåŠ', 'D. äº‹å€åŠŸå€'], correctAnswer: 1, explanation: '"äº‹å€åŠŸåŠ"çš„åä¹‰è¯æ˜¯"äº‹åŠåŠŸå€"ï¼Œå½¢å®¹æ•ˆç‡é«˜ã€‚' },
  { id: 'i048', type: 'correct', question: '"å®ˆæ ªå¾…å…”"çš„å¯“æ„æ˜¯ï¼š', options: ['A. ç­‰å¾…æœºä¼š', 'B. æ­»å®ˆä¸çŸ¥å˜é€š', 'C. è€å¿ƒç­‰å¾…', 'D. ç›¼æœ›æˆåŠŸ'], correctAnswer: 1, explanation: '"å®ˆæ ªå¾…å…”"æ¯”å–»æ­»å®ˆç‹­éš˜ç»éªŒï¼Œä¸çŸ¥å˜é€šã€‚' },
  { id: 'i049', type: 'correct', question: '"ç”»è›‡æ·»è¶³"å‘Šè¯‰æˆ‘ä»¬ï¼š', options: ['A. å¤šåšæ˜¯å¥½çš„', 'B. åšå¤šä½™çš„äº‹åä¸å¥½', 'C. ç”»ç”»è¦ç»†è‡´', 'D. è›‡æœ‰è„š'], correctAnswer: 1, explanation: '"ç”»è›‡æ·»è¶³"æ¯”å–»åšäº†å¤šä½™çš„äº‹ï¼Œéä½†æ— ç›Šï¼Œåè€Œä¸åˆé€‚ã€‚' },
  { id: 'i050', type: 'correct', question: '"æ‹”è‹—åŠ©é•¿"å‘Šè¯‰æˆ‘ä»¬ï¼š', options: ['A. å¸®åŠ©æ¤ç‰©', 'B. æ€¥äºæ±‚æˆåäº‹', 'C. è¾›å‹¤åŠ³åŠ¨', 'D. çˆ±æŠ¤åº„ç¨¼'], correctAnswer: 1, explanation: '"æ‹”è‹—åŠ©é•¿"æ¯”å–»è¿åäº‹ç‰©å‘å±•è§„å¾‹ï¼Œæ€¥äºæ±‚æˆåè€Œåäº‹ã€‚' },

  // æˆè¯­ä½¿ç”¨åˆ¤æ–­ï¼ˆK12çœŸé¢˜ï¼‰
  { id: 'i051', type: 'usage', question: 'ä¸‹åˆ—å¥å­ä¸­åŠ ç‚¹æˆè¯­çš„ä½¿ç”¨ï¼Œä¸æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š\nA. åŒ—äº¬å†¬æ®‹å¥¥ä¼šå³å°†å¼€å¹•ï¼Œä¸­å›½ä½“è‚²ä»£è¡¨å›¢è¿‘ç™¾åè¿åŠ¨å‘˜___ï¼Œæ•´è£…å¾…å‘ã€‚', options: ['A. å‰å…µç§£é©¬', 'B. ä½¿ç”¨æ­£ç¡®', 'C. ä½¿ç”¨æ­£ç¡®', 'D. ä½¿ç”¨æ­£ç¡®'], correctAnswer: 0, explanation: '"å‰å…µç§£é©¬"æŒ‡ç£¨å¥½å…µå™¨ï¼Œå–‚å¥½é©¬ï¼Œå½¢å®¹å‡†å¤‡æˆ˜æ–—ï¼Œä¹Ÿæ¯”å–»äº‹å‰ç§¯æå‡†å¤‡ã€‚ç”¨äºè¿åŠ¨å‘˜å‡†å¤‡æ¯”èµ›æ˜¯æ°å½“çš„ã€‚' },
  { id: 'i052', type: 'usage', question: 'ä¸‹åˆ—å¥å­ä¸­åŠ ç‚¹æˆè¯­çš„ä½¿ç”¨ï¼Œä¸æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š\nB. "å¼€å­¦ç¬¬ä¸€è¯¾"ä¸Šï¼ŒåŒå­¦ä»¬è§‚çœ‹äº†å¥³è¶³äºšæ´²æ¯å¤ºå† çš„è§†é¢‘ç‰‡æ®µï¼Œçº·çº·___ã€‚', options: ['A. æ‹æ‰‹ç§°å¿«', 'B. ä½¿ç”¨æ­£ç¡®', 'C. ä½¿ç”¨æ­£ç¡®', 'D. ä½¿ç”¨æ­£ç¡®'], correctAnswer: 0, explanation: '"æ‹æ‰‹ç§°å¿«"æŒ‡æ‹æŒå«å¥½ï¼Œå¤šæŒ‡ä»‡æ¨å¾—åˆ°æ¶ˆé™¤æˆ–äº‹æƒ…çš„ç»“æŸï¼ˆä¸€èˆ¬ç”¨äºåäº‹ï¼‰ã€‚ç”¨äºå½¢å®¹è§‚çœ‹å¤ºå† è§†é¢‘ä¸æ°å½“ã€‚' },
  { id: 'i053', type: 'usage', question: 'ä¸‹åˆ—æˆè¯­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¿™éƒ¨ç”µå½±é£æ™¯å¦‚ç”»ï¼Œæ°”å€™å®œäººï¼Œå‰æ¥æ—…æ¸¸çš„äººä¸ç»å¦‚ç¼•', 'B. è°ˆèµ·é»„æ¢…æˆï¼Œå­©å­è¯´å¾—å¤´å¤´æ˜¯é“ï¼Œè®©äººæƒŠå¹ä¸å·²', 'C. å¯¹å­©å­è¿›è¡Œçˆ±å›½æ•™è‚²æ˜¯æ¯ä¸ªå®¶é•¿ä»»åŠ³ä»»æ€¨çš„è´£ä»»', 'D. è¿™æ¬¡æ¯”èµ›ä»–çœŸè®©äººå¦çœ¼ç›¸çœ‹'], correctAnswer: 1, explanation: 'Aé¡¹"ä¸ç»å¦‚ç¼•"åº”ä¸º"ç»œç»ä¸ç»"ï¼›Bé¡¹æ­£ç¡®ï¼›Cé¡¹"ä»»åŠ³ä»»æ€¨"åº”ä¸º"ä¹‰ä¸å®¹è¾"ï¼›Dé¡¹"å¦çœ¼ç›¸çœ‹"ç”¨é”™è¯­å¢ƒã€‚' },
  { id: 'i054', type: 'usage', question: 'ä¸‹åˆ—æˆè¯­ä½¿ç”¨æ°å½“çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä»–è¿™æ¬¡æ¯”èµ›___ï¼Œé¡ºåˆ©æ™‹çº§', 'B. åœ¨å†³èµ›å‰çš„æ³è°ˆä¼šä¸Šï¼Œé˜Ÿå‘˜ä»¬___ï¼Œæ€»ç»“äº†æŠ€æˆ˜æœ¯', 'C. ç¾Šæ¯›å‡ºåœ¨ç¾Šèº«ä¸Šï¼Œè¿™äº›çƒæ˜Ÿé€šè¿‡å•†ä¸šæ´»åŠ¨èµšå›è½¬ä¼šè´¹', 'D. è¿™æ”¯çƒé˜Ÿçš„___ï¼Œä¸‰ä¸‹äº”é™¤äºŒå°±å‡»å€’äº†å¯¹æ‰‹'], correctAnswer: 1, explanation: 'Aé¡¹åº”ä¸º"æ——å¼€å¾—èƒœ"ï¼›Bé¡¹"æ‰“å¼€å¤©çª—è¯´äº®è¯"æ­£ç¡®ï¼›Cé¡¹ä¸æ˜¯æˆè¯­ï¼›Dé¡¹"ä¸‰ä¸‹äº”é™¤äºŒ"ç”¨é”™è¯­å¢ƒã€‚' },
  { id: 'i055', type: 'usage', question: 'ä¸‹åˆ—æˆè¯­ä½¿ç”¨ä¸æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å¥¹è¾¹èµ°è¾¹ç¬‘é“ï¼š"ä½ ___ï¼Œå“ªé‡Œè¿˜è®°å¾—æˆ‘ä»¬è¿™äº›å°ç™¾å§“å‘¢ã€‚"', 'B. æœç„¶æ˜¯___ï¼Œå¥¹è¿™ä¹ˆä¸€æ‰“æ‰®ï¼Œç®€ç›´è·Ÿæ¢äº†ä¸ªäººä¼¼çš„', 'C. è¿™ä»¶äº‹___å‘¢ï¼Œä½ å…ˆåˆ«ç€æ€¥å•Š', 'D. ä»–ä»¬ä¿©___ï¼Œè‡ªæ­¤å˜æˆäº†ä»‡äººï¼Œäº’ç›¸äº‰æ–—æ€¨æ¨äº†ä¸€è¾ˆå­'], correctAnswer: 3, explanation: 'Dé¡¹"ä¸æ‰“ä¸ç›¸è¯†"æ˜¯è¤’ä¹‰è¯ï¼ŒæŒ‡ç»è¿‡å†²çªåæ›´äº†è§£å¯¹æ–¹ï¼Œä¸èƒ½ç”¨äºå˜æˆä»‡äººã€‚åº”ä¸º"ç»“ä¸‹ä»‡æ€¨"ã€‚' },
  { id: 'i056', type: 'usage', question: '"è”šç„¶æˆé£"çš„æ„æ€æ˜¯ï¼š', options: ['A. å½¢å®¹é£å¾ˆå¤§', 'B. å½¢å®¹äº‹ç‰©è“¬å‹ƒå‘å±•ï¼Œå½¢æˆé£æ°”', 'C. å½¢å®¹é£æ™¯ä¼˜ç¾', 'D. å½¢å®¹é£å‘æ”¹å˜'], correctAnswer: 1, explanation: '"è”šç„¶æˆé£"å½¢å®¹ä¸€ä»¶äº‹æƒ…é€æ¸å‘å±•ç››è¡Œï¼Œå½¢æˆä¸€ç§é£æ°”ã€‚' },
  { id: 'i057', type: 'usage', question: '"é”±é“¢å¿…è¾ƒ"çš„æ„æ€æ˜¯ï¼š', options: ['A. éå¸¸ä»”ç»†', 'B. å¯¹æå°‘çš„é’±æˆ–å¾ˆå°çš„äº‹éƒ½ååˆ†è®¡è¾ƒ', 'C. è®¤çœŸè´Ÿè´£', 'D. ç²¾æ‰“ç»†ç®—'], correctAnswer: 1, explanation: '"é”±é“¢å¿…è¾ƒ"å½¢å®¹å¯¹å¾ˆå°‘çš„é’±æˆ–å¾ˆå°çš„äº‹éƒ½ååˆ†è®¡è¾ƒã€‚' },
  { id: 'i058', type: 'usage', question: '"åŠé€”è€ŒåºŸ"æ¯”å–»ï¼š', options: ['A. èµ°åˆ°ä¸€åŠåœæ­¢', 'B. åšäº‹ä¸èƒ½åšæŒåˆ°åº•', 'C. åŠè·¯æ”¾å¼ƒ', 'D. äº‹æƒ…åšäº†ä¸€åŠ'], correctAnswer: 1, explanation: '"åŠé€”è€ŒåºŸ"æ¯”å–»åšäº‹ä¸èƒ½åšæŒåˆ°åº•ï¼Œä¸­é€”åœæ­¢ã€‚' },
  { id: 'i059', type: 'usage', question: '"æŒä¹‹ä»¥æ’"çš„æ„æ€æ˜¯ï¼š', options: ['A. åšæŒåˆ°åº•', 'B. é•¿ä¹…åœ°åšæŒä¸‹å»', 'C. æŒç»­ä¸æ–­', 'D. æ°¸æ’ä¸å˜'], correctAnswer: 1, explanation: '"æŒä¹‹ä»¥æ’"æŒ‡é•¿ä¹…åœ°åšæŒä¸‹å»ã€‚' },
  { id: 'i060', type: 'usage', question: '"å›«å›µåæ£"æ¯”å–»ï¼š', options: ['A. åƒæ£å¤ªå¿«', 'B. è¯»ä¹¦ç­‰ä¸åŠ åˆ†æåœ°ç¬¼ç»Ÿæ¥å—', 'C. åƒä¸œè¥¿ä¸åš¼', 'D. è´ªåƒ'], correctAnswer: 1, explanation: '"å›«å›µåæ£"æ¯”å–»è¯»ä¹¦ç­‰ä¸åŠ åˆ†æåœ°ç¬¼ç»Ÿæ¥å—ã€‚' },
  { id: 'i061', type: 'usage', question: '"ä¸é—ä½™åŠ›"çš„æ„æ€æ˜¯ï¼š', options: ['A. ä¿ç•™åŠ›é‡', 'B. æŠŠå…¨éƒ¨åŠ›é‡éƒ½ä½¿å‡ºæ¥', 'C. ä¸æµªè´¹åŠ›é‡', 'D. æœ‰ä½™åŠ›'], correctAnswer: 1, explanation: '"ä¸é—ä½™åŠ›"æŒ‡æŠŠå…¨éƒ¨åŠ›é‡éƒ½ä½¿å‡ºæ¥ã€‚' },
  { id: 'i062', type: 'usage', question: '"å¥‹ä¸é¡¾èº«"å½¢å®¹ï¼š', options: ['A. å¥‹å‹‡å‘å‰', 'B. ä¸é¡¾è‡ªèº«å®‰å±ï¼Œå‹‡å¾€ç›´å‰', 'C. ä¸é¡¾èº«ä½“', 'D. å¥‹åŠ›å‰è¡Œ'], correctAnswer: 1, explanation: '"å¥‹ä¸é¡¾èº«"æŒ‡ä¸é¡¾è‡ªèº«å®‰å±ï¼Œå‹‡å¾€ç›´å‰ã€‚' },
  { id: 'i063', type: 'usage', question: '"è§ä¹‰å‹‡ä¸º"çš„æ„æ€æ˜¯ï¼š', options: ['A. è§åˆ°æ­£ä¹‰çš„äº‹å°±å‹‡æ•¢åœ°åš', 'B. å‹‡æ•¢åœ°åšæ­£ä¹‰çš„äº‹', 'C. ä¸ºæ­£ä¹‰è€Œå¥‹æ–—', 'D. å‹‡æ•¢è¡Œä¸º'], correctAnswer: 0, explanation: '"è§ä¹‰å‹‡ä¸º"æŒ‡è§åˆ°æ­£ä¹‰çš„äº‹å°±å‹‡æ•¢åœ°å»åšã€‚' },
  { id: 'i064', type: 'usage', question: '"èˆå·±ä¸ºäºº"å½¢å®¹ï¼š', options: ['A. èˆå¼ƒè‡ªå·±', 'B. ä¸ºäº†ä»–äººç‰ºç‰²è‡ªå·±çš„åˆ©ç›Š', 'C. æ”¾å¼ƒè‡ªå·±', 'D. èˆå·±æ•‘äºº'], correctAnswer: 1, explanation: '"èˆå·±ä¸ºäºº"æŒ‡ä¸ºäº†ä»–äººçš„åˆ©ç›Šè€Œä¸æƒœç‰ºç‰²è‡ªå·±çš„åˆ©ç›Šã€‚' },
  { id: 'i065', type: 'usage', question: '"å¤§å…¬æ— ç§"çš„æ„æ€æ˜¯ï¼š', options: ['A. å¾ˆå¤§æ–¹', 'B. å®Œå…¨ä¸ºäººæ°‘åˆ©ç›Šç€æƒ³ï¼Œæ¯«æ— ç§å¿ƒ', 'C. å…¬æ­£æ— ç§', 'D. å¤§å…¬'], correctAnswer: 1, explanation: '"å¤§å…¬æ— ç§"æŒ‡å®Œå…¨ä¸ºäººæ°‘åˆ©ç›Šç€æƒ³ï¼Œæ¯«æ— ç§å¿ƒã€‚' },
  { id: 'i066', type: 'usage', question: '"å…‰æ˜ç£Šè½"å½¢å®¹ï¼š', options: ['A. å…‰æ˜æ­£å¤§', 'B. å¿ƒåœ°å…‰æ˜ï¼Œèƒ¸æ€€å¦ç™½', 'C. æ­£å¤§å…‰æ˜', 'D. å…‰æ˜ç£Šè½'], correctAnswer: 1, explanation: '"å…‰æ˜ç£Šè½"å½¢å®¹å¿ƒåœ°å…‰æ˜ï¼Œèƒ¸æ€€å¦ç™½ã€‚' },
  { id: 'i067', type: 'usage', question: '"ä¸¤è¢–æ¸…é£"å½¢å®¹ï¼š', options: ['A. è¢–å­å¾ˆå¹²å‡€', 'B. ä¸ºå®˜æ¸…å»‰', 'C. ç”Ÿæ´»ç®€æœ´', 'D. æ‰‹å¾ˆå¹²å‡€'], correctAnswer: 1, explanation: '"ä¸¤è¢–æ¸…é£"å½¢å®¹ä¸ºå®˜æ¸…å»‰ï¼Œé™¤è¡£è¢–ä¸­çš„æ¸…é£å¤–ï¼Œåˆ«æ— æ‰€æœ‰ã€‚' },
  { id: 'i068', type: 'usage', question: '"å…‹å·±å¥‰å…¬"çš„æ„æ€æ˜¯ï¼š', options: ['A. å…‹æœè‡ªå·±', 'B. ä¸¥æ ¼è¦æ±‚è‡ªå·±ï¼Œä¸€å¿ƒä¸ºå…¬', 'C. å…‹åˆ¶ç§å¿ƒ', 'D. å¥‰å…¬å®ˆæ³•'], correctAnswer: 1, explanation: '"å…‹å·±å¥‰å…¬"æŒ‡ä¸¥æ ¼è¦æ±‚è‡ªå·±ï¼Œä¸€å¿ƒä¸ºå…¬ã€‚' },
  { id: 'i069', type: 'usage', question: '"é èº¬å°½ç˜"çš„æ„æ€æ˜¯ï¼š', options: ['A. é èº¬è‡´æ•¬', 'B. å°å¿ƒè°¨æ…', 'C. è´¡çŒ®å…¨éƒ¨åŠ›é‡', 'D. å°½èŒå°½è´£'], correctAnswer: 2, explanation: '"é èº¬å°½ç˜"æŒ‡æ­æ•¬è°¨æ…ï¼Œç«­å°½å¿ƒåŠ›å»æ•ˆåŠ³ã€‚' },
  { id: 'i070', type: 'usage', question: '"æ­»è€Œåå·²"å½¢å®¹ï¼š', options: ['A. æ­»äº†æ‰ç®—', 'B. å½¢å®¹ä¸ºäº‹ä¸šå¥‹æ–—åˆ°æ­»', 'C. æ­»åç»“æŸ', 'D. ç›´åˆ°æ­»'], correctAnswer: 1, explanation: '"æ­»è€Œåå·²"æŒ‡å½¢å®¹ä¸ºäº‹ä¸šå¥‹æ–—åˆ°æ­»ä¸ºæ­¢ã€‚' },
  { id: 'i071', type: 'usage', question: '"ä¸€ä¸ä¸è‹Ÿ"å½¢å®¹ï¼š', options: ['A. ä¸é©¬è™', 'B. è¿æœ€ç»†å¾®çš„åœ°æ–¹ä¹Ÿä¸é©¬è™', 'C. è®¤çœŸ', 'D. ç»†å¿ƒ'], correctAnswer: 1, explanation: '"ä¸€ä¸ä¸è‹Ÿ"å½¢å®¹è¿æœ€ç»†å¾®çš„åœ°æ–¹ä¹Ÿä¸é©¬è™ã€‚' },
  { id: 'i072', type: 'usage', question: '"ç²¾ç›Šæ±‚ç²¾"çš„æ„æ€æ˜¯ï¼š', options: ['A. éå¸¸ç²¾ç»†', 'B. å·²ç»å¾ˆå¥½äº†è¿˜è¦æ±‚æ›´å¥½', 'C. ç²¾ç›Šæ±‚ç²¾', 'D. æ±‚ç²¾'], correctAnswer: 1, explanation: '"ç²¾ç›Šæ±‚ç²¾"æŒ‡å·²ç»å¾ˆå¥½äº†ï¼Œè¿˜è¦æ±‚æ›´å¥½ã€‚' },
  { id: 'i073', type: 'usage', question: '"ä¸“å¿ƒè‡´å¿—"å½¢å®¹ï¼š', options: ['A. éå¸¸ä¸“å¿ƒ', 'B. ä¸€å¿ƒä¸€æ„ï¼Œé›†ä¸­ç²¾ç¥', 'C. ä¸“æ³¨', 'D. è‡´å¿—'], correctAnswer: 1, explanation: '"ä¸“å¿ƒè‡´å¿—"å½¢å®¹ä¸€å¿ƒä¸€æ„ï¼Œé›†ä¸­ç²¾ç¥ã€‚' },
  { id: 'i074', type: 'usage', question: '"å…¨ç¥è´¯æ³¨"çš„æ„æ€æ˜¯ï¼š', options: ['A. å…¨éƒ¨ç²¾ç¥', 'B. æ³¨æ„åŠ›é«˜åº¦é›†ä¸­', 'C. å…¨ç¥', 'D. è´¯æ³¨'], correctAnswer: 1, explanation: '"å…¨ç¥è´¯æ³¨"å½¢å®¹æ³¨æ„åŠ›é«˜åº¦é›†ä¸­ã€‚' },

  // æ›´å¤šæˆè¯­è¾¨æ
  { id: 'i075', type: 'distinguish', question: '"ä¸å¯æ€è®®"çš„æ„æ€æ˜¯ï¼š', options: ['A. ä¸å¯æƒ³è±¡', 'B. éš¾ä»¥ç†è§£', 'C. æ— æ³•æƒ³è±¡ï¼Œéš¾ä»¥ç†è§£', 'D. ç¥å¥‡'], correctAnswer: 2, explanation: '"ä¸å¯æ€è®®"å½¢å®¹ä¸å¯æƒ³è±¡ï¼Œéš¾ä»¥ç†è§£ã€‚' },
  { id: 'i076', type: 'distinguish', question: '"å†å†åœ¨ç›®"å½¢å®¹ï¼š', options: ['A. æ¸…æ¥šåœ¨çœ¼å‰', 'B. è¿‡å»çš„äº‹æƒ…æ¸…æ¥šåœ°å‡ºç°åœ¨çœ¼å‰', 'C. çœ‹å¾—æ¸…æ¥š', 'D. å›å¿†æ¸…æ™°'], correctAnswer: 1, explanation: '"å†å†åœ¨ç›®"å½¢å®¹è¿‡å»çš„äº‹æƒ…æ¸…æ¥šåœ°å‡ºç°åœ¨çœ¼å‰ã€‚' },
  { id: 'i077', type: 'distinguish', question: '"è®°å¿†çŠ¹æ–°"çš„æ„æ€æ˜¯ï¼š', options: ['A. è®°å¿†å¾ˆå¥½', 'B. è¿‡å»çš„äº‹å°è±¡è¿˜å¾ˆæ·±', 'C. è®°å¿†çŠ¹åœ¨', 'D. è®°å¿†æ¸…æ™°'], correctAnswer: 1, explanation: '"è®°å¿†çŠ¹æ–°"æŒ‡è¿‡å»çš„äº‹æƒ…å°è±¡è¿˜å¾ˆæ·±ï¼Œè®°å¾—å¾ˆæ¸…æ¥šã€‚' },
  { id: 'i078', type: 'distinguish', question: '"æå¦‚éš”ä¸–"å½¢å®¹ï¼š', options: ['A. å¥½åƒéš”äº†ä¸€ä¸–', 'B. æ„Ÿè§‰ä¸€åˆ‡éƒ½å˜äº†', 'C. éš”ä¸–ä¹‹æ„Ÿ', 'D. ä¸–äº‹å˜è¿'], correctAnswer: 1, explanation: '"æå¦‚éš”ä¸–"å½¢å®¹ä»¿ä½›éš”äº†ä¸€ä»£ï¼Œæ„Ÿè§‰ä¸€åˆ‡éƒ½å˜äº†ã€‚' },
  { id: 'i079', type: 'distinguish', question: '"å†ä¹…å¼¥æ–°"çš„æ„æ€æ˜¯ï¼š', options: ['A. å¾ˆä¹…è¿˜æ˜¯æ–°çš„', 'B. ç»è¿‡é•¿ä¹…æ—¶é—´åè€Œæ›´åŠ é²œæ´»', 'C. å†ä¹…å¼¥åš', 'D. è¶Šä¹…è¶Šå¥½'], correctAnswer: 1, explanation: '"å†ä¹…å¼¥æ–°"æŒ‡ç»å†é•¿ä¹…çš„æ—¶é—´è€Œæ›´åŠ é²œæ´»ï¼Œæ›´åŠ æœ‰æ´»åŠ›ã€‚' },
  { id: 'i080', type: 'distinguish', question: '"æºè¿œæµé•¿"å½¢å®¹ï¼š', options: ['A. æ²³æµå¾ˆé•¿', 'B. å†å²æ‚ ä¹…', 'C. æ¥æºå¾ˆè¿œ', 'D. æµä¼ ä¹…è¿œ'], correctAnswer: 1, explanation: '"æºè¿œæµé•¿"å½¢å®¹æ²³æµçš„æºå¤´å¾ˆè¿œï¼Œæ°´æµå¾ˆé•¿ï¼Œæ¯”å–»å†å²æ‚ ä¹…ã€‚' },
  { id: 'i081', type: 'distinguish', question: '"åšå¤§ç²¾æ·±"å½¢å®¹ï¼š', options: ['A. å¹¿å¤§æ·±åš', 'B. æ€æƒ³ã€å­¦è¯†ç­‰å¹¿åšé«˜æ·±', 'C. åšå¤§', 'D. ç²¾æ·±'], correctAnswer: 1, explanation: '"åšå¤§ç²¾æ·±"å½¢å®¹æ€æƒ³ã€å­¦è¯´ç­‰å¹¿åšé«˜æ·±ã€‚' },
  { id: 'i082', type: 'distinguish', question: '"è„ç‚™äººå£"çš„æ„æ€æ˜¯ï¼š', options: ['A. å¾ˆå¤šäººåƒ', 'B. å¥½çš„è¯—æ–‡ä¸ºä¼—äººç§°é¢‚', 'C. æµè¡Œå¹¿æ³›', 'D. å£å£ç›¸ä¼ '], correctAnswer: 1, explanation: '"è„ç‚™äººå£"æ¯”å–»å¥½çš„è¯—æ–‡æˆ–äº‹ç‰©ä¸ºä¼—äººæ‰€ç§°é¢‚ã€‚' },
  { id: 'i083', type: 'distinguish', question: '"å–œé—»ä¹è§"å½¢å®¹ï¼š', options: ['A. å–œæ¬¢å¬å–œæ¬¢çœ‹', 'B. å¾ˆå—æ¬¢è¿', 'C. ä¼—äººå–œæ¬¢', 'D. å¤§ä¼—å–œçˆ±'], correctAnswer: 1, explanation: '"å–œé—»ä¹è§"æŒ‡å–œæ¬¢å¬ï¼Œä¹æ„çœ‹ï¼Œå½¢å®¹å¾ˆå—æ¬¢è¿ã€‚' },
  { id: 'i084', type: 'distinguish', question: '"æ´¥æ´¥ä¹é“"çš„æ„æ€æ˜¯ï¼š', options: ['A. å¾ˆæœ‰å‘³é“åœ°è¯´', 'B. å¾ˆæœ‰å…´è¶£åœ°è°ˆè®º', 'C. å¿«ä¹åœ°è¯´', 'D. æ´¥æ´¥æœ‰å‘³'], correctAnswer: 1, explanation: '"æ´¥æ´¥ä¹é“"å½¢å®¹å¾ˆæœ‰å…´è¶£åœ°è°ˆè®ºã€‚' },
  { id: 'i085', type: 'distinguish', question: '"å¤¸å¤¸å…¶è°ˆ"å½¢å®¹ï¼š', options: ['A. è¯´è¯æµåˆ©', 'B. è¯´è¯æµ®å¤¸ä¸åˆ‡å®é™…', 'C. å¤¸å¤¸å…¶è°ˆ', 'D. è¯´è¯å¤¸å¼ '], correctAnswer: 1, explanation: '"å¤¸å¤¸å…¶è°ˆ"å½¢å®¹è¯´è¯æµ®å¤¸ï¼Œä¸åˆ‡å®é™…ã€‚' },
  { id: 'i086', type: 'distinguish', question: '"å£è‹¥æ‚¬æ²³"å½¢å®¹ï¼š', options: ['A. è¯´è¯åƒæ²³æ°´', 'B. å£æ‰å¥½ï¼Œè¯´è¯å¤š', 'C. å–„äºè¨€è°ˆ', 'D. èƒ½è¯´ä¼šé“'], correctAnswer: 1, explanation: '"å£è‹¥æ‚¬æ²³"å½¢å®¹å£æ‰å¥½ï¼Œè¯´è¯å¤šè€Œæµç•…ã€‚' },
  { id: 'i087', type: 'distinguish', question: '"æ»”æ»”ä¸ç»"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ²³æ°´ä¸æ–­', 'B. è¯å¤šä¸æ–­', 'C. è¿ç»­ä¸æ–­', 'D. è¯´è¯è¿ç»­'], correctAnswer: 1, explanation: '"æ»”æ»”ä¸ç»"å½¢å®¹è¯å¾ˆå¤šï¼Œè¿ç»­ä¸æ–­ã€‚' },
  { id: 'i088', type: 'distinguish', question: '"å¨“å¨“é“æ¥"å½¢å®¹ï¼š', options: ['A. è¯´è¯åŠ¨å¬', 'B. æ¸©æŸ”ä»å®¹åœ°è¯´è¯', 'C. å¨“å¨“è€Œè°ˆ', 'D. è¯´è¯å¥½å¬'], correctAnswer: 1, explanation: '"å¨“å¨“é“æ¥"å½¢å®¹è¯´è¯æ¸©æŸ”ä»å®¹ï¼Œä¸é—´æ–­ã€‚' },
  { id: 'i089', type: 'distinguish', question: '"å–‹å–‹ä¸ä¼‘"å½¢å®¹ï¼š', options: ['A. è¯´è¯ä¸åœ', 'B. æ²¡å®Œæ²¡äº†åœ°è¯´', 'C. è¯´è¯å¤š', 'D. å•°å—¦'], correctAnswer: 1, explanation: '"å–‹å–‹ä¸ä¼‘"å½¢å®¹è¯´è¯æ²¡å®Œæ²¡äº†ã€‚' },
  { id: 'i090', type: 'distinguish', question: '"æŒ¯æŒ¯æœ‰è¯"çš„æ„æ€æ˜¯ï¼š', options: ['A. è¯´å¾—æœ‰ç†', 'B. ç†ç›´æ°”å£®åœ°è¯´', 'C. æŒ¯æŒ¯æœ‰è¯', 'D. è¯´è¯æœ‰åŠ›'], correctAnswer: 1, explanation: '"æŒ¯æŒ¯æœ‰è¯"å½¢å®¹ç†ç”±ä¼¼ä¹å¾ˆå……åˆ†ï¼Œè¯´ä¸ªä¸ä¼‘ã€‚' },

  // æˆè¯­è¿‘ä¹‰åä¹‰
  { id: 'i091', type: 'relation', question: '"äº‹åŠåŠŸå€"çš„åä¹‰è¯æ˜¯ï¼š', options: ['A. äº‹å€åŠŸåŠ', 'B. äº‹åŠåŠŸåŠ', 'C. äº‹åŠå·¥å€', 'D. åŠŸåŠäº‹å€'], correctAnswer: 0, explanation: '"äº‹åŠåŠŸå€"çš„åä¹‰è¯æ˜¯"äº‹å€åŠŸåŠ"ã€‚' },
  { id: 'i092', type: 'relation', question: '"æ·±è°‹è¿œè™‘"çš„è¿‘ä¹‰è¯æ˜¯ï¼š', options: ['A. æ·±æ€ç†Ÿè™‘', 'B. è€è°‹æ·±ç®—', 'C. è°‹åˆ’æ·±è¿œ', 'D. è€ƒè™‘å‘¨å…¨'], correctAnswer: 0, explanation: '"æ·±è°‹è¿œè™‘"çš„è¿‘ä¹‰è¯æ˜¯"æ·±æ€ç†Ÿè™‘"ã€‚' },
  { id: 'i093', type: 'relation', question: '"å”¯åˆ©æ˜¯å›¾"çš„åä¹‰è¯æ˜¯ï¼š', options: ['A. å¤§å…¬æ— ç§', 'B. å…¬è€Œå¿˜ç§', 'C. å…ˆå…¬åç§', 'D. ä¸è°‹ç§åˆ©'], correctAnswer: 0, explanation: '"å”¯åˆ©æ˜¯å›¾"çš„åä¹‰è¯æ˜¯"å¤§å…¬æ— ç§"ã€‚' },
  { id: 'i094', type: 'relation', question: '"ç²—å¿ƒå¤§æ„"çš„åä¹‰è¯æ˜¯ï¼š', options: ['A. å°å¿ƒè°¨æ…', 'B. ç»†å¿ƒ', 'C. ä¸€ä¸ä¸è‹Ÿ', 'D. ç²¾ç›Šæ±‚ç²¾'], correctAnswer: 0, explanation: '"ç²—å¿ƒå¤§æ„"çš„åä¹‰è¯æ˜¯"å°å¿ƒè°¨æ…"ã€‚' },
  { id: 'i095', type: 'relation', question: '"ä¸¾ä¸–é—»å"çš„è¿‘ä¹‰è¯æ˜¯ï¼š', options: ['A. èµ«èµ«æœ‰å', 'B. ä¸–ç•Œé—»å', 'C. åæ‰¬å¤©ä¸‹', 'D. å¤§åé¼é¼'], correctAnswer: 0, explanation: '"ä¸¾ä¸–é—»å"çš„è¿‘ä¹‰è¯æ˜¯"èµ«èµ«æœ‰å"ã€‚' },
  { id: 'i096', type: 'relation', question: '"å¾®ä¸è¶³é“"çš„åä¹‰è¯æ˜¯ï¼š', options: ['A. ä¸¾è¶³è½»é‡', 'B. ä¸¾è¶³è½»é‡', 'C. è‡³å…³é‡è¦', 'D. éå¸¸é‡è¦'], correctAnswer: 0, explanation: '"å¾®ä¸è¶³é“"çš„åä¹‰è¯æ˜¯"ä¸¾è¶³è½»é‡"ã€‚' },
  { id: 'i097', type: 'relation', question: '"æ–¤æ–¤è®¡è¾ƒ"çš„è¿‘ä¹‰è¯æ˜¯ï¼š', options: ['A. é”±é“¢å¿…è¾ƒ', 'B. çšçœ¦å¿…æŠ¥', 'C. æ–¤æ–¤è®¡è¾ƒ', 'D. è®¡è¾ƒå°äº‹'], correctAnswer: 0, explanation: '"æ–¤æ–¤è®¡è¾ƒ"çš„è¿‘ä¹‰è¯æ˜¯"é”±é“¢å¿…è¾ƒ"ã€‚' },
  { id: 'i098', type: 'relation', question: '"æ¼ ä¸å…³å¿ƒ"çš„åä¹‰è¯æ˜¯ï¼š', options: ['A. å…³æ€€å¤‡è‡³', 'B. å…³å¿ƒä½“è´´', 'C. ä½“è´´å…¥å¾®', 'D. çƒ­æƒ…å…³æ€€'], correctAnswer: 0, explanation: '"æ¼ ä¸å…³å¿ƒ"çš„åä¹‰è¯æ˜¯"å…³æ€€å¤‡è‡³"ã€‚' },
  { id: 'i099', type: 'relation', question: '"ä¸€å¸†é£é¡º"çš„åä¹‰è¯æ˜¯ï¼š', options: ['A. åƒéš¾ä¸‡é™©', 'B. è‰°éš¾æ›²æŠ˜', 'C. æ›²æŠ˜åå·', 'D. é£é›¨é£˜æ‘‡'], correctAnswer: 0, explanation: '"ä¸€å¸†é£é¡º"çš„åä¹‰è¯æ˜¯"åƒéš¾ä¸‡é™©"ã€‚' },
  { id: 'i100', type: 'relation', question: '"å‚å¤´ä¸§æ°”"çš„è¿‘ä¹‰è¯æ˜¯ï¼š', options: ['A. ç°å¿ƒä¸§æ°”', 'B. æ²¡ç²¾æ‰“é‡‡', 'C. å‚å¤´ä¸§æ°”', 'D. ä¸§æ°”'], correctAnswer: 1, explanation: '"å‚å¤´ä¸§æ°”"çš„è¿‘ä¹‰è¯æ˜¯"æ²¡ç²¾æ‰“é‡‡"ã€‚' }
]

function Idiom() {
  const [questions, setQuestions] = useState([])
  const [currentIndex, setCurrentIndex] = useState(0)
  const [selectedAnswer, setSelectedAnswer] = useState(null)
  const [showResult, setShowResult] = useState(false)
  const [score, setScore] = useState(0)
  const [completed, setCompleted] = useState(false)
  const [isFavorited, setIsFavorited] = useState(false)
  const [favoriteLoading, setFavoriteLoading] = useState(false)
  // è®°å½•æ¯é“é¢˜çš„ç­”æ¡ˆï¼Œç”¨äºä¿å­˜åˆ° answer_history
  const userAnswers = useRef({})

  const currentQuestion = questions[currentIndex]

  useDidShow(() => {
    startPractice()
    loadFavorites()
  })

  /**
   * åŠ è½½ç”¨æˆ·çš„æ”¶è—åˆ—è¡¨
   */
  const loadFavorites = async () => {
    try {
      const favorites = await questionService.getFavorites(1, 1000)
      FAVORITES_CACHE = new Set(favorites.map(f => f.id || f._id))
      updateFavoriteStatus()
    } catch (err) {
      console.error('åŠ è½½æ”¶è—å¤±è´¥:', err)
    }
  }

  /**
   * æ›´æ–°å½“å‰é¢˜ç›®çš„æ”¶è—çŠ¶æ€
   */
  const updateFavoriteStatus = () => {
    if (currentQuestion) {
      setIsFavorited(FAVORITES_CACHE.has(currentQuestion.id))
    }
  }

  /**
   * åˆ‡æ¢æ”¶è—çŠ¶æ€
   */
  const handleToggleFavorite = async () => {
    if (!currentQuestion || favoriteLoading) return

    setFavoriteLoading(true)
    try {
      // ä¼ é€’å®Œæ•´çš„é¢˜ç›®æ•°æ®
      const questionData = {
        id: currentQuestion.id,
        type: currentQuestion.type || 'idiom',
        question: currentQuestion.question,
        options: currentQuestion.options,
        correctAnswer: currentQuestion.correctAnswer,
        explanation: currentQuestion.explanation || ''
      }

      const success = await questionService.toggleFavorite(currentQuestion.id, questionData)
      if (success) {
        if (isFavorited) {
          FAVORITES_CACHE.delete(currentQuestion.id)
        } else {
          FAVORITES_CACHE.add(currentQuestion.id)
        }
        setIsFavorited(!isFavorited)
        Taro.showToast({
          title: isFavorited ? 'å·²å–æ¶ˆæ”¶è—' : 'å·²æ”¶è—',
          icon: isFavorited ? 'none' : 'success',
          duration: 1500
        })
      }
    } catch (err) {
      console.error('æ”¶è—å¤±è´¥:', err)
      Taro.showToast({ title: 'æ“ä½œå¤±è´¥', icon: 'none' })
    } finally {
      setFavoriteLoading(false)
    }
  }

  // é¢˜ç›®å˜åŒ–æ—¶æ›´æ–°æ”¶è—çŠ¶æ€
  useEffect(() => {
    updateFavoriteStatus()
  }, [currentIndex, questions])

  const startPractice = () => {
    // éšæœºæ‰“ä¹±é¢˜ç›®ï¼Œå–10é“
    const shuffled = [...IDIOM_QUESTIONS].sort(() => Math.random() - 0.5)
    setQuestions(shuffled.slice(0, 10))
    setCurrentIndex(0)
    setSelectedAnswer(null)
    setShowResult(false)
    setScore(0)
    setCompleted(false)
    userAnswers.current = {} // æ¸…ç©ºç­”æ¡ˆè®°å½•
  }

  const handleAnswer = (index) => {
    if (selectedAnswer !== null) return
    setSelectedAnswer(index)

    const currentQuestion = questions[currentIndex]
    // è®°å½•ç”¨æˆ·ç­”æ¡ˆ
    userAnswers.current[currentQuestion.id] = index

    if (index === currentQuestion.correctAnswer) {
      setScore(score + 1)
    }
    setShowResult(true)
  }

  const handleNext = () => {
    if (currentIndex < questions.length - 1) {
      setCurrentIndex(currentIndex + 1)
      setSelectedAnswer(null)
      setShowResult(false)
    } else {
      finishPractice()
    }
  }

  const finishPractice = async () => {
    console.log('=== finishPractice è¢«è°ƒç”¨ (æˆè¯­) ===')
    console.log('questions æ•°é‡:', questions.length)
    console.log('userAnswers.current:', JSON.stringify(userAnswers.current))

    setCompleted(true)

    // å‡†å¤‡ç­”é¢˜æ•°æ®ï¼ŒåŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯
    const answerData = questions.map(q => {
      const userAnswer = userAnswers.current[q.id] ?? -1
      const isCorrect = userAnswer === q.correctAnswer
      return {
        questionId: q.id,
        answer: userAnswer,
        isCorrect,
        questionType: 'idiom',
        // åŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯ï¼Œä»¥ä¾¿é”™é¢˜é‡åšæ—¶ä½¿ç”¨
        questionText: q.question || '',
        options: q.options || [],
        correctAnswer: q.correctAnswer
      }
    })

    console.log('=== answerData å‡†å¤‡å®Œæˆ (æˆè¯­) ===')
    console.log('answerData æ•°é‡:', answerData.length)

    // 1. ä¿å­˜ç­”é¢˜å†å²åˆ° answer_history
    try {
      console.log('=== å¼€å§‹è°ƒç”¨ question äº‘å‡½æ•° submitBatch (æˆè¯­) ===')
      const submitResult = await Taro.cloud.callFunction({
        name: 'question',
        data: {
          action: 'submitBatch',
          answers: answerData
        }
      })
      console.log('=== question äº‘å‡½æ•°è¿”å› (æˆè¯­) ===')
      console.log('result:', JSON.stringify(submitResult.result))
    } catch (err) {
      console.error('=== question äº‘å‡½æ•°è°ƒç”¨å¤±è´¥ (æˆè¯­) ===')
      console.error('é”™è¯¯:', err.errMsg || err.message)
      Taro.showToast({ title: 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', icon: 'none', duration: 2000 })
    }

    // 2. ä¿å­˜å­¦ä¹ è®°å½•åˆ° study_records
    try {
      await studyService.addRecord({
        type: 'idiom',
        title: 'æˆè¯­å­¦ä¹ ',
        score: Math.round((score / questions.length) * 100),
        totalQuestions: questions.length,
        correctAnswers: score,
        duration: 5
      })

      eventBus.emit(EVENTS.STUDY_RECORD_UPDATED, {
        type: 'idiom',
        score: Math.round((score / questions.length) * 100),
        correctCount: score,
        totalCount: questions.length
      })
    } catch (err) {
      console.error('ä¿å­˜å­¦ä¹ è®°å½•å¤±è´¥:', err)
    }
  }

  if (questions.length === 0) {
    return <View className="idiom-page"><Text>åŠ è½½ä¸­...</Text></View>
  }

  if (completed) {
    return (
      <View className="idiom-page">
        <View className="result-page">
          <View className="result-card">
            <Text className="result-title">ç»ƒä¹ å®Œæˆï¼</Text>
            <Text className="result-score">{score} / {questions.length}</Text>
            <Text className="result-desc">
              {score >= questions.length * 0.8 ? 'å¤ªæ£’äº†ï¼' :
               score >= questions.length * 0.6 ? 'ç»§ç»­åŠ æ²¹ï¼' : 'å†ç»ƒä¹ ä¸€ä¸‹å§ï¼'}
            </Text>
            <View className="result-actions">
              <View className="action-btn secondary" onClick={startPractice}>å†ç»ƒä¸€æ¬¡</View>
              <View className="action-btn" onClick={() => Taro.navigateBack()}>è¿”å›</View>
            </View>
          </View>
        </View>
      </View>
    )
  }

  return (
    <View className="idiom-page">
      {/* è¿›åº¦æ¡ */}
      <View className="progress-bar">
        <View
          className="progress-fill"
          style={{ width: `${((currentIndex + 1) / questions.length) * 100}%` }}
        />
      </View>

      <ScrollView scrollY className="content-scroll">
        {/* é¢˜ç›®å¡ç‰‡ */}
        <View className="question-card">
          <View className="question-header">
            <Text className="question-num">ç¬¬ {currentIndex + 1} / {questions.length} é¢˜</Text>
            <View className="question-tag">æˆè¯­å­¦ä¹ </View>
            <View
              className={`favorite-btn ${isFavorited ? 'favorited' : ''} ${favoriteLoading ? 'loading' : ''}`}
              onClick={handleToggleFavorite}
            >
              <Text className="favorite-icon">{isFavorited ? 'â˜…' : 'â˜†'}</Text>
            </View>
          </View>

          <View className="question-content">
            <Text className="question-text">{currentQuestion?.question}</Text>
          </View>

          {/* é€‰é¡¹åˆ—è¡¨ */}
          <View className="options-list">
            {currentQuestion?.options.map((option, index) => {
              const isSelected = selectedAnswer === index
              const isCorrect = index === currentQuestion.correctAnswer
              const showCorrect = showResult && isCorrect

              return (
                <View
                  key={index}
                  className={`option-item ${isSelected ? (isCorrect ? 'correct' : 'wrong') : ''} ${showCorrect ? 'correct' : ''}`}
                  onClick={() => handleAnswer(index)}
                >
                  <Text className="option-text">{option}</Text>
                  {showCorrect && <Text className="option-icon">âœ“</Text>}
                  {isSelected && !isCorrect && <Text className="option-icon">Ã—</Text>}
                </View>
              )
            })}
          </View>

          {/* è§£æ */}
          {showResult && currentQuestion?.explanation && (
            <View className="explanation-box">
              <Text className="explanation-label">è§£æ</Text>
              <Text className="explanation-text">{currentQuestion.explanation}</Text>
            </View>
          )}

          {/* ä¸‹ä¸€é¢˜æŒ‰é’® */}
          {showResult && (
            <View className="next-btn" onClick={handleNext}>
              <Text>{currentIndex < questions.length - 1 ? 'ä¸‹ä¸€é¢˜' : 'æŸ¥çœ‹ç»“æœ'}</Text>
            </View>
          )}
        </View>
      </ScrollView>
    </View>
  )
}

export default Idiom


// ===== src/pages/vocabulary/index.jsx =====
/**
 * è¯æ±‡å­¦ä¹ é¡µé¢ - é€‰æ‹©é¢˜æ¨¡å¼
 */
import { useState, useEffect, useRef } from 'react'
import { View, Text, ScrollView } from '@tarojs/components'
import Taro from '@tarojs/taro'
import { useDidShow } from '@tarojs/taro'
import studyService from '../../services/study'
import questionService from '../../services/question'
import eventBus, { EVENTS } from '../../utils/eventBus'
import './index.less'

// æ”¶è—çŠ¶æ€ç¼“å­˜
let FAVORITES_CACHE = new Set()

// è¯æ±‡é€‰æ‹©é¢˜åº“ï¼ˆåŸºäºK12çœŸé¢˜ï¼‰
const VOCABULARY_QUESTIONS = [
  // è¯è¯­é‡Šä¹‰é€‰æ‹©
  { id: 'v001', type: 'meaning', question: '"ç„•ç„¶ä¸€æ–°"çš„æ„æ€æ˜¯ï¼š', options: ['A. å®Œå…¨æ”¹å˜', 'B. å‡ºç°å´­æ–°çš„é¢è²Œ', 'C. ç¾ä¸½æ— æ¯”', 'D. é‡æ–°å¼€å§‹'], correctAnswer: 1, explanation: '"ç„•ç„¶ä¸€æ–°"å½¢å®¹å‡ºç°äº†å´­æ–°çš„é¢è²Œã€‚' },
  { id: 'v002', type: 'meaning', question: '"è°ˆç¬‘é£ç”Ÿ"çš„æ„æ€æ˜¯ï¼š', options: ['A. è°ˆè¯æœ‰é£', 'B. è°ˆç¬‘é£å£°', 'C. å½¢å®¹è°ˆè¯å…´è‡´å¾ˆé«˜', 'D. æœ‰è¯´æœ‰ç¬‘'], correctAnswer: 2, explanation: '"è°ˆç¬‘é£ç”Ÿ"å½¢å®¹è°ˆè¯æ—¶æœ‰è¯´æœ‰ç¬‘ï¼Œå…´è‡´å¾ˆé«˜ã€‚' },
  { id: 'v003', type: 'meaning', question: '"ç¾è½®ç¾å¥‚"å½¢å®¹ï¼š', options: ['A. ç¾ä¸½é£æ™¯', 'B. é«˜å¤§åä¸½å»ºç­‘', 'C. ç¾ä¸½çš„äºº', 'D. ç¾å¥½éŸ³ä¹'], correctAnswer: 1, explanation: '"ç¾è½®ç¾å¥‚"å½¢å®¹æˆ¿å±‹é«˜å¤§åä¸½ã€‚' },
  { id: 'v004', type: 'meaning', question: '"å·æµä¸æ¯"å½¢å®¹ï¼š', options: ['A. å±±å·æ²³æµ', 'B. è¡Œäººè½¦è¾†è¿ç»­ä¸æ–­', 'C. æ²³æµä¸æ–­', 'D. é£æ™¯ä¼˜ç¾'], correctAnswer: 1, explanation: '"å·æµä¸æ¯"å½¢å®¹è¡Œäººã€è½¦é©¬ç­‰åƒæ°´æµä¸€æ ·è¿ç»­ä¸æ–­ã€‚' },
  { id: 'v005', type: 'meaning', question: '"å› åœ°åˆ¶å®œ"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ”¹é€ ç¯å¢ƒ', 'B. æ ¹æ®å½“åœ°åˆ¶å®šåŠæ³•', 'C. é€‚åº”ç¯å¢ƒ', 'D. æ”¹å˜åˆ¶åº¦'], correctAnswer: 1, explanation: '"å› åœ°åˆ¶å®œ"æŒ‡æ ¹æ®å„åœ°çš„å…·ä½“æƒ…å†µï¼Œåˆ¶å®šé€‚å®œçš„åŠæ³•ã€‚' },
  { id: 'v006', type: 'meaning', question: '"é³æ¬¡æ ‰æ¯”"å½¢å®¹ï¼š', options: ['A. æ’åˆ—å¯†é›†æ•´é½', 'B. é±¼å’Œæ¢³å­', 'C. æ¬¡åºæ··ä¹±', 'D. æ•´é½ç¨€ç–'], correctAnswer: 0, explanation: '"é³æ¬¡æ ‰æ¯”"å½¢å®¹æˆ¿å±‹æˆ–èˆ¹åªç­‰æ’åˆ—å¾—å¾ˆå¯†å¾ˆæ•´é½ã€‚' },
  { id: 'v007', type: 'meaning', question: '"åˆ«å‡ºå¿ƒè£"çš„æ„æ€æ˜¯ï¼š', options: ['A. ç‹¬åˆ›ä¸€æ ¼', 'B. å¥‡æ€ª', 'C. ç‰¹æ®Š', 'D. æ™®é€š'], correctAnswer: 0, explanation: '"åˆ«å‡ºå¿ƒè£"æŒ‡ç‹¬åˆ›ä¸€æ ¼ï¼Œä¸ä¼—ä¸åŒã€‚' },
  { id: 'v008', type: 'meaning', question: '"æŠ‘æ‰¬é¡¿æŒ«"å½¢å®¹ï¼š', options: ['A. å£°éŸ³é«˜ä½èµ·ä¼', 'B. æƒ…ç»ªå˜åŒ–', 'C. åŠ¨ä½œèµ·ä¼', 'D. æ€æƒ³å˜åŒ–'], correctAnswer: 0, explanation: '"æŠ‘æ‰¬é¡¿æŒ«"æŒ‡å£°éŸ³çš„é«˜ä½èµ·ä¼å’Œåœé¡¿è½¬æŠ˜ã€‚' },
  { id: 'v009', type: 'meaning', question: '"é”²è€Œä¸èˆ"æ¯”å–»ï¼š', options: ['A. åšæŒä¸æ‡ˆ', 'B. åŠé€”è€ŒåºŸ', 'C. åšå†³', 'D. åŠªåŠ›'], correctAnswer: 0, explanation: '"é”²è€Œä¸èˆ"æ¯”å–»æœ‰æ’å¿ƒï¼Œæœ‰æ¯…åŠ›ï¼ŒåšæŒä¸æ‡ˆã€‚' },
  { id: 'v010', type: 'meaning', question: '"æœªé›¨ç»¸ç¼ª"æ„æ€æ˜¯ï¼š', options: ['A. ä¸‹é›¨å‰å‡†å¤‡', 'B. äº‹å…ˆåšå¥½å‡†å¤‡', 'C. é˜²æ­¢ä¸‹é›¨', 'D. å¤©æ°”é¢„æŠ¥'], correctAnswer: 1, explanation: '"æœªé›¨ç»¸ç¼ª"æ¯”å–»äº‹å…ˆåšå¥½å‡†å¤‡å·¥ä½œã€‚' },

  // è¯è¯­è¿ç”¨ï¼ˆé€‰è¯å¡«ç©ºï¼‰
  { id: 'v011', type: 'fill', question: 'ä¾æ¬¡å¡«å…¥æ¨ªçº¿å¤„æœ€æ°å½“çš„è¯è¯­ï¼š\nå†°é›ªæ—…æ¸¸ã€ä½“è‚²èµ›äº‹ç­‰å¤šé¢†åŸŸååŒå‘å±•ï¼Œä¸ºç¤¾ä¼š____äº†æ›´å¤šçš„å°±ä¸šå’Œå‘å±•æœºä¼šã€‚', options: ['A. åˆ›é€ ', 'B. æ‰“é€ ', 'C. åˆ¶é€ ', 'D. å»ºé€ '], correctAnswer: 0, explanation: '"åˆ›é€ æœºä¼š"æ˜¯å›ºå®šæ­é…ã€‚' },
  { id: 'v012', type: 'fill', question: 'ä¾æ¬¡å¡«å…¥æ¨ªçº¿å¤„æœ€æ°å½“çš„è¯è¯­ï¼š\nè´¢æ”¿æŠ•å…¥ä¸æ”¹å–„æ°‘ç”Ÿ____ç›¸èåˆï¼Œ____äº†åŸå¸‚è¿è¡Œæ°´å¹³çš„æé«˜ã€‚', options: ['A. æå‡/ä¿ƒè¿›', 'B. æé«˜/ä¿ƒæˆ', 'C. æå‡/ä¿ƒæˆ', 'D. æé«˜/ä¿ƒè¿›'], correctAnswer: 0, explanation: '"æå‡"ä¸æ°´å¹³æ­é…ï¼Œ"ä¿ƒè¿›"ä¸æé«˜æ­é…ã€‚' },
  { id: 'v013', type: 'fill', question: 'ä¾æ¬¡å¡«å…¥æ¨ªçº¿å¤„æœ€æ°å½“çš„è¯è¯­ï¼š\nåœ¨æ–°æ—¶ä»£èƒŒæ™¯ä¸‹ï¼Œæ˜ç¡®ç«æŠ€ä½“è‚²çš„æœªæ¥å‘å±•____å’Œæ”¹è‰¯ç­–ç•¥ï¼Œå®ç°ç«æŠ€ä½“è‚²å‘å±•ç†å¿µçš„____ã€‚', options: ['A. å¯¼å‘/è½¬ç§»', 'B. æ–¹å‘/è½¬å˜', 'C. å¯¼å‘/è½¬å˜', 'D. æ–¹å‘/è½¬ç§»'], correctAnswer: 2, explanation: '"å‘å±•å¯¼å‘"æ˜¯å¸¸ç”¨æ­é…ï¼Œ"å‘å±•ç†å¿µè½¬å˜"ä¹Ÿç¬¦åˆè¯­å¢ƒã€‚' },
  { id: 'v014', type: 'fill', question: 'ä¾æ¬¡å¡«å…¥æ¨ªçº¿å¤„æœ€æ°å½“çš„è¯è¯­ï¼š\nä½“è‚²æ¯”èµ›ä¸­ï¼ŒæŠ€æœ¯æ˜¯å®Œæˆæˆ˜æœ¯é…åˆçš„____ï¼Œè€Œæˆ˜æœ¯çš„ä¸æ–­____å’Œå‘å±•åˆå¯¹æŠ€æœ¯æå‡ºæ›´é«˜è¦æ±‚ã€‚', options: ['A. åŸºå‡†/æ¼”ç¤º', 'B. åŸºç¡€/æ¼”å˜', 'C. åŸºå‡†/æ¼”å˜', 'D. åŸºç¡€/æ¼”ç¤º'], correctAnswer: 1, explanation: '"åŸºç¡€"ä¸"é…åˆ"æ­é…ï¼Œ"æ¼”å˜"ä¸"å‘å±•"æ­é…ã€‚' },
  { id: 'v015', type: 'fill', question: 'ä¾æ¬¡å¡«å…¥æ¨ªçº¿å¤„æœ€æ°å½“çš„è¯è¯­ï¼š\n____ç«æŠ€ä½“è‚²çš„å¿«é€Ÿå‘å±•ï¼Œä½“è‚²æ¯”èµ›ä¼šç»™äººä»¬å¸¦æ¥æ›´å¤§çš„è§†è§‰éœ‡æ’¼ã€‚', options: ['A. éšç€', 'B. éšåŒ', 'C. ä¼´éš', 'D. è·Ÿéš'], correctAnswer: 0, explanation: '"éšç€"è¡¨ç¤ºä¼´éšæƒ…å†µçš„å˜åŒ–ã€‚' },

  // è¯è¯­ä¹¦å†™åˆ¤æ–­
  { id: 'v016', type: 'writing', question: 'ä¸‹åˆ—å„ç»„è¯è¯­ä¸­ï¼Œä¹¦å†™å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç¼–çº‚ é—·è‘«èŠ¦ ä¸–å¤–æ¡ƒå›­', 'B. è¾å°„ å¾®å¾ªç¯ åƒæ——æ¯é¼“', 'C. è¡¨å½° å³°çªç…¤ é›·å‰é£è¡Œ', 'D. ä¸´æ‘¹ ç»Šè„šçŸ³ ç¸æ‰‹å¯çƒ­'], correctAnswer: 1, explanation: 'Aé¡¹"ä¸–å¤–æ¡ƒå›­"åº”ä¸º"ä¸–å¤–æ¡ƒæº"ï¼›Cé¡¹"å³°çªç…¤"åº”ä¸º"èœ‚çªç…¤"ï¼›Dé¡¹"ç¸æ‰‹å¯çƒ­"åº”ä¸º"ç‚™æ‰‹å¯çƒ­"ã€‚' },
  { id: 'v017', type: 'writing', question: 'ä¸‹åˆ—å„ç»„è¯è¯­ä¸­ï¼Œä¹¦å†™å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é—®é¼ é€†æ—¶é’ˆ é›·éœ†ä¸‡é’§', 'B. è£è†º é—´å¥æ›² æˆ®åŠ›åŒå¿ƒ', 'C. è¯·æ¨± æ®Šä¸çŸ¥ ç”šå™¨å°˜ä¸Š', 'D. æŠ›é”š ä¹¦åˆ¸æ°” æ—å¾åšå¼•'], correctAnswer: 1, explanation: 'Aé¡¹"é€†æ—¶é’ˆ"æ­£ç¡®ï¼›Bé¡¹å…¨éƒ¨æ­£ç¡®ï¼›Cé¡¹"è¯·æ¨±"åº”ä¸º"è¯·ç¼¨"ï¼Œ"ç”šå™¨å°˜ä¸Š"åº”ä¸º"ç”šåš£å°˜ä¸Š"ï¼›Dé¡¹"ä¹¦åˆ¸æ°”"åº”ä¸º"ä¹¦å·æ°”"ã€‚' },
  { id: 'v018', type: 'writing', question: 'ä¸‹åˆ—å„ç»„è¯è¯­ä¸­ï¼Œä¹¦å†™å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç­‰å€™ åä¸Šå®¢ é èº¬å°½ç˜', 'B. å¥¢å ç‰›è§’å°– è½»é‡ç¼“æ€¥', 'C. å°‘è®¸ å†ç¨‹ç¢‘ å±…å®‰æ€å±', 'D. ç¨æ¯ å±…ç•™æƒ ç¤¼ä¸Šå¾€æ¥'], correctAnswer: 1, explanation: 'Aé¡¹"åä¸Šå®¢"åº”ä¸º"åº§ä¸Šå®¢"ï¼›Cé¡¹"å†ç¨‹ç¢‘"åº”ä¸º"é‡Œç¨‹ç¢‘"ï¼›Dé¡¹"ç¤¼ä¸Šå¾€æ¥"åº”ä¸º"ç¤¼å°šå¾€æ¥"ã€‚' },
  { id: 'v019', type: 'writing', question: 'ä¸‹åˆ—å„ç»„è¯è¯­ä¸­ï¼Œä¹¦å†™å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¼ä¸¤ æ®Šä¸çŸ¥ åˆ åˆ æ¥è¿Ÿ', 'B. æœŸå¾… å…¨å¤©å€™ å…¥ä¸æ•·å‡º', 'C. å¯»è§… æµè§ˆå™¨ æŒ‰æ­¥å°±ç­', 'D. å¶åƒ åè°ˆä¼š å…³æ€€å€è‡³'], correctAnswer: 1, explanation: 'Aé¡¹"ä¼ä¸¤"åº”ä¸º"ä¼ä¿©"ï¼Œ"åˆ åˆ æ¥è¿Ÿ"åº”ä¸º"å§—å§—æ¥è¿Ÿ"ï¼›Cé¡¹"æµè§ˆå™¨"åº”ä¸º"æµè§ˆå™¨"ï¼Œ"æŒ‰æ­¥å°±ç­"åº”ä¸º"æŒ‰éƒ¨å°±ç­"ï¼›Dé¡¹"åè°ˆä¼š"åº”ä¸º"åº§è°ˆä¼š"ï¼Œ"å…³æ€€å€è‡³"åº”ä¸º"å…³æ€€å¤‡è‡³"ã€‚' },
  { id: 'v020', type: 'writing', question: 'ä¸‹åˆ—å„ç»„è¯è¯­ä¸­ï¼Œä¹¦å†™å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ¸©é¦¨ å¢¨è®¸ æ¸ºæ— äººçƒŸ', 'B. å¯è’™ å†¥æƒ³ çŸ«å¾€è¿‡æ­£', 'C. é¹…é»„ é›€è·ƒ é—»é¸¡èµ·èˆ', 'D. è—è§† æ‰¼è…• èŠ±æ‹³ç§€è…¿'], correctAnswer: 2, explanation: 'Aé¡¹"å¢¨è®¸"åº”ä¸º"é»˜è®¸"ï¼›Bé¡¹"çŸ«å¾€è¿‡æ­£"åº”ä¸º"çŸ«æ‰è¿‡æ­£"ï¼›Dé¡¹"èŠ±æ‹³ç§€è…¿"åº”ä¸º"èŠ±æ‹³ç»£è…¿"ã€‚' },

  // è¯è¯­è¾¨æ
  { id: 'v021', type: 'distinguish', question: '"ç›¸å¾—ç›Šå½°"çš„æ„æ€æ˜¯ï¼š', options: ['A. äº’ç›¸é…åˆ', 'B. äº’ç›¸é…åˆï¼ŒåŒæ–¹èƒ½åŠ›æ›´èƒ½å‘æŒ¥', 'C. å„æœ‰åƒç§‹', 'D. å–é•¿è¡¥çŸ­'], correctAnswer: 1, explanation: '"ç›¸å¾—ç›Šå½°"æŒ‡ä¸¤ä¸ªäººæˆ–ä¸¤ä»¶äº‹ç‰©äº’ç›¸é…åˆï¼ŒåŒæ–¹çš„èƒ½åŠ›å’Œä½œç”¨æ›´èƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚' },
  { id: 'v022', type: 'distinguish', question: '"åšç§¯è–„å‘"å½¢å®¹ï¼š', options: ['A. ç§¯ç´¯åé‡Šæ”¾', 'B. é•¿æ—¶é—´ç§¯ç´¯åæ…¢æ…¢é‡Šæ”¾', 'C. å¤šç§¯å°‘å‘', 'D. å‘è´¢è‡´å¯Œ'], correctAnswer: 1, explanation: '"åšç§¯è–„å‘"å½¢å®¹é•¿æ—¶é—´ç§¯ç´¯ï¼Œæ…¢æ…¢é‡Šæ”¾å‡ºæ¥ã€‚' },
  { id: 'v023', type: 'distinguish', question: '"è„ç‚™äººå£"å½¢å®¹ï¼š', options: ['A. å¾ˆå¤šäººåƒ', 'B. ç¾å‘³å¯å£', 'C. ä¸ºä¼—äººæ‰€ç§°é¢‚', 'D. æµè¡Œå¹¿æ³›'], correctAnswer: 2, explanation: '"è„ç‚™äººå£"æ¯”å–»å¥½çš„è¯—æ–‡æˆ–äº‹ç‰©ä¸ºä¼—äººæ‰€ç§°é¢‚ã€‚' },
  { id: 'v024', type: 'distinguish', question: '"æœ›æ´‹å…´å¹"æ¯”å–»ï¼š', options: ['A. çœ‹æµ·æ„Ÿå¹', 'B. åŠ›ä¸ä»å¿ƒ', 'C. æ— å¯å¥ˆä½•', 'D. å‰é€”æ¸ºèŒ«'], correctAnswer: 2, explanation: '"æœ›æ´‹å…´å¹"æ¯”å–»åšäº‹æ—¶å› åŠ›ä¸èƒœä»»æˆ–æ²¡æœ‰æ¡ä»¶è€Œæ„Ÿåˆ°æ— å¯å¥ˆä½•ã€‚' },
  { id: 'v025', type: 'distinguish', question: '"å¶å…¬å¥½é¾™"æ¯”å–»ï¼š', options: ['A. çœŸçš„å–œæ¬¢é¾™', 'B. å£å¤´ä¸Šè¯´çˆ±å¥½ï¼Œå®é™…ä¸çœŸçˆ±å¥½', 'C. å–œæ¬¢åŠ¨ç‰©', 'D. çˆ±å¥½å¹¿æ³›'], correctAnswer: 1, explanation: '"å¶å…¬å¥½é¾™"æ¯”å–»å£å¤´ä¸Šè¯´çˆ±å¥½æŸäº‹ç‰©ï¼Œå®é™…ä¸Šå¹¶ä¸çœŸçˆ±å¥½ã€‚' },
  { id: 'v026', type: 'distinguish', question: '"æäººå¿§å¤©"æ¯”å–»ï¼š', options: ['A. å¿§è™‘å¤©æ°”', 'B. ä¸å¿…è¦çš„å¿§è™‘', 'C. æ‹…å¿ƒå¤©ä¸‹', 'D. çˆ±ç®¡é—²äº‹'], correctAnswer: 1, explanation: '"æäººå¿§å¤©"æ¯”å–»ä¸å¿…è¦çš„æˆ–ç¼ºä¹æ ¹æ®çš„å¿§è™‘å’Œæ‹…å¿ƒã€‚' },
  { id: 'v027', type: 'distinguish', question: '"æ¯å¼“è›‡å½±"æ¯”å–»ï¼š', options: ['A. æ¯å­å’Œè›‡', 'B. ç–‘ç¥ç–‘é¬¼', 'C. ææƒ§å®³æ€•', 'D. å±é™©é‡é‡'], correctAnswer: 1, explanation: '"æ¯å¼“è›‡å½±"æ¯”å–»å› ç–‘ç¥ç–‘é¬¼è€Œå¼•èµ·ææƒ§ã€‚' },
  { id: 'v028', type: 'distinguish', question: '"ç”»è›‡æ·»è¶³"æ¯”å–»ï¼š', options: ['A. ç”»ç”»å¾ˆå¥½', 'B. åšäº‹è®¤çœŸ', 'C. åšå¤šä½™çš„äº‹åä¸å¥½', 'D. ç”»è›‡æŠ€å·§é«˜è¶…'], correctAnswer: 2, explanation: '"ç”»è›‡æ·»è¶³"æ¯”å–»åšäº†å¤šä½™çš„äº‹ï¼Œéä½†æ— ç›Šï¼Œåè€Œä¸åˆé€‚ã€‚' },
  { id: 'v029', type: 'distinguish', question: '"å®ˆæ ªå¾…å…”"æ¯”å–»ï¼š', options: ['A. ç­‰å¾…æœºä¼š', 'B. æ­»å®ˆç»éªŒä¸çŸ¥å˜é€š', 'C. è€å¿ƒç­‰å¾…', 'D. æœŸç›¼æˆåŠŸ'], correctAnswer: 1, explanation: '"å®ˆæ ªå¾…å…”"æ¯”å–»æ­»å®ˆç‹­éš˜ç»éªŒï¼Œä¸çŸ¥å˜é€šã€‚' },
  { id: 'v030', type: 'distinguish', question: '"åˆ»èˆŸæ±‚å‰‘"æ¯”å–»ï¼š', options: ['A. è®°æ€§å¥½', 'B. æ‹˜æ³¥æˆæ³•ä¸çŸ¥å˜é€š', 'C. åšäº‹åšæŒ', 'D. çºªå¿µæ·±åˆ»'], correctAnswer: 1, explanation: '"åˆ»èˆŸæ±‚å‰‘"æ¯”å–»æ‹˜æ³¥æˆæ³•ï¼Œä¸çŸ¥é“å˜é€šã€‚' },
  { id: 'v031', type: 'distinguish', question: '"äº¡ç¾Šè¡¥ç‰¢"çš„æ„æ€æ˜¯ï¼š', options: ['A. ç¾Šä¸¢äº†', 'B. å‡ºé—®é¢˜åè¡¥æ•‘', 'C. å¤ªæ™šäº†', 'D. ä¿®è¡¥ç¾Šåœˆ'], correctAnswer: 1, explanation: '"äº¡ç¾Šè¡¥ç‰¢"æ¯”å–»å‡ºäº†é—®é¢˜ä»¥åæƒ³åŠæ³•è¡¥æ•‘ï¼Œå¯ä»¥é˜²æ­¢ç»§ç»­å—æŸå¤±ã€‚' },
  { id: 'v032', type: 'distinguish', question: '"æ©è€³ç›—é“ƒ"æ¯”å–»ï¼š', options: ['A. å·ä¸œè¥¿', 'B. è‡ªå·±æ¬ºéª—è‡ªå·±', 'C. æ©ç›–é”™è¯¯', 'D. è’™éª—åˆ«äºº'], correctAnswer: 1, explanation: '"æ©è€³ç›—é“ƒ"æ¯”å–»è‡ªå·±æ¬ºéª—è‡ªå·±ã€‚' },
  { id: 'v033', type: 'distinguish', question: '"å—è¾•åŒ—è¾™"æ¯”å–»ï¼š', options: ['A. å—æ–¹åˆ°åŒ—æ–¹', 'B. è¡ŒåŠ¨å’Œç›®çš„ç›¸å', 'C. è·¯é€”é¥è¿œ', 'D. æ–¹å‘æ­£ç¡®'], correctAnswer: 1, explanation: '"å—è¾•åŒ—è¾™"æ¯”å–»è¡ŒåŠ¨å’Œç›®çš„æ­£å¥½ç›¸åã€‚' },
  { id: 'v034', type: 'distinguish', question: '"ä¸€é¸£æƒŠäºº"æ¯”å–»ï¼š', options: ['A. å«å£°å¾ˆå¤§', 'B. çªç„¶æˆåŠŸ', 'C. å¹³æ—¶ä¸çªå‡ºï¼Œä¸€åšå°±æœ‰æƒŠäººæˆç»©', 'D. ä»¤äººæƒŠè®¶'], correctAnswer: 2, explanation: '"ä¸€é¸£æƒŠäºº"æ¯”å–»å¹³æ—¶æ²¡æœ‰ç‰¹æ®Šè¡¨ç°ï¼Œä¸€åšèµ·æ¥å°±æœ‰æƒŠäººçš„æˆç»©ã€‚' },
  { id: 'v035', type: 'distinguish', question: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»ï¼š', options: ['A. èº«ä½“å¥åº·', 'B. åšäº‹æœ‰æŠŠæ¡', 'C. å–œæ¬¢ç”»ç”»', 'D. å¿ƒé‡Œæœ‰æ•°'], correctAnswer: 1, explanation: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»åšäº‹ä¹‹å‰å·²ç»æœ‰é€šç›˜çš„è€ƒè™‘ã€‚' },
  { id: 'v036', type: 'distinguish', question: '"æœ›æ¢…æ­¢æ¸´"æ¯”å–»ï¼š', options: ['A. å–œæ¬¢åƒæ¢…å­', 'B. ç”¨ç©ºæƒ³å®‰æ…°è‡ªå·±', 'C. æ¸´æœ›æˆåŠŸ', 'D. å……æ»¡å¸Œæœ›'], correctAnswer: 1, explanation: '"æœ›æ¢…æ­¢æ¸´"æ¯”å–»ç”¨ç©ºæƒ³å®‰æ…°è‡ªå·±ã€‚' },
  { id: 'v037', type: 'distinguish', question: '"æ‹”è‹—åŠ©é•¿"æ¯”å–»ï¼š', options: ['A. å¸®åŠ©æ¤ç‰©ç”Ÿé•¿', 'B. æ€¥äºæ±‚æˆåè€Œåäº‹', 'C. è¾›å‹¤åŠ³åŠ¨', 'D. å†œä¸šç”Ÿäº§'], correctAnswer: 1, explanation: '"æ‹”è‹—åŠ©é•¿"æ¯”å–»è¿åäº‹ç‰©å‘å±•çš„å®¢è§‚è§„å¾‹ï¼Œæ€¥äºæ±‚æˆï¼Œåè€ŒæŠŠäº‹æƒ…å¼„ç³Ÿã€‚' },
  { id: 'v038', type: 'distinguish', question: '"æ»¥ç«½å……æ•°"æ¯”å–»ï¼š', options: ['A. éŸ³ä¹æ¼”å¥', 'B. æ²¡æœ‰çœŸæ‰å®å­¦çš„äººæ··åœ¨è¡Œå®¶é‡Œé¢å……æ•°', 'C. äººå¤šçƒ­é—¹', 'D. æ¬ºéª—è¡Œä¸º'], correctAnswer: 1, explanation: '"æ»¥ç«½å……æ•°"æ¯”å–»æ²¡æœ‰çœŸæ‰å®å­¦çš„äººæ··åœ¨è¡Œå®¶é‡Œé¢å……æ•°ã€‚' },
  { id: 'v039', type: 'distinguish', question: '"å¯¹ç‰›å¼¹ç´"æ¯”å–»ï¼š', options: ['A. å¯¹ç‰›å¼¹ç´', 'B. å¯¹ä¸æ‡‚é“ç†çš„äººè®²é“ç†', 'C. éŸ³ä¹æ¬£èµ', 'D. è€å¿ƒæ•™å­¦'], correctAnswer: 1, explanation: '"å¯¹ç‰›å¼¹ç´"æ¯”å–»å¯¹ä¸è®²é“ç†çš„äººè®²é“ç†ã€‚' },
  { id: 'v040', type: 'distinguish', question: '"ç ´é‡œæ²‰èˆŸ"æ¯”å–»ï¼š', options: ['A. ç ¸é”…æ²‰èˆ¹', 'B. ä¸‹å®šå†³å¿ƒä¸é¡¾ä¸€åˆ‡åœ°å¹²åˆ°åº•', 'C. å¤±è´¥äº†', 'D. èµŒåšè¡Œä¸º'], correctAnswer: 1, explanation: '"ç ´é‡œæ²‰èˆŸ"æ¯”å–»ä¸‹å†³å¿ƒä¸é¡¾ä¸€åˆ‡åœ°å¹²åˆ°åº•ã€‚' },
  { id: 'v041', type: 'distinguish', question: '"å§è–ªå°èƒ†"å½¢å®¹ï¼š', options: ['A. ç¡è§‰åƒè‹¦', 'B. åˆ»è‹¦è‡ªåŠ±', 'C. ç”Ÿæ´»è‰°è‹¦', 'D. åšæŒä¸æ‡ˆ'], correctAnswer: 1, explanation: '"å§è–ªå°èƒ†"å½¢å®¹äººåˆ»è‹¦è‡ªåŠ±ï¼Œå‘æ„¤å›¾å¼ºã€‚' },
  { id: 'v042', type: 'distinguish', question: '"ä¸‰é¡¾èŒ…åº"æ¯”å–»ï¼š', options: ['A. æ‹œè®¿ä¸‰æ¬¡', 'B. è¯šå¿ƒè¯šæ„åœ°é‚€è¯·äººå®¶', 'C. å–œæ¬¢æ—…æ¸¸', 'D. å‚è§‚èŒ…åº'], correctAnswer: 1, explanation: '"ä¸‰é¡¾èŒ…åº"æ¯”å–»è¯šå¿ƒè¯šæ„åœ°é‚€è¯·äººå®¶ã€‚' },
  { id: 'v043', type: 'distinguish', question: '"è´Ÿè†è¯·ç½ª"è¡¨ç¤ºï¼š', options: ['A. æ‰¿è®¤é”™è¯¯', 'B. å‘äººè®¤é”™èµ”ç½ª', 'C. é“æ­‰', 'D. æ„Ÿè°¢å¸®åŠ©'], correctAnswer: 1, explanation: '"è´Ÿè†è¯·ç½ª"è¡¨ç¤ºå‘äººè®¤é”™èµ”ç½ªã€‚' },
  { id: 'v044', type: 'distinguish', question: '"å®Œç’§å½’èµµ"æ¯”å–»ï¼š', options: ['A. å½’è¿˜ç‰©å“', 'B. æŠŠç‰©å“å®Œå¥½åœ°å½’è¿˜ç»™ä¸»äºº', 'C. é€ç¤¼', 'D. å€Ÿä¸œè¥¿'], correctAnswer: 1, explanation: '"å®Œç’§å½’èµµ"æ¯”å–»æŠŠç‰©å“å®Œå¥½åœ°å½’è¿˜ç»™ç‰©å“çš„ä¸»äººã€‚' },

  // è¿‘ä¹‰è¯è¾¨æ
  { id: 'v045', type: 'synonym', question: '"ç²¾è‡´"å’Œ"ç²¾å·§"çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š', options: ['A. æ²¡æœ‰åŒºåˆ«', 'B. ç²¾è‡´ä¾§é‡ç»†è‡´ï¼Œç²¾å·§ä¾§é‡å·§å¦™', 'C. ç²¾è‡´ä¾§é‡å·§å¦™ï¼Œç²¾å·§ä¾§é‡ç»†è‡´', 'D. ç²¾è‡´ç”¨äºå¤§ç‰©ä½“ï¼Œç²¾å·§ç”¨äºå°ç‰©ä½“'], correctAnswer: 1, explanation: '"ç²¾è‡´"ä¾§é‡ç²¾ç»†ç»†è‡´ï¼Œ"ç²¾å·§"ä¾§é‡ç²¾å¦™å·§å¦™ã€‚' },
  { id: 'v046', type: 'synonym', question: '"åºŸé™¤"å’Œ"åºŸæ­¢"çš„æ­£ç¡®ä½¿ç”¨æ˜¯ï¼š', options: ['A. åºŸé™¤æ³•ä»¤ï¼ŒåºŸæ­¢åˆ¶åº¦', 'B. åºŸé™¤åˆ¶åº¦ï¼ŒåºŸæ­¢æ³•ä»¤', 'C. åºŸé™¤æ¡çº¦ï¼ŒåºŸæ­¢æ³•å¾‹', 'D. ä¸¤è€…å¯ä»¥äº’æ¢'], correctAnswer: 1, explanation: '"åºŸé™¤"å¤šç”¨äºåˆ¶åº¦ã€ä¹ ä¿—ï¼Œ"åºŸæ­¢"å¤šç”¨äºæ³•ä»¤ã€æ¡ä¾‹ã€‚' },
  { id: 'v047', type: 'synonym', question: '"å¿…é¡»"å’Œ"å¿…éœ€"çš„åŒºåˆ«æ˜¯ï¼š', options: ['A. å®Œå…¨ç›¸åŒ', 'B. å¿…é¡»æ˜¯å‰¯è¯ï¼Œå¿…éœ€æ˜¯åŠ¨è¯', 'C. å¿…é¡»æ˜¯åŠ¨è¯ï¼Œå¿…éœ€æ˜¯å‰¯è¯', 'D. éƒ½æ˜¯åŠ¨è¯'], correctAnswer: 1, explanation: '"å¿…é¡»"æ˜¯å‰¯è¯ï¼Œè¡¨ç¤ºä¸€å®šè¦ï¼›"å¿…éœ€"æ˜¯åŠ¨è¯ï¼Œè¡¨ç¤ºä¸€å®šè¦æœ‰ã€‚' },
  { id: 'v048', type: 'synonym', question: '"è€ƒå¯Ÿ"å’Œ"è€ƒæŸ¥"çš„åŒºåˆ«æ˜¯ï¼š', options: ['A. å®Œå…¨ç›¸åŒ', 'B. è€ƒå¯Ÿæ˜¯å®åœ°è§‚å¯Ÿï¼Œè€ƒæŸ¥æ˜¯æ£€éªŒ', 'C. è€ƒå¯Ÿæ˜¯æ£€éªŒï¼Œè€ƒæŸ¥æ˜¯å®åœ°è§‚å¯Ÿ', 'D. ä¸¤è€…å¯ä»¥äº’æ¢'], correctAnswer: 1, explanation: '"è€ƒå¯Ÿ"æŒ‡å®åœ°è§‚å¯Ÿè°ƒæŸ¥ï¼Œ"è€ƒæŸ¥"æŒ‡ç”¨ä¸€å®šæ ‡å‡†æ£€éªŒã€‚' },
  { id: 'v049', type: 'synonym', question: '"å“å‘³"å’Œ"å“ä½"çš„åŒºåˆ«æ˜¯ï¼š', options: ['A. å®Œå…¨ç›¸åŒ', 'B. å“å‘³æ˜¯å“å°ï¼Œå“ä½æ˜¯å“è´¨', 'C. å“å‘³æ˜¯å“è´¨ï¼Œå“ä½æ˜¯å“å°', 'D. éƒ½æ˜¯å“å°çš„æ„æ€'], correctAnswer: 1, explanation: '"å“å‘³"æŒ‡å“å°ã€ä½“ä¼šï¼Œ"å“ä½"æŒ‡å“è´¨ã€æ°´å¹³ã€‚' },

  // è¯è¯­æ­é…åˆ¤æ–­
  { id: 'v050', type: 'collocation', question: 'ä¸‹åˆ—æ­é…æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‘æŒ¥ä½œç”¨', 'B. å‘æ‰¬ä½œç”¨', 'C. å‘ç”Ÿä½œç”¨', 'D. å‘æ‰¬ä½œç”¨'], correctAnswer: 0, explanation: '"å‘æŒ¥ä½œç”¨"æ˜¯æ­£ç¡®æ­é…ï¼Œ"å‘æ‰¬"ä¸€èˆ¬ä¸"ç²¾ç¥""ä¼ ç»Ÿ"æ­é…ã€‚' },
  { id: 'v051', type: 'collocation', question: 'ä¸‹åˆ—æ­é…æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ”¹è¿›ç¼ºç‚¹', 'B. æ”¹æ­£ç¼ºç‚¹', 'C. æ”¹æ­£é”™è¯¯', 'D. æ”¹è¿›é”™è¯¯'], correctAnswer: 2, explanation: '"æ”¹æ­£é”™è¯¯""æ”¹è¿›å·¥ä½œ"æ˜¯æ­£ç¡®æ­é…ã€‚' },
  { id: 'v052', type: 'collocation', question: 'ä¸‹åˆ—æ­é…æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æé«˜æ•ˆç‡', 'B. å¢é«˜æ•ˆç‡', 'C. å‡é«˜æ•ˆç‡', 'D. åŠ é«˜æ•ˆç‡'], correctAnswer: 0, explanation: '"æé«˜æ•ˆç‡"æ˜¯æ­£ç¡®æ­é…ã€‚' },
  { id: 'v053', type: 'collocation', question: 'ä¸‹åˆ—æ­é…æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å¢è¿›å‹è°Š', 'B. å¢åŠ å‹è°Š', 'C. æé«˜å‹è°Š', 'D. å‡é«˜å‹è°Š'], correctAnswer: 0, explanation: '"å¢è¿›å‹è°Š"æ˜¯æ­£ç¡®æ­é…ã€‚' },
  { id: 'v054', type: 'collocation', question: 'ä¸‹åˆ—æ­é…æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¸°å¯Œç»éªŒ', 'B. ä¸°åšç»éªŒ', 'C. å¯Œæœ‰ç»éªŒ', 'D. ä¸°è£•ç»éªŒ'], correctAnswer: 0, explanation: '"ä¸°å¯Œç»éªŒ"æ˜¯æ­£ç¡®æ­é…ã€‚' },

  // æ›´å¤šK12çœŸé¢˜è¯æ±‡é¢˜
  { id: 'v055', type: 'usage', question: '"ä¸è®¡å…¶æ•°"çš„æ„æ€æ˜¯ï¼š', options: ['A. ä¸è®¡ç®—æ•°å­—', 'B. æ— æ³•è®¡ç®—æ•°ç›®ï¼Œå½¢å®¹å¾ˆå¤š', 'C. ä¸è¦è®¡ç®—', 'D. æ•°ä¸æ¸…æ¥š'], correctAnswer: 1, explanation: '"ä¸è®¡å…¶æ•°"å½¢å®¹å¾ˆå¤šï¼Œæ— æ³•è®¡ç®—ã€‚' },
  { id: 'v056', type: 'usage', question: '"è¿«ä¸åŠå¾…"çš„æ„æ€æ˜¯ï¼š', options: ['A. ç­‰å¾…ä¸åŠ', 'B. æ€¥è¿«å¾—ä¸èƒ½ç­‰å¾…', 'C. ä¸è¦ç­‰å¾…', 'D. ä¸èƒ½ç­‰å¾…'], correctAnswer: 1, explanation: '"è¿«ä¸åŠå¾…"å½¢å®¹å¿ƒæƒ…æ€¥åˆ‡ï¼Œæ€¥è¿«å¾—ä¸èƒ½ç­‰å¾…ã€‚' },
  { id: 'v057', type: 'usage', question: '"å…´é«˜é‡‡çƒˆ"å½¢å®¹ï¼š', options: ['A. å…´è‡´é«˜', 'B. å…´è‡´é«˜æ˜‚ï¼Œæƒ…ç»ªçƒ­çƒˆ', 'C. é«˜å…´é‡‡èŠ±', 'D. çƒ­çƒˆè®¨è®º'], correctAnswer: 1, explanation: '"å…´é«˜é‡‡çƒˆ"å½¢å®¹å…´è‡´é«˜ï¼Œæƒ…ç»ªçƒ­çƒˆã€‚' },
  { id: 'v058', type: 'usage', question: '"å°å¿ƒç¿¼ç¿¼"å½¢å®¹ï¼š', options: ['A. éå¸¸å°å¿ƒ', 'B. ä¸¾åŠ¨è°¨æ…ï¼Œä¸æ•¢ç–å¿½', 'C. å®¹æ˜“ææƒ§', 'D. å°å¿ƒçœ¼'], correctAnswer: 1, explanation: '"å°å¿ƒç¿¼ç¿¼"å½¢å®¹ä¸¾åŠ¨è°¨æ…ï¼Œä¸æ•¢ç–å¿½ã€‚' },
  { id: 'v059', type: 'usage', question: '"æç„¶å¤§æ‚Ÿ"çš„æ„æ€æ˜¯ï¼š', options: ['A. çªç„¶æ˜ç™½', 'B. å¿½ç„¶å¤§æ‚Ÿ', 'C. ææƒšæ˜ç™½', 'D. å¤§æ‚Ÿ'], correctAnswer: 1, explanation: '"æç„¶å¤§æ‚Ÿ"å½¢å®¹ä¸€ä¸‹å­æ˜ç™½è¿‡æ¥ã€‚' },
  { id: 'v060', type: 'usage', question: '"ä¸çº¦è€ŒåŒ"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ²¡æœ‰çº¦å®š', 'B. äº‹å…ˆæ²¡æœ‰å•†é‡è€Œè¡ŒåŠ¨ä¸€è‡´', 'C. ä¸åŒæ„', 'D. ä¸ä¸€è‡´'], correctAnswer: 1, explanation: '"ä¸çº¦è€ŒåŒ"æŒ‡äº‹å…ˆæ²¡æœ‰å•†é‡è€Œç›¸äº’ä¸€è‡´ã€‚' },
  { id: 'v061', type: 'usage', question: '"å…¨ç¥è´¯æ³¨"å½¢å®¹ï¼š', options: ['A. å…¨éƒ¨ç²¾ç¥é›†ä¸­', 'B. æ³¨æ„åŠ›é«˜åº¦é›†ä¸­', 'C. å…¨ç¥æŠ•å…¥', 'D. ç²¾ç¥é¥±æ»¡'], correctAnswer: 1, explanation: '"å…¨ç¥è´¯æ³¨"å½¢å®¹æ³¨æ„åŠ›é«˜åº¦é›†ä¸­ã€‚' },
  { id: 'v062', type: 'usage', question: '"ç›®ä¸è½¬ç›"å½¢å®¹ï¼š', options: ['A. çœ¼ç›ä¸è½¬', 'B. ç›¯ç€çœ‹', 'C. æ³¨æ„åŠ›é›†ä¸­åœ°çœ‹ç€', 'D. çœ‹ä¸æ¸…'], correctAnswer: 2, explanation: '"ç›®ä¸è½¬ç›"å½¢å®¹æ³¨æ„åŠ›é›†ä¸­åœ°çœ‹ç€ã€‚' },
  { id: 'v063', type: 'usage', question: '"èšç²¾ä¼šç¥"çš„æ„æ€æ˜¯ï¼š', options: ['A. èšé›†ç²¾ç¥', 'B. ç²¾ç¥é›†ä¸­', 'C. ä¼šè§ç¥ä»™', 'D. ç²¾ç¥é¥±æ»¡'], correctAnswer: 1, explanation: '"èšç²¾ä¼šç¥"å½¢å®¹ç²¾ç¥é›†ä¸­ã€‚' },
  { id: 'v064', type: 'usage', question: '"æ´¥æ´¥æœ‰å‘³"å½¢å®¹ï¼š', options: ['A. æœ‰å‘³é“', 'B. åƒå¾—é¦™', 'C. å…´è¶£æµ“åš', 'D. æœ‰æ»‹å‘³'], correctAnswer: 2, explanation: '"æ´¥æ´¥æœ‰å‘³"å½¢å®¹åƒå¾—å¾ˆæœ‰å‘³é“æˆ–å¾ˆæœ‰å…´è¶£ã€‚' },
  { id: 'v065', type: 'usage', question: '"å‚å¤´ä¸§æ°”"å½¢å®¹ï¼š', options: ['A. ä½ä¸‹å¤´', 'B. ä¸§æ°”å¤±æœ›', 'C. å¤±æœ›æ²®ä¸§', 'D. å¤´ä½ä¸‹æ¥'], correctAnswer: 2, explanation: '"å‚å¤´ä¸§æ°”"å½¢å®¹å¤±æœ›æ²®ä¸§çš„ç¥æƒ…ã€‚' },
  { id: 'v066', type: 'usage', question: '"å…´é«˜é‡‡çƒˆ"çš„åä¹‰è¯æ˜¯ï¼š', options: ['A. å…´è‡´å‹ƒå‹ƒ', 'B. æ— ç²¾æ‰“é‡‡', 'C. é«˜é«˜å…´å…´', 'D. æ¬¢å¤©å–œåœ°'], correctAnswer: 1, explanation: '"æ— ç²¾æ‰“é‡‡"æ˜¯"å…´é«˜é‡‡çƒˆ"çš„åä¹‰è¯ã€‚' },
  { id: 'v067', type: 'usage', question: '"é¸¦é›€æ— å£°"å½¢å®¹ï¼š', options: ['A. éå¸¸å®‰é™', 'B. é¸Ÿé›€æ²¡æœ‰å£°éŸ³', 'C. å¯‚é™æ— å£°', 'D. æ‚„æ‚„æ— å£°'], correctAnswer: 0, explanation: '"é¸¦é›€æ— å£°"å½¢å®¹éå¸¸å®‰é™ã€‚' },
  { id: 'v068', type: 'usage', question: '"ç³ç…æ»¡ç›®"å½¢å®¹ï¼š', options: ['A. çœ¼ç›æ»¡äº†', 'B. ç¾å¥½äº‹ç‰©å¾ˆå¤š', 'C. æ»¡çœ¼éƒ½æ˜¯', 'D. ä¸°å¯Œå¤šæ ·'], correctAnswer: 1, explanation: '"ç³ç…æ»¡ç›®"å½¢å®¹ç¾å¥½äº‹ç‰©å¾ˆå¤šã€‚' },
  { id: 'v069', type: 'usage', question: '"ç¾ä¸èƒœæ”¶"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ”¶ä¸äº†', 'B. ç¾å¥½çš„ä¸œè¥¿å¤ªå¤šï¼Œçœ‹ä¸è¿‡æ¥', 'C. ç¾ä¸½', 'D. æ”¶è·ç¾'], correctAnswer: 1, explanation: '"ç¾ä¸èƒœæ”¶"å½¢å®¹ç¾å¥½çš„ä¸œè¥¿å¤ªå¤šï¼Œçœ‹ä¸è¿‡æ¥ã€‚' },
  { id: 'v070', type: 'usage', question: '"ä¸€æœ›æ— é™…"å½¢å®¹ï¼š', options: ['A. çœ‹ä¸åˆ°è¾¹', 'B. éå¸¸å¹¿é˜”', 'C. ä¸€çœ¼æœ›ä¸åˆ°è¾¹', 'D. æ— è¾¹æ— é™…'], correctAnswer: 2, explanation: '"ä¸€æœ›æ— é™…"å½¢å®¹ä¸€çœ¼æœ›ä¸åˆ°è¾¹ï¼Œéå¸¸è¾½é˜”ã€‚' },
  { id: 'v071', type: 'usage', question: '"åƒæ–¹ç™¾è®¡"çš„æ„æ€æ˜¯ï¼š', options: ['A. ä¸€åƒä¸ªæ–¹æ³•', 'B. æƒ³å°½æˆ–ç”¨å°½ä¸€åˆ‡åŠæ³•', 'C. å¾ˆå¤šåŠæ³•', 'D. å„ç§åŠæ³•'], correctAnswer: 1, explanation: '"åƒæ–¹ç™¾è®¡"å½¢å®¹æƒ³å°½æˆ–ç”¨å°½ä¸€åˆ‡åŠæ³•ã€‚' },
  { id: 'v072', type: 'usage', question: '"ä¸è¾åŠ³è‹¦"çš„æ„æ€æ˜¯ï¼š', options: ['A. ä¸æ€•è¾›è‹¦', 'B. ä¸æ¨è¾åŠ³è‹¦', 'C. ä¸æ€•åŠ³ç´¯', 'D. è¾›å‹¤åŠ³ä½œ'], correctAnswer: 1, explanation: '"ä¸è¾åŠ³è‹¦"å½¢å®¹ä¸æ¨è¾åŠ³ç´¯è¾›è‹¦ã€‚' },
  { id: 'v073', type: 'usage', question: '"ä»»åŠ³ä»»æ€¨"å½¢å®¹ï¼š', options: ['A. åŠ³ä½œ', 'B. åšäº‹ä¸è¾åŠ³è‹¦ï¼Œä¸æ€•åŸ‹æ€¨', 'C. ä»»åŠ³ä»»æ€¨', 'D. è¾›å‹¤å·¥ä½œ'], correctAnswer: 1, explanation: '"ä»»åŠ³ä»»æ€¨"å½¢å®¹åšäº‹ä¸è¾åŠ³è‹¦ï¼Œä¸æ€•åˆ«äººåŸ‹æ€¨ã€‚' },
  { id: 'v074', type: 'usage', question: '"ä¸€ä¸ä¸è‹Ÿ"å½¢å®¹ï¼š', options: ['A. ä¸é©¬è™', 'B. è¿æœ€ç»†å¾®çš„åœ°æ–¹ä¹Ÿä¸é©¬è™', 'C. è®¤çœŸ', 'D. ç»†å¿ƒ'], correctAnswer: 1, explanation: '"ä¸€ä¸ä¸è‹Ÿ"å½¢å®¹è¿æœ€ç»†å¾®çš„åœ°æ–¹ä¹Ÿä¸é©¬è™ã€‚' },

  // è¯è¯­ç†è§£ä¸è¿ç”¨
  { id: 'v075', type: 'understand', question: '"å¿ƒæ—·ç¥æ€¡"å½¢å®¹ï¼š', options: ['A. å¿ƒæƒ…èˆ’ç•…', 'B. ç²¾ç¥æ„‰å¿«', 'C. å¿ƒèƒ¸å¼€é˜”ï¼Œç²¾ç¥æ„‰å¿«', 'D. é«˜å…´'], correctAnswer: 2, explanation: '"å¿ƒæ—·ç¥æ€¡"å½¢å®¹å¿ƒèƒ¸å¼€é˜”ï¼Œç²¾ç¥æ„‰å¿«ã€‚' },
  { id: 'v076', type: 'understand', question: '"èµå¿ƒæ‚¦ç›®"å½¢å®¹ï¼š', options: ['A. çœ‹ç€èˆ’æœ', 'B. å› æ¬£èµç¾å¥½æ™¯ç‰©è€Œå¿ƒæƒ…èˆ’ç•…', 'C. ç¾å¥½', 'D. æ‚¦ç›®'], correctAnswer: 1, explanation: '"èµå¿ƒæ‚¦ç›®"å½¢å®¹å› æ¬£èµç¾å¥½çš„æ™¯ç‰©è€Œå¿ƒæƒ…èˆ’ç•…ã€‚' },
  { id: 'v077', type: 'understand', question: '"å¿ƒèŠ±æ€’æ”¾"å½¢å®¹ï¼š', options: ['A. é«˜å…´', 'B. æå…¶é«˜å…´', 'C. å¼€å¿ƒ', 'D. å…´å¥‹'], correctAnswer: 1, explanation: '"å¿ƒèŠ±æ€’æ”¾"å½¢å®¹æå…¶é«˜å…´ã€‚' },
  { id: 'v078', type: 'understand', question: '"æ¬£å–œè‹¥ç‹‚"çš„æ„æ€æ˜¯ï¼š', options: ['A. é«˜å…´å¾—å‘ç‹‚', 'B. é«˜å…´åˆ°äº†æç‚¹', 'C. ç‹‚å–œ', 'D. æ¬£å–œ'], correctAnswer: 1, explanation: '"æ¬£å–œè‹¥ç‹‚"å½¢å®¹é«˜å…´åˆ°äº†æç‚¹ã€‚' },
  { id: 'v079', type: 'understand', question: '"å¿ƒå¹³æ°”å’Œ"å½¢å®¹ï¼š', options: ['A. å¹³é™', 'B. å¿ƒæƒ…å¹³é™ï¼Œæ€åº¦æ¸©å’Œ', 'C. å’Œæ°”', 'D. å†·é™'], correctAnswer: 1, explanation: '"å¿ƒå¹³æ°”å’Œ"å½¢å®¹å¿ƒæƒ…å¹³é™ï¼Œæ€åº¦æ¸©å’Œã€‚' },
  { id: 'v080', type: 'understand', question: '"ä»å®¹ä¸è¿«"çš„æ„æ€æ˜¯ï¼š', options: ['A. ä¸æ…Œä¸å¿™', 'B. éå¸¸é•‡é™ï¼Œä¸æ…Œä¸å¿™', 'C. å†·é™', 'D. æ²‰ç€'], correctAnswer: 1, explanation: '"ä»å®¹ä¸è¿«"å½¢å®¹éå¸¸é•‡é™ï¼Œä¸æ…Œä¸å¿™ã€‚' }
]

function Vocabulary() {
  const [questions, setQuestions] = useState([])
  const [currentIndex, setCurrentIndex] = useState(0)
  const [selectedAnswer, setSelectedAnswer] = useState(null)
  const [showResult, setShowResult] = useState(false)
  const [score, setScore] = useState(0)
  const [completed, setCompleted] = useState(false)
  const [isFavorited, setIsFavorited] = useState(false)
  const [favoriteLoading, setFavoriteLoading] = useState(false)
  // è®°å½•æ¯é“é¢˜çš„ç­”æ¡ˆï¼Œç”¨äºä¿å­˜åˆ° answer_history
  const userAnswers = useRef({})

  const currentQuestion = questions[currentIndex]

  useDidShow(() => {
    startPractice()
    loadFavorites()
  })

  /**
   * åŠ è½½ç”¨æˆ·çš„æ”¶è—åˆ—è¡¨
   */
  const loadFavorites = async () => {
    try {
      const favorites = await questionService.getFavorites(1, 1000)
      FAVORITES_CACHE = new Set(favorites.map(f => f.id || f._id))
      updateFavoriteStatus()
    } catch (err) {
      console.error('åŠ è½½æ”¶è—å¤±è´¥:', err)
    }
  }

  /**
   * æ›´æ–°å½“å‰é¢˜ç›®çš„æ”¶è—çŠ¶æ€
   */
  const updateFavoriteStatus = () => {
    if (currentQuestion) {
      setIsFavorited(FAVORITES_CACHE.has(currentQuestion.id))
    }
  }

  /**
   * åˆ‡æ¢æ”¶è—çŠ¶æ€
   */
  const handleToggleFavorite = async () => {
    if (!currentQuestion || favoriteLoading) return

    setFavoriteLoading(true)

    // æ‰“å°å½“å‰é¢˜ç›®æ•°æ®
    console.log('=== handleToggleFavorite å½“å‰é¢˜ç›® ===')
    console.log('currentQuestion:', currentQuestion)

    try {
      // ä¼ é€’å®Œæ•´çš„é¢˜ç›®æ•°æ®
      const questionData = {
        id: currentQuestion.id,
        type: currentQuestion.type || 'vocabulary',
        question: currentQuestion.question,
        options: currentQuestion.options,
        correctAnswer: currentQuestion.correctAnswer,
        explanation: currentQuestion.explanation || ''
      }

      console.log('=== å‡†å¤‡å‘é€çš„ questionData ===', questionData)

      const success = await questionService.toggleFavorite(currentQuestion.id, questionData)

      console.log('=== toggleFavorite è¿”å›ç»“æœ ===', success)

      if (success) {
        if (isFavorited) {
          FAVORITES_CACHE.delete(currentQuestion.id)
        } else {
          FAVORITES_CACHE.add(currentQuestion.id)
        }
        setIsFavorited(!isFavorited)
        Taro.showToast({
          title: isFavorited ? 'å·²å–æ¶ˆæ”¶è—' : 'å·²æ”¶è—',
          icon: isFavorited ? 'none' : 'success',
          duration: 1500
        })
      }
    } catch (err) {
      console.error('æ”¶è—å¤±è´¥:', err)
      Taro.showToast({ title: 'æ“ä½œå¤±è´¥', icon: 'none' })
    } finally {
      setFavoriteLoading(false)
    }
  }

  // é¢˜ç›®å˜åŒ–æ—¶æ›´æ–°æ”¶è—çŠ¶æ€
  useEffect(() => {
    updateFavoriteStatus()
  }, [currentIndex, questions])

  const startPractice = () => {
    // éšæœºæ‰“ä¹±é¢˜ç›®ï¼Œå–10é“
    const shuffled = [...VOCABULARY_QUESTIONS].sort(() => Math.random() - 0.5)
    setQuestions(shuffled.slice(0, 10))
    setCurrentIndex(0)
    setSelectedAnswer(null)
    setShowResult(false)
    setScore(0)
    setCompleted(false)
    userAnswers.current = {} // æ¸…ç©ºç­”æ¡ˆè®°å½•
  }

  const handleAnswer = (index) => {
    if (selectedAnswer !== null) {
      return
    }
    setSelectedAnswer(index)

    const currentQuestion = questions[currentIndex]
    // è®°å½•ç”¨æˆ·ç­”æ¡ˆ
    userAnswers.current[currentQuestion.id] = index

    if (index === currentQuestion.correctAnswer) {
      setScore(score + 1)
    }
    setShowResult(true)
  }

  const handleNext = () => {
    if (currentIndex < questions.length - 1) {
      setCurrentIndex(currentIndex + 1)
      setSelectedAnswer(null)
      setShowResult(false)
    } else {
      finishPractice()
    }
  }

  const finishPractice = async () => {
    setCompleted(true)

    // å‡†å¤‡ç­”é¢˜æ•°æ®ï¼ŒåŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯
    const answerData = questions.map(q => {
      const userAnswer = userAnswers.current[q.id] ?? -1
      const isCorrect = userAnswer === q.correctAnswer
      return {
        questionId: q.id,
        answer: userAnswer,
        isCorrect,
        questionType: 'vocabulary',
        // åŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯ï¼Œä»¥ä¾¿é”™é¢˜é‡åšæ—¶ä½¿ç”¨
        questionText: q.question || '',
        options: q.options || [],
        correctAnswer: q.correctAnswer
      }
    })

    // 1. ä¿å­˜ç­”é¢˜å†å²åˆ° answer_history
    try {
      const submitResult = await Taro.cloud.callFunction({
        name: 'question',
        data: {
          action: 'submitBatch',
          answers: answerData
        }
      })
      console.log('=== äº‘å‡½æ•°è¿”å›å®Œæ•´æ•°æ® ===', JSON.stringify(submitResult))
      // å…¼å®¹ä¸¤ç§è¿”å›æ ¼å¼ï¼šæ‰å¹³ç»“æ„å’ŒåµŒå¥— data ç»“æ„
      const result = submitResult.result || submitResult || {}
      console.log('=== result ===', JSON.stringify(result))
      // æ–°æ ¼å¼ï¼šç›´æ¥ä» result è¯»å–
      // æ—§æ ¼å¼ï¼šä» result.data è¯»å–
      const saved = result.savedCount ?? result.data?.savedCount ?? '?'
      const version = result.version ?? result.data?.version ?? 'no-ver'
      console.log('=== è§£æç»“æœ ===', { saved, version, total: answerData.length })
    } catch (err) {
      console.error('=== äº‘å‡½æ•°è°ƒç”¨å¤±è´¥ ===', err)
      Taro.showToast({ title: 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', icon: 'none', duration: 2000 })
      throw err
    }

    // 2. ä¿å­˜å­¦ä¹ è®°å½•åˆ° study_records
    try {
      await studyService.addRecord({
        type: 'vocabulary',
        title: 'è¯æ±‡å­¦ä¹ ',
        score: Math.round((score / questions.length) * 100),
        totalQuestions: questions.length,
        correctAnswers: score,
        duration: 5
      })

      eventBus.emit(EVENTS.STUDY_RECORD_UPDATED, {
        type: 'vocabulary',
        score: Math.round((score / questions.length) * 100),
        correctCount: score,
        totalCount: questions.length
      })
    } catch (err) {
      console.error('ä¿å­˜å­¦ä¹ è®°å½•å¤±è´¥:', err)
    }
  }

  if (questions.length === 0) {
    return <View className="vocabulary-page"><Text>åŠ è½½ä¸­...</Text></View>
  }

  if (completed) {
    return (
      <View className="vocabulary-page">
        <View className="result-page">
          <View className="result-card">
            <Text className="result-title">ç»ƒä¹ å®Œæˆï¼</Text>
            <Text className="result-score">{score} / {questions.length}</Text>
            <Text className="result-desc">
              {score >= questions.length * 0.8 ? 'å¤ªæ£’äº†ï¼' :
               score >= questions.length * 0.6 ? 'ç»§ç»­åŠ æ²¹ï¼' : 'å†ç»ƒä¹ ä¸€ä¸‹å§ï¼'}
            </Text>
            <View className="result-actions">
              <View className="action-btn secondary" onClick={startPractice}>å†ç»ƒä¸€æ¬¡</View>
              <View className="action-btn" onClick={() => Taro.navigateBack()}>è¿”å›</View>
            </View>
          </View>
        </View>
      </View>
    )
  }

  return (
    <View className="vocabulary-page">
      {/* è¿›åº¦æ¡ */}
      <View className="progress-bar">
        <View
          className="progress-fill"
          style={{ width: `${((currentIndex + 1) / questions.length) * 100}%` }}
        />
      </View>

      <ScrollView scrollY className="content-scroll">
        {/* é¢˜ç›®å¡ç‰‡ */}
        <View className="question-card">
          <View className="question-header">
            <Text className="question-num">ç¬¬ {currentIndex + 1} / {questions.length} é¢˜</Text>
            <View className="question-tag">è¯æ±‡å­¦ä¹ </View>
            <View
              className={`favorite-btn ${isFavorited ? 'favorited' : ''} ${favoriteLoading ? 'loading' : ''}`}
              onClick={handleToggleFavorite}
            >
              <Text className="favorite-icon">{isFavorited ? 'â˜…' : 'â˜†'}</Text>
            </View>
          </View>

          <View className="question-content">
            <Text className="question-text">{currentQuestion?.question}</Text>
          </View>

          {/* é€‰é¡¹åˆ—è¡¨ */}
          <View className="options-list">
            {currentQuestion?.options.map((option, index) => {
              const isSelected = selectedAnswer === index
              const isCorrect = index === currentQuestion.correctAnswer
              const showCorrect = showResult && isCorrect

              return (
                <View
                  key={index}
                  className={`option-item ${isSelected ? (isCorrect ? 'correct' : 'wrong') : ''} ${showCorrect ? 'correct' : ''}`}
                  onClick={() => handleAnswer(index)}
                >
                  <Text className="option-text">{option}</Text>
                  {showCorrect && <Text className="option-icon">âœ“</Text>}
                  {isSelected && !isCorrect && <Text className="option-icon">Ã—</Text>}
                </View>
              )
            })}
          </View>

          {/* è§£æ */}
          {showResult && currentQuestion?.explanation && (
            <View className="explanation-box">
              <Text className="explanation-label">è§£æ</Text>
              <Text className="explanation-text">{currentQuestion.explanation}</Text>
            </View>
          )}

          {/* ä¸‹ä¸€é¢˜æŒ‰é’® */}
          {showResult && (
            <View className="next-btn" onClick={handleNext}>
              <Text>{currentIndex < questions.length - 1 ? 'ä¸‹ä¸€é¢˜' : 'æŸ¥çœ‹ç»“æœ'}</Text>
            </View>
          )}
        </View>
      </ScrollView>
    </View>
  )
}

export default Vocabulary


// ===== src/pages/correction/index.jsx =====
/**
 * ç—…å¥ä¿®æ”¹é¡µé¢ - é€‰æ‹©é¢˜æ¨¡å¼
 */
import { useState, useRef, useEffect } from 'react'
import { View, Text, ScrollView } from '@tarojs/components'
import Taro from '@tarojs/taro'
import { useDidShow } from '@tarojs/taro'
import studyService from '../../services/study'
import questionService from '../../services/question'
import eventBus, { EVENTS } from '../../utils/eventBus'
import './index.less'

// æ”¶è—çŠ¶æ€ç¼“å­˜
let FAVORITES_CACHE = new Set()

// ç—…å¥ä¿®æ”¹é€‰æ‹©é¢˜åº“
const CORRECTION_QUESTIONS = [
  // åˆ¤æ–­æ˜¯å¦æœ‰è¯­ç—…
  { id: 'c001', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"é€šè¿‡è¿™æ¬¡å­¦ä¹ ï¼Œä½¿æˆ‘å—ç›ŠåŒªæµ…ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: '"é€šè¿‡"å’Œ"ä½¿"åŒæ—¶ä½¿ç”¨ï¼Œå¯¼è‡´å¥å­ç¼ºå°‘ä¸»è¯­ã€‚åº”åˆ å»"é€šè¿‡"æˆ–"ä½¿"ã€‚' },
  { id: 'c002', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"æˆ‘ä»¬å¿…é¡»éšæ—¶å‘ç°å¹¶æ”¹æ­£è‡ªå·±çš„ç¼ºç‚¹ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: '"ç¼ºç‚¹"ä¸èƒ½ä¸"æ”¹æ­£"æ­é…ï¼Œåº”æ”¹ä¸º"é”™è¯¯"ã€‚' },
  { id: 'c003', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"ç¨»ç±³æ˜¯æµ™æ±Ÿã€æ±Ÿè‹ä¸€å¸¦çš„ä¸»è¦ç²®é£Ÿã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: '"ç²®é£Ÿ"èŒƒå›´å¤ªå¹¿ï¼Œåº”æ”¹ä¸º"ç²®é£Ÿä½œç‰©"æ‰å‡†ç¡®ã€‚' },
  { id: 'c004', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"æ˜¥å¤©çš„æ­å·æ˜¯ä¸€ä¸ªç¾ä¸½çš„å­£èŠ‚ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'ä¸»å®¾æ­é…ä¸å½“ã€‚"æ­å·"æ˜¯åœ°ç‚¹ï¼Œä¸èƒ½æ˜¯"å­£èŠ‚"ã€‚åº”æ”¹ä¸º"æ­å·çš„æ˜¥å¤©æ˜¯ä¸€ä¸ªç¾ä¸½çš„å­£èŠ‚"ã€‚' },
  { id: 'c005', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"ä»–è™½ç„¶å­¦ä¹ å¾ˆå¿™ï¼Œä½†æ˜¯åšæŒé”»ç‚¼èº«ä½“ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 1, explanation: 'å¥å­æ— è¯­ç—…ï¼Œå…³è”è¯ä½¿ç”¨æ­£ç¡®ã€‚' },
  { id: 'c006', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"ä¸ºäº†é˜²æ­¢ç±»ä¼¼çš„äº¤é€šäº‹æ•…ä¸å†å‘ç”Ÿï¼Œæˆ‘ä»¬åŠ å¼ºäº†å®‰å…¨æ•™è‚²ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'å¦å®šä¸å½“ã€‚"é˜²æ­¢"å’Œ"ä¸å†"è¿ç”¨è¡¨ç¤ºè‚¯å®šï¼Œåº”å»æ‰"ä¸"ã€‚' },
  { id: 'c007', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"è¿™ç¯‡å°è¯´é€šè¿‡æå†™äººç‰©çš„å¿ƒç†æ´»åŠ¨ï¼Œè¡¨ç°äº†ä½œè€…çš„æ€æƒ³æ„Ÿæƒ…ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 1, explanation: 'å¥å­æ— è¯­ç—…ï¼Œè¡¨è¾¾æ¸…æ™°å‡†ç¡®ã€‚' },
  { id: 'c008', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"ç»è¿‡è€å¸ˆçš„è€å¿ƒæ•™è‚²ï¼Œä½¿æˆ‘è®¤è¯†åˆ°äº†è‡ªå·±çš„é”™è¯¯ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'æˆåˆ†æ®‹ç¼ºï¼Œç¼ºå°‘ä¸»è¯­ã€‚"ç»è¿‡"å’Œ"ä½¿"åŒæ—¶ä½¿ç”¨å¯¼è‡´ä¸»è¯­ç¼ºå¤±ã€‚' },
  { id: 'c009', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"å„ç§æ–°å‘ç°çš„æµè¡Œç—…ï¼Œå¯¹åŒ»åŠ¡äººå‘˜æ˜¯æ–°çš„è€ƒéªŒã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'è¯­åºä¸å½“ã€‚åº”æ”¹ä¸º"æ–°å‘ç°çš„å„ç§æµè¡Œç—…"ã€‚' },
  { id: 'c010', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"åªæœ‰åšæŒåŠªåŠ›ï¼Œå°±èƒ½å–å¾—æˆåŠŸã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'å…³è”è¯æ­é…ä¸å½“ã€‚"åªæœ‰"åº”ä¸"æ‰"æ­é…ï¼Œ"åªè¦"æ‰ä¸"å°±"æ­é…ã€‚' },

  // é€‰æ‹©æ­£ç¡®ä¿®æ”¹
  { id: 'c011', type: 'correct', question: '"è¿™ä¸ªé—®é¢˜ç»è¿‡å¤§å®¶è®¨è®ºï¼Œå·²ç»æœ‰äº†æ˜ç¡®çš„è®¤è¯†ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è¿™ä¸ªé—®é¢˜ç»è¿‡å¤§å®¶è®¨è®ºï¼Œå·²ç»æœ‰äº†æ˜ç¡®çš„è®¤è¯†', 'B. ç»è¿‡å¤§å®¶å¯¹è¿™ä¸ªé—®é¢˜çš„è®¨è®ºï¼Œå·²ç»æœ‰äº†æ˜ç¡®çš„è®¤è¯†', 'C. å¤§å®¶å¯¹è¿™ä¸ªé—®é¢˜çš„è®¨è®ºï¼Œå·²ç»æœ‰äº†æ˜ç¡®çš„è®¤è¯†'], correctAnswer: 1, explanation: 'åŸå¥ç¼ºå°‘ä¸»è¯­ï¼Œåº”åœ¨"ç»è¿‡"å‰åŠ ä¸Šä¸»è¯­ï¼Œæˆ–è°ƒæ•´è¯­åºã€‚' },
  { id: 'c012', type: 'correct', question: '"èƒ½å¦ä¿æŒè‰°è‹¦æœ´ç´ çš„ä½œé£ï¼Œæ˜¯æ¥ç­äººçš„é‡è¦æ¡ä»¶ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. èƒ½å¦ä¿æŒè‰°è‹¦æœ´ç´ çš„ä½œé£ï¼Œæ˜¯æˆä¸ºæ¥ç­äººçš„é‡è¦æ¡ä»¶', 'B. ä¿æŒè‰°è‹¦æœ´ç´ çš„ä½œé£ï¼Œæ˜¯æ¥ç­äººçš„é‡è¦æ¡ä»¶', 'C. èƒ½å¦ä¿æŒè‰°è‹¦æœ´ç´ çš„ä½œé£ï¼Œèƒ½å¦æˆä¸ºæ¥ç­äººçš„é‡è¦æ¡ä»¶'], correctAnswer: 1, explanation: '"èƒ½å¦"è¡¨ç¤ºä¸¤é¢ï¼Œåé¢ä¹Ÿåº”å¯¹åº”ä¸¤é¢ï¼Œæˆ–åˆ å»"èƒ½å¦"ä¿æŒä¸€é¢ã€‚' },
  { id: 'c013', type: 'correct', question: '"æˆ‘ä»¬è¦ä¸æ–­æ”¹è¿›å­¦ä¹ æ–¹æ³•ï¼Œå¢åŠ å­¦ä¹ æ•ˆç‡ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬è¦ä¸æ–­æ”¹è¿›å­¦ä¹ æ–¹æ³•ï¼Œæé«˜å­¦ä¹ æ•ˆç‡', 'B. æˆ‘ä»¬è¦ä¸æ–­æ”¹å–„å­¦ä¹ æ–¹æ³•ï¼Œå¢åŠ å­¦ä¹ æ•ˆç‡', 'C. æˆ‘ä»¬è¦ä¸æ–­æ”¹è¿›å­¦ä¹ æ–¹æ³•ï¼ŒåŠ å¼ºå­¦ä¹ æ•ˆç‡'], correctAnswer: 0, explanation: '"æ•ˆç‡"åº”ä¸"æé«˜"æ­é…ï¼Œä¸æ˜¯"å¢åŠ "ã€‚' },
  { id: 'c014', type: 'correct', question: '"ä»–çš„ä½œæ–‡ä¸ä½†åœ¨å…¨æ ¡è·å¥–ï¼Œè€Œä¸”åœ¨å…¨å›½è·å¥–ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. ä»–çš„ä½œæ–‡ä¸ä½†åœ¨å…¨å›½è·å¥–ï¼Œè€Œä¸”åœ¨å…¨æ ¡è·å¥–', 'B. ä»–çš„ä½œæ–‡ä¸ä½†å…¨æ ¡è·å¥–ï¼Œè€Œä¸”å…¨å›½è·å¥–', 'C. ä»–çš„ä½œæ–‡ä¸ä»…åœ¨å…¨æ ¡è·å¥–ï¼Œè€Œä¸”åœ¨å…¨å›½è·å¥–'], correctAnswer: 2, explanation: 'é€’è¿›å…³ç³»è¯­åºä¸å½“ï¼Œåº”ä»å°èŒƒå›´åˆ°å¤§èŒƒå›´ï¼Œ"ä¸ä½†...è€Œä¸”..."æ”¹ä¸º"ä¸ä»…...è€Œä¸”..."æ›´è§„èŒƒã€‚' },
  { id: 'c015', type: 'correct', question: '"å¸‚åœºä¸Šåˆ°å¤„éƒ½æ˜¯å„ç§æ°´æœï¼Œæœ‰è¥¿ç“œã€è‹¹æœã€æ¢¨ç­‰ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. å¸‚åœºä¸Šåˆ°å¤„éƒ½æ˜¯æ°´æœï¼Œæœ‰è¥¿ç“œã€è‹¹æœã€æ¢¨ç­‰å„ç§', 'B. å¸‚åœºä¸Šæœ‰å„ç§æ°´æœï¼Œåˆ°å¤„éƒ½æ˜¯è¥¿ç“œã€è‹¹æœã€æ¢¨ç­‰', 'C. å¸‚åœºä¸Šåˆ°å¤„éƒ½æ˜¯å„ç§æ°´æœï¼Œä¾‹å¦‚è¥¿ç“œã€è‹¹æœã€æ¢¨ç­‰'], correctAnswer: 0, explanation: '"åˆ°å¤„"ä¸"å„ç§"è¯­åºä¸å½“ï¼Œä¸”"ç­‰"è¡¨ç¤ºåˆ—ä¸¾æœªå®Œï¼Œåº”æ”¾åœ¨"å„ç§"å‰é¢ã€‚' },
  { id: 'c016', type: 'correct', question: '"è¿™æ˜¯æœ‰è¶£çš„ä¸€æœ¬è¯¾å¤–ä¹¦ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è¿™æ˜¯æœ‰è¶£çš„è¯¾å¤–ä¹¦ä¸€æœ¬', 'B. è¿™æ˜¯ä¸€æœ¬æœ‰è¶£çš„è¯¾å¤–ä¹¦', 'C. ä¸€æœ¬æœ‰è¶£çš„è¯¾å¤–ä¹¦è¿™æ˜¯'], correctAnswer: 1, explanation: 'æ•°é‡çŸ­è¯­ä½ç½®ä¸å½“ï¼Œ"ä¸€æœ¬"åº”æ”¾åœ¨"æœ‰è¶£"å‰é¢ã€‚' },
  { id: 'c017', type: 'correct', question: '"åšç‰©é¦†å±•å‡ºäº†å‡ åƒå¹´ä»¥å‰åˆšå‡ºåœŸçš„æ–‡ç‰©ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. åšç‰©é¦†å±•å‡ºäº†åˆšå‡ºåœŸçš„å‡ åƒå¹´ä»¥å‰çš„æ–‡ç‰©', 'B. åšç‰©é¦†å±•å‡ºäº†å‡ åƒå¹´ä»¥å‰çš„æ–‡ç‰©åˆšå‡ºåœŸçš„', 'C. åˆšå‡ºåœŸçš„å‡ åƒå¹´ä»¥å‰çš„æ–‡ç‰©åœ¨åšç‰©é¦†å±•å‡º'], correctAnswer: 0, explanation: '"åˆšå‡ºåœŸ"åº”ä¿®é¥°"æ–‡ç‰©"ï¼Œè€Œä¸æ˜¯"å‡ åƒå¹´ä»¥å‰"ã€‚' },
  { id: 'c018', type: 'correct', question: '"ä»–æŠŠä½œæ–‡åšäº†è®¤çœŸä¿®æ”¹ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. ä»–æŠŠä½œæ–‡è®¤çœŸåšäº†ä¿®æ”¹', 'B. ä»–è®¤çœŸåœ°æŠŠä½œæ–‡åšäº†ä¿®æ”¹', 'C. ä»–æŠŠä½œæ–‡è®¤çœŸä¿®æ”¹äº†ä¸€é'], correctAnswer: 2, explanation: '"åšäº†"æ˜¯å¤šä½™æˆåˆ†ï¼Œåº”åˆ å»ï¼Œä½¿å¥å­æ›´ç®€æ´ã€‚' },
  { id: 'c019', type: 'correct', question: '"æˆ‘ä»¬ç­åŒå­¦åŸºæœ¬ä¸Šéƒ½å‚åŠ äº†è¿™æ¬¡æ´»åŠ¨ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬ç­åŒå­¦åŸºæœ¬ä¸Šå‚åŠ äº†è¿™æ¬¡æ´»åŠ¨', 'B. æˆ‘ä»¬ç­åŸºæœ¬ä¸ŠåŒå­¦éƒ½å‚åŠ äº†è¿™æ¬¡æ´»åŠ¨', 'C. æˆ‘ä»¬ç­åŒå­¦éƒ½åŸºæœ¬ä¸Šå‚åŠ äº†è¿™æ¬¡æ´»åŠ¨'], correctAnswer: 0, explanation: '"åŸºæœ¬ä¸Š"å’Œ"éƒ½"çŸ›ç›¾ï¼Œåº”åˆ å»å…¶ä¸­ä¸€ä¸ªã€‚' },
  { id: 'c020', type: 'correct', question: '"è¿™ä½è€ç§‘å­¦å®¶çš„å®¶é‡Œï¼Œæœ‰å¾ˆå¤šè—ä¹¦ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è¿™ä½è€ç§‘å­¦å®¶çš„å®¶é‡Œï¼Œæœ‰å¤§é‡çš„è—ä¹¦', 'B. è¿™ä½è€ç§‘å­¦å®¶æœ‰å¾ˆå¤šè—ä¹¦', 'C. è¿™ä½è€ç§‘å­¦å®¶çš„è—ä¹¦å¾ˆå¤š'], correctAnswer: 2, explanation: 'åŸå¥ä¸»è°“æ­é…ä¸å½“ï¼Œ"è—ä¹¦"å±äº"è€ç§‘å­¦å®¶"è€Œé"å®¶é‡Œ"ã€‚' },
  { id: 'c021', type: 'correct', question: '"ç»è¿‡åŠªåŠ›ï¼Œæˆ‘çš„å­¦ä¹ æˆç»©æœ‰äº†å¾ˆå¤§çš„å¢åŠ ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. ç»è¿‡åŠªåŠ›ï¼Œæˆ‘çš„å­¦ä¹ æˆç»©æœ‰äº†å¾ˆå¤§çš„æé«˜', 'B. ç»è¿‡åŠªåŠ›ï¼Œæˆ‘çš„å­¦ä¹ æˆç»©æœ‰äº†å¾ˆå¤§çš„å¢åŠ ', 'C. ç»è¿‡åŠªåŠ›ï¼Œæˆ‘çš„å­¦ä¹ æˆç»©å¢åŠ äº†å¾ˆå¤š'], correctAnswer: 0, explanation: '"å­¦ä¹ æˆç»©"åº”ä¸"æé«˜"æ­é…ï¼Œè€Œä¸æ˜¯"å¢åŠ "ã€‚' },
  { id: 'c022', type: 'correct', question: '"æˆ‘ä»¬è¦å‘æ‰¬å’Œç»§æ‰¿ä¸­åæ°‘æ—çš„ä¼˜è‰¯ä¼ ç»Ÿã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬è¦ç»§æ‰¿å’Œå‘æ‰¬ä¸­åæ°‘æ—çš„ä¼˜è‰¯ä¼ ç»Ÿ', 'B. æˆ‘ä»¬è¦å‘æ‰¬ä¸­åæ°‘æ—çš„ä¼˜è‰¯ä¼ ç»Ÿ', 'C. æˆ‘ä»¬è¦ç»§æ‰¿ä¸­åæ°‘æ—çš„ä¼˜è‰¯ä¼ ç»Ÿ'], correctAnswer: 0, explanation: 'é€»è¾‘é¡ºåºä¸å½“ï¼Œåº”å…ˆ"ç»§æ‰¿"å†"å‘æ‰¬"ã€‚' },
  { id: 'c023', type: 'correct', question: '"å³ä½¿å¤©æ°”å¾ˆå†·ï¼Œä½†æ˜¯æˆ‘ä»¬åšæŒé”»ç‚¼ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è™½ç„¶å¤©æ°”å¾ˆå†·ï¼Œä½†æ˜¯æˆ‘ä»¬åšæŒé”»ç‚¼', 'B. å³ä½¿å¤©æ°”å¾ˆå†·ï¼Œä½†æ˜¯æˆ‘ä»¬åšæŒé”»ç‚¼', 'C. å³ä½¿å¤©æ°”å¾ˆå†·ï¼Œæˆ‘ä»¬ä¹ŸåšæŒé”»ç‚¼'], correctAnswer: 0, explanation: 'å…³è”è¯æ­é…ä¸å½“ï¼Œ"è™½ç„¶...ä½†æ˜¯..."è¡¨ç¤ºè½¬æŠ˜ï¼Œ"å³ä½¿...ä¹Ÿ..."è¡¨ç¤ºå‡è®¾è®©æ­¥ã€‚' },
  { id: 'c024', type: 'correct', question: '"æœ‰æ²¡æœ‰è¿œå¤§çš„ç†æƒ³ï¼Œæ˜¯ä¸€ä¸ªäººèƒ½å¦æˆåŠŸçš„å…³é”®ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æœ‰æ²¡æœ‰è¿œå¤§çš„ç†æƒ³ï¼Œæ˜¯ä¸€ä¸ªäººæˆåŠŸçš„å…³é”®', 'B. æœ‰è¿œå¤§çš„ç†æƒ³ï¼Œæ˜¯ä¸€ä¸ªäººèƒ½å¦æˆåŠŸçš„å…³é”®', 'C. æœ‰è¿œå¤§çš„ç†æƒ³ï¼Œæ˜¯ä¸€ä¸ªäººæˆåŠŸçš„å…³é”®'], correctAnswer: 2, explanation: 'ä¸¤é¢ä¸ä¸€é¢ä¸å¯¹åº”ï¼Œåº”ä¿æŒä¸€è‡´ï¼Œéƒ½ç”¨è‚¯å®šæˆ–éƒ½ç”¨å¦å®šã€‚' },
  { id: 'c025', type: 'correct', question: '"åœ¨è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œä½¿æˆ‘æ”¹æ­£äº†é”™è¯¯ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. åœ¨è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œæˆ‘æ”¹æ­£äº†é”™è¯¯', 'B. åœ¨è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œä½¿æˆ‘æ”¹æ­£äº†é”™è¯¯', 'C. åœ¨è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œæˆ‘é”™è¯¯å¾—åˆ°äº†æ”¹æ­£'], correctAnswer: 0, explanation: 'æˆåˆ†æ®‹ç¼ºï¼Œ"åœ¨...ä¸‹"å’Œ"ä½¿"è¿ç”¨å¯¼è‡´ç¼ºä¸»è¯­ï¼Œåˆ å»"ä½¿"ã€‚' },
  { id: 'c026', type: 'correct', question: '"åŒå­¦ä»¬éƒ½éå¸¸æ•¬ä½©è¿™ä½å…«åå²çš„å¥åº·çš„è€äººã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. åŒå­¦ä»¬éƒ½éå¸¸æ•¬ä½©è¿™ä½å…«åå²çš„å¥åº·è€äºº', 'B. åŒå­¦ä»¬éƒ½éå¸¸æ•¬ä½©è¿™ä½å¥åº·çš„å…«åå²è€äºº', 'C. åŒå­¦ä»¬éƒ½éå¸¸æ•¬ä½©è¿™ä½å¥åº·è€äººï¼Œä»–å·²ç»å…«åå²äº†'], correctAnswer: 0, explanation: 'å¤šé‡å®šè¯­è¯­åºï¼Œå¹´é¾„åœ¨å‰ï¼Œç‰¹å¾åœ¨åï¼ŒåŸå¥è¯­åºæ­£ç¡®ã€‚' },
  { id: 'c027', type: 'correct', question: '"æˆ‘ä»¬è¦å“åº”æ¯›ä¸»å¸­æå‡ºçš„"å‘é›·é”‹åŒå¿—å­¦ä¹ "çš„å£å·ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬è¦å“åº”æ¯›ä¸»å¸­æå‡ºçš„"å‘é›·é”‹åŒå¿—å­¦ä¹ "', 'B. æˆ‘ä»¬è¦å“åº”æ¯›ä¸»å¸­æå‡ºçš„"å‘é›·é”‹åŒå¿—å­¦ä¹ "çš„å·å¬', 'C. æˆ‘ä»¬è¦å“åº”"å‘é›·é”‹åŒå¿—å­¦ä¹ "çš„å£å·'], correctAnswer: 1, explanation: '"å“åº”"åº”ä¸"å·å¬"æ­é…ï¼Œè€Œä¸æ˜¯"å£å·"ã€‚' },
  { id: 'c028', type: 'correct', question: '"å¢¨é»‘çš„ä¹Œäº‘å’Œç“¢æ³¼çš„å¤§é›¨ä»å¤©ä¸Šå€¾æ³»ä¸‹æ¥ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. å¢¨é»‘çš„ä¹Œäº‘å’Œç“¢æ³¼çš„å¤§é›¨ä»å¤©ä¸Šä¸‹ä¸‹æ¥', 'B. å¢¨é»‘çš„ä¹Œäº‘å¯†å¸ƒï¼Œç“¢æ³¼çš„å¤§é›¨ä»å¤©ä¸Šå€¾æ³»ä¸‹æ¥', 'C. ç“¢æ³¼çš„å¤§é›¨ä»å¤©ä¸Šå€¾æ³»ä¸‹æ¥'], correctAnswer: 1, explanation: 'ä¸»è°“æ­é…ä¸å½“ï¼Œ"ä¹Œäº‘"ä¸èƒ½"å€¾æ³»ä¸‹æ¥"ã€‚' },
  { id: 'c029', type: 'correct', question: '"è¿™æ˜¯ä¸€å¹…ç¾ä¸½çš„é£æ™¯ç”»ï¼Œæˆ‘éå¸¸å–œæ¬¢çœ‹ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è¿™æ˜¯ä¸€å¹…ç¾ä¸½çš„é£æ™¯ç”»ï¼Œæˆ‘éå¸¸å–œæ¬¢', 'B. è¿™æ˜¯ä¸€å¹…ç¾ä¸½çš„é£æ™¯ç”»ï¼Œæˆ‘éå¸¸å–œæ¬¢æ¬£èµ', 'C. ç¾ä¸½çš„é£æ™¯ç”»æ˜¯ä¸€å¹…ï¼Œæˆ‘éå¸¸å–œæ¬¢çœ‹'], correctAnswer: 0, explanation: '"å–œæ¬¢"å·²ç»åŒ…å«"çœ‹"çš„æ„æ€ï¼Œ"çœ‹"å­—å¤šä½™ã€‚' },
  { id: 'c030', type: 'correct', question: '"æˆ‘ä»¬ç­çš„äººæ•°æ¯”ä»–ä»¬ç­å¤šã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬ç­çš„äººæ•°æ¯”ä»–ä»¬ç­çš„äººæ•°å¤š', 'B. æˆ‘ä»¬ç­çš„äººæ•°æ¯”ä»–ä»¬ç­å¤šå¾—å¤š', 'C. æˆ‘ä»¬ç­æ¯”ä»–ä»¬ç­çš„äººæ•°å¤š'], correctAnswer: 0, explanation: 'ä¸»å®¾æ­é…ä¸å½“ï¼Œ"äººæ•°"åº”ä¸"äººæ•°"æ¯”è¾ƒã€‚' },

  // æ›´å¤šè¯­ç—…åˆ¤æ–­é¢˜
  { id: 'c031', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"ç»è¿‡è¿™æ¬¡æ´»åŠ¨ï¼Œä½¿æˆ‘æ·±å—æ•™è‚²ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'æˆåˆ†æ®‹ç¼ºï¼Œ"ç»è¿‡"å’Œ"ä½¿"åŒæ—¶ä½¿ç”¨å¯¼è‡´ä¸»è¯­ç¼ºå¤±ã€‚' },
  { id: 'c032', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"è¿™ä½è€å¸ˆçš„åˆ°æ¥ï¼Œä½¿æˆ‘ä»¬ç­çº§çš„æ°”æ°›æ´»è·ƒèµ·æ¥ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 1, explanation: 'å¥å­æ— è¯­ç—…ï¼Œä¸»è°“æ­é…æ°å½“ã€‚' },
  { id: 'c033', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"æˆ‘ä»¬è¦å°½é‡èŠ‚çº¦ä¸å¿…è¦çš„å¼€æ”¯å’Œæµªè´¹ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'æ­é…ä¸å½“ï¼Œ"èŠ‚çº¦"å¯ä»¥æ­é…"å¼€æ”¯"ï¼Œä½†ä¸èƒ½æ­é…"æµªè´¹"ã€‚' },
  { id: 'c034', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"åªæœ‰å¥½å¥½å¬è¯¾ï¼Œå°±èƒ½å®Œæˆä½œä¸šã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'å…³è”è¯æ­é…ä¸å½“ï¼Œ"åªæœ‰"åº”ä¸"æ‰"æ­é…ã€‚' },
  { id: 'c035', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"ä»–çš„å­¦ä¹ æˆç»©å¾ˆå¥½ï¼Œæ‰€ä»¥ä»–å¾ˆéª„å‚²ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 1, explanation: 'å¥å­æ— è¯­ç—…ï¼Œå› æœå…³ç³»æ˜ç¡®ã€‚' },
  { id: 'c036', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"æˆ‘ä»¬è¦ä¸æ–­æ”¹è¿›å­¦ä¹ æ–¹æ³•ï¼Œå¢åŠ å­¦ä¹ è´¨é‡ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'æ­é…ä¸å½“ï¼Œ"è´¨é‡"åº”ä¸"æé«˜"æ­é…ï¼Œä¸èƒ½"å¢åŠ "ã€‚' },
  { id: 'c037', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"è¿™æ˜¯ä¸€æœ¬æˆ‘çš„ä¹¦ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'è¯­åºä¸å½“ï¼Œåº”æ”¹ä¸º"è¿™æ˜¯æˆ‘çš„ä¸€æœ¬ä¹¦"ã€‚' },
  { id: 'c038', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"ä¸ç®¡å¤©æ°”ååˆ†æ¶åŠ£ï¼Œä»–è¿˜æ˜¯åšæŒè®­ç»ƒã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'å…³è”è¯æ­é…ä¸å½“ï¼Œ"ä¸ç®¡"åº”ä¸"éƒ½"æ­é…ï¼Œæˆ–æ”¹ä¸º"å°½ç®¡"ã€‚' },
  { id: 'c039', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"å¦ˆå¦ˆç»™æˆ‘ä¹°äº†ä¸€æ”¯é’¢ç¬”å’Œä¸€æœ¬ç¬”è®°æœ¬ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 1, explanation: 'å¥å­æ— è¯­ç—…ï¼Œç»“æ„å®Œæ•´ã€‚' },
  { id: 'c040', type: 'judge', question: 'åˆ¤æ–­å¥å­æ˜¯å¦æœ‰è¯­ç—…ï¼š\n"æˆ‘ä»¬ç­åŸºæœ¬ä¸Šéƒ½åˆ°é½äº†ã€‚"', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…'], correctAnswer: 0, explanation: 'å‰åçŸ›ç›¾ï¼Œ"åŸºæœ¬ä¸Š"å’Œ"éƒ½"ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚' },

  // æˆåˆ†æ®‹ç¼ºç±»å‹
  { id: 'c041', type: 'correct', question: '"é€šè¿‡è¿™æ¬¡ç­ä¼šï¼Œä½¿æˆ‘æ˜ç™½äº†å›¢ç»“çš„é‡è¦æ€§ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. é€šè¿‡è¿™æ¬¡ç­ä¼šï¼Œæˆ‘æ˜ç™½äº†å›¢ç»“çš„é‡è¦æ€§', 'B. è¿™æ¬¡ç­ä¼šï¼Œä½¿æˆ‘æ˜ç™½äº†å›¢ç»“çš„é‡è¦æ€§', 'C. é€šè¿‡ç­ä¼šï¼Œä½¿æˆ‘æ˜ç™½äº†å›¢ç»“çš„é‡è¦æ€§'], correctAnswer: 0, explanation: 'åˆ é™¤"ä½¿"æˆ–"é€šè¿‡"ï¼Œä½¿ä¸»è¯­æ˜ç¡®ã€‚' },
  { id: 'c042', type: 'correct', question: '"åœ¨è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œä½¿æˆ‘æ”¹æ­£äº†é”™è¯¯ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. åœ¨è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œæˆ‘æ”¹æ­£äº†é”™è¯¯', 'B. åœ¨è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œä½¿æˆ‘æ”¹æ­£äº†é”™è¯¯', 'C. è€å¸ˆå¸®åŠ©ä¸‹ï¼Œä½¿æˆ‘æ”¹æ­£äº†é”™è¯¯'], correctAnswer: 0, explanation: 'åˆ é™¤"ä½¿"ï¼Œè®©"æˆ‘"ä½œä¸»è¯­ã€‚' },
  { id: 'c043', type: 'correct', question: '"å¬äº†è¿™ä¸ªæ•…äº‹ï¼Œå—åˆ°äº†æ·±åˆ»çš„æ•™è‚²ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. å¬äº†è¿™ä¸ªæ•…äº‹ï¼Œæˆ‘å—åˆ°äº†æ·±åˆ»çš„æ•™è‚²', 'B. å¬äº†è¿™ä¸ªæ•…äº‹ï¼Œå—åˆ°äº†æ·±åˆ»çš„æ•™è‚²', 'C. å¬äº†æ•…äº‹ï¼Œå—åˆ°äº†æ·±åˆ»æ•™è‚²'], correctAnswer: 0, explanation: 'ç¼ºå°‘ä¸»è¯­ï¼Œåº”åŠ ä¸Šä¸»è¯­"æˆ‘"ã€‚' },
  { id: 'c044', type: 'correct', question: '"ç»è¿‡åŠªåŠ›ï¼Œæˆ‘çš„å­¦ä¹ æ€åº¦æœ‰äº†æ˜æ˜¾çš„æé«˜ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. ç»è¿‡åŠªåŠ›ï¼Œæˆ‘çš„å­¦ä¹ æ€åº¦æœ‰äº†æ˜æ˜¾çš„æ”¹è¿›', 'B. ç»è¿‡åŠªåŠ›ï¼Œæˆ‘çš„å­¦ä¹ æ€åº¦æœ‰äº†æ˜æ˜¾çš„æé«˜', 'C. åŠªåŠ›åï¼Œå­¦ä¹ æ€åº¦æé«˜äº†'], correctAnswer: 0, explanation: '"æ€åº¦"ä¸èƒ½"æé«˜"ï¼Œåº”æ”¹ä¸º"æ”¹è¿›"ã€‚' },
  { id: 'c045', type: 'correct', question: '"æˆ‘ä»¬è¦åŸ¹å…»å’Œæ ‘ç«‹è‰¯å¥½çš„é“å¾·å“è´¨ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬è¦æ ‘ç«‹å’ŒåŸ¹å…»è‰¯å¥½çš„é“å¾·å“è´¨', 'B. æˆ‘ä»¬è¦åŸ¹å…»è‰¯å¥½çš„é“å¾·å“è´¨', 'C. æˆ‘ä»¬è¦æ ‘ç«‹è‰¯å¥½çš„é“å¾·å“è´¨'], correctAnswer: 0, explanation: 'é€»è¾‘é¡ºåºä¸å½“ï¼Œå…ˆ"æ ‘ç«‹"å"åŸ¹å…»"ã€‚' },

  // æ­é…ä¸å½“ç±»å‹
  { id: 'c046', type: 'correct', question: '"æˆ‘ä»¬è¦æ”¹è¿›å­¦ä¹ æ–¹æ³•ï¼Œå¢åŠ å­¦ä¹ æ•ˆç‡ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬è¦æ”¹è¿›å­¦ä¹ æ–¹æ³•ï¼Œæé«˜å­¦ä¹ æ•ˆç‡', 'B. æˆ‘ä»¬è¦æ”¹å–„å­¦ä¹ æ–¹æ³•ï¼Œå¢åŠ å­¦ä¹ æ•ˆç‡', 'C. æˆ‘ä»¬è¦æ”¹è¿›å­¦ä¹ æ–¹æ³•ï¼Œæé«˜å­¦ä¹ æ•ˆæœ'], correctAnswer: 0, explanation: '"æ•ˆç‡"åº”ä¸"æé«˜"æ­é…ã€‚' },
  { id: 'c047', type: 'correct', question: '"ä»–çš„æ­Œå£°æ¸…è„†æ‚¦è€³ï¼Œå—åˆ°å¤§å®¶çš„æ¬¢è¿ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. ä»–çš„æ­Œå£°æ¸…è„†æ‚¦è€³ï¼Œå—åˆ°å¤§å®¶çš„å–œçˆ±', 'B. ä»–çš„æ­Œå£°æ¸…è„†æ‚¦è€³ï¼Œå—åˆ°å¤§å®¶çš„æ¬¢è¿', 'C. ä»–æ­Œå£°æ¸…è„†ï¼Œå—æ¬¢è¿'], correctAnswer: 0, explanation: '"æ­Œå£°"é€šå¸¸ä¸"å–œçˆ±"æ­é…ï¼Œ"æ¬¢è¿"å¤šç”¨äºäººæˆ–è¡Œä¸ºã€‚' },
  { id: 'c048', type: 'correct', question: '"æˆ‘ä»¬ç­åŒå­¦åŸºæœ¬ä¸Šéƒ½å‚åŠ äº†æ´»åŠ¨ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬ç­åŒå­¦åŸºæœ¬ä¸Šå‚åŠ äº†æ´»åŠ¨', 'B. æˆ‘ä»¬ç­åŒå­¦éƒ½å‚åŠ äº†æ´»åŠ¨', 'C. æˆ‘ä»¬ç­åŸºæœ¬ä¸ŠåŒå­¦éƒ½å‚åŠ äº†æ´»åŠ¨'], correctAnswer: 1, explanation: '"åŸºæœ¬ä¸Š"å’Œ"éƒ½"çŸ›ç›¾ï¼Œåˆ é™¤å…¶ä¸­ä¸€ä¸ªã€‚' },
  { id: 'c049', type: 'correct', question: '"æˆ‘ä»¬è¦å‘æ‰¬å’Œç»§æ‰¿ä¼˜è‰¯ä¼ ç»Ÿã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬è¦ç»§æ‰¿å’Œå‘æ‰¬ä¼˜è‰¯ä¼ ç»Ÿ', 'B. æˆ‘ä»¬è¦å‘æ‰¬ä¼˜è‰¯ä¼ ç»Ÿ', 'C. æˆ‘ä»¬è¦ç»§æ‰¿ä¼˜è‰¯ä¼ ç»Ÿ'], correctAnswer: 0, explanation: 'é€»è¾‘é¡ºåºï¼šå…ˆ"ç»§æ‰¿"å†"å‘æ‰¬"ã€‚' },
  { id: 'c050', type: 'correct', question: '"æˆ‘çš„ç”Ÿæ´»æ°´å¹³å’Œè¿‡å»ç›¸æ¯”æœ‰äº†å¾ˆå¤§æ”¹å–„ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘çš„ç”Ÿæ´»æ°´å¹³å’Œè¿‡å»ç›¸æ¯”æœ‰äº†å¾ˆå¤§æé«˜', 'B. æˆ‘çš„æ¡ä»¶å’Œè¿‡å»ç›¸æ¯”æœ‰äº†å¾ˆå¤§æ”¹å–„', 'C. æˆ‘çš„ç”Ÿæ´»å’Œè¿‡å»ç›¸æ¯”æœ‰äº†å¾ˆå¤§æ”¹å–„'], correctAnswer: 0, explanation: '"ç”Ÿæ´»æ°´å¹³"åº”ä¸"æé«˜"æ­é…ã€‚' },

  // è¯­åºä¸å½“ç±»å‹
  { id: 'c051', type: 'correct', question: '"åšç‰©é¦†å±•å‡ºäº†å‡ åƒå¹´å‰åˆšå‡ºåœŸçš„æ–‡ç‰©ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. åšç‰©é¦†å±•å‡ºäº†åˆšå‡ºåœŸçš„å‡ åƒå¹´å‰çš„æ–‡ç‰©', 'B. åšç‰©é¦†å±•å‡ºäº†å‡ åƒå¹´å‰çš„æ–‡ç‰©åˆšå‡ºåœŸçš„', 'C. åˆšå‡ºåœŸçš„å‡ åƒå¹´å‰çš„æ–‡ç‰©åœ¨åšç‰©é¦†å±•å‡º'], correctAnswer: 0, explanation: '"åˆšå‡ºåœŸ"åº”ä¿®é¥°"æ–‡ç‰©"ï¼Œè€Œé"å‡ åƒå¹´å‰"ã€‚' },
  { id: 'c052', type: 'correct', question: '"è¿™æ˜¯æœ‰è¶£çš„ä¸€æœ¬ä¹¦ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è¿™æ˜¯ä¸€æœ¬æœ‰è¶£çš„ä¹¦', 'B. è¿™æ˜¯æœ‰è¶£çš„ä¹¦ä¸€æœ¬', 'C. ä¸€æœ¬æœ‰è¶£çš„ä¹¦è¿™æ˜¯'], correctAnswer: 0, explanation: 'æ•°é‡è¯"ä¸€æœ¬"åº”æ”¾åœ¨å½¢å®¹è¯"æœ‰è¶£"ä¹‹å‰ã€‚' },
  { id: 'c053', type: 'correct', question: '"ä»–æŠŠä½œæ–‡åšäº†è®¤çœŸä¿®æ”¹ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. ä»–æŠŠä½œæ–‡è®¤çœŸåšäº†ä¿®æ”¹', 'B. ä»–è®¤çœŸåœ°æŠŠä½œæ–‡ä¿®æ”¹äº†', 'C. ä»–æŠŠä½œæ–‡è®¤çœŸä¿®æ”¹äº†ä¸€é'], correctAnswer: 2, explanation: '"åšäº†"å¤šä½™ï¼Œåº”åˆ å»ä½¿å¥å­ç®€æ´ã€‚' },
  { id: 'c054', type: 'correct', question: '"å„ç§æ–°å‘ç°çš„æµè¡Œç—…ï¼Œå¯¹åŒ»åŠ¡äººå‘˜æ˜¯æ–°çš„è€ƒéªŒã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æ–°å‘ç°çš„å„ç§æµè¡Œç—…ï¼Œå¯¹åŒ»åŠ¡äººå‘˜æ˜¯æ–°çš„è€ƒéªŒ', 'B. å„ç§æ–°å‘ç°çš„æµè¡Œç—…ï¼Œæ˜¯æ–°çš„è€ƒéªŒ', 'C. æ–°å‘ç°çš„æµè¡Œç—…ï¼Œå¯¹åŒ»åŠ¡äººå‘˜æ˜¯è€ƒéªŒ'], correctAnswer: 0, explanation: '"å„ç§"åº”åœ¨"æ–°å‘ç°"ä¹‹å‰ã€‚' },
  { id: 'c055', type: 'correct', question: '"å¸‚åœºä¸Šåˆ°å¤„éƒ½æ˜¯å„ç§æ°´æœã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. å¸‚åœºä¸Šåˆ°å¤„éƒ½æ˜¯æ°´æœï¼Œæœ‰å„ç§å„æ ·çš„', 'B. å¸‚åœºä¸Šæœ‰å„ç§æ°´æœï¼Œåˆ°å¤„éƒ½æ˜¯', 'C. åˆ°å¤„å¸‚åœºä¸Šéƒ½æ˜¯å„ç§æ°´æœ'], correctAnswer: 0, explanation: '"åˆ°å¤„"ä¸"å„ç§"è¯­åºä¸å½“ï¼Œåº”è°ƒæ•´ã€‚' },

  // å…³è”è¯ä½¿ç”¨ä¸å½“
  { id: 'c056', type: 'correct', question: '"åªæœ‰åšæŒåŠªåŠ›ï¼Œå°±èƒ½å–å¾—æˆåŠŸã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. åªæœ‰åšæŒåŠªåŠ›ï¼Œæ‰èƒ½å–å¾—æˆåŠŸ', 'B. åªè¦åšæŒåŠªåŠ›ï¼Œå°±èƒ½å–å¾—æˆåŠŸ', 'C. åªæœ‰åšæŒåŠªåŠ›ï¼Œå°±å–å¾—æˆåŠŸ'], correctAnswer: 1, explanation: '"åªè¦...å°±..."æˆ–"åªæœ‰...æ‰..."æ˜¯æ­£ç¡®æ­é…ã€‚' },
  { id: 'c057', type: 'correct', question: '"å³ä½¿å¤©æ°”å¾ˆå†·ï¼Œä½†æ˜¯æˆ‘ä»¬åšæŒé”»ç‚¼ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è™½ç„¶å¤©æ°”å¾ˆå†·ï¼Œä½†æ˜¯æˆ‘ä»¬åšæŒé”»ç‚¼', 'B. å³ä½¿å¤©æ°”å¾ˆå†·ï¼Œæˆ‘ä»¬ä¹ŸåšæŒé”»ç‚¼', 'C. å³ä½¿å¤©æ°”å¾ˆå†·ï¼Œä½†æ˜¯æˆ‘ä»¬åšæŒé”»ç‚¼'], correctAnswer: 0, explanation: '"è™½ç„¶...ä½†æ˜¯..."è¡¨ç¤ºè½¬æŠ˜ï¼Œ"å³ä½¿...ä¹Ÿ..."è¡¨ç¤ºå‡è®¾è®©æ­¥ã€‚' },
  { id: 'c058', type: 'correct', question: '"ä¸ç®¡å›°éš¾å¾ˆå¤§ï¼Œæˆ‘ä»¬éƒ½è¦å®Œæˆä»»åŠ¡ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è™½ç„¶å›°éš¾å¾ˆå¤§ï¼Œæˆ‘ä»¬éƒ½è¦å®Œæˆä»»åŠ¡', 'B. å°½ç®¡å›°éš¾å¾ˆå¤§ï¼Œæˆ‘ä»¬éƒ½è¦å®Œæˆä»»åŠ¡', 'C. ä¸ç®¡å›°éš¾å¤šå¤§ï¼Œæˆ‘ä»¬éƒ½è¦å®Œæˆä»»åŠ¡'], correctAnswer: 2, explanation: '"ä¸ç®¡...éƒ½..."ä¸­ç–‘é—®è¯è¦å¯¹åº”ï¼Œæˆ–æ”¹ç”¨"å°½ç®¡...éƒ½..."ã€‚' },
  { id: 'c059', type: 'correct', question: '"ä¸å…¶å»ç”µå½±é™¢ï¼Œä¸å¦‚åœ¨å®¶çœ‹ç”µå½±ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. ä¸å…¶å»ç”µå½±é™¢ï¼Œä¸å¦‚åœ¨å®¶çœ‹ç”µå½±', 'B. å®æ„¿å»ç”µå½±é™¢ï¼Œä¸å¦‚åœ¨å®¶çœ‹ç”µå½±', 'C. å»ç”µå½±é™¢ï¼Œä¸å¦‚åœ¨å®¶çœ‹ç”µå½±'], correctAnswer: 0, explanation: 'å¥å­æœ¬èº«æ­£ç¡®ï¼Œ"ä¸å…¶...ä¸å¦‚..."æ˜¯å–èˆå…³ç³»ã€‚' },
  { id: 'c060', type: 'correct', question: '"å› ä¸ºå¤©ä¸‹é›¨ï¼Œæ‰€ä»¥æˆ‘ä¸å»å­¦æ ¡äº†ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. å› ä¸ºå¤©ä¸‹é›¨ï¼Œæ‰€ä»¥æˆ‘ä¸å»å­¦æ ¡äº†', 'B. å› ä¸ºå¤©ä¸‹é›¨ï¼Œæˆ‘ä¸å»å­¦æ ¡äº†', 'C. æ—¢ç„¶å¤©ä¸‹é›¨ï¼Œæ‰€ä»¥æˆ‘ä¸å»å­¦æ ¡äº†'], correctAnswer: 0, explanation: '"å› ä¸º...æ‰€ä»¥..."æ­é…æ­£ç¡®ã€‚' },

  // ä¸¤é¢ä¸ä¸€é¢ä¸å¯¹åº”
  { id: 'c061', type: 'correct', question: '"æœ‰æ²¡æœ‰å¥åº·çš„èº«ä½“ï¼Œæ˜¯èƒ½å¦æˆåŠŸçš„å…³é”®ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æœ‰æ²¡æœ‰å¥åº·çš„èº«ä½“ï¼Œæ˜¯æˆåŠŸçš„å…³é”®', 'B. æœ‰å¥åº·çš„èº«ä½“ï¼Œæ˜¯èƒ½å¦æˆåŠŸçš„å…³é”®', 'C. æœ‰å¥åº·çš„èº«ä½“ï¼Œæ˜¯æˆåŠŸçš„å…³é”®'], correctAnswer: 2, explanation: 'ä¸¤é¢ä¸ä¸€é¢åº”å¯¹åº”ä¸€è‡´ï¼Œæˆ–éƒ½ç”¨ä¸€é¢ã€‚' },
  { id: 'c062', type: 'correct', question: '"èƒ½å¦åŸ¹å…»åˆ›æ–°èƒ½åŠ›ï¼Œæ˜¯äº‹ä¸šæˆåŠŸçš„é‡è¦æ¡ä»¶ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. åŸ¹å…»åˆ›æ–°èƒ½åŠ›ï¼Œæ˜¯äº‹ä¸šæˆåŠŸçš„é‡è¦æ¡ä»¶', 'B. èƒ½å¦åŸ¹å…»åˆ›æ–°èƒ½åŠ›ï¼Œèƒ½å¦äº‹ä¸šæˆåŠŸ', 'C. åŸ¹å…»åˆ›æ–°èƒ½åŠ›ï¼Œæ˜¯èƒ½å¦æˆåŠŸçš„é‡è¦æ¡ä»¶'], correctAnswer: 0, explanation: '"èƒ½å¦"æ˜¯ä¸¤é¢ï¼Œåé¢ä¹Ÿåº”ä¸¤é¢å¯¹åº”ï¼Œæˆ–åˆ å»"èƒ½å¦"ç”¨ä¸€é¢ã€‚' },
  { id: 'c063', type: 'correct', question: '"åŠªåŠ›å­¦ä¹ ï¼Œæ˜¯å­¦ç”Ÿèƒ½å¦å–å¾—å¥½æˆç»©çš„å…³é”®ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æ˜¯å¦åŠªåŠ›å­¦ä¹ ï¼Œæ˜¯å­¦ç”Ÿèƒ½å¦å–å¾—å¥½æˆç»©çš„å…³é”®', 'B. åŠªåŠ›å­¦ä¹ ï¼Œæ˜¯å­¦ç”Ÿå–å¾—å¥½æˆç»©çš„å…³é”®', 'C. åŠªåŠ›å­¦ä¹ ï¼Œæ˜¯èƒ½å¦å–å¾—å¥½æˆç»©çš„å…³é”®'], correctAnswer: 1, explanation: 'ä¸¤é¢ä¸ä¸€é¢ä¸ä¸€è‡´ï¼Œåº”ç»Ÿä¸€ã€‚' },
  { id: 'c064', type: 'correct', question: '"æ€åº¦å†³å®šä¸€åˆ‡ï¼Œæ˜¯èƒ½å¦æˆåŠŸçš„é‡è¦å› ç´ ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æ€åº¦å†³å®šä¸€åˆ‡ï¼Œæ˜¯æˆåŠŸçš„é‡è¦å› ç´ ', 'B. æ€åº¦ï¼Œæ˜¯èƒ½å¦æˆåŠŸçš„é‡è¦å› ç´ ', 'C. æ€åº¦å†³å®šä¸€åˆ‡ï¼Œæ˜¯èƒ½å¦æˆåŠŸçš„å…³é”®'], correctAnswer: 0, explanation: 'ç»Ÿä¸€ä½¿ç”¨ä¸€é¢è¡¨è¾¾ã€‚' },
  { id: 'c065', type: 'correct', question: '"æœ‰æ²¡æœ‰è¿œå¤§ç†æƒ³ï¼Œæ˜¯ä¸€ä¸ªäººèƒ½å¦æˆåŠŸçš„å…³é”®ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æœ‰æ²¡æœ‰è¿œå¤§ç†æƒ³ï¼Œæ˜¯ä¸€ä¸ªäººæˆåŠŸçš„å…³é”®', 'B. æœ‰è¿œå¤§ç†æƒ³ï¼Œæ˜¯ä¸€ä¸ªäººèƒ½å¦æˆåŠŸçš„å…³é”®', 'C. æœ‰è¿œå¤§ç†æƒ³ï¼Œæ˜¯ä¸€ä¸ªäººæˆåŠŸçš„å…³é”®'], correctAnswer: 2, explanation: 'ä¸¤é¢ä¸ä¸€é¢ä¸å¯¹åº”ï¼Œåº”ä¿æŒä¸€è‡´ã€‚' },

  // å¦å®šä¸å½“
  { id: 'c066', type: 'correct', question: '"ä¸ºäº†é˜²æ­¢ç±»ä¼¼çš„äº¤é€šäº‹æ•…ä¸å†å‘ç”Ÿï¼Œæˆ‘ä»¬åŠ å¼ºäº†å®‰å…¨æ•™è‚²ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. ä¸ºäº†é˜²æ­¢ç±»ä¼¼çš„äº¤é€šäº‹æ•…ä¸å†å‘ç”Ÿ', 'B. ä¸ºäº†é˜²æ­¢ç±»ä¼¼çš„äº¤é€šäº‹æ•…å†æ¬¡å‘ç”Ÿ', 'C. ä¸ºäº†é˜²æ­¢ç±»ä¼¼çš„äº¤é€šäº‹æ•…ä¸å‘ç”Ÿ'], correctAnswer: 1, explanation: '"é˜²æ­¢"å’Œ"ä¸å†"è¿ç”¨è¡¨ç¤ºè‚¯å®šï¼Œåº”æ”¹ä¸º"å†æ¬¡"ã€‚' },
  { id: 'c067', type: 'correct', question: '"æˆ‘ä»¬ä¸å¾—ä¸å¦è®¤è¿™ä¸ªäº‹å®ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬ä¸å¾—ä¸æ‰¿è®¤è¿™ä¸ªäº‹å®', 'B. æˆ‘ä»¬ä¸å¾—ä¸å¦è®¤è¿™ä¸ªäº‹å®', 'C. æˆ‘ä»¬ä¸å¾—ä¸æ‰¿è®¤ä¸äº‹å®'], correctAnswer: 0, explanation: 'åŒé‡å¦å®šå¯¼è‡´æ„æ€ç›¸åï¼Œåº”æ”¹ä¸º"æ‰¿è®¤"ã€‚' },
  { id: 'c068', type: 'correct', question: '"éš¾é“èƒ½å¦è®¤æˆ‘ä¸æ˜¯ä¸€ä¸ªä¸­å›½äººå—ï¼Ÿ"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. éš¾é“èƒ½å¦è®¤æˆ‘æ˜¯ä¸€ä¸ªä¸­å›½äººå—', 'B. éš¾é“èƒ½å¦è®¤æˆ‘ä¸æ˜¯ä¸­å›½äººå—', 'C. éš¾é“èƒ½å¦è®¤æˆ‘æ˜¯ä¸€ä¸ªä¸­å›½äºº'], correctAnswer: 0, explanation: 'å¤šé‡å¦å®šé€ æˆé€»è¾‘æ··ä¹±ã€‚' },
  { id: 'c069', type: 'correct', question: '"è°ä¹Ÿä¸èƒ½å¦è®¤ä¼˜å¼‚çš„æˆç»©ä¸æ˜¯é å‹¤å¥‹å¾—æ¥çš„ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è°ä¹Ÿä¸èƒ½å¦è®¤ä¼˜å¼‚çš„æˆç»©æ˜¯é å‹¤å¥‹å¾—æ¥çš„', 'B. è°ä¹Ÿä¸èƒ½å¦è®¤ä¼˜å¼‚çš„æˆç»©ä¸æ˜¯é å‹¤å¥‹å¾—æ¥çš„', 'C. è°ä¹Ÿæ‰¿è®¤ä¼˜å¼‚çš„æˆç»©ä¸æ˜¯é å‹¤å¥‹å¾—æ¥çš„'], correctAnswer: 0, explanation: 'å¤šé‡å¦å®šå¯¼è‡´æ„æ€ç›¸åã€‚' },
  { id: 'c070', type: 'correct', question: '"ä¸ºäº†é¿å…ä¸å†çŠ¯é”™ï¼Œæˆ‘è®¤çœŸæ£€æŸ¥äº†ä½œä¸šã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. ä¸ºäº†é¿å…ä¸å†çŠ¯é”™', 'B. ä¸ºäº†é¿å…å†æ¬¡çŠ¯é”™', 'C. ä¸ºäº†ä¸å†çŠ¯é”™'], correctAnswer: 1, explanation: '"é¿å…"å’Œ"ä¸å†"è¿ç”¨é€ æˆæ„æ€ç›¸åã€‚' },

  // ä¸»å®¾æ­é…ä¸å½“
  { id: 'c071', type: 'correct', question: '"æ˜¥å¤©çš„æ­å·æ˜¯ä¸€ä¸ªç¾ä¸½çš„å­£èŠ‚ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æ­å·çš„æ˜¥å¤©æ˜¯ä¸€ä¸ªç¾ä¸½çš„å­£èŠ‚', 'B. æ˜¥å¤©çš„æ­å·æ˜¯ç¾ä¸½çš„', 'C. æ˜¥å¤©æ˜¯ä¸€ä¸ªç¾ä¸½çš„å­£èŠ‚'], correctAnswer: 0, explanation: '"æ­å·"æ˜¯åœ°ç‚¹ï¼Œä¸èƒ½æ˜¯"å­£èŠ‚"ã€‚' },
  { id: 'c072', type: 'correct', question: '"æˆ‘ä»¬ç­çš„äººæ•°æ¯”ä»–ä»¬ç­å¤šã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬ç­çš„äººæ•°æ¯”ä»–ä»¬ç­çš„äººæ•°å¤š', 'B. æˆ‘ä»¬ç­æ¯”ä»–ä»¬ç­äººå¤š', 'C. æˆ‘ä»¬ç­æ¯”ä»–ä»¬ç­å¤š'], correctAnswer: 0, explanation: '"äººæ•°"åº”ä¸"äººæ•°"æ¯”è¾ƒã€‚' },
  { id: 'c073', type: 'correct', question: '"è¿™ç¯‡å°è¯´é€šè¿‡æå†™å¿ƒç†æ´»åŠ¨ï¼Œè¡¨ç°äº†ä½œè€…çš„æ€æƒ³æ„Ÿæƒ…ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è¿™ç¯‡å°è¯´é€šè¿‡äººç‰©å¿ƒç†æ´»åŠ¨çš„æå†™ï¼Œè¡¨ç°äº†ä½œè€…çš„æ€æƒ³æ„Ÿæƒ…', 'B. è¿™ç¯‡å°è¯´æå†™å¿ƒç†æ´»åŠ¨ï¼Œè¡¨ç°ä½œè€…æ€æƒ³æ„Ÿæƒ…', 'C. å°è¯´é€šè¿‡å¿ƒç†æå†™ï¼Œè¡¨ç°æ€æƒ³æ„Ÿæƒ…'], correctAnswer: 0, explanation: 'æ˜ç¡®"äººç‰©å¿ƒç†æ´»åŠ¨"æ›´å‡†ç¡®ã€‚' },
  { id: 'c074', type: 'correct', question: '"å¢¨é»‘çš„ä¹Œäº‘å’Œç“¢æ³¼çš„å¤§é›¨ä»å¤©ä¸Šå€¾æ³»ä¸‹æ¥ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. å¢¨é»‘çš„ä¹Œäº‘å¯†å¸ƒï¼Œç“¢æ³¼çš„å¤§é›¨ä»å¤©ä¸Šå€¾æ³»ä¸‹æ¥', 'B. å¢¨é»‘çš„ä¹Œäº‘å’Œç“¢æ³¼çš„å¤§é›¨ä»å¤©ä¸Šä¸‹ä¸‹æ¥', 'C. ç“¢æ³¼çš„å¤§é›¨ä»å¤©ä¸Šå€¾æ³»ä¸‹æ¥'], correctAnswer: 0, explanation: '"ä¹Œäº‘"ä¸èƒ½"å€¾æ³»ä¸‹æ¥"ï¼Œä¸»è°“æ­é…ä¸å½“ã€‚' },
  { id: 'c075', type: 'correct', question: '"è¿™ä½è€ç§‘å­¦å®¶çš„å®¶é‡Œï¼Œæœ‰å¾ˆå¤šè—ä¹¦ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è¿™ä½è€ç§‘å­¦å®¶çš„å®¶é‡Œï¼Œæœ‰å¤§é‡çš„è—ä¹¦', 'B. è¿™ä½è€ç§‘å­¦å®¶æœ‰å¾ˆå¤šè—ä¹¦', 'C. è¿™ä½è€ç§‘å­¦å®¶çš„è—ä¹¦å¾ˆå¤š'], correctAnswer: 2, explanation: 'åŸå¥ä¸»è°“æ­é…ä¸å½“ï¼Œè—ä¹¦å±äºäººè€Œéå®¶é‡Œã€‚' },

  // ç”¨è¯ä¸å½“
  { id: 'c076', type: 'correct', question: '"æˆ‘ä»¬è¦å“åº”æ¯›ä¸»å¸­æå‡ºçš„"å‘é›·é”‹åŒå¿—å­¦ä¹ "çš„å£å·ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬è¦å“åº”æ¯›ä¸»å¸­æå‡ºçš„"å‘é›·é”‹åŒå¿—å­¦ä¹ "', 'B. æˆ‘ä»¬è¦å“åº”"å‘é›·é”‹åŒå¿—å­¦ä¹ "çš„å·å¬', 'C. æˆ‘ä»¬è¦å“åº”"å‘é›·é”‹åŒå¿—å­¦ä¹ "çš„å£å·'], correctAnswer: 1, explanation: '"å“åº”"åº”ä¸"å·å¬"æ­é…ï¼Œ"å£å·"åº”ä¸"æå‡º"æ­é…ã€‚' },
  { id: 'c077', type: 'correct', question: '"æˆ‘ä»¬ç­åŒå­¦åŸºæœ¬ä¸Šéƒ½åˆ°é½äº†ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬ç­åŒå­¦åŸºæœ¬ä¸Šåˆ°é½äº†', 'B. æˆ‘ä»¬ç­åŒå­¦éƒ½åˆ°é½äº†', 'C. æˆ‘ä»¬ç­åŸºæœ¬ä¸ŠåŒå­¦éƒ½åˆ°é½äº†'], correctAnswer: 1, explanation: '"åŸºæœ¬ä¸Š"å’Œ"éƒ½"çŸ›ç›¾ï¼Œåˆ é™¤å…¶ä¸­ä¸€ä¸ªã€‚' },
  { id: 'c078', type: 'correct', question: '"æˆ‘ä»¬ç­æœ‰å°†è¿‘äº”åäººå·¦å³ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬ç­æœ‰å°†è¿‘äº”åäºº', 'B. æˆ‘ä»¬ç­æœ‰äº”åäººå·¦å³', 'C. æˆ‘ä»¬ç­æœ‰å°†è¿‘äº”åäººå¤š'], correctAnswer: 0, explanation: '"å°†è¿‘"å’Œ"å·¦å³"çŸ›ç›¾ï¼Œåº”åˆ å»ä¸€ä¸ªã€‚' },
  { id: 'c079', type: 'correct', question: '"è¿™æ˜¯ä¸€å¹…ç¾ä¸½çš„é£æ™¯ç”»ï¼Œæˆ‘éå¸¸å–œæ¬¢çœ‹ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. è¿™æ˜¯ä¸€å¹…ç¾ä¸½çš„é£æ™¯ç”»ï¼Œæˆ‘éå¸¸å–œæ¬¢', 'B. è¿™æ˜¯ä¸€å¹…ç¾ä¸½çš„é£æ™¯ç”»ï¼Œæˆ‘éå¸¸å–œæ¬¢æ¬£èµ', 'C. ç¾ä¸½çš„é£æ™¯ç”»æ˜¯ä¸€å¹…ï¼Œæˆ‘å–œæ¬¢çœ‹'], correctAnswer: 0, explanation: '"å–œæ¬¢"å·²åŒ…å«"çœ‹"çš„æ„æ€ï¼Œ"çœ‹"å­—å¤šä½™ã€‚' },
  { id: 'c080', type: 'correct', question: '"æˆ‘ä»¬å¿…é¡»éšæ—¶å‘ç°å¹¶æ”¹æ­£è‡ªå·±çš„ç¼ºç‚¹ã€‚"åº”ä¿®æ”¹ä¸ºï¼š', options: ['A. æˆ‘ä»¬å¿…é¡»éšæ—¶å‘ç°å¹¶æ”¹æ­£è‡ªå·±çš„é”™è¯¯', 'B. æˆ‘ä»¬å¿…é¡»éšæ—¶å‘ç°å¹¶æ”¹æ­£ç¼ºç‚¹', 'C. æˆ‘ä»¬å¿…é¡»éšæ—¶å‘ç°ç¼ºç‚¹å¹¶æ”¹æ­£'], correctAnswer: 0, explanation: '"æ”¹æ­£"åº”ä¸"é”™è¯¯"æ­é…ï¼Œ"ç¼ºç‚¹"åº”ç”¨"å…‹æœ"ã€‚' }
]

function Correction() {
  const [questions, setQuestions] = useState([])
  const [currentIndex, setCurrentIndex] = useState(0)
  const [selectedAnswer, setSelectedAnswer] = useState(null)
  const [showResult, setShowResult] = useState(false)
  const [score, setScore] = useState(0)
  const [completed, setCompleted] = useState(false)
  const [isFavorited, setIsFavorited] = useState(false)
  const [favoriteLoading, setFavoriteLoading] = useState(false)
  // è®°å½•æ¯é“é¢˜çš„ç­”æ¡ˆï¼Œç”¨äºä¿å­˜åˆ° answer_history
  const userAnswers = useRef({})

  const currentQuestion = questions[currentIndex]

  useDidShow(() => {
    startPractice()
    loadFavorites()
  })

  /**
   * åŠ è½½ç”¨æˆ·çš„æ”¶è—åˆ—è¡¨
   */
  const loadFavorites = async () => {
    try {
      const favorites = await questionService.getFavorites(1, 1000)
      FAVORITES_CACHE = new Set(favorites.map(f => f.id || f._id))
      updateFavoriteStatus()
    } catch (err) {
      console.error('åŠ è½½æ”¶è—å¤±è´¥:', err)
    }
  }

  /**
   * æ›´æ–°å½“å‰é¢˜ç›®çš„æ”¶è—çŠ¶æ€
   */
  const updateFavoriteStatus = () => {
    if (currentQuestion) {
      setIsFavorited(FAVORITES_CACHE.has(currentQuestion.id))
    }
  }

  /**
   * åˆ‡æ¢æ”¶è—çŠ¶æ€
   */
  const handleToggleFavorite = async () => {
    if (!currentQuestion || favoriteLoading) return

    setFavoriteLoading(true)
    try {
      // ä¼ é€’å®Œæ•´çš„é¢˜ç›®æ•°æ®
      const questionData = {
        id: currentQuestion.id,
        type: currentQuestion.type || 'correction',
        question: currentQuestion.question,
        options: currentQuestion.options,
        correctAnswer: currentQuestion.correctAnswer,
        explanation: currentQuestion.explanation || ''
      }

      const success = await questionService.toggleFavorite(currentQuestion.id, questionData)
      if (success) {
        if (isFavorited) {
          FAVORITES_CACHE.delete(currentQuestion.id)
        } else {
          FAVORITES_CACHE.add(currentQuestion.id)
        }
        setIsFavorited(!isFavorited)
        Taro.showToast({
          title: isFavorited ? 'å·²å–æ¶ˆæ”¶è—' : 'å·²æ”¶è—',
          icon: isFavorited ? 'none' : 'success',
          duration: 1500
        })
      }
    } catch (err) {
      console.error('æ”¶è—å¤±è´¥:', err)
      Taro.showToast({ title: 'æ“ä½œå¤±è´¥', icon: 'none' })
    } finally {
      setFavoriteLoading(false)
    }
  }

  // é¢˜ç›®å˜åŒ–æ—¶æ›´æ–°æ”¶è—çŠ¶æ€
  useEffect(() => {
    updateFavoriteStatus()
  }, [currentIndex, questions])

  const startPractice = () => {
    // éšæœºæ‰“ä¹±é¢˜ç›®ï¼Œå–10é“
    const shuffled = [...CORRECTION_QUESTIONS].sort(() => Math.random() - 0.5)
    setQuestions(shuffled.slice(0, 10))
    setCurrentIndex(0)
    setSelectedAnswer(null)
    setShowResult(false)
    setScore(0)
    setCompleted(false)
    userAnswers.current = {} // æ¸…ç©ºç­”æ¡ˆè®°å½•
  }

  const handleAnswer = (index) => {
    if (selectedAnswer !== null) return
    setSelectedAnswer(index)

    const currentQuestion = questions[currentIndex]
    // è®°å½•ç”¨æˆ·ç­”æ¡ˆ
    userAnswers.current[currentQuestion.id] = index

    if (index === currentQuestion.correctAnswer) {
      setScore(score + 1)
    }
    setShowResult(true)
  }

  const handleNext = () => {
    if (currentIndex < questions.length - 1) {
      setCurrentIndex(currentIndex + 1)
      setSelectedAnswer(null)
      setShowResult(false)
    } else {
      finishPractice()
    }
  }

  const finishPractice = async () => {
    setCompleted(true)

    // å‡†å¤‡ç­”é¢˜æ•°æ®ï¼ŒåŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯
    const answerData = questions.map(q => {
      const userAnswer = userAnswers.current[q.id] ?? -1
      const isCorrect = userAnswer === q.correctAnswer
      return {
        questionId: q.id,
        answer: userAnswer,
        isCorrect,
        questionType: 'correction',
        // åŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯ï¼Œä»¥ä¾¿é”™é¢˜é‡åšæ—¶ä½¿ç”¨
        questionText: q.question || '',
        options: q.options || [],
        correctAnswer: q.correctAnswer
      }
    })

    // 1. ä¿å­˜ç­”é¢˜å†å²åˆ° answer_history
    try {
      await Taro.cloud.callFunction({
        name: 'question',
        data: {
          action: 'submitBatch',
          answers: answerData
        }
      })
    } catch (err) {
      Taro.showToast({ title: 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', icon: 'none', duration: 2000 })
    }

    // 2. ä¿å­˜å­¦ä¹ è®°å½•åˆ° study_records
    try {
      await studyService.addRecord({
        type: 'correction',
        title: 'ç—…å¥ä¿®æ”¹',
        score: Math.round((score / questions.length) * 100),
        totalQuestions: questions.length,
        correctAnswers: score,
        duration: 5
      })

      // 3. è§¦å‘ç»Ÿè®¡æ›´æ–°äº‹ä»¶ï¼ˆå®ç°å®æ—¶åˆ·æ–°ï¼‰
      eventBus.emit(EVENTS.STUDY_RECORD_UPDATED, {
        type: 'correction',
        score: Math.round((score / questions.length) * 100),
        correctCount: score,
        totalCount: questions.length
      })
    } catch (err) {
      console.error('ä¿å­˜å­¦ä¹ è®°å½•å¤±è´¥:', err)
    }
  }

  if (questions.length === 0) {
    return <View className="correction-page"><Text>åŠ è½½ä¸­...</Text></View>
  }

  if (completed) {
    return (
      <View className="correction-page">
        <View className="result-page">
          <View className="result-card">
            <Text className="result-title">ç»ƒä¹ å®Œæˆï¼</Text>
            <Text className="result-score">{score} / {questions.length}</Text>
            <Text className="result-desc">
              {score >= questions.length * 0.8 ? 'å¤ªæ£’äº†ï¼' :
               score >= questions.length * 0.6 ? 'ç»§ç»­åŠ æ²¹ï¼' : 'å†ç»ƒä¹ ä¸€ä¸‹å§ï¼'}
            </Text>
            <View className="result-actions">
              <View className="action-btn secondary" onClick={startPractice}>å†ç»ƒä¸€æ¬¡</View>
              <View className="action-btn" onClick={() => Taro.navigateBack()}>è¿”å›</View>
            </View>
          </View>
        </View>
      </View>
    )
  }

  return (
    <View className="correction-page">
      {/* è¿›åº¦æ¡ */}
      <View className="progress-bar">
        <View
          className="progress-fill"
          style={{ width: `${((currentIndex + 1) / questions.length) * 100}%` }}
        />
      </View>

      <ScrollView scrollY className="content-scroll">
        {/* é¢˜ç›®å¡ç‰‡ */}
        <View className="question-card">
          <View className="question-header">
            <Text className="question-num">ç¬¬ {currentIndex + 1} / {questions.length} é¢˜</Text>
            <View className="question-tag">ç—…å¥ä¿®æ”¹</View>
            <View
              className={`favorite-btn ${isFavorited ? 'favorited' : ''} ${favoriteLoading ? 'loading' : ''}`}
              onClick={handleToggleFavorite}
            >
              <Text className="favorite-icon">{isFavorited ? 'â˜…' : 'â˜†'}</Text>
            </View>
          </View>

          <View className="question-content">
            <Text className="question-text">{currentQuestion?.question}</Text>
          </View>

          {/* é€‰é¡¹åˆ—è¡¨ */}
          <View className="options-list">
            {currentQuestion?.options.map((option, index) => {
              const isSelected = selectedAnswer === index
              const isCorrect = index === currentQuestion.correctAnswer
              const showCorrect = showResult && isCorrect

              return (
                <View
                  key={index}
                  className={`option-item ${isSelected ? (isCorrect ? 'correct' : 'wrong') : ''} ${showCorrect ? 'correct' : ''}`}
                  onClick={() => handleAnswer(index)}
                >
                  <Text className="option-text">{option}</Text>
                  {showCorrect && <Text className="option-icon">âœ“</Text>}
                  {isSelected && !isCorrect && <Text className="option-icon">Ã—</Text>}
                </View>
              )
            })}
          </View>

          {/* è§£æ */}
          {showResult && currentQuestion?.explanation && (
            <View className="explanation-box">
              <Text className="explanation-label">è§£æ</Text>
              <Text className="explanation-text">{currentQuestion.explanation}</Text>
            </View>
          )}

          {/* ä¸‹ä¸€é¢˜æŒ‰é’® */}
          {showResult && (
            <View className="next-btn" onClick={handleNext}>
              <Text>{currentIndex < questions.length - 1 ? 'ä¸‹ä¸€é¢˜' : 'æŸ¥çœ‹ç»“æœ'}</Text>
            </View>
          )}
        </View>
      </ScrollView>
    </View>
  )
}

export default Correction


// ===== src/pages/mock-exam/index.jsx =====
/**
 * æ¨¡æ‹Ÿè€ƒè¯•é¡µé¢
 * ä»æ•°æ®åº“é¢˜åº“ä¸­éšæœºæŠ½å–é¢˜ç›®ï¼Œæ¯æ¬¡è€ƒè¯•é¢˜ç›®éƒ½ä¸åŒ
 */
import { useState, useEffect } from 'react'
import { View, Text, ScrollView } from '@tarojs/components'
import Taro from '@tarojs/taro'
import { navigateBack, useDidShow } from '@tarojs/taro'
import { QUESTION_TYPES } from '../../utils/constants'
import studyService from '../../services/study'
import questionService from '../../services/question'
import eventBus, { EVENTS } from '../../utils/eventBus'
import './index.less'

// å¼•å…¥æ‰©å±•åçš„é¢˜ç›®æ•°æ®ï¼ˆ1000é“é¢˜ï¼‰
// ä½¿ç”¨åŠ¨æ€ import é¿å…å¾ªç¯ä¾èµ–
let ALL_QUESTIONS = []

// åˆå§‹åŒ–é¢˜ç›®æ•°æ®
const initQuestions = () => {
  if (ALL_QUESTIONS.length === 0) {
    // è¿™é‡Œä½¿ç”¨åŠ¨æ€æ„é€ é¢˜ç›®æ•°æ®
    // ä» question.js ä¸­çš„ç”Ÿæˆå‡½æ•°è·å–é¢˜ç›®
    const baseQuestions = [
      // æ‹¼éŸ³é¢˜ - åŸºç¡€20é¢˜
      { id: 'py001', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç‹¡ç‹(nÃ­ng)', 'B. æœºæ¢°(jiÃ¨)', 'C. åŒä»‡æ•Œå¿¾(kÃ i)', 'D. ç·æ±¡(zhÄ“n)'], correctAnswer: 2, analysis: 'Cé¡¹æ³¨éŸ³å®Œå…¨æ­£ç¡®ã€‚' },
      { id: 'py002', type: 'pinyin', question: 'ä¸‹åˆ—è¯è¯­ä¸­åŠ ç‚¹å­—çš„è¯»éŸ³ï¼Œä¸æ‰€ç»™æ³¨éŸ³å…¨éƒ¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¾› gÃ²ng ä¾›ç»™ ä¾›è®¤ ä¾›å“', 'B. è§’ juÃ© è§’è‰² å£è§’ è§’é€', 'C. å¼º qiÃ¡ng å¼ºè¿« å€”å¼º å¼ºå£®', 'D. å¤„ chÇ” å¤„ç† å¤„åˆ† å¤„æ‰€'], correctAnswer: 1, analysis: 'Bé¡¹å…¨éƒ¨è¯»juÃ©ã€‚' },
      { id: 'py003', type: 'pinyin', question: '"å‚"åœ¨"å‚åŠ "ä¸­è¯»ï¼š', options: ['A. cÄ“n', 'B. shÄ“n', 'C. cÄn', 'D. cÄ«'], correctAnswer: 2, analysis: '"å‚"åœ¨"å‚åŠ "ä¸­è¯»cÄnã€‚' },
      { id: 'py004', type: 'pinyin', question: '"è–„"åœ¨"è–„é›¾"ä¸­è¯»ï¼š', options: ['A. bÃ¡o', 'B. bÃ³', 'C. bÃ²', 'D. bÄ“'], correctAnswer: 0, analysis: '"è–„"åœ¨"è–„é›¾"ä¸­è¯»bÃ¡oã€‚' },
      { id: 'py005', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è´®è“„(zhÃ¹) è¡è(hÃ n) é…é…¿(niÃ ng)', 'B. ç²—ç³™(cÄo) ç¡®å‡¿(zÃ¡o) å”¯å¦™å”¯è‚–(xiÃ o)', 'C. è®ªç¬‘(shÃ n) æŒ‘è¡…(xÃ¬n) å“‚ç¬‘(xÄ«)', 'D. åª²ç¾(pÃ¬) ç¼„é»˜(jiÄn) é…·è‚–(xiÃ o)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
      // æˆè¯­é¢˜
      { id: 'cy001', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä¸­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç”µå½±æƒ…èŠ‚è‡ªç›¸çŸ›ç›¾', 'B. æ–‡ç« è§è§£ä¸åŒå‡¡å“', 'C. ç»æµå‘å±•ä¸¾ä¸–ç©ç›®', 'D. å¤±åˆ©åé‡æ•´æ——é¼“'], correctAnswer: 3, analysis: 'Dé¡¹"é‡æ•´æ——é¼“"ä½¿ç”¨æ­£ç¡®ã€‚' },
      { id: 'cy002', type: 'idiom', question: '"ç”»è›‡æ·»è¶³"æ¯”å–»ï¼š', options: ['A. åšäº‹è¦è®¤çœŸ', 'B. åšå¤šä½™çš„äº‹åä¸å¥½', 'C. æŠ“ä½æœºä¼š', 'D. åšæŒåˆ°åº•'], correctAnswer: 1, analysis: '"ç”»è›‡æ·»è¶³"æ¯”å–»åšäº†å¤šä½™çš„äº‹ã€‚' },
      { id: 'cy003', type: 'idiom', question: '"å®ˆæ ªå¾…å…”"æ¯”å–»ï¼š', options: ['A. å–„äºè§‚å¯Ÿ', 'B. æ­»å®ˆä¸çŸ¥å˜é€š', 'C. æœ‰è€å¿ƒ', 'D. è¿æ°”é‡è¦'], correctAnswer: 1, analysis: '"å®ˆæ ªå¾…å…”"æ¯”å–»æ­»å®ˆç»éªŒä¸çŸ¥å˜é€šã€‚' },
      { id: 'cy004', type: 'idiom', question: '"äº¡ç¾Šè¡¥ç‰¢"çš„æ„æ€æ˜¯ï¼š', options: ['A. ç¾Šä¸¢äº†ä¸æ‰¾', 'B. å‡ºé—®é¢˜åè¡¥æ•‘', 'C. ä¿®ç†ç¾Šåœˆ', 'D. é¢„é˜²é—®é¢˜'], correctAnswer: 1, analysis: '"äº¡ç¾Šè¡¥ç‰¢"æ¯”å–»å‡ºäº†é—®é¢˜åŠæ—¶è¡¥æ•‘ã€‚' },
      { id: 'cy005', type: 'idiom', question: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»ï¼š', options: ['A. å¿ƒé‡Œæœ‰ç«¹å­', 'B. åšäº‹æœ‰æŠŠæ¡', 'C. å–œæ¬¢ç”»ç”»', 'D. èƒ¸éƒ¨å®½å¹¿'], correctAnswer: 1, analysis: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»åšäº‹æœ‰æŠŠæ¡ã€‚' },
      // è¯æ±‡é¢˜
      { id: 'vo001', type: 'vocabulary', question: '"å§¹ç´«å«£çº¢"çš„æ„æ€æ˜¯ï¼š', options: ['A. é¢œè‰²å•ä¸€', 'B. å„ç§èŠ±æœµå¨‡è‰³', 'C. ç´«è‰²çº¢è‰²', 'D. èŠ±æœµå‡‹é›¶'], correctAnswer: 1, analysis: '"å§¹ç´«å«£çº¢"å½¢å®¹å„ç§é¢œè‰²èŠ±æœµå¨‡è‰³ã€‚' },
      { id: 'vo002', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å†æ¥å†åŠ±', 'B. è°ˆç¬‘é£ç”Ÿ', 'C. å·§å¤ºå¤©å…¬', 'D. è¿«ä¸æ€¥å¾…'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚' },
      { id: 'vo003', type: 'vocabulary', question: '"ç¾è½®ç¾å¥‚"å½¢å®¹ï¼š', options: ['A. ç¾ä¸½é£æ™¯', 'B. é«˜å¤§åä¸½å»ºç­‘', 'C. ç¾ä¸½çš„äºº', 'D. ç¾å¥½éŸ³ä¹'], correctAnswer: 1, analysis: '"ç¾è½®ç¾å¥‚"å½¢å®¹æˆ¿å±‹é«˜å¤§åä¸½ã€‚' },
      { id: 'vo004', type: 'vocabulary', question: '"é³æ¬¡æ ‰æ¯”"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ’åˆ—å¯†', 'B. é±¼å’Œæ¢³å­', 'C. æ¬¡åºæ··ä¹±', 'D. æ•´é½ç¨€ç–'], correctAnswer: 0, analysis: '"é³æ¬¡æ ‰æ¯”"å½¢å®¹å»ºç­‘ç‰©æ’åˆ—å¯†æ•´ã€‚' },
      { id: 'vo005', type: 'vocabulary', question: '"å› åœ°åˆ¶å®œ"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ ¹æ®å½“åœ°åˆ¶å®šæªæ–½', 'B. æ”¹é€ ç¯å¢ƒ', 'C. é€‚åº”ç¯å¢ƒ', 'D. æ”¹å˜åˆ¶åº¦'], correctAnswer: 0, analysis: '"å› åœ°åˆ¶å®œ"æŒ‡æ ¹æ®æƒ…å†µåˆ¶å®šåŠæ³•ã€‚' },
      // ç—…å¥é¢˜
      { id: 'bc001', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é€šè¿‡æ´»åŠ¨ï¼Œä½¿æˆ‘æ˜ç™½', 'B. æ€åº¦ç«¯æ­£ï¼Œæˆç»©æé«˜', 'C. æ‰“æ‰«æ•™å®¤å«ç”Ÿ', 'D. æ”¹è¿›æ–¹æ³•ï¼Œå¢åŠ æ•ˆç‡'], correctAnswer: 1, analysis: 'Bé¡¹æ— è¯­ç—…ã€‚' },
      { id: 'bc002', type: 'correction', question: '"å¢åŠ æ•ˆç‡"çš„é”™è¯¯ç±»å‹æ˜¯ï¼š', options: ['A. è¯­åºä¸å½“', 'B. æ­é…ä¸å½“', 'C. æˆåˆ†æ®‹ç¼º', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, analysis: '"å¢åŠ "ä¸"æ•ˆç‡"æ­é…ä¸å½“ã€‚' },
      { id: 'bc003', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŒ—äº¬ç§‹å¤©ç¾ä¸½', 'B. æ–‡ç« è§‚ç‚¹æ·±åˆ»', 'C. ç©¿ç€ä¸Šè¡£æˆ´å¸½å­', 'D. å…»æˆå­¦ä¹ ä¹ æƒ¯'], correctAnswer: 2, analysis: 'Cé¡¹æ­é…ä¸å½“ã€‚' },
      { id: 'bc004', type: 'correction', question: '"é€šè¿‡å­¦ä¹ ï¼Œä½¿æˆ‘å—ç›Š"ç—…å› æ˜¯ï¼š', options: ['A. æˆåˆ†æ®‹ç¼º', 'B. æ­é…ä¸å½“', 'C. è¯­åºä¸å½“', 'D. ç»“æ„æ··ä¹±'], correctAnswer: 0, analysis: 'æ»¥ç”¨ä»‹è¯å¯¼è‡´ä¸»è¯­ç¼ºå¤±ã€‚' },
      { id: 'bc005', type: 'correction', question: 'ä¸‹åˆ—æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ–‡ç« å¯¹æˆ‘æœ‰å…´è¶£', 'B. æˆ‘å¯¹æ–‡ç« æœ‰å…´è¶£', 'C. æ–‡ç« å¼•èµ·å…´è¶£', 'D. æ–‡ç« è®©æˆ‘æ„Ÿå…´è¶£'], correctAnswer: 2, analysis: 'Cé¡¹æ— è¯­ç—…ã€‚' },
      // å¤è¯—è¯é¢˜
      { id: 'gs001', type: 'literature', question: '"é‡‡èŠä¸œç¯±ä¸‹ï¼Œæ‚ ç„¶è§å—å±±"å‡ºè‡ªè°ï¼š', options: ['A. æç™½', 'B. æœç”«', 'C. é™¶æ¸Šæ˜', 'D. ç‹ç»´'], correctAnswer: 2, analysis: 'é™¶æ¸Šæ˜ã€Šé¥®é…’ã€‹ã€‚' },
      { id: 'gs002', type: 'literature', question: '"æµ·å†…å­˜çŸ¥å·±ï¼Œå¤©æ¶¯è‹¥æ¯”é‚»"å‡ºè‡ªï¼š', options: ['A. ç‹å‹ƒ', 'B. æç™½', 'C. ç‹ç»´', 'D. æœç”«'], correctAnswer: 0, analysis: 'ç‹å‹ƒã€Šé€æœå°‘åºœä¹‹ä»»èœ€å·ã€‹ã€‚' },
      { id: 'gs003', type: 'literature', question: '"æ˜¥çœ ä¸è§‰æ™“"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. èŠ±è½çŸ¥å¤šå°‘', 'B. å¤„å¤„é—»å•¼é¸Ÿ', 'C. å¤œæ¥é£é›¨å£°', 'D. æ±Ÿæ¸…æœˆè¿‘äºº'], correctAnswer: 1, analysis: '"æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿ"ã€‚' },
      { id: 'gs004', type: 'literature', question: '"ä½†æ„¿äººé•¿ä¹…"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. åƒé‡Œå…±å©µå¨Ÿ', 'B. æ˜æœˆå‡ æ—¶æœ‰', 'C. æŠŠé…’é—®é’å¤©', 'D. ä½•ä¼¼åœ¨äººé—´'], correctAnswer: 0, analysis: '"ä½†æ„¿äººé•¿ä¹…ï¼Œåƒé‡Œå…±å©µå¨Ÿ"ã€‚' },
      { id: 'gs005', type: 'literature', question: '"ä¼šå½“å‡Œç»é¡¶"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. ä¸€è§ˆä¼—å±±å°', 'B. é€ åŒ–é’Ÿç¥ç§€', 'C. å†³çœ¦å…¥å½’é¸Ÿ', 'D. è¡èƒ¸ç”Ÿå±‚äº‘'], correctAnswer: 0, analysis: '"ä¼šå½“å‡Œç»é¡¶ï¼Œä¸€è§ˆä¼—å±±å°"ã€‚' }
    ]

    // æ‰©å±•é¢˜ç›® - å‚è€ƒk12_mdä¸­çš„é¢˜å‹ç”Ÿæˆæ›´å¤šé¢˜ç›®
    const extendedQuestions = generateExtendedQuestions()
    ALL_QUESTIONS = [...baseQuestions, ...extendedQuestions]
  }
  return ALL_QUESTIONS
}

// ç”Ÿæˆæ‰©å±•é¢˜ç›®ï¼ˆæ¨¡æ‹Ÿä»question.jsä¸­çš„1000é“é¢˜æŠ½å–ï¼‰
const generateExtendedQuestions = () => {
  const questions = []
  let id = 100

  // å¤šéŸ³å­—é¢˜ç›®
  const polyphones = [
    { char: 'å®¿', words: ['å®¿èˆ', 'æ˜Ÿå®¿', 'ä¿ç•™'], readings: ['sÃ¹', 'xiÃ¹', 'xiÇ”'] },
    { char: 'èˆ', words: ['å®¿èˆ', 'èˆå¼ƒ', 'æ–½èˆ'], readings: ['shÃ¨', 'shÄ›', 'shÄ›'] },
    { char: 'å¼º', words: ['åšå¼º', 'å€”å¼º', 'å¼ºè¿«'], readings: ['qiÃ¡ng', 'jiÃ ng', 'qiÇng'] },
    { char: 'å‚', words: ['å‚åŠ ', 'äººå‚', 'å‚å·®'], readings: ['cÄn', 'shÄ“n', 'cÄ“n'] },
    { char: 'è–„', words: ['è–„å¼±', 'è–„è·', 'è–„é›¾'], readings: ['bÃ³', 'bÃ²', 'bÃ¡o'] },
    { char: 'æ¨¡', words: ['æ¨¡èŒƒ', 'æ¨¡æ ·', 'æ¨¡å…·'], readings: ['mÃ³', 'mÃº', 'mÃº'] },
    { char: 'å’½', words: ['å’½å–‰', 'åå’½', 'å‘œå’½'], readings: ['yÄn', 'yÃ n', 'yÃ¨'] },
    { char: 'æ³Š', words: ['åœæ³Š', 'æ¹–æ³Š', 'æ¼‚æ³Š'], readings: ['bÃ³', 'pÅ', 'bÃ³'] },
    { char: 'è§’', words: ['è§’è‰²', 'å£è§’', 'è§’é€'], readings: ['juÃ©', 'jiÇo', 'juÃ©'] },
    { char: 'ç››', words: ['ç››å¤§', 'ç››é¥­', 'ç››æ»¡'], readings: ['shÃ¨ng', 'chÃ©ng', 'chÃ©ng'] }
  ]

  polyphones.forEach(p => {
    questions.push({
      id: `py${id++}`,
      type: 'pinyin',
      question: `"${p.char}"åœ¨"${p.words[1]}"ä¸­è¯»ï¼š`,
      options: [`A. ${p.readings[0]}`, `B. ${p.readings[1]}`, `C. ${p.readings[2]}`, `D. ${p.readings[0]}`],
      correctAnswer: 1,
      analysis: `"${p.char}"åœ¨"${p.words[1]}"ä¸­è¯»${p.readings[1]}ã€‚`
    })
  })

  // æˆè¯­é¢˜ç›®
  const idioms = [
    { name: 'ç”»é¾™ç‚¹ç›', meaning: 'æ¯”å–»åœ¨å…³é”®å¤„åŠ ä¸Šä¸€ç¬”ï¼Œä½¿å†…å®¹æ›´ç”ŸåŠ¨ä¼ ç¥' },
    { name: 'é”¦ä¸Šæ·»èŠ±', meaning: 'æ¯”å–»å¥½ä¸ŠåŠ å¥½ï¼Œç¾ä¸ŠåŠ ç¾' },
    { name: 'é›ªä¸­é€ç‚­', meaning: 'æ¯”å–»åœ¨æ€¥éœ€æ—¶ç»™ä»¥ç‰©è´¨ä¸Šæˆ–ç²¾ç¥ä¸Šçš„å¸®åŠ©' },
    { name: 'çº¸ä¸Šè°ˆå…µ', meaning: 'æ¯”å–»ç©ºè°ˆç†è®ºï¼Œä¸èƒ½è§£å†³å®é™…é—®é¢˜' },
    { name: 'åˆ»èˆŸæ±‚å‰‘', meaning: 'æ¯”å–»æ‹˜æ³¥æˆæ³•ï¼Œä¸çŸ¥é“å˜é€š' },
    { name: 'å—è¾•åŒ—è¾™', meaning: 'æ¯”å–»è¡ŒåŠ¨å’Œç›®çš„æ­£å¥½ç›¸å' },
    { name: 'ä¸€é¸£æƒŠäºº', meaning: 'æ¯”å–»å¹³æ—¶æ²¡æœ‰ç‰¹æ®Šè¡¨ç°ï¼Œä¸€åšèµ·æ¥å°±æœ‰æƒŠäººçš„æˆç»©' },
    { name: 'ä¸‰é¡¾èŒ…åº', meaning: 'æ¯”å–»è¯šå¿ƒè¯šæ„åœ°é‚€è¯·äººå®¶' },
    { name: 'è´Ÿè†è¯·ç½ª', meaning: 'è¡¨ç¤ºå‘äººè®¤é”™èµ”ç½ª' },
    { name: 'å®Œç’§å½’èµµ', meaning: 'æ¯”å–»æŠŠç‰©å“å®Œå¥½åœ°å½’è¿˜ç»™ç‰©å“çš„ä¸»äºº' },
    { name: 'ç¨‹é—¨ç«‹é›ª', meaning: 'å½¢å®¹å°Šå¸ˆé‡é“ï¼Œè™”è¯šæ±‚æ•™' },
    { name: 'é—»é¸¡èµ·èˆ', meaning: 'æ¯”å–»æœ‰å¿—æŠ¥å›½çš„äººåŠæ—¶å¥‹èµ·' },
    { name: 'å…¥æœ¨ä¸‰åˆ†', meaning: 'å½¢å®¹ä¹¦æ³•ææœ‰ç¬”åŠ›ï¼Œç°å¤šæ¯”å–»åˆ†æé—®é¢˜å¾ˆæ·±åˆ»' },
    { name: 'æœ›æ´‹å…´å¹', meaning: 'æ¯”å–»åšäº‹æ—¶å› åŠ›ä¸èƒœä»»æˆ–æ²¡æœ‰æ¡ä»¶è€Œæ„Ÿåˆ°æ— å¯å¥ˆä½•' },
    { name: 'å¶å…¬å¥½é¾™', meaning: 'æ¯”å–»å£å¤´ä¸Šè¯´çˆ±å¥½æŸäº‹ç‰©ï¼Œå®é™…ä¸Šå¹¶ä¸çœŸçˆ±å¥½' },
    { name: 'é»”é©´æŠ€ç©·', meaning: 'æ¯”å–»æœ‰é™çš„ä¸€ç‚¹æœ¬é¢†ä¹Ÿå·²ç»ç”¨å®Œäº†' },
    { name: 'æäººå¿§å¤©', meaning: 'æ¯”å–»ä¸å¿…è¦çš„æˆ–ç¼ºä¹æ ¹æ®çš„å¿§è™‘å’Œæ‹…å¿ƒ' },
    { name: 'æ¯å¼“è›‡å½±', meaning: 'æ¯”å–»å› ç–‘ç¥ç–‘é¬¼è€Œå¼•èµ·ææƒ§' },
    { name: 'å¯¹ç‰›å¼¹ç´', meaning: 'æ¯”å–»å¯¹ä¸è®²é“ç†çš„äººè®²é“ç†' },
    { name: 'æŒ‡é¹¿ä¸ºé©¬', meaning: 'æ¯”å–»æ•…æ„é¢ å€’é»‘ç™½ï¼Œæ··æ·†æ˜¯é' }
  ]

  idioms.forEach(i => {
    // ç”Ÿæˆæ··æ·†é€‰é¡¹
    const wrongOptions = idioms
      .filter(x => x.name !== i.name)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.meaning)

    // æ‰“ä¹±é€‰é¡¹é¡ºåº
    const allOptions = [i.meaning, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(i.meaning)

    questions.push({
      id: `cy${id++}`,
      type: 'idiom',
      question: `"${i.name}"çš„æ„æ€æ˜¯ï¼š`,
      options: allOptions.map((opt, idx) => `ABCD`[idx] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: i.meaning
    })
  })

  // è¯æ±‡é¢˜ç›®
  const vocabWords = [
    { word: 'ç„•ç„¶ä¸€æ–°', error: 'æ¢ç„¶ä¸€æ–°' },
    { word: 'è°ˆç¬‘é£ç”Ÿ', error: 'è°ˆç¬‘é£å£°' },
    { word: 'è¿«åœ¨çœ‰ç«', error: 'è¿«åœ¨çœ‰æ·' },
    { word: 'å†æ¥å†å‰', error: 'å†æ¥å†åŠ±' },
    { word: 'ç›¸å¾—ç›Šå½°', error: 'ç›¸å¾—ç›Šç« ' },
    { word: 'æµè¿å¿˜è¿”', error: 'ç•™è¿å¿˜è¿”' },
    { word: 'éœ‡è€³æ¬²è‹', error: 'æŒ¯è€³æ¬²è‹' },
    { word: 'éƒ‘é‡å…¶äº‹', error: 'éƒ‘é‡å…¶æ˜¯' },
    { word: 'æ¼«ä¸ç»å¿ƒ', error: 'æ…¢ä¸ç»å¿ƒ' },
    { word: 'æƒŠæ…Œå¤±æª', error: 'æƒŠæ…Œå¤±é”™' },
    { word: 'åˆ«å‡ºå¿ƒè£', error: 'åˆ«å‡ºæ–°è£' },
    { word: 'å†å†åœ¨ç›®', error: 'å†å†åœ¨æœ¨' },
    { word: 'ç»œç»ä¸ç»', error: 'è½ç»ä¸ç»' },
    { word: 'éšå£°é™„å’Œ', error: 'éšå£°é™„åˆ' },
    { word: 'å› åœ°åˆ¶å®œ', error: 'å› è‡³åˆ¶å®œ' },
    { word: 'é³æ¬¡æ ‰æ¯”', error: 'é³æ¬¡æ ‰æ­¤' },
    { word: 'æŠ‘æ‰¬é¡¿æŒ«', error: 'æŠ‘æ‰¬é¡¿æª' },
    { word: 'ç›¸æ¿¡ä»¥æ²«', error: 'ç›¸å„’ä»¥æ²«' },
    { word: 'ä¸å¯æ€è®®', error: 'ä¸å¯æ€ä¹‰' },
    { word: 'å§¹ç´«å«£çº¢', error: 'è¯§ç´«å«£çº¢' }
  ]

  vocabWords.forEach((v, idx) => {
    // ç”Ÿæˆæ··æ·†é€‰é¡¹
    const wrongOptions = vocabWords
      .filter((x, i) => i !== idx)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.word)

    // æ‰“ä¹±é€‰é¡¹é¡ºåº
    const allOptions = [v.word, v.error, ...wrongOptions.slice(0, 2)].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(v.word)

    questions.push({
      id: `vo${id++}`,
      type: 'vocabulary',
      question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š',
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: `${`ABCD`[correctIndex]}é¡¹"${v.word}"æ­£ç¡®ã€‚`
    })
  })

  // ç—…å¥é¢˜ç›®
  const errorTypes = [
    { type: 'æˆåˆ†æ®‹ç¼º', example: 'é€šè¿‡å­¦ä¹ ï¼Œä½¿æˆ‘å—ç›Š' },
    { type: 'æ­é…ä¸å½“', example: 'å¢åŠ æ•ˆç‡' },
    { type: 'è¯­åºä¸å½“', example: 'åšç‰©é¦†å±•å‡ºäº†ä¸¤åƒå¤šå¹´å‰æ–°å‡ºåœŸçš„æ–‡ç‰©' },
    { type: 'å¥å¼æ‚ç³…', example: 'è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯é²è¿…å†™çš„' },
    { type: 'è¡¨æ„ä¸æ˜', example: 'ä¸¤ä¸ªå­¦æ ¡çš„è€å¸ˆéƒ½æ¥äº†' },
    { type: 'å¦å®šå¤±å½“', example: 'é˜²æ­¢ä¸è¦å‘ç”Ÿäº‹æ•…' },
    { type: 'æˆåˆ†èµ˜ä½™', example: 'å¤§çº¦10ä¸ªå·¦å³' },
    { type: 'ä¸»å®¢é¢ å€’', example: 'è¿™ç¯‡æ–‡ç« å¯¹æˆ‘å¾ˆæ„Ÿå…´è¶£' }
  ]

  errorTypes.forEach((e, idx) => {
    // ç”Ÿæˆæ··æ·†é€‰é¡¹
    const wrongOptions = errorTypes
      .filter((x, i) => i !== idx)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.type)

    // æ‰“ä¹±é€‰é¡¹é¡ºåº
    const allOptions = [e.type, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(e.type)

    questions.push({
      id: `bc${id++}`,
      type: 'correction',
      question: `"${e.example}"çš„ç—…å› æ˜¯ï¼š`,
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: `${e.type}ã€‚`
    })
  })

  // å¤è¯—è¯é¢˜ç›®
  const poems = [
    { q: 'å›½ç ´å±±æ²³åœ¨', a: 'åŸæ˜¥è‰æœ¨æ·±', author: 'æœç”«', title: 'æ˜¥æœ›' },
    { q: 'æ„Ÿæ—¶èŠ±æº…æ³ª', a: 'æ¨åˆ«é¸ŸæƒŠå¿ƒ', author: 'æœç”«', title: 'æ˜¥æœ›' },
    { q: 'çƒ½ç«è¿ä¸‰æœˆ', a: 'å®¶ä¹¦æŠµä¸‡é‡‘', author: 'æœç”«', title: 'æ˜¥æœ›' },
    { q: 'ç™½æ—¥ä¾å±±å°½', a: 'é»„æ²³å…¥æµ·æµ', author: 'ç‹ä¹‹æ¶£', title: 'ç™»é¹³é›€æ¥¼' },
    { q: 'æ¬²ç©·åƒé‡Œç›®', a: 'æ›´ä¸Šä¸€å±‚æ¥¼', author: 'ç‹ä¹‹æ¶£', title: 'ç™»é¹³é›€æ¥¼' },
    { q: 'åºŠå‰æ˜æœˆå…‰', a: 'ç–‘æ˜¯åœ°ä¸Šéœœ', author: 'æç™½', title: 'é™å¤œæ€' },
    { q: 'ä¸¾å¤´æœ›æ˜æœˆ', a: 'ä½å¤´æ€æ•…ä¹¡', author: 'æç™½', title: 'é™å¤œæ€' },
    { q: 'å­¤å¸†è¿œå½±ç¢§ç©ºå°½', a: 'å”¯è§é•¿æ±Ÿå¤©é™…æµ', author: 'æç™½', title: 'é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶ä¹‹å¹¿é™µ' },
    { q: 'åŠå›æ›´å°½ä¸€æ¯é…’', a: 'è¥¿å‡ºé˜³å…³æ— æ•…äºº', author: 'ç‹ç»´', title: 'é€å…ƒäºŒä½¿å®‰è¥¿' },
    { q: 'æ¡ƒèŠ±æ½­æ°´æ·±åƒå°º', a: 'ä¸åŠæ±ªä¼¦é€æˆ‘æƒ…', author: 'æç™½', title: 'èµ æ±ªä¼¦' },
    { q: 'è«æ„å‰è·¯æ— çŸ¥å·±', a: 'å¤©ä¸‹è°äººä¸è¯†å›', author: 'é«˜é€‚', title: 'åˆ«è‘£å¤§' },
    { q: 'å¤œæ¥é£é›¨å£°', a: 'èŠ±è½çŸ¥å¤šå°‘', author: 'å­Ÿæµ©ç„¶', title: 'æ˜¥æ™“' },
    { q: 'æ˜æœˆå‡ æ—¶æœ‰', a: 'æŠŠé…’é—®é’å¤©', author: 'è‹è½¼', title: 'æ°´è°ƒæ­Œå¤´' },
    { q: 'æˆ‘æ¬²ä¹˜é£å½’å»', a: 'åˆæç¼æ¥¼ç‰å®‡', author: 'è‹è½¼', title: 'æ°´è°ƒæ­Œå¤´' },
    { q: 'äººæœ‰æ‚²æ¬¢ç¦»åˆ', a: 'æœˆæœ‰é˜´æ™´åœ†ç¼º', author: 'è‹è½¼', title: 'æ°´è°ƒæ­Œå¤´' }
  ]

  poems.forEach((p, idx) => {
    // ç”Ÿæˆæ··æ·†é€‰é¡¹
    const wrongOptions = poems
      .filter((x, i) => i !== idx)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.a)

    // æ‰“ä¹±é€‰é¡¹é¡ºåº
    const allOptions = [p.a, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(p.a)

    questions.push({
      id: `gs${id++}`,
      type: 'literature',
      question: `"${p.q}"ä¸‹ä¸€å¥æ˜¯ï¼š`,
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: `${p.author}ã€Š${p.title}ã€‹ã€‚`
    })
  })

  return questions
}

function MockExam() {
  const [questions, setQuestions] = useState([])
  const [loading, setLoading] = useState(true)
  const [currentIndex, setCurrentIndex] = useState(0)
  const [answers, setAnswers] = useState({})
  const [timeLeft, setTimeLeft] = useState(120 * 60) // 120åˆ†é’Ÿ
  const [showResult, setShowResult] = useState(false)
  const [showCard, setShowCard] = useState(false)
  const [examStarted, setExamStarted] = useState(false)
  const [timerId, setTimerId] = useState(null)

  // ä½¿ç”¨ useDidShow ç¡®ä¿é¢˜ç›®åœ¨é¡µé¢æ˜¾ç¤ºæ—¶åŠ è½½
  useDidShow(() => {
    loadQuestions()
  })

  const loadQuestions = async () => {
    setLoading(true)

    try {
      // ä»æ•°æ®åº“éšæœºæŠ½å–50é“é¢˜ç›®
      const questions = await questionService.getRandomQuestions(50)

      if (questions && questions.length > 0) {
        console.log('ä»æ•°æ®åº“åŠ è½½æ¨¡æ‹Ÿè€ƒè¯•é¢˜ç›®æ•°é‡:', questions.length)

        // å°†æ•°æ®åº“é¢˜ç›®æ ¼å¼è½¬æ¢ä¸ºé¡µé¢éœ€è¦çš„æ ¼å¼
        const examQuestions = questions.map((q) => ({
          id: q._id || q.id,
          type: q.type,
          question: q.question,
          options: q.options || [],
          correctAnswer: q.correctAnswer,
          analysis: q.explanation || ''
        }))

        setQuestions(examQuestions)
        setLoading(false)
      } else {
        // å¦‚æœæ•°æ®åº“æ²¡æœ‰é¢˜ç›®ï¼Œä½¿ç”¨æœ¬åœ°å¤‡ç”¨é¢˜ç›®
        console.log('æ•°æ®åº“æš‚æ— é¢˜ç›®ï¼Œä½¿ç”¨æœ¬åœ°å¤‡ç”¨é¢˜ç›®')
        loadLocalQuestions()
      }
    } catch (err) {
      console.error('ä»æ•°æ®åº“åŠ è½½é¢˜ç›®å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å¤‡ç”¨é¢˜ç›®:', err)
      loadLocalQuestions()
    }
  }

  // æœ¬åœ°å¤‡ç”¨é¢˜ç›®åŠ è½½å‡½æ•°
  const loadLocalQuestions = () => {
    const allQuestions = initQuestions()

    // Fisher-Yates æ´—ç‰Œç®—æ³•æ‰“ä¹±é¡ºåº
    const shuffled = [...allQuestions]
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1))
      ;[shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]
    }

    const examQuestions = shuffled.slice(0, 50)
    console.log('ä½¿ç”¨æœ¬åœ°å¤‡ç”¨é¢˜ç›®æ•°é‡:', examQuestions.length)
    setQuestions(examQuestions)
    setLoading(false)
  }

  const startExam = () => {
    setExamStarted(true)
    const timer = setInterval(() => {
      setTimeLeft(prev => {
        if (prev <= 0) {
          clearInterval(timer)
          handleSubmit()
          return 0
        }
        return prev - 1
      })
    }, 1000)
    setTimerId(timer)
  }

  useEffect(() => {
    return () => {
      if (timerId) clearInterval(timerId)
    }
  }, [timerId])

  // åŠ è½½ä¸­
  if (loading) {
    return (
      <View className="mock-exam-page">
        <View className="exam-loading">
          <Text className="loading-text">æ­£åœ¨åŠ è½½è¯•å·...</Text>
        </View>
      </View>
    )
  }

  // å‡†å¤‡å¼€å§‹é¡µé¢
  if (!examStarted) {
    return (
      <View className="mock-exam-page">
        <ScrollView scrollY className="content-scroll">
          <View className="exam-intro">
            <Text className="intro-title">æ¨¡æ‹Ÿè€ƒè¯•</Text>
            <View className="intro-info">
              <View className="info-item">
                <Text className="info-label">é¢˜ç›®æ•°é‡</Text>
                <Text className="info-value">{questions.length} é¢˜</Text>
              </View>
              <View className="info-item">
                <Text className="info-label">è€ƒè¯•æ—¶é•¿</Text>
                <Text className="info-value">120 åˆ†é’Ÿ</Text>
              </View>
              <View className="info-item">
                <Text className="info-label">æ€»åˆ†</Text>
                <Text className="info-value">100 åˆ†</Text>
              </View>
            </View>
            <View className="intro-tips">
              <Text className="tips-title">è€ƒè¯•é¡»çŸ¥ï¼š</Text>
              <Text className="tips-item">â€¢ è€ƒè¯•å¼€å§‹åå€’è®¡æ—¶è‡ªåŠ¨å¯åŠ¨</Text>
              <Text className="tips-item">â€¢ ç­”é¢˜å®Œæˆåå¯äº¤å·</Text>
              <Text className="tips-item">â€¢ è¶…æ—¶è‡ªåŠ¨äº¤å·</Text>
            </View>
            <View className="start-btn" onClick={startExam}>
              å¼€å§‹è€ƒè¯•
            </View>
          </View>
        </ScrollView>
      </View>
    )
  }

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60)
    const secs = seconds % 60
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
  }

  const handleAnswer = (value) => {
    setAnswers({
      ...answers,
      [questions[currentIndex].id]: value
    })
  }

  const handlePrev = () => {
    if (currentIndex > 0) {
      setCurrentIndex(currentIndex - 1)
    }
  }

  const handleNext = () => {
    if (currentIndex < questions.length - 1) {
      setCurrentIndex(currentIndex + 1)
    }
  }

  const jumpTo = (index) => {
    setCurrentIndex(index)
    setShowCard(false)
  }

  const handleSubmit = async () => {
    if (timerId) clearInterval(timerId)

    // è®¡ç®—åˆ†æ•°å¹¶ä¿å­˜æ•°æ®
    const correctCount = questions.filter(q => answers[q.id] === q.correctAnswer).length
    const score = Math.round((correctCount / questions.length) * 100)

    // ä¿å­˜å­¦ä¹ è®°å½•åˆ° study_records
    try {
      await studyService.addRecord({
        type: 'mock_exam',
        title: 'æ¨¡æ‹Ÿè€ƒè¯•',
        score: score,
        totalQuestions: questions.length,
        correctAnswers: correctCount,
        duration: Math.round((7200 - timeLeft) / 60) // 120åˆ†é’Ÿ = 7200ç§’
      })

      // è§¦å‘ç»Ÿè®¡æ›´æ–°äº‹ä»¶ï¼ˆå®ç°å®æ—¶åˆ·æ–°ï¼‰
      eventBus.emit(EVENTS.STUDY_RECORD_UPDATED, {
        type: 'mock_exam',
        score: score,
        correctCount: correctCount,
        totalCount: questions.length
      })
    } catch (err) {
      console.error('ä¿å­˜å­¦ä¹ è®°å½•å¤±è´¥:', err)
    }

    // ä¿å­˜ç­”é¢˜è®°å½•åˆ° answer_historyï¼ˆåŒ…å« isCorrect å’Œ questionTypeï¼‰
    try {
      const answerData = questions.map(q => {
        const userAnswer = answers[q.id]
        const isCorrect = userAnswer === q.correctAnswer
        return {
          questionId: q.id,
          answer: userAnswer,
          isCorrect,
          questionType: q.type
        }
      })
      await Taro.cloud.callFunction({
        name: 'question',
        data: {
          action: 'submitBatch',
          answers: answerData
        }
      })
    } catch (err) {
      console.error('ä¿å­˜ç­”é¢˜å†å²å¤±è´¥:', err)
    }

    setShowResult(true)
  }

  const getAnswerStatus = (index) => {
    const q = questions[index]
    if (answers[q.id] === undefined) return 'unanswered'
    return 'answered'
  }

  // ç»“æœé¡µé¢
  if (showResult) {
    // æ­£ç¡®è®¡ç®—ç­”å¯¹ã€ç­”é”™ã€æœªç­”æ•°é‡
    const correctCount = questions.filter(q => answers[q.id] === q.correctAnswer).length
    const wrongCount = questions.filter(q => answers[q.id] !== undefined && answers[q.id] !== q.correctAnswer).length
    const unansweredCount = questions.length - correctCount - wrongCount
    const score = Math.round((correctCount / questions.length) * 100)

    // è·³è½¬åˆ°è§£æé¡µé¢
    const handleViewAnalysis = () => {
      const resultData = {
        questions: questions,
        answers: answers,
        score: score
      }
      Taro.navigateTo({
        url: `/pages/exam-result/index?data=${JSON.stringify(resultData)}`
      })
    }

    return (
      <View className="exam-result">
        <View className="result-header">
          <Text className="result-score">{score}</Text>
          <Text className="result-text">åˆ†</Text>
        </View>
        <View className="result-stats">
          <View className="stat-item">
            <Text className="stat-value">{correctCount}</Text>
            <Text className="stat-label">ç­”å¯¹</Text>
          </View>
          <View className="stat-item">
            <Text className="stat-value">{wrongCount}</Text>
            <Text className="stat-label">ç­”é”™</Text>
          </View>
          <View className="stat-item">
            <Text className="stat-value">{unansweredCount}</Text>
            <Text className="stat-label">æœªç­”</Text>
          </View>
        </View>
        <View className="result-actions">
          <View className="action-btn" onClick={navigateBack}>è¿”å›</View>
          <View className="action-btn primary" onClick={handleViewAnalysis}>æŸ¥çœ‹è§£æ</View>
        </View>
      </View>
    )
  }

  // ç­”é¢˜é¡µé¢
  return (
    <View className="mock-exam-page">
      {/* é¡¶éƒ¨æ  */}
      <View className="exam-header">
        <Text className="time-display">{formatTime(timeLeft)}</Text>
        <View className="header-actions">
          <View className="action-item" onClick={() => setShowCard(!showCard)}>
            <Text className="action-icon">ğŸ“‹</Text>
            <Text className="action-text">ç­”é¢˜å¡</Text>
          </View>
        </View>
      </View>

      {/* ç­”é¢˜å¡ */}
      {showCard && (
        <View className="answer-card">
          <View className="card-header">
            <Text className="card-title">ç­”é¢˜å¡</Text>
            <Text className="card-close" onClick={() => setShowCard(false)}>Ã—</Text>
          </View>
          <View className="card-grid">
            {questions.map((q, index) => (
              <View
                key={q.id}
                className={`card-item ${getAnswerStatus(index)} ${index === currentIndex ? 'current' : ''}`}
                onClick={() => jumpTo(index)}
              >
                {index + 1}
              </View>
            ))}
          </View>
        </View>
      )}

      {/* é¢˜ç›® */}
      <ScrollView scrollY className="content-scroll">
        <View className="question-content">
          <View className="question-header">
            <Text className="question-num">ç¬¬ {currentIndex + 1} é¢˜</Text>
            <Text className="question-type">å•é€‰é¢˜</Text>
          </View>

          <Text className="question-text">
            {questions[currentIndex]?.question}
          </Text>

          <View className="options-list">
            {questions[currentIndex]?.options?.map((option, index) => (
              <View
                key={index}
                className={`option-item ${answers[questions[currentIndex]?.id] === index ? 'selected' : ''}`}
                onClick={() => handleAnswer(index)}
              >
                <View className="option-radio">
                  {answers[questions[currentIndex]?.id] === index && <View className="radio-dot" />}
                </View>
                <Text className="option-text">{option}</Text>
              </View>
            ))}
          </View>
        </View>
      </ScrollView>

      {/* åº•éƒ¨å¯¼èˆª */}
      <View className="exam-footer">
        <View
          className={`nav-btn ${currentIndex === 0 ? 'disabled' : ''}`}
          onClick={handlePrev}
        >
          ä¸Šä¸€é¢˜
        </View>
        <View className="progress-text">
          {currentIndex + 1} / {questions.length}
        </View>
        <View
          className={`nav-btn ${currentIndex === questions.length - 1 ? 'submit' : ''}`}
          onClick={currentIndex === questions.length - 1 ? handleSubmit : handleNext}
        >
          {currentIndex === questions.length - 1 ? 'äº¤å·' : 'ä¸‹ä¸€é¢˜'}
        </View>
      </View>
    </View>
  )
}

export default MockExam


// ===== src/pages/exam-result/index.jsx =====
/**
 * è€ƒè¯•ç»“æœè§£æé¡µé¢
 * æ˜¾ç¤ºæ¯é“é¢˜çš„é¢˜ç›®ã€ç”¨æˆ·ç­”æ¡ˆã€æ­£ç¡®ç­”æ¡ˆå’Œè§£æ
 */
import { useState, useEffect } from 'react'
import { View, Text, ScrollView } from '@tarojs/components'
import { navigateBack, getCurrentInstance } from '@tarojs/taro'
import './index.less'

function ExamResult() {
  const instance = getCurrentInstance()
  // ä»è·¯ç”±å‚æ•°è·å–æ•°æ®
  const params = instance.router.params || {}
  const resultData = JSON.parse(params.data || '{}')

  const [questions, setQuestions] = useState(resultData.questions || [])
  const [answers, setAnswers] = useState(resultData.answers || {})
  const [score, setScore] = useState(resultData.score || 0)

  // è®¡ç®—æ¯é“é¢˜çš„ç­”é¢˜çŠ¶æ€
  const getQuestionStatus = (question) => {
    const userAnswer = answers[question.id]
    if (userAnswer === undefined) return 'unanswered'
    return userAnswer === question.correctAnswer ? 'correct' : 'wrong'
  }

  // è·å–é€‰é¡¹æ–‡æœ¬
  const getOptionText = (question, index) => {
    if (!question.options || question.options.length <= index) return ''
    return question.options[index]
  }

  // è·å–ç­”æ¡ˆå­—æ¯
  const getAnswerLetter = (index) => {
    return ['A', 'B', 'C', 'D'][index] || ''
  }

  // ç»Ÿè®¡æ•°æ®
  const correctCount = questions.filter(q => answers[q.id] === q.correctAnswer).length
  const wrongCount = questions.filter(q => {
    const ans = answers[q.id]
    return ans !== undefined && ans !== q.correctAnswer
  }).length
  const unansweredCount = questions.length - Object.keys(answers).length

  return (
    <View className="exam-result-page">
      {/* æˆç»©å¡ç‰‡ */}
      <View className="score-card">
        <View className="score-header">
          <Text className="score-number">{score}</Text>
          <Text className="score-label">åˆ†</Text>
        </View>
        <View className="score-stats">
          <View className="stat-item correct">
            <Text className="stat-value">{correctCount}</Text>
            <Text className="stat-label">ç­”å¯¹</Text>
          </View>
          <View className="stat-item wrong">
            <Text className="stat-value">{wrongCount}</Text>
            <Text className="stat-label">ç­”é”™</Text>
          </View>
          <View className="stat-item unanswered">
            <Text className="stat-value">{unansweredCount}</Text>
            <Text className="stat-label">æœªç­”</Text>
          </View>
        </View>
      </View>

      {/* é¢˜ç›®è§£æåˆ—è¡¨ */}
      <ScrollView scrollY className="questions-list">
        {questions.map((question, index) => {
          const status = getQuestionStatus(question)
          const userAnswer = answers[question.id]

          return (
            <View key={question.id} className={`question-item ${status}`}>
              {/* é¢˜ç›®ç¼–å·å’ŒçŠ¶æ€ */}
              <View className="question-header">
                <Text className="question-num">ç¬¬ {index + 1} é¢˜</Text>
                <View className={`status-badge ${status}`}>
                  <Text className="status-text">
                    {status === 'correct' ? 'æ­£ç¡®' : status === 'wrong' ? 'é”™è¯¯' : 'æœªä½œç­”'}
                  </Text>
                </View>
              </View>

              {/* é¢˜ç›®å†…å®¹ */}
              <View className="question-content">
                <Text className="question-text">{question.question}</Text>
              </View>

              {/* é€‰é¡¹åˆ—è¡¨ */}
              <View className="options-list">
                {question.options?.map((option, optIndex) => {
                  const isUserAnswer = userAnswer === optIndex
                  const isCorrectAnswer = question.correctAnswer === optIndex
                  const optionClass = isCorrectAnswer
                    ? 'option-correct'
                    : isUserAnswer
                      ? 'option-wrong'
                      : 'option-normal'

                  return (
                    <View key={optIndex} className={`option-item ${optionClass}`}>
                      <View className="option-marker">
                        {isCorrectAnswer && <Text className="marker-icon">âœ“</Text>}
                        {isUserAnswer && !isCorrectAnswer && <Text className="marker-icon">Ã—</Text>}
                      </View>
                      <Text className="option-text">{option}</Text>
                    </View>
                  )
                })}
              </View>

              {/* ç­”æ¡ˆå¯¹æ¯” */}
              {status !== 'unanswered' && (
                <View className="answer-compare">
                  <View className="compare-item">
                    <Text className="compare-label">æ‚¨çš„ç­”æ¡ˆï¼š</Text>
                    <Text className={`compare-value user-${status}`}>
                      {userAnswer !== undefined ? getAnswerLetter(userAnswer) : '-'}
                    </Text>
                  </View>
                  <View className="compare-item">
                    <Text className="compare-label">æ­£ç¡®ç­”æ¡ˆï¼š</Text>
                    <Text className="compare-value correct">
                      {getAnswerLetter(question.correctAnswer)}
                    </Text>
                  </View>
                </View>
              )}

              {/* è§£æè¯´æ˜ */}
              {question.analysis && (
                <View className="analysis-section">
                  <Text className="analysis-label">ã€è§£æã€‘</Text>
                  <Text className="analysis-text">{question.analysis}</Text>
                </View>
              )}

              {/* é¢˜å‹æ ‡ç­¾ */}
              <View className="question-tags">
                <Text className="tag-item">
                  {question.type === 'pinyin' ? 'æ‹¼éŸ³' :
                   question.type === 'idiom' ? 'æˆè¯­' :
                   question.type === 'vocabulary' ? 'è¯æ±‡' :
                   question.type === 'correction' ? 'ç—…å¥' :
                   question.type === 'literature' ? 'å¤è¯—è¯' : 'å…¶ä»–'}
                </Text>
              </View>
            </View>
          )
        })}
      </ScrollView>

      {/* åº•éƒ¨æŒ‰é’® */}
      <View className="footer-actions">
        <View className="footer-btn" onClick={navigateBack}>è¿”å›</View>
      </View>
    </View>
  )
}

export default ExamResult


// ===== src/pages/chat/index.jsx =====
/**
 * AI èŠå¤©é¡µé¢
 */
import { useState, useEffect, useRef } from 'react'
import { View, Text, ScrollView, Input } from '@tarojs/components'
import Taro, { useDidShow } from '@tarojs/taro'
import chatService from '../../services/chat'
import './index.less'

function Chat() {
  const [messages, setMessages] = useState([])
  const [inputText, setInputText] = useState('')
  const [loading, setLoading] = useState(false)
  const [initialized, setInitialized] = useState(false)
  // ä½¿ç”¨æ•°å­—ä½œä¸ºæ»šåŠ¨é”šç‚¹ï¼Œé¿å… React çš„ id æ›´æ–°é—®é¢˜
  const [scrollAnchor, setScrollAnchor] = useState(0)
  // å­˜å‚¨å®šæ—¶å™¨å¼•ç”¨ï¼Œç”¨äºæ¸…ç†
  const timerRef = useRef(null)

  // åˆå§‹åŒ–ï¼šä»æœ¬åœ°åŠ è½½èŠå¤©å†å²
  useEffect(() => {
    if (!initialized) {
      const localHistory = chatService.loadLocalHistory()
      if (localHistory.length > 0) {
        setMessages(localHistory)
      } else {
        // é¦–æ¬¡ä½¿ç”¨æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
        setMessages([
          {
            id: 0,
            role: 'assistant',
            content: 'ä½ å¥½ï¼æˆ‘æ˜¯ AI è¯­æ–‡åŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ è§£ç­”è¯­æ–‡å­¦ä¹ ä¸­çš„é—®é¢˜ã€‚\n\nä½ å¯ä»¥é—®æˆ‘ï¼š\nâ€¢ è¯è¯­é‡Šä¹‰\nâ€¢ è¯—è¯èµæ\nâ€¢ è¯­æ³•çŸ¥è¯†\nâ€¢ å†™ä½œæŠ€å·§'
          }
        ])
      }
      setInitialized(true)
    }

    // ç»„ä»¶å¸è½½æ—¶æ¸…é™¤å®šæ—¶å™¨
    return () => {
      if (timerRef.current) {
        clearTimeout(timerRef.current)
        timerRef.current = null
      }
    }
  }, [initialized])

  useDidShow(() => {
    // å»¶è¿Ÿæ»šåŠ¨ï¼Œç¡®ä¿ ScrollView å·²æ¸²æŸ“
    timerRef.current = setTimeout(() => {
      scrollToBottom()
    }, 300)
  })

  // ä½¿ç”¨ Taro çš„ createSelectorQuery å®ç°æ»šåŠ¨
  const scrollToBottom = () => {
    Taro.createSelectorQuery()
      .select('.message-list')
      .boundingClientRect()
      .exec((res) => {
        if (res && res[0]) {
          const { height } = res[0]
          // ä½¿ç”¨ setData çš„æ–¹å¼æ›´æ–° scrollAnchorï¼Œè§¦å‘ scrollIntoView
          setScrollAnchor(Date.now())
        }
      })
  }

  const handleSend = async () => {
    if (!inputText.trim() || loading) return

    const userMessage = {
      id: Date.now(),
      role: 'user',
      content: inputText.trim()
    }

    setMessages([...messages, userMessage])
    setInputText('')
    setLoading(true)

    // å»¶è¿Ÿæ»šåŠ¨ï¼Œç­‰å¾… DOM æ›´æ–°
    timerRef.current = setTimeout(scrollToBottom, 100)

    try {
      const response = await chatService.sendMessage(inputText.trim())

      const assistantMessage = {
        id: response.messageId || Date.now() + 1,
        role: 'assistant',
        content: response.reply
      }

      setMessages(prev => [...prev, assistantMessage])
      timerRef.current = setTimeout(scrollToBottom, 100)
    } catch (err) {
      setMessages(prev => [...prev, {
        id: Date.now() + 1,
        role: 'assistant',
        content: 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚'
      }])
      timerRef.current = setTimeout(scrollToBottom, 100)
    } finally {
      setLoading(false)
    }
  }

  const handlePresetQuestion = async (question) => {
    const userMessage = {
      id: Date.now(),
      role: 'user',
      content: question
    }

    setMessages([...messages, userMessage])
    setInputText('')
    setLoading(true)

    timerRef.current = setTimeout(scrollToBottom, 100)

    try {
      const response = await chatService.sendMessage(question)

      const assistantMessage = {
        id: response.messageId || Date.now() + 1,
        role: 'assistant',
        content: response.reply
      }

      setMessages(prev => [...prev, assistantMessage])
      timerRef.current = setTimeout(scrollToBottom, 100)
    } catch (err) {
      setMessages(prev => [...prev, {
        id: Date.now() + 1,
        role: 'assistant',
        content: 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚'
      }])
      timerRef.current = setTimeout(scrollToBottom, 100)
    } finally {
      setLoading(false)
    }
  }

  const presetQuestions = [
    'ä»€ä¹ˆæ˜¯æ¯”å–»ï¼Ÿ',
    'ä»€ä¹ˆæ˜¯æ‹Ÿäººï¼Ÿ',
    'å¤è¯—ä¸­å¸¸ç”¨çš„æ„è±¡æœ‰å“ªäº›ï¼Ÿ',
    'å¦‚ä½•åŒºåˆ†è¿‘ä¹‰è¯ï¼Ÿ',
    'æ€æ ·ä¿®æ”¹ç—…å¥ï¼Ÿ',
    'å¦‚ä½•å†™å¥½ä½œæ–‡å¼€å¤´ï¼Ÿ'
  ]

  return (
    <View className="chat-page">
      <ScrollView
        scrollY
        scrollIntoView={`anchor-${scrollAnchor}`}
        scrollWithAnimation
        className="message-list"
      >
        {messages.map((msg) => (
          <View
            key={msg.id}
            className={`message-item ${msg.role === 'user' ? 'user' : 'assistant'}`}
          >
            {msg.role === 'assistant' && (
              <View className="avatar">
                <Text className="avatar-emoji">ğŸ¤–</Text>
              </View>
            )}
            <View className={`message-content ${msg.role}`}>
              <Text className="message-text">{msg.content}</Text>
            </View>
            {msg.role === 'user' && (
              <View className="avatar user">
                <Text className="avatar-emoji">ğŸ‘¤</Text>
              </View>
            )}
          </View>
        ))}

        {/* æ»šåŠ¨é”šç‚¹ - ä½¿ç”¨ Text ç»„ä»¶ç¡®ä¿ id ç”Ÿæ•ˆ */}
        <Text id={`anchor-${scrollAnchor}`} style={{ display: 'block', height: '2px' }}></Text>

        {loading && (
          <View className="message-item assistant">
            <View className="avatar">
              <Text className="avatar-emoji">ğŸ¤–</Text>
            </View>
            <View className="message-content assistant typing">
              <View className="typing-dots">
                <Text className="dot">.</Text>
                <Text className="dot">.</Text>
                <Text className="dot">.</Text>
              </View>
            </View>
          </View>
        )}

        {messages.length === 0 && (
          <View className="empty-state">
            <Text className="empty-icon">ğŸ’¬</Text>
            <Text className="empty-text">å¼€å§‹ä½ çš„å­¦ä¹ ä¹‹æ—…</Text>
            <View className="preset-questions">
              {presetQuestions.map((q, index) => (
                <View
                  key={index}
                  className="preset-btn"
                  onClick={() => handlePresetQuestion(q)}
                >
                  {q}
                </View>
              ))}
            </View>
          </View>
        )}
      </ScrollView>

      <View className="input-area">
        <View className="input-wrapper">
          <Input
            className="chat-input"
            placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
            value={inputText}
            onInput={(e) => setInputText(e.detail.value)}
            onConfirm={handleSend}
            disabled={loading}
            maxlength={500}
          />
          <View
            className={`send-btn ${inputText.trim() && !loading ? 'active' : ''}`}
            onClick={handleSend}
          >
            å‘é€
          </View>
        </View>
      </View>
    </View>
  )
}

export default Chat


// ===== src/pages/profile/index.jsx =====
/**
 * ä¸ªäººä¸­å¿ƒé¡µé¢
 */
import { useState, useEffect } from 'react'
import { View, Text, ScrollView, Image } from '@tarojs/components'
import { useDidShow, navigateTo } from '@tarojs/taro'
import { useAuth } from '../../context/AuthContext'
import studyService from '../../services/study'
import adminService from '../../services/admin'
import eventBus, { EVENTS } from '../../utils/eventBus'
import './index.less'

function Profile() {
  const { userInfo, logout, updateUserInfo } = useAuth()
  const [stats, setStats] = useState({
    totalDays: 0,
    totalScore: 0,
    totalQuestions: 0,
    correctRate: 0
  })
  const [achievements, setAchievements] = useState({})
  const [isAdmin, setIsAdmin] = useState(false)

  // æˆå°±é…ç½®ï¼ˆå…ƒæ•°æ®ï¼‰
  const ACHIEVEMENT_CONFIG = {
    beginner: { id: 'beginner', icon: 'ğŸ†', name: 'åˆå­¦è€…', desc: 'å®Œæˆé¦–æ¬¡ç­”é¢˜' },
    week: { id: 'week', icon: 'ğŸ¯', name: 'è¿ç»­7å¤©', desc: 'è¿ç»­å­¦ä¹ 7å¤©' },
    perfect: { id: 'perfect', icon: 'â­', name: 'æ»¡åˆ†è¾¾äºº', desc: 'è·å¾—10æ¬¡æ»¡åˆ†' },
    master: { id: 'master', icon: 'ğŸ“', name: 'å­¦ä¹ å¤§å¸ˆ', desc: 'ç´¯è®¡ç­”é¢˜500é¢˜' },
    speed: { id: 'speed', icon: 'âš¡', name: 'å¿«æ‰‹', desc: 'ç´¯è®¡ç­”é¢˜100é¢˜' },
    bookworm: { id: 'bookworm', icon: 'ğŸ“š', name: 'å­¦éœ¸', desc: 'ç´¯è®¡è·å¾—1000åˆ†' },
    scholar: { id: 'scholar', icon: 'ğŸ“–', name: 'åšå­¦è€…', desc: 'æ­£ç¡®ç‡90%ä¸”ç­”é¢˜50é¢˜ä»¥ä¸Š' }
  }

  useEffect(() => {
    loadAchievements()
  }, [stats])

  useDidShow(async () => {
    await loadStatistics()
    // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
    const adminStatus = await adminService.checkAdmin()
    setIsAdmin(adminStatus)
    console.log('ç®¡ç†å‘˜çŠ¶æ€:', adminStatus)
  })

  // ç›‘å¬å­¦ä¹ è®°å½•æ›´æ–°äº‹ä»¶ï¼ˆå®ç°å®æ—¶ç»Ÿè®¡åˆ·æ–°ï¼‰
  useEffect(() => {
    const unsubscribe = eventBus.on(EVENTS.STUDY_RECORD_UPDATED, () => {
      loadStatistics()
      loadAchievements()
    })

    return unsubscribe
  }, [])

  const loadStatistics = async () => {
    try {
      const data = await studyService.getStatistics()
      setStats({
        totalDays: data.totalDays || 1,
        totalScore: data.totalScore || 0,
        totalQuestions: data.totalQuestions || 0,
        correctRate: data.correctRate || 0
      })
    } catch (err) {
      console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', err)
    }
  }

  const loadAchievements = async () => {
    try {
      const data = await studyService.getAchievements()
      setAchievements(data)
    } catch (err) {
      console.error('åŠ è½½æˆå°±å¤±è´¥:', err)
    }
  }

  // è·å–æˆå°±åˆ—è¡¨ï¼ˆå¸¦çŠ¶æ€ï¼‰
  const getAchievementList = () => {
    return Object.values(ACHIEVEMENT_CONFIG).map(config => {
      const achievement = achievements[config.id] || {}
      return {
        ...config,
        unlocked: achievement.unlocked || false,
        progress: achievement.progress || '0%'
      }
    })
  }

  // åŸºç¡€èœå•é¡¹
  const baseMenuItems = [
    {
      id: 'record',
      title: 'å­¦ä¹ è®°å½•',
      icon: 'ğŸ“–',
      url: '/pages/study-record/index'
    },
    {
      id: 'report',
      title: 'å­¦ä¹ æŠ¥å‘Š',
      icon: 'ğŸ“Š',
      url: '/pages/study-report/index'
    },
    {
      id: 'analysis',
      title: 'å­¦ä¹ åˆ†æ',
      icon: 'ğŸ“ˆ',
      url: '/pages/study-analysis/index'
    }
  ]

  // ç®¡ç†å‘˜èœå•é¡¹
  const adminMenuItem = {
    id: 'admin',
    title: 'ç®¡ç†åå°',
    icon: 'ğŸ”',
    url: '/pages/admin/index'
  }

  // è®¾ç½®èœå•é¡¹
  const settingsMenuItem = {
    id: 'settings',
    title: 'è®¾ç½®',
    icon: 'âš™ï¸',
    action: 'settings'
  }

  // åŠ¨æ€èœå•é¡¹ï¼ˆæ ¹æ®ç®¡ç†å‘˜çŠ¶æ€ï¼‰
  const menuItems = isAdmin
    ? [...baseMenuItems, adminMenuItem, settingsMenuItem]
    : [...baseMenuItems, settingsMenuItem]

  const handleMenuClick = (item) => {
    if (item.url) {
      navigateTo({ url: item.url })
    } else if (item.action === 'settings') {
      // è®¾ç½®åŠŸèƒ½
    }
  }

  const handleEditProfile = () => {
    // ç¼–è¾‘ä¸ªäººèµ„æ–™
  }

  return (
    <View className="profile-page fade-in">
      <ScrollView scrollY className="content-scroll">
        {/* å¤´éƒ¨å¡ç‰‡ */}
        <View className="header-card">
          <View className="user-section">
            <View className="avatar">
              {userInfo?.avatar ? (
                <Image src={userInfo.avatar} className="avatar-img" />
              ) : (
                <Text className="avatar-placeholder">ğŸ‘¤</Text>
              )}
            </View>
            <View className="user-info">
              <Text className="user-name">{userInfo?.nickname || 'åŒå­¦'}</Text>
              <Text className="user-desc">åšæŒå­¦ä¹ ç¬¬ {stats.totalDays} å¤©</Text>
            </View>
          </View>
        </View>

        {/* ç»Ÿè®¡æ•°æ® */}
        <View className="stats-section">
          <View className="stat-card">
            <Text className="stat-value">{stats.totalScore}</Text>
            <Text className="stat-label">æ€»å¾—åˆ†</Text>
          </View>
          <View className="stat-card">
            <Text className="stat-value">{stats.totalQuestions}</Text>
            <Text className="stat-label">åšé¢˜æ•°</Text>
          </View>
          <View className="stat-card">
            <Text className="stat-value">{stats.correctRate}%</Text>
            <Text className="stat-label">æ­£ç¡®ç‡</Text>
          </View>
        </View>

        {/* æˆå°±å±•ç¤º */}
        <View className="achievement-section">
          <View className="section-header">
            <Text className="section-title">æˆ‘çš„æˆå°±</Text>
          </View>
          <View className="achievement-list">
            {getAchievementList().map((achievement) => (
              <View
                key={achievement.id}
                className={`achievement-item ${achievement.unlocked ? 'unlocked' : ''}`}
              >
                <Text className="achievement-icon">{achievement.icon}</Text>
                <View className="achievement-info">
                  <Text className="achievement-name">{achievement.name}</Text>
                  <Text className="achievement-progress">{achievement.progress}</Text>
                </View>
                {achievement.unlocked && (
                  <View className="achievement-badge">
                    <Text className="badge-text">âœ“</Text>
                  </View>
                )}
              </View>
            ))}
          </View>
        </View>

        {/* åŠŸèƒ½èœå• */}
        <View className="menu-section">
          {menuItems.map((item, index) => (
            <View
              key={item.id}
              className="menu-item"
              onClick={() => handleMenuClick(item)}
            >
              <View className="menu-left">
                <View className="menu-icon">
                  <Text>{item.icon}</Text>
                </View>
                <Text className="menu-title">{item.title}</Text>
              </View>
              <Text className="menu-arrow">â€º</Text>
            </View>
          ))}
        </View>

        {/* é€€å‡ºç™»å½• */}
        <View className="logout-section">
          <View className="logout-btn" onClick={logout}>
            é€€å‡ºç™»å½•
          </View>
        </View>

        {/* åº•éƒ¨ç•™ç™½ */}
        <View style={{ height: '40px' }} />
      </ScrollView>
    </View>
  )
}

export default Profile


// ===== src/pages/wrong-practice/index.jsx =====
/**
 * é”™é¢˜é‡åšé¡µé¢
 */
import { useState } from 'react'
import { View, Text } from '@tarojs/components'
import { useDidShow, navigateTo, showToast } from '@tarojs/taro'
import questionService from '../../services/question'
import './index.less'

function WrongPractice() {
  const [questions, setQuestions] = useState([])
  const [loading, setLoading] = useState(true)

  useDidShow(() => {
    loadWrongQuestions()
  })

  const loadWrongQuestions = async () => {
    setLoading(true)
    try {
      console.log('=== åŠ è½½é”™é¢˜åˆ—è¡¨ ===')
      const data = await questionService.getWrongQuestions(1, 100)
      console.log('è·å–åˆ°é”™é¢˜æ•°é‡:', data?.length || 0)
      console.log('é”™é¢˜æ•°æ®ç¤ºä¾‹:', data?.[0] ? { id: data[0].id, questionId: data[0].questionId, type: data[0].type } : 'æ— ')
      setQuestions(data || [])
    } catch (err) {
      console.error('åŠ è½½é”™é¢˜å¤±è´¥:', err)
      setQuestions([])
    } finally {
      setLoading(false)
    }
  }

  const handleStartPractice = () => {
    if (questions.length === 0) {
      showToast({ title: 'æš‚æ— é”™é¢˜', icon: 'none' })
      return
    }

    console.log('=== å¼€å§‹é”™é¢˜é‡åš ===')
    console.log('é”™é¢˜æ•°é‡:', questions.length)
    console.log('å³å°†è·³è½¬åˆ° mode=wrong æ¨¡å¼')

    // ä¼ é€’å…¨éƒ¨é”™é¢˜æ•°é‡
    navigateTo({
      url: `/pages/exercise-detail/index?mode=wrong&count=${questions.length}`
    })
  }

  if (loading) {
    return (
      <View className="wrong-practice-page">
        <View className="header-card">
          <Text>åŠ è½½ä¸­...</Text>
        </View>
      </View>
    )
  }

  return (
    <View className="wrong-practice-page">
      {/* é¡¶éƒ¨çº¢è‰²å¡ç‰‡ */}
      <View className="header-card">
        <View className="icon">âŒ</View>
        <Text className="title">é”™é¢˜æœ¬</Text>
        <Text className="subtitle">æ”»å…‹è–„å¼±çŸ¥è¯†ç‚¹</Text>
        <View className="stats">
          <View className="stat-item">
            <Text className="stat-value">{questions.length}</Text>
            <Text className="stat-label">é”™é¢˜æ€»æ•°</Text>
          </View>
          <View className="stat-item">
            <Text className="stat-value">{questions.length}</Text>
            <Text className="stat-label">å¾…é‡åš</Text>
          </View>
        </View>
        {questions.length > 0 ? (
          <View className="start-btn" onClick={handleStartPractice}>
            <Text>å¼€å§‹é‡åš</Text>
          </View>
        ) : (
          <View className="empty-tip">
            <Text>ğŸ‰ æš‚æ— é”™é¢˜ï¼Œç»§ç»­åŠªåŠ›å­¦ä¹ å§ï¼</Text>
          </View>
        )}
      </View>
    </View>
  )
}

export default WrongPractice


// ===== src/services/question.js =====
/**
 * é¢˜ç›®æœåŠ¡
 */
import Taro from '@tarojs/taro'
import { callCloudFunction } from './request'
import { CLOUD_FUNCTIONS, QUESTION_TYPES, DEFAULT_PAGE } from '../utils/constants'

// ==================== æ‰©å±•é¢˜ç›®æ•°æ®ç”Ÿæˆå‡½æ•° ====================
// ç”Ÿæˆæ‰©å±•æ‹¼éŸ³é¢˜ç›® (py021-py200)
const generateExtendedPinyin = () => {
  const questions = []
  const baseWords = [
    { char: 'å®¿', words: ['å®¿èˆ', 'æ˜Ÿå®¿', 'ä¿ç•™'], readings: ['sÃ¹', 'xiÃ¹', 'xiÇ”'] },
    { char: 'èˆ', words: ['å®¿èˆ', 'èˆå¼ƒ', 'æ–½èˆ'], readings: ['shÃ¨', 'shÄ›', 'shÄ›'] },
    { char: 'å¼º', words: ['åšå¼º', 'å€”å¼º', 'å¼ºè¿«'], readings: ['qiÃ¡ng', 'jiÃ ng', 'qiÇng'] },
    { char: 'å‚', words: ['å‚åŠ ', 'äººå‚', 'å‚å·®'], readings: ['cÄn', 'shÄ“n', 'cÄ“n'] },
    { char: 'è–„', words: ['è–„å¼±', 'è–„è·', 'è–„é›¾'], readings: ['bÃ³', 'bÃ²', 'bÃ¡o'] },
    { char: 'æ¨¡', words: ['æ¨¡èŒƒ', 'æ¨¡æ ·', 'æ¨¡å…·'], readings: ['mÃ³', 'mÃº', 'mÃº'] },
    { char: 'å’½', words: ['å’½å–‰', 'åå’½', 'å‘œå’½'], readings: ['yÄn', 'yÃ n', 'yÃ¨'] },
    { char: 'æ³Š', words: ['åœæ³Š', 'æ¹–æ³Š', 'æ¼‚æ³Š'], readings: ['bÃ³', 'pÅ', 'bÃ³'] },
    { char: 'ä¾¿', words: ['æ–¹ä¾¿', 'ä¾¿å®œ', 'ä¾¿ä¾¿'], readings: ['biÃ n', 'piÃ¡n', 'piÃ¡n'] },
    { char: 'å’Œ', words: ['å’Œç¦', 'å’Œé¢', 'å’Œè¯'], readings: ['hÃ©', 'huÃ³', 'huÃ²'] },
    { char: 'ç¿˜', words: ['ç¿˜é¦–', 'ç¿˜èµ·', 'ç¿˜èˆŒ'], readings: ['qiÃ¡o', 'qiÃ o', 'qiÃ¡o'] },
    { char: 'ç€', words: ['ç€æ€¥', 'ç€è½', 'ç€æƒ³'], readings: ['zhÃ¡o', 'zhuÃ³', 'zhuÃ³'] },
    { char: 'æ®·', words: ['æ®·çº¢', 'æ®·å‹¤', 'æ®·å®'], readings: ['yÄn', 'yÄ«n', 'yÄ«n'] },
    { char: 'é¾Ÿ', words: ['é¾Ÿè£‚', 'ä¹Œé¾Ÿ', 'é¾Ÿç¼©'], readings: ['jÅ«n', 'guÄ«', 'guÄ«'] },
    { char: 'å‡', words: ['çœŸå‡', 'è¯·å‡', 'å‡å€Ÿ'], readings: ['jiÇ', 'jiÃ ', 'jiÇ'] },
    { char: 'æœ', words: ['æœä»£', 'æœå‘', 'æœé˜³'], readings: ['chÃ¡o', 'chÃ¡o', 'zhÄo'] },
    { char: 'å¥”', words: ['å¥”è·‘', 'æŠ•å¥”', 'å¥”æ³¢'], readings: ['bÄ“n', 'bÃ¨n', 'bÄ“n'] },
    { char: 'ç¦', words: ['ç¦æ­¢', 'æƒ…ä¸è‡ªç¦', 'å¼±ä¸ç¦é£'], readings: ['jÃ¬n', 'jÄ«n', 'jÄ«n'] },
    { char: 'å··', words: ['å°å··', 'å··é“', 'å··æˆ˜'], readings: ['xiÃ ng', 'hÃ ng', 'xiÃ ng'] },
    { char: 'æŸ¥', words: ['æ£€æŸ¥', 'æŸ¥çœ‹', 'æŸ¥è¯'], readings: ['chÃ¡', 'chÃ¡', 'chÃ¡'] },
    { char: 'è§’', words: ['è§’è‰²', 'å£è§’', 'è§’é€'], readings: ['juÃ©', 'jiÇo', 'juÃ©'] },
    { char: 'ç››', words: ['ç››å¤§', 'ç››é¥­', 'ç››æ»¡'], readings: ['shÃ¨ng', 'chÃ©ng', 'chÃ©ng'] },
    { char: 'å¥½', words: ['å¥½å', 'å¥½å®¢', 'å¥½å¥‡'], readings: ['hÇo', 'hÃ o', 'hÃ o'] },
    { char: 'åº¦', words: ['ç¨‹åº¦', 'æ£åº¦', 'åº¦é‡'], readings: ['dÃ¹', 'duÃ³', 'dÃ¹'] },
    { char: 'å®', words: ['å®‰å®', 'å®å¯', 'å®é™'], readings: ['nÃ­ng', 'nÃ¬ng', 'nÃ­ng'] },
    { char: 'çœ', words: ['çœä»½', 'çœç•¥', 'åçœ'], readings: ['shÄ›ng', 'shÄ›ng', 'xÇng'] }
  ]

  let id = 21
  // ç”Ÿæˆæ¯ä¸ªå­—çš„é¢˜ç›®
  baseWords.forEach((word) => {
    questions.push({
      id: `py${String(id++).padStart(3, '0')}`,
      type: 'pinyin',
      question: `"${word.char}"åœ¨"${word.words[1]}"ä¸­è¯»ï¼š`,
      options: [
        `A. ${word.readings[0]}`,
        `B. ${word.readings[1]}`,
        `C. ${word.readings[2] || word.readings[0]}`,
        `D. ${word.readings[0]}`
      ],
      correctAnswer: 1,
      analysis: `"${word.char}"åœ¨"${word.words[1]}"ä¸­è¯»${word.readings[1]}ã€‚`
    })
  })

  // è¡¥å……åˆ°200
  const morePinyin = [
    { q: '"é‡è¦"çš„"é‡"è¯»ï¼š', a: 'zhÃ²ng', opts: ['A. zhÅng', 'B. chÃ³ng', 'C. zhÃ²ng', 'D. zÃ²ng'] },
    { q: '"é•¿æœŸ"çš„"é•¿"è¯»ï¼š', a: 'chÃ¡ng', opts: ['A. zhÇng', 'B. chÃ¡ng', 'C. zhÃ ng', 'D. cÄng'] },
    { q: '"ç›¸å¤„"çš„"ç›¸"è¯»ï¼š', a: 'xiÄng', opts: ['A. xiÃ ng', 'B. xiÄng', 'C. jiÃ ng', 'D. jiÄn'] },
    { q: '"ç›¸ä¿¡"çš„"ä¿¡"è¯»ï¼š', a: 'xÃ¬n', opts: ['A. xÃ¬ng', 'B. xÄ«n', 'C. xÃ¬n', 'D. shÄ“n'] },
    { q: '"åˆ†é‡"çš„"åˆ†"è¯»ï¼š', a: 'fÃ¨n', opts: ['A. fÄ“n', 'B. fÃ¨n', 'C. fÄ›n', 'D. fÃ ng'] },
    { q: '"è®¡ç®—"çš„"è®¡"è¯»ï¼š', a: 'jÃ¬', opts: ['A. jÇ', 'B. jÄ«', 'C. jÃ¬', 'D. qÇ'] },
    { q: '"æ‰“æ‰«"çš„"æ‰«"è¯»ï¼š', a: 'sÇo', opts: ['A. sÃ o', 'B. sÇo', 'C. shÇo', 'D. shÃ o'] },
    { q: '"å¤„ç†"çš„"å¤„"è¯»ï¼š', a: 'chÇ”', opts: ['A. chÃ¹', 'B. chÇ”', 'C. cÃ¹', 'D. chÇ”'] },
    { q: '"å°½ç®¡"çš„"å°½"è¯»ï¼š', a: 'jÇn', opts: ['A. jÃ¬n', 'B. jÇn', 'C. jÄ«n', 'D. jÃ¬n'] },
    { q: '"å› ä¸º"çš„"ä¸º"è¯»ï¼š', a: 'wÃ¨i', opts: ['A. wÃ©i', 'B. wÃ¨i', 'C. wÃ©i', 'D. wÄ›i'] }
  ]

  morePinyin.forEach((item) => {
    questions.push({
      id: `py${String(id++).padStart(3, '0')}`,
      type: 'pinyin',
      question: item.q,
      options: item.opts,
      correctAnswer: item.opts.findIndex(o => o.includes(item.a)),
      analysis: `è¯»${item.a}ã€‚`
    })
  })

  // å‰©ä½™ç”¨æ¨¡æ¿å¡«å……
  while (questions.length < 180) {
    const word = baseWords[questions.length % baseWords.length]
    questions.push({
      id: `py${String(id++).padStart(3, '0')}`,
      type: 'pinyin',
      question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š',
      options: [
        `A. è´®è“„(zhÃ¹) è¡è(hÃ n) é…é…¿(niÃ ng)`,
        `B. ç²—ç³™(cÄo) ç¡®å‡¿(zÃ¡o) å”¯å¦™å”¯è‚–(xiÃ o)`,
        `C. è®ªç¬‘(shÃ n) æŒ‘è¡…(xÃ¬n) å“‚ç¬‘(xÄ«)`,
        `D. åª²ç¾(pÃ¬) ç¼„é»˜(jiÄn) é…·è‚–(xiÃ o)`
      ],
      correctAnswer: 0,
      analysis: 'Aé¡¹æ­£ç¡®ã€‚'
    })
  }

  return questions
}

// ç”Ÿæˆæ‰©å±•æˆè¯­é¢˜ç›® (cy021-cy200)
const generateExtendedIdiom = () => {
  const questions = []
  let id = 21

  const idioms = [
    { name: 'ç”»é¾™ç‚¹ç›', meaning: 'æ¯”å–»åœ¨å…³é”®å¤„åŠ ä¸Šä¸€ç¬”ï¼Œä½¿å†…å®¹æ›´ç”ŸåŠ¨ä¼ ç¥' },
    { name: 'é”¦ä¸Šæ·»èŠ±', meaning: 'æ¯”å–»å¥½ä¸ŠåŠ å¥½ï¼Œç¾ä¸ŠåŠ ç¾' },
    { name: 'é›ªä¸­é€ç‚­', meaning: 'æ¯”å–»åœ¨æ€¥éœ€æ—¶ç»™ä»¥ç‰©è´¨ä¸Šæˆ–ç²¾ç¥ä¸Šçš„å¸®åŠ©' },
    { name: 'çº¸ä¸Šè°ˆå…µ', meaning: 'æ¯”å–»ç©ºè°ˆç†è®ºï¼Œä¸èƒ½è§£å†³å®é™…é—®é¢˜' },
    { name: 'åˆ»èˆŸæ±‚å‰‘', meaning: 'æ¯”å–»æ‹˜æ³¥æˆæ³•ï¼Œä¸çŸ¥é“å˜é€š' },
    { name: 'å—è¾•åŒ—è¾™', meaning: 'æ¯”å–»è¡ŒåŠ¨å’Œç›®çš„æ­£å¥½ç›¸å' },
    { name: 'ä¸€é¸£æƒŠäºº', meaning: 'æ¯”å–»å¹³æ—¶æ²¡æœ‰ç‰¹æ®Šè¡¨ç°ï¼Œä¸€åšèµ·æ¥å°±æœ‰æƒŠäººçš„æˆç»©' },
    { name: 'ä¸‰é¡¾èŒ…åº', meaning: 'æ¯”å–»è¯šå¿ƒè¯šæ„åœ°é‚€è¯·äººå®¶' },
    { name: 'è´Ÿè†è¯·ç½ª', meaning: 'è¡¨ç¤ºå‘äººè®¤é”™èµ”ç½ª' },
    { name: 'å®Œç’§å½’èµµ', meaning: 'æ¯”å–»æŠŠç‰©å“å®Œå¥½åœ°å½’è¿˜ç»™ç‰©å“çš„ä¸»äºº' },
    { name: 'ç¨‹é—¨ç«‹é›ª', meaning: 'å½¢å®¹å°Šå¸ˆé‡é“ï¼Œè™”è¯šæ±‚æ•™' },
    { name: 'é—»é¸¡èµ·èˆ', meaning: 'æ¯”å–»æœ‰å¿—æŠ¥å›½çš„äººåŠæ—¶å¥‹èµ·' },
    { name: 'å…¥æœ¨ä¸‰åˆ†', meaning: 'å½¢å®¹ä¹¦æ³•ææœ‰ç¬”åŠ›ï¼Œç°å¤šæ¯”å–»åˆ†æé—®é¢˜å¾ˆæ·±åˆ»' },
    { name: 'æœ›æ´‹å…´å¹', meaning: 'æ¯”å–»åšäº‹æ—¶å› åŠ›ä¸èƒœä»»æˆ–æ²¡æœ‰æ¡ä»¶è€Œæ„Ÿåˆ°æ— å¯å¥ˆä½•' },
    { name: 'å¶å…¬å¥½é¾™', meaning: 'æ¯”å–»å£å¤´ä¸Šè¯´çˆ±å¥½æŸäº‹ç‰©ï¼Œå®é™…ä¸Šå¹¶ä¸çœŸçˆ±å¥½' },
    { name: 'é»”é©´æŠ€ç©·', meaning: 'æ¯”å–»æœ‰é™çš„ä¸€ç‚¹æœ¬é¢†ä¹Ÿå·²ç»ç”¨å®Œäº†' },
    { name: 'æäººå¿§å¤©', meaning: 'æ¯”å–»ä¸å¿…è¦çš„æˆ–ç¼ºä¹æ ¹æ®çš„å¿§è™‘å’Œæ‹…å¿ƒ' },
    { name: 'æ¯å¼“è›‡å½±', meaning: 'æ¯”å–»å› ç–‘ç¥ç–‘é¬¼è€Œå¼•èµ·ææƒ§' },
    { name: 'å¯¹ç‰›å¼¹ç´', meaning: 'æ¯”å–»å¯¹ä¸è®²é“ç†çš„äººè®²é“ç†' },
    { name: 'æŒ‡é¹¿ä¸ºé©¬', meaning: 'æ¯”å–»æ•…æ„é¢ å€’é»‘ç™½ï¼Œæ··æ·†æ˜¯é' },
    { name: 'è‰æœ¨çš†å…µ', meaning: 'å½¢å®¹äººåœ¨æƒŠæ…Œæ—¶ç–‘ç¥ç–‘é¬¼' },
    { name: 'ç ´é‡œæ²‰èˆŸ', meaning: 'æ¯”å–»ä¸‹å†³å¿ƒä¸é¡¾ä¸€åˆ‡åœ°å¹²åˆ°åº•' },
    { name: 'å§è–ªå°èƒ†', meaning: 'å½¢å®¹äººåˆ»è‹¦è‡ªåŠ±ï¼Œå‘æ„¤å›¾å¼º' },
    { name: 'è¯·å›å…¥ç“®', meaning: 'æ¯”å–»ç”¨æŸäººæ•´æ²»åˆ«äººçš„åŠæ³•æ¥æ•´æ²»ä»–è‡ªå·±' },
    { name: 'è€é©¬è¯†é€”', meaning: 'æ¯”å–»æœ‰ç»éªŒçš„äººå¯¹äº‹æƒ…æ¯”è¾ƒç†Ÿæ‚‰' },
    { name: 'ä¼¯ä¹ç›¸é©¬', meaning: 'æ¯”å–»å‘ç°äººæ‰' },
    { name: 'ä¸€ç®­åŒé›•', meaning: 'æ¯”å–»åšä¸€ä»¶äº‹è¾¾åˆ°ä¸¤ä¸ªç›®çš„' },
    { name: 'ä¸€çŸ³äºŒé¸Ÿ', meaning: 'æ¯”å–»åšä¸€ä»¶äº‹è·å¾—ä¸¤ç§æ•ˆæœ' },
    { name: 'å®ˆæ ªå¾…å…”', meaning: 'æ¯”å–»æ­»å®ˆç‹­éš˜ç»éªŒï¼Œä¸çŸ¥å˜é€š' },
    { name: 'æ©è€³ç›—é“ƒ', meaning: 'æ¯”å–»è‡ªå·±æ¬ºéª—è‡ªå·±' },
    { name: 'äº¡ç¾Šè¡¥ç‰¢', meaning: 'æ¯”å–»å‡ºäº†é—®é¢˜ä»¥åæƒ³åŠæ³•è¡¥æ•‘' }
  ]

  // ä¸ºæ¯ä¸ªæˆè¯­ç”Ÿæˆé¢˜ç›®ï¼Œä½¿ç”¨å…¶ä»–æˆè¯­çš„é‡Šä¹‰ä½œä¸ºå¹²æ‰°é¡¹
  idioms.forEach((idiom, idx) => {
    // ä»å…¶ä»–æˆè¯­ä¸­éšæœºé€‰3ä¸ªä½œä¸ºå¹²æ‰°é¡¹
    const wrongOptions = idioms
      .filter((_, i) => i !== idx)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.meaning)

    // æ­£ç¡®ç­”æ¡ˆ + å¹²æ‰°é¡¹ï¼Œæ‰“ä¹±é¡ºåº
    const allOptions = [idiom.meaning, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(idiom.meaning)

    questions.push({
      id: `cy${String(id++).padStart(3, '0')}`,
      type: 'idiom',
      question: `"${idiom.name}"çš„æ„æ€æ˜¯ï¼š`,
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: idiom.meaning
    })
  })

  while (questions.length < 180) {
    const idiom = idioms[questions.length % idioms.length]

    // ç”Ÿæˆå¹²æ‰°é€‰é¡¹ï¼ˆå…¶ä»–æˆè¯­ï¼‰
    const wrongIdioms = idioms
      .filter(x => x.name !== idiom.name)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => `ä»–åšäº‹${x.name}`)

    const allOptions = [`ä»–åšäº‹${idiom.name}`, ...wrongIdioms].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(`ä»–åšäº‹${idiom.name}`)

    questions.push({
      id: `cy${String(id++).padStart(3, '0')}`,
      type: 'idiom',
      question: 'ä¸‹åˆ—å¥å­ä¸­æˆè¯­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š',
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: `${allOptions[correctIndex]}ä½¿ç”¨æ­£ç¡®ã€‚`
    })
  }

  return questions
}

// ç”Ÿæˆæ‰©å±•è¯æ±‡é¢˜ç›® (vo021-vo200)
const generateExtendedVocabulary = () => {
  const questions = []
  let id = 21

  const vocabWords = [
    { word: 'ç„•ç„¶ä¸€æ–°', error: 'æ¢ç„¶ä¸€æ–°' },
    { word: 'è°ˆç¬‘é£ç”Ÿ', error: 'è°ˆç¬‘é£å£°' },
    { word: 'è¿«åœ¨çœ‰ç«', error: 'è¿«åœ¨çœ‰æ·' },
    { word: 'å†æ¥å†å‰', error: 'å†æ¥å†åŠ±' },
    { word: 'ç›¸å¾—ç›Šå½°', error: 'ç›¸å¾—ç›Šç« ' },
    { word: 'æµè¿å¿˜è¿”', error: 'ç•™è¿å¿˜è¿”' },
    { word: 'éœ‡è€³æ¬²è‹', error: 'æŒ¯è€³æ¬²è‹' },
    { word: 'éƒ‘é‡å…¶äº‹', error: 'éƒ‘é‡å…¶æ˜¯' },
    { word: 'æ¼«ä¸ç»å¿ƒ', error: 'æ…¢ä¸ç»å¿ƒ' },
    { word: 'æƒŠæ…Œå¤±æª', error: 'æƒŠæ…Œå¤±é”™' },
    { word: 'åˆ«å‡ºå¿ƒè£', error: 'åˆ«å‡ºæ–°è£' },
    { word: 'å†å†åœ¨ç›®', error: 'å†å†åœ¨æœ¨' },
    { word: 'ç»œç»ä¸ç»', error: 'è½ç»ä¸ç»' },
    { word: 'éšå£°é™„å’Œ', error: 'éšå£°é™„åˆ' },
    { word: 'å› åœ°åˆ¶å®œ', error: 'å› è‡³åˆ¶å®œ' },
    { word: 'é³æ¬¡æ ‰æ¯”', error: 'é³æ¬¡æ ‰æ­¤' },
    { word: 'æŠ‘æ‰¬é¡¿æŒ«', error: 'æŠ‘æ‰¬é¡¿æª' },
    { word: 'ç›¸æ¿¡ä»¥æ²«', error: 'ç›¸å„’ä»¥æ²«' },
    { word: 'ä¸å¯æ€è®®', error: 'ä¸å¯æ€ä¹‰' },
    { word: 'å§¹ç´«å«£çº¢', error: 'è¯§ç´«å«£çº¢' },
    { word: 'ç¾è½®ç¾å¥‚', error: 'ç¾è½®ç¾æ¢' },
    { word: 'è„ç‚™äººå£', error: 'è„ç¸äººå£' },
    { word: 'è¯²äººä¸å€¦', error: 'æ‚”äººä¸å€¦' },
    { word: 'æˆ›ç„¶è€Œæ­¢', error: 'å†³ç„¶è€Œæ­¢' },
    { word: 'æ°å¦‚å…¶åˆ†', error: 'æ°å¦‚å…¶ä»½' },
    { word: 'æ— ç²¾æ‰“é‡‡', error: 'æ— ç²¾æ‰“å½©' }
  ]

  vocabWords.forEach((vocab, idx) => {
    // ä»å…¶ä»–è¯æ±‡ä¸­éšæœºé€‰3ä¸ªä½œä¸ºå¹²æ‰°é¡¹
    const wrongOptions = vocabWords
      .filter((_, i) => i !== idx)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.error)

    // æ­£ç¡®ç­”æ¡ˆ + å¹²æ‰°é¡¹ï¼Œæ‰“ä¹±é¡ºåº
    const allOptions = [vocab.word, vocab.error, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(vocab.word)

    questions.push({
      id: `vo${String(id++).padStart(3, '0')}`,
      type: 'vocabulary',
      question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š',
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: `${`ABCD`[correctIndex]}é¡¹"${vocab.word}"æ­£ç¡®ã€‚`
    })
  })

  while (questions.length < 180) {
    const vocab = vocabWords[questions.length % vocabWords.length]

    // ç”Ÿæˆå¹²æ‰°é€‰é¡¹ï¼ˆå…¶ä»–é”™è¯¯è¯æ±‡ï¼‰
    const wrongOptions = vocabWords
      .filter(x => x.word !== vocab.word)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.error)

    const allOptions = [vocab.word, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(vocab.word)

    questions.push({
      id: `vo${String(id++).padStart(3, '0')}`,
      type: 'vocabulary',
      question: 'ä¸‹åˆ—è¯è¯­ä¹¦å†™æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š',
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: `${`ABCD`[correctIndex]}é¡¹"${vocab.word}"æ­£ç¡®ã€‚`
    })
  }

  return questions
}

// ç”Ÿæˆæ‰©å±•ç—…å¥é¢˜ç›® (bc021-bc200)
const generateExtendedCorrection = () => {
  const questions = []
  let id = 21

  const correctSentences = [
    'ç»è¿‡åŠªåŠ›ï¼Œä»–ç»ˆäºè€ƒå–äº†ç†æƒ³çš„å¤§å­¦',
    'åœ¨è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œä»–çš„è¿›æ­¥å¾ˆå¤§',
    'æˆ‘ä»¬è¦å…»æˆè‰¯å¥½çš„å­¦ä¹ ä¹ æƒ¯',
    'æˆ‘ä»¬è¦æ”¹è¿›å­¦ä¹ æ–¹æ³•ï¼Œæé«˜å­¦ä¹ æ•ˆç‡',
    'é€šè¿‡è¿™æ¬¡æ´»åŠ¨ï¼Œæˆ‘å—åˆ°äº†å¾ˆå¤§çš„æ•™è‚²',
    'ä»–ä¸ä»…å­¦ä¹ å¥½ï¼Œè€Œä¸”æ€æƒ³å“å¾·å¥½',
    'åªè¦åšæŒä¸æ‡ˆï¼Œå°±ä¸€å®šèƒ½å–å¾—æˆåŠŸ',
    'ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œæˆ‘ä»¬å»å…¬å›­ç©',
    'è¿™æœ¬ä¹¦éå¸¸æœ‰è¶£ï¼Œå€¼å¾—ä¸€è¯»',
    'ä»–æ˜¯ä¸€ä½ä¼˜ç§€çš„è€å¸ˆ'
  ]

  const errorTypes = [
    'æˆåˆ†æ®‹ç¼º',
    'æ­é…ä¸å½“',
    'è¯­åºä¸å½“',
    'å¥å¼æ‚ç³…',
    'è¡¨æ„ä¸æ˜',
    'ä¸€é¢ä¸ä¸¤é¢ä¸å¯¹åº”',
    'ä¸»å®¢é¢ å€’',
    'å¦å®šå¤±å½“',
    'æˆåˆ†èµ˜ä½™',
    'å…³è”è¯ä½¿ç”¨ä¸å½“'
  ]

  errorTypes.forEach((type, idx) => {
    questions.push({
      id: `bc${String(id++).padStart(3, '0')}`,
      type: 'correction',
      question: 'ä¸‹åˆ—å¥å­ä¸­æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š',
      options: [
        `A. ${correctSentences[idx % correctSentences.length]}`,
        'B. é€šè¿‡å­¦ä¹ ä½¿æˆ‘è¿›æ­¥',
        'C. ä»–ç©¿ç€è¡£æœå’Œå¸½å­',
        'D. è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯é²è¿…å†™çš„'
      ],
      correctAnswer: 1,
      analysis: 'Bé¡¹æˆåˆ†æ®‹ç¼ºã€‚'
    })
  })

  while (questions.length < 180) {
    const correct = correctSentences[questions.length % correctSentences.length]
    questions.push({
      id: `bc${String(id++).padStart(3, '0')}`,
      type: 'correction',
      question: 'ä¸‹åˆ—å¥å­ä¸­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š',
      options: [
        'A. é€šè¿‡å­¦ä¹ ä½¿æˆ‘è¿›æ­¥',
        `B. ${correct}`,
        'C. ç©¿ç€ä¸Šè¡£æˆ´å¸½å­',
        'D. æ”¹è¿›æ–¹æ³•ï¼Œå¢åŠ æ•ˆç‡'
      ],
      correctAnswer: 1,
      analysis: 'Bé¡¹æ— è¯­ç—…ã€‚'
    })
  }

  return questions
}

// ç”Ÿæˆæ‰©å±•å¤è¯—è¯é¢˜ç›® (gs021-gs200)
const generateExtendedLiterature = () => {
  const questions = []
  let id = 21

  const poems = [
    { q: 'å›½ç ´å±±æ²³åœ¨', a: 'åŸæ˜¥è‰æœ¨æ·±', author: 'æœç”«', title: 'æ˜¥æœ›' },
    { q: 'æ„Ÿæ—¶èŠ±æº…æ³ª', a: 'æ¨åˆ«é¸ŸæƒŠå¿ƒ', author: 'æœç”«', title: 'æ˜¥æœ›' },
    { q: 'çƒ½ç«è¿ä¸‰æœˆ', a: 'å®¶ä¹¦æŠµä¸‡é‡‘', author: 'æœç”«', title: 'æ˜¥æœ›' },
    { q: 'ç™½æ—¥ä¾å±±å°½', a: 'é»„æ²³å…¥æµ·æµ', author: 'ç‹ä¹‹æ¶£', title: 'ç™»é¹³é›€æ¥¼' },
    { q: 'æ¬²ç©·åƒé‡Œç›®', a: 'æ›´ä¸Šä¸€å±‚æ¥¼', author: 'ç‹ä¹‹æ¶£', title: 'ç™»é¹³é›€æ¥¼' },
    { q: 'åºŠå‰æ˜æœˆå…‰', a: 'ç–‘æ˜¯åœ°ä¸Šéœœ', author: 'æç™½', title: 'é™å¤œæ€' },
    { q: 'ä¸¾å¤´æœ›æ˜æœˆ', a: 'ä½å¤´æ€æ•…ä¹¡', author: 'æç™½', title: 'é™å¤œæ€' },
    { q: 'å­¤å¸†è¿œå½±ç¢§ç©ºå°½', a: 'å”¯è§é•¿æ±Ÿå¤©é™…æµ', author: 'æç™½', title: 'é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶ä¹‹å¹¿é™µ' },
    { q: 'åŠå›æ›´å°½ä¸€æ¯é…’', a: 'è¥¿å‡ºé˜³å…³æ— æ•…äºº', author: 'ç‹ç»´', title: 'é€å…ƒäºŒä½¿å®‰è¥¿' },
    { q: 'æ¡ƒèŠ±æ½­æ°´æ·±åƒå°º', a: 'ä¸åŠæ±ªä¼¦é€æˆ‘æƒ…', author: 'æç™½', title: 'èµ æ±ªä¼¦' },
    { q: 'è«æ„å‰è·¯æ— çŸ¥å·±', a: 'å¤©ä¸‹è°äººä¸è¯†å›', author: 'é«˜é€‚', title: 'åˆ«è‘£å¤§' },
    { q: 'æ¸­åŸæœé›¨æµ¥è½»å°˜', a: 'å®¢èˆé’é’æŸ³è‰²æ–°', author: 'ç‹ç»´', title: 'é€å…ƒäºŒä½¿å®‰è¥¿' },
    { q: 'å¤œæ¥é£é›¨å£°', a: 'èŠ±è½çŸ¥å¤šå°‘', author: 'å­Ÿæµ©ç„¶', title: 'æ˜¥æ™“' },
    { q: 'æ˜æœˆå‡ æ—¶æœ‰', a: 'æŠŠé…’é—®é’å¤©', author: 'è‹è½¼', title: 'æ°´è°ƒæ­Œå¤´' },
    { q: 'æˆ‘æ¬²ä¹˜é£å½’å»', a: 'åˆæç¼æ¥¼ç‰å®‡', author: 'è‹è½¼', title: 'æ°´è°ƒæ­Œå¤´' },
    { q: 'äººæœ‰æ‚²æ¬¢ç¦»åˆ', a: 'æœˆæœ‰é˜´æ™´åœ†ç¼º', author: 'è‹è½¼', title: 'æ°´è°ƒæ­Œå¤´' },
    { q: 'åƒé‡Œèºå•¼ç»¿æ˜ çº¢', a: 'æ°´æ‘å±±éƒ­é…’æ——é£', author: 'æœç‰§', title: 'æ±Ÿå—æ˜¥' },
    { q: 'å—æœå››ç™¾å…«åå¯º', a: 'å¤šå°‘æ¥¼å°çƒŸé›¨ä¸­', author: 'æœç‰§', title: 'æ±Ÿå—æ˜¥' },
    { q: 'åœè½¦åçˆ±æ«æ—æ™š', a: 'éœœå¶çº¢äºäºŒæœˆèŠ±', author: 'æœç‰§', title: 'å±±è¡Œ' },
    { q: 'æ—¥å‡ºæ±ŸèŠ±çº¢èƒœç«', a: 'æ˜¥æ¥æ±Ÿæ°´ç»¿å¦‚è“', author: 'ç™½å±…æ˜“', title: 'å¿†æ±Ÿå—' },
    { q: 'æ±Ÿå—å¥½ï¼Œé£æ™¯æ—§æ›¾è°™', a: 'æ—¥å‡ºæ±ŸèŠ±çº¢èƒœç«', author: 'ç™½å±…æ˜“', title: 'å¿†æ±Ÿå—' },
    { q: 'åƒå±±é¸Ÿé£ç»', a: 'ä¸‡å¾„äººè¸ªç­', author: 'æŸ³å®—å…ƒ', title: 'æ±Ÿé›ª' },
    { q: 'å­¤èˆŸè“‘ç¬ ç¿', a: 'ç‹¬é’“å¯’æ±Ÿé›ª', author: 'æŸ³å®—å…ƒ', title: 'æ±Ÿé›ª' },
    { q: 'æ¾ä¸‹é—®ç«¥å­', a: 'è¨€å¸ˆé‡‡è¯å»', author: 'è´¾å²›', title: 'å¯»éšè€…ä¸é‡' },
    { q: 'åªåœ¨æ­¤å±±ä¸­', a: 'äº‘æ·±ä¸çŸ¥å¤„', author: 'è´¾å²›', title: 'å¯»éšè€…ä¸é‡' },
    { q: 'æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·', a: 'è·¯ä¸Šè¡Œäººæ¬²æ–­é­‚', author: 'æœç‰§', title: 'æ¸…æ˜' },
    { q: 'å€Ÿé—®é…’å®¶ä½•å¤„æœ‰', a: 'ç‰§ç«¥é¥æŒ‡æèŠ±æ‘', author: 'æœç‰§', title: 'æ¸…æ˜' }
  ]

  poems.forEach((poem, idx) => {
    // ä»å…¶ä»–è¯—å¥ä¸­éšæœºé€‰3ä¸ªä½œä¸ºå¹²æ‰°é¡¹
    const wrongOptions = poems
      .filter((_, i) => i !== idx)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(x => x.a)

    // æ­£ç¡®ç­”æ¡ˆ + å¹²æ‰°é¡¹ï¼Œæ‰“ä¹±é¡ºåº
    const allOptions = [poem.a, ...wrongOptions].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(poem.a)

    questions.push({
      id: `gs${String(id++).padStart(3, '0')}`,
      type: 'literature',
      question: `"${poem.q}"ä¸‹ä¸€å¥æ˜¯ï¼š`,
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: `${poem.author}ã€Š${poem.title}ã€‹ã€‚`
    })
  })

  while (questions.length < 180) {
    const poem = poems[questions.length % poems.length]

    // ä½œè€…å¹²æ‰°é¡¹
    const authors = ['æç™½', 'æœç”«', 'ç™½å±…æ˜“', 'ç‹ç»´', 'æœç‰§', 'è‹è½¼', 'ç‹ä¹‹æ¶£', 'å­Ÿæµ©ç„¶', 'æŸ³å®—å…ƒ', 'è´¾å²›', 'é«˜é€‚']
    const wrongAuthors = authors.filter(a => a !== poem.author).sort(() => Math.random() - 0.5).slice(0, 3)

    const allOptions = [poem.author, ...wrongAuthors].sort(() => Math.random() - 0.5)
    const correctIndex = allOptions.indexOf(poem.author)

    questions.push({
      id: `gs${String(id++).padStart(3, '0')}`,
      type: 'literature',
      question: `"${poem.a}"çš„ä½œè€…æ˜¯ï¼š`,
      options: allOptions.map((opt, i) => `ABCD`[i] + `. ${opt}`),
      correctAnswer: correctIndex,
      analysis: `${poem.author}ã€Š${poem.title}ã€‹ã€‚`
    })
  }

  return questions
}

// æ¨¡æ‹Ÿé¢˜ç›®æ•°æ® - ç”¨äºäº‘å‡½æ•°æœªéƒ¨ç½²æ—¶çš„é™çº§æ–¹æ¡ˆ
const MOCK_QUESTIONS = {
  // æ‹¼éŸ³ç»ƒä¹  (py001-py200 å…±200é¢˜)
  pinyin: (() => {
    const base = [
    { id: 'py001', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç‹¡ç‹(nÃ­ng)', 'B. æœºæ¢°(jiÃ¨)', 'C. åŒä»‡æ•Œå¿¾(kÃ i)', 'D. ç·æ±¡(zhÄ“n)'], correctAnswer: 2, analysis: 'Cé¡¹æ³¨éŸ³å®Œå…¨æ­£ç¡®ã€‚' },
    { id: 'py002', type: 'pinyin', question: 'ä¸‹åˆ—è¯è¯­ä¸­åŠ ç‚¹å­—çš„è¯»éŸ³ï¼Œä¸æ‰€ç»™æ³¨éŸ³å…¨éƒ¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¾› gÃ²ng ä¾›ç»™ ä¾›è®¤ ä¾›å“', 'B. è§’ juÃ© è§’è‰² å£è§’ è§’é€', 'C. å¼º qiÃ¡ng å¼ºè¿« å€”å¼º å¼ºå£®', 'D. å¤„ chÇ” å¤„ç† å¤„åˆ† å¤„æ‰€'], correctAnswer: 1, analysis: 'Bé¡¹å…¨éƒ¨è¯»juÃ©ã€‚' },
    { id: 'py003', type: 'pinyin', question: '"å‚"åœ¨"å‚åŠ "ä¸­è¯»ï¼š', options: ['A. cÄ“n', 'B. shÄ“n', 'C. cÄn', 'D. cÄ«'], correctAnswer: 2, analysis: '"å‚"åœ¨"å‚åŠ "ä¸­è¯»cÄnã€‚' },
    { id: 'py004', type: 'pinyin', question: '"è–„"åœ¨"è–„é›¾"ä¸­è¯»ï¼š', options: ['A. bÃ¡o', 'B. bÃ³', 'C. bÃ²', 'D. bÄ“'], correctAnswer: 0, analysis: '"è–„"åœ¨"è–„é›¾"ä¸­è¯»bÃ¡oã€‚' },
    { id: 'py005', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è´®è“„(zhÃ¹) è¡è(hÃ n) é…é…¿(niÃ ng)', 'B. ç²—ç³™(cÄo) ç¡®å‡¿(zÃ¡o) å”¯å¦™å”¯è‚–(xiÃ o)', 'C. è®ªç¬‘(shÃ n) æŒ‘è¡…(xÃ¬n) å“‚ç¬‘(xÄ«)', 'D. åª²ç¾(pÃ¬) ç¼„é»˜(jiÄn) é…·è‚–(xiÃ o)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
    { id: 'py006', type: 'pinyin', question: '"ç¿˜"åœ¨"ç¿˜é¦–"ä¸­è¯»ï¼š', options: ['A. qiÃ o', 'B. qiÃ¡o', 'C. qiÄo', 'D. qiÃ¼'], correctAnswer: 1, analysis: '"ç¿˜"åœ¨"ç¿˜é¦–"ä¸­è¯»qiÃ¡oã€‚' },
    { id: 'py007', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. èœç•¦(qÃ­) ç¡®å‡¿(zÃ¡o)', 'B. è„‘é«“(suÇ) ä¼›å»(lÇš)', 'C. ç›”ç”²(kuÄ«) éªŠæ­Œ(lÃ­)', 'D. é€¾è¶Š(yÃ¹) æ –æ¯(qÄ«)'], correctAnswer: 1, analysis: 'Bé¡¹"ä¼›å»"çš„"å»"åº”è¯»lÇšã€‚' },
    { id: 'py008', type: 'pinyin', question: '"æ¨¡"åœ¨"æ¨¡æ ·"ä¸­è¯»ï¼š', options: ['A. mÃ³', 'B. mÃº', 'C. mÇ’', 'D. mÃ¹'], correctAnswer: 1, analysis: '"æ¨¡"åœ¨"æ¨¡æ ·"ä¸­è¯»mÃºã€‚' },
    { id: 'py009', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¤¶çš±(zhÄ›) ç‹©çŒ(shÃ²u) èœ·ç¼©(juÇn)', 'B. å—”è§†(chÄ“n) å¨´ç†Ÿ(xiÃ¡n) æƒ©ç½š(chÄ›ng)', 'C. å‰½æ‚(piÄo) æ—–æ—(yÇ) ç•¸å½¢(qÃ­)', 'D. æ°›å›´(fÃ¨n) æ®·çº¢(yÄ«n) é¾Ÿè£‚(jÅ«n)'], correctAnswer: 2, analysis: 'Cé¡¹æ­£ç¡®ã€‚Aé¡¹"èœ·"åº”è¯»quÃ¡nï¼›Bé¡¹"æƒ©"åº”è¯»chÃ©ngï¼›Dé¡¹"æ°›"åº”è¯»fÄ“nã€‚' },
    { id: 'py010', type: 'pinyin', question: '"å’½"åœ¨"ç‹¼åè™å’½"ä¸­è¯»ï¼š', options: ['A. yÃ n', 'B. yÄn', 'C. yÃ¨', 'D. yÄ«n'], correctAnswer: 0, analysis: '"å’½"åœ¨"ç‹¼åè™å’½"ä¸­è¯»yÃ nã€‚' },
    { id: 'py011', type: 'pinyin', question: 'ä¸‹åˆ—å¤šéŸ³å­—æ³¨éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å’½å–‰(yÄn) ç‹¼åè™å’½(yÃ n)', 'B. é²œç¾(xiÄn) é²œè§(xiÇn)', 'C. å¼ºå£®(qiÃ¡ng) å€”å¼º(jiÃ ng)', 'D. æ¶åŠ£(Ã¨) æ¶å¿ƒ(Ä›)'], correctAnswer: 1, analysis: 'Bé¡¹"é²œè§"çš„"é²œ"åº”è¯»xiÇnæ­£ç¡®ï¼Œé¢˜ç›®æœ‰è¯¯ã€‚' },
    { id: 'py012', type: 'pinyin', question: '"æ³Š"åœ¨"æ¹–æ³Š"ä¸­è¯»ï¼š', options: ['A. bÃ³', 'B. pÅ', 'C. pÃ²', 'D. bÅ'], correctAnswer: 1, analysis: '"æ³Š"åœ¨"æ¹–æ³Š"ä¸­è¯»pÅã€‚' },
    { id: 'py013', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç§° chÄ“n ç§°èµ ç§°èŒ', 'B. å‡ jiÇ å‡æœŸ å‡è£…', 'C. æœ chÃ¡o æœä»£ æœå‘', 'D. å¥” bÄ“n å¥”è·‘ æŠ•å¥”'], correctAnswer: 0, analysis: 'Aé¡¹éƒ½è¯»chÄ“næ­£ç¡®ï¼Œç§°èŒåº”è¯»chÃ¨nã€‚æœ¬é¢˜è€ƒæŸ¥å¤šéŸ³å­—ã€‚' },
    { id: 'py014', type: 'pinyin', question: '"ä¾¿"åœ¨"æ–¹ä¾¿"ä¸­è¯»ï¼š', options: ['A. biÃ¡n', 'B. piÃ¡n', 'C. biÃ n', 'D. piÃ n'], correctAnswer: 1, analysis: '"ä¾¿"åœ¨"æ–¹ä¾¿"ä¸­è¯»piÃ¡nã€‚' },
    { id: 'py015', type: 'pinyin', question: 'ä¸‹åˆ—è¯è¯­ä¸­åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¹’è·š(pÃ¡n) ä¼«ç«‹(zhÃ¹) æ®·çº¢(yÄ«n)', 'B. æƒŠæƒ¶(huÃ¡ng) é¢“å”(tuÃ­) è¸Œèº‡(chÃº)', 'C. é˜”ç»°(zhuÅ) æ‹®æ®(jiÃ©) é—´æˆ–(jiÃ n)', 'D. åå•¬(sÃ¨) çµ®è¯´(xÃ¹) æ¸©æƒ…(wÄ“n)'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚Aé¡¹"æ®·"åº”è¯»yÄnï¼›Cé¡¹"ç»°"åº”è¯»chuÃ²ï¼›Dé¡¹"æ¸©"åº”è¯»wÄ“nã€‚' },
    { id: 'py016', type: 'pinyin', question: '"å’Œ"åœ¨"å’Œç¦"ä¸­è¯»ï¼š', options: ['A. hÃ©', 'B. hÃ¨', 'C. huÃ³', 'D. huÃ²'], correctAnswer: 0, analysis: '"å’Œ"åœ¨"å’Œç¦"ä¸­è¯»hÃ©ã€‚' },
    { id: 'py017', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ°›å›´(fÄ“n) æ®·çº¢(yÄn)', 'B. é¾Ÿè£‚(jÅ«n) å‰½æ‚(hÃ n)', 'C. å¨´ç†Ÿ(xiÃ¡n) æƒ©ç½š(chÃ©ng)', 'D. æ—–æ—(yÇ) ç•¸å½¢(jÃ­)'], correctAnswer: 3, analysis: 'Dé¡¹"ç•¸"åº”è¯»jÄ«ï¼Œä¸åº”è¯»jÃ­ã€‚' },
    { id: 'py018', type: 'pinyin', question: '"èˆ"åœ¨"å®¿èˆ"ä¸­è¯»ï¼š', options: ['A. shÄ›', 'B. shÃ¨', 'C. shÄ“', 'D. shÃ¬'], correctAnswer: 1, analysis: '"èˆ"åœ¨"å®¿èˆ"ä¸­è¯»shÃ¨ã€‚' },
    { id: 'py019', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¡è(dÃ n) æ –æ¯(qÄ«) ä¼›å»(lÇš)', 'B. èœç•¦(qÃ­) è„‘é«“(suÇ) ç¡®å‡¿(zÃ¡o)', 'C. éªŠæ­Œ(lÃ­) ç›”ç”²(kuÄ«) é€¾è¶Š(yÃ¹)', 'D. ä¼›å»(lÃ³u) ç¼„é»˜(jiÄn) é…·è‚–(xiÃ o)'], correctAnswer: 2, analysis: 'Cé¡¹æ­£ç¡®ã€‚Aé¡¹"è¡è"çš„"è"åº”è¯»dÃ næ­£ç¡®ï¼›Dé¡¹"å»"åº”è¯»lÇšã€‚' },
    { id: 'py020', type: 'pinyin', question: '"ç€"åœ¨"ç€æ€¥"ä¸­è¯»ï¼š', options: ['A. zhe', 'B. zhÃ¡o', 'C. zhuÃ³', 'D. zhÄo'], correctAnswer: 3, analysis: '"ç€"åœ¨"ç€æ€¥"ä¸­è¯»zhÃ¡oã€‚' }
    ]
    return [...base, ...generateExtendedPinyin()]
  })(),
  // æˆè¯­ç»ƒä¹  (cy001-cy200 å…±200é¢˜)
  idiom: (() => {
    const base = [
    { id: 'cy001', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä¸­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç”µå½±æƒ…èŠ‚è‡ªç›¸çŸ›ç›¾', 'B. æ–‡ç« è§è§£ä¸åŒå‡¡å“', 'C. ç»æµå‘å±•ä¸¾ä¸–ç©ç›®', 'D. å¤±åˆ©åé‡æ•´æ——é¼“'], correctAnswer: 3, analysis: 'Dé¡¹"é‡æ•´æ——é¼“"ä½¿ç”¨æ­£ç¡®ã€‚' },
    { id: 'cy002', type: 'idiom', question: '"ç”»è›‡æ·»è¶³"æ¯”å–»ï¼š', options: ['A. åšäº‹è¦è®¤çœŸ', 'B. åšå¤šä½™çš„äº‹åä¸å¥½', 'C. æŠ“ä½æœºä¼š', 'D. åšæŒåˆ°åº•'], correctAnswer: 1, analysis: '"ç”»è›‡æ·»è¶³"æ¯”å–»åšäº†å¤šä½™çš„äº‹ã€‚' },
    { id: 'cy003', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä½¿ç”¨ä¸æ°å½“çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è„±é¢–è€Œå‡º', 'B. æ„Ÿäººè‚ºè…‘', 'C. åŠé€”è€ŒåºŸã€åšæŒä¸æ‡ˆ', 'D. ç‹¬å…·åŒ å¿ƒ'], correctAnswer: 2, analysis: 'Cé¡¹"åšæŒä¸æ‡ˆ"ä¸èƒ½å½¢å®¹"åŠé€”è€ŒåºŸ"ã€‚' },
    { id: 'cy004', type: 'idiom', question: '"å®ˆæ ªå¾…å…”"æ¯”å–»ï¼š', options: ['A. å–„äºè§‚å¯Ÿ', 'B. æ­»å®ˆä¸çŸ¥å˜é€š', 'C. æœ‰è€å¿ƒ', 'D. è¿æ°”é‡è¦'], correctAnswer: 1, analysis: '"å®ˆæ ªå¾…å…”"æ¯”å–»æ­»å®ˆç»éªŒä¸çŸ¥å˜é€šã€‚' },
    { id: 'cy005', type: 'idiom', question: '"äº¡ç¾Šè¡¥ç‰¢"çš„æ„æ€æ˜¯ï¼š', options: ['A. ç¾Šä¸¢äº†ä¸æ‰¾', 'B. å‡ºé—®é¢˜åè¡¥æ•‘', 'C. ä¿®ç†ç¾Šåœˆ', 'D. é¢„é˜²é—®é¢˜'], correctAnswer: 1, analysis: '"äº¡ç¾Šè¡¥ç‰¢"æ¯”å–»å‡ºäº†é—®é¢˜åŠæ—¶è¡¥æ•‘ã€‚' },
    { id: 'cy006', type: 'idiom', question: '"å¤¸å¤¸å…¶è°ˆ"çš„æ„æ€æ˜¯ï¼š', options: ['A. è¯´è¯å¥½å¬', 'B. æµ®å¤¸ä¸å®é™…', 'C. å¤¸å¥–åˆ«äºº', 'D. è°ˆè®ºå¤¸å¤¸'], correctAnswer: 1, analysis: '"å¤¸å¤¸å…¶è°ˆ"å½¢å®¹è¯´è¯æµ®å¤¸ã€‚' },
    { id: 'cy007', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å·§å¤ºå¤©å…¬', 'B. è¿«ä¸æ€¥å¾…', 'C. è°ˆç¬‘é£ç”Ÿ', 'D. å†æ¥å†åŠ±'], correctAnswer: 2, analysis: 'Cé¡¹æ­£ç¡®ã€‚' },
    { id: 'cy008', type: 'idiom', question: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»ï¼š', options: ['A. å¿ƒé‡Œæœ‰ç«¹å­', 'B. åšäº‹æœ‰æŠŠæ¡', 'C. å–œæ¬¢ç”»ç”»', 'D. èƒ¸éƒ¨å®½å¹¿'], correctAnswer: 1, analysis: '"èƒ¸æœ‰æˆç«¹"æ¯”å–»åšäº‹æœ‰æŠŠæ¡ã€‚' },
    { id: 'cy009', type: 'idiom', question: 'ä¸‹åˆ—åŠ ç‚¹æˆè¯­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä»–åšäº‹ä¸€ä¸ä¸è‹Ÿ', 'B. è¿™æ¬¡ä¼šè®®ä¸‡äººç©ºå··', 'C. ä»–æ€»æ˜¯è¢–æ‰‹æ—è§‚', 'D. è¿™ç¯‡æ–‡ç« åˆ«å‡ºå¿ƒè£'], correctAnswer: 0, analysis: 'Aé¡¹"ä¸€ä¸ä¸è‹Ÿ"ä½¿ç”¨æ­£ç¡®ã€‚' },
    { id: 'cy010', type: 'idiom', question: '"æ´¥æ´¥æœ‰å‘³"çš„æ„æ€æ˜¯ï¼š', options: ['A. å‘³é“å¥½', 'B. å…´è¶£æµ“åš', 'C. æ´¥æ´¥æœ‰å‘³', 'D. å¾ˆæœ‰å‘³é“'], correctAnswer: 1, analysis: '"æ´¥æ´¥æœ‰å‘³"å½¢å®¹å…´è¶£æµ“åšã€‚' },
    { id: 'cy011', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä¹¦å†™æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åˆ»èˆŸæ±‚å‰‘', 'B. å®ˆæ ªå¾…å…”', 'C. æ©è€³ç›—é“ƒ', 'D. äº¡ç¾Šè¡¥ç‰¢'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ï¼Œå…¨éƒ¨éƒ½ä¹¦å†™æ­£ç¡®ã€‚' },
    { id: 'cy012', type: 'idiom', question: '"æ»¥ç«½å……æ•°"æ¯”å–»ï¼š', options: ['A. ä¹å™¨å¾ˆå¤š', 'B. æ²¡æœ‰çœŸæ‰å®å­¦', 'C. å……æ•°', 'D. æ»¥ç”¨'], correctAnswer: 1, analysis: '"æ»¥ç«½å……æ•°"æ¯”å–»æ²¡æœ‰çœŸæ‰å®å­¦æ··åœ¨è¡Œå®¶é‡Œé¢ã€‚' },
    { id: 'cy013', type: 'idiom', question: '"ä¸èƒ«è€Œèµ°"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ²¡æœ‰è…¿è·‘', 'B. ä¼ æ’­è¿…é€Ÿ', 'C. èµ°è·¯å¿«', 'D. ä¸èµ°è·¯'], correctAnswer: 1, analysis: '"ä¸èƒ«è€Œèµ°"æ¯”å–»æ¶ˆæ¯ä¼ æ’­è¿…é€Ÿã€‚' },
    { id: 'cy014', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä½¿ç”¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä»–å­¦ä¹ ä¸è€»ä¸‹é—®', 'B. è¿™ä»¶äº‹åŠ¿åœ¨å¿…è¡Œ', 'C. ä»–æ€»æ˜¯éšå£°é™„å’Œ', 'D. è¿™ç¯‡æ–‡ç« æ— æ‡ˆå¯å‡»'], correctAnswer: 3, analysis: 'Dé¡¹"æ— æ‡ˆå¯å‡»"ä½¿ç”¨æ­£ç¡®ã€‚' },
    { id: 'cy015', type: 'idiom', question: '"å‘•å¿ƒæ²¥è¡€"å½¢å®¹ï¼š', options: ['A. å‘•å', 'B. è´¹å°½å¿ƒè¡€', 'C. å‡ºè¡€', 'D. ç—›è‹¦'], correctAnswer: 1, analysis: '"å‘•å¿ƒæ²¥è¡€"å½¢å®¹è´¹å°½å¿ƒè¡€ã€‚' },
    { id: 'cy016', type: 'idiom', question: '"ä¸å¯æ•‘è¯"çš„æ„æ€æ˜¯ï¼š', options: ['A. ä¸èƒ½åƒè¯', 'B. ç—…é‡æ— æ³•åŒ»æ²»', 'C. æ— æ³•æŒ½æ•‘', 'D. ä¸èƒ½æ²»ç–—'], correctAnswer: 2, analysis: '"ä¸å¯æ•‘è¯"æ¯”å–»äººæˆ–äº‹ç‰©ååˆ°æ— æ³•æŒ½æ•‘ã€‚' },
    { id: 'cy017', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä½¿ç”¨ä¸æ°å½“çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä»–æ€»æ˜¯è‡ªä»¥ä¸ºæ˜¯', 'B. è¿™ä¸ªæ•…äº‹è€äººå¯»å‘³', 'C. ä»–åšäº‹æ€»æ˜¯åŠé€”è€ŒåºŸ', 'D. ä»–æ€»æ˜¯ç²¾ç›Šæ±‚ç²¾'], correctAnswer: 2, analysis: 'Cé¡¹æ˜¯è´¬ä¹‰è¯ï¼Œè¯­å¢ƒéœ€è¦ã€‚æœ¬é¢˜Cé¡¹ä½¿ç”¨æ°å½“ã€‚' },
    { id: 'cy018', type: 'idiom', question: '"æ ©æ ©å¦‚ç”Ÿ"å½¢å®¹ï¼š', options: ['A. äººæ´»ç€', 'B. è‰ºæœ¯å½¢è±¡é€¼çœŸ', 'C. ç”Ÿæ´»', 'D. ç”Ÿç‰©'], correctAnswer: 1, analysis: '"æ ©æ ©å¦‚ç”Ÿ"å½¢å®¹è‰ºæœ¯å½¢è±¡ç”ŸåŠ¨é€¼çœŸã€‚' },
    { id: 'cy019', type: 'idiom', question: '"å…´é«˜é‡‡çƒˆ"çš„æ„æ€æ˜¯ï¼š', options: ['A. é«˜å…´å…´å¥‹', 'B. é‡‡èŠ±', 'C. å…´å¥‹', 'D. é«˜é«˜'], correctAnswer: 0, analysis: '"å…´é«˜é‡‡çƒˆ"å½¢å®¹å…´è‡´é«˜æƒ…ç»ªçƒ­çƒˆã€‚' },
    { id: 'cy020', type: 'idiom', question: 'ä¸‹åˆ—æˆè¯­ä¸"ç”»è›‡æ·»è¶³"æ„æ€ç›¸è¿‘çš„æ˜¯ï¼š', options: ['A. å¤šæ­¤ä¸€ä¸¾', 'B. ç”»é¾™ç‚¹ç›', 'C. é”¦ä¸Šæ·»èŠ±', 'D. é›ªä¸­é€ç‚­'], correctAnswer: 0, analysis: '"å¤šæ­¤ä¸€ä¸¾"ä¸"ç”»è›‡æ·»è¶³"æ„æ€ç›¸è¿‘ã€‚' }
    ]
    return [...base, ...generateExtendedIdiom()]
  })(),
  // è¯æ±‡ç»ƒä¹  (vo001-vo200 å…±200é¢˜)
  vocabulary: (() => {
    const base = [
    { id: 'vo001', type: 'vocabulary', question: '"å§¹ç´«å«£çº¢"çš„æ„æ€æ˜¯ï¼š', options: ['A. é¢œè‰²å•ä¸€', 'B. å„ç§èŠ±æœµå¨‡è‰³', 'C. ç´«è‰²çº¢è‰²', 'D. èŠ±æœµå‡‹é›¶'], correctAnswer: 1, analysis: '"å§¹ç´«å«£çº¢"å½¢å®¹å„ç§é¢œè‰²èŠ±æœµå¨‡è‰³ã€‚' },
    { id: 'vo002', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å†æ¥å†åŠ±', 'B. è°ˆç¬‘é£ç”Ÿ', 'C. å·§å¤ºå¤©å…¬', 'D. è¿«ä¸æ€¥å¾…'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚' },
    { id: 'vo003', type: 'vocabulary', question: '"ç¾è½®ç¾å¥‚"å½¢å®¹ï¼š', options: ['A. ç¾ä¸½é£æ™¯', 'B. é«˜å¤§åä¸½å»ºç­‘', 'C. ç¾ä¸½çš„äºº', 'D. ç¾å¥½éŸ³ä¹'], correctAnswer: 1, analysis: '"ç¾è½®ç¾å¥‚"å½¢å®¹æˆ¿å±‹é«˜å¤§åä¸½ã€‚' },
    { id: 'vo004', type: 'vocabulary', question: '"é³æ¬¡æ ‰æ¯”"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ’åˆ—å¯†', 'B. é±¼å’Œæ¢³å­', 'C. æ¬¡åºæ··ä¹±', 'D. æ•´é½ç¨€ç–'], correctAnswer: 0, analysis: '"é³æ¬¡æ ‰æ¯”"å½¢å®¹å»ºç­‘ç‰©æ’åˆ—å¯†æ•´ã€‚' },
    { id: 'vo005', type: 'vocabulary', question: '"å·æµä¸æ¯"çš„"å·"æ„æ€æ˜¯ï¼š', options: ['A. å±±å·', 'B. æ²³æµ', 'C. å¹³åŸ', 'D. é“è·¯'], correctAnswer: 1, analysis: '"å·"æŒ‡æ²³æµã€‚' },
    { id: 'vo006', type: 'vocabulary', question: '"å› åœ°åˆ¶å®œ"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ ¹æ®å½“åœ°åˆ¶å®šæªæ–½', 'B. æ”¹é€ ç¯å¢ƒ', 'C. é€‚åº”ç¯å¢ƒ', 'D. æ”¹å˜åˆ¶åº¦'], correctAnswer: 0, analysis: '"å› åœ°åˆ¶å®œ"æŒ‡æ ¹æ®æƒ…å†µåˆ¶å®šåŠæ³•ã€‚' },
    { id: 'vo007', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­è§£é‡Šæœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‡›å†½ï¼šå¯’å†·', 'B. é€¶è¿¤ï¼šå¼¯æ›²', 'C. å¦¥å¸–ï¼šæ°å½“', 'D. ä¿¨ç„¶ï¼šä¸¥è‚ƒ'], correctAnswer: 3, analysis: 'Dé¡¹"ä¿¨ç„¶"ä¸»è¦æŒ‡å¾ˆåƒã€‚' },
    { id: 'vo008', type: 'vocabulary', question: '"ä¸å¯æ€è®®"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ— æ³•æƒ³è±¡', 'B. ä¸å¯è®®è®º', 'C. å¾ˆç¥å¥‡', 'D. ä¸è®²ç†'], correctAnswer: 0, analysis: '"ä¸å¯æ€è®®"å½¢å®¹éš¾ä»¥æƒ³è±¡ã€‚' },
    { id: 'vo009', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç„•ç„¶ä¸€æ–°', 'B. è°ˆç¬‘é£å£°', 'C. è¿«ä¸æ€¥å¾…', 'D. å†æ¥å†åŠ±'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚Båº”"ç”Ÿ"ï¼ŒCåº”"åŠ"ï¼ŒDåº”"å‰"ã€‚' },
    { id: 'vo010', type: 'vocabulary', question: '"æŠ‘æ‰¬é¡¿æŒ«"å½¢å®¹ï¼š', options: ['A. å£°éŸ³é«˜ä½èµ·ä¼', 'B. æŠ‘åˆ¶', 'C. æŒ«æŠ˜', 'D. åœé¡¿'], correctAnswer: 0, analysis: '"æŠ‘æ‰¬é¡¿æŒ«"å½¢å®¹å£°éŸ³é«˜ä½èµ·ä¼å’Œè°ã€‚' },
    { id: 'vo011', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¹¦å†™æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç›¸å¾—ç›Šç« ', 'B. ç›¸å¾—ç›Šå½°', 'C. ç›¸å¾—ç›Šå¼ ', 'D. ç›¸å¾—ç›Šæ¶¨'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚' },
    { id: 'vo012', type: 'vocabulary', question: '"ç»œç»ä¸ç»"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ–­æ–­ç»­ç»­', 'B. è¿ç»­ä¸æ–­', 'C. ç»œç»', 'D. ä¸ç»'], correctAnswer: 1, analysis: '"ç»œç»ä¸ç»"å½¢å®¹è¡Œäººè½¦é©¬è¿ç»­ä¸æ–­ã€‚' },
    { id: 'vo013', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. éƒ‘é‡å…¶äº‹', 'B. æ¼«ä¸ç»å¿ƒ', 'C. æƒŠæ…Œå¤±æª', 'D. æŒ¯è€³æ¬²è‹'], correctAnswer: 3, analysis: 'Dé¡¹åº”å†™"éœ‡è€³æ¬²è‹"ã€‚' },
    { id: 'vo014', type: 'vocabulary', question: '"éšå£°é™„å’Œ"çš„æ„æ€æ˜¯ï¼š', options: ['A. è·Ÿç€è¯´', 'B. é™„å’Œä»–äºº', 'C. éšä¾¿è¯´', 'D. é™„å’Œ'], correctAnswer: 1, analysis: '"éšå£°é™„å’Œ"å½¢å®¹æ²¡æœ‰ä¸»è§ã€‚' },
    { id: 'vo015', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¹¦å†™å…¨éƒ¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç„•ç„¶ä¸€æ–° æ°”åŠ¿å‡¶å‡¶', 'B. æ¼«ä¸ç»å¿ƒ æµè¿å¿˜è¿”', 'C. éƒ‘é‡å…¶äº‹ æŒ¯è€³æ¬²è‹', 'D. ç›¸å¾—ç›Šç«  è¿«ä¸æ€¥å¾…'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚A"æ±¹æ±¹"ï¼ŒC"éœ‡"ï¼ŒD"å½°""åŠ"ã€‚' },
    { id: 'vo016', type: 'vocabulary', question: '"å› åœ°åˆ¶å®œ"çš„"å®œ"æ„æ€æ˜¯ï¼š', options: ['A. é€‚å®œ', 'B. åº”è¯¥', 'C. å®¹æ˜“', 'D. é€‚å®œ'], correctAnswer: 0, analysis: '"å®œ"æŒ‡é€‚å®œçš„æªæ–½ã€‚' },
    { id: 'vo017', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­"å®œ"çš„æ„æ€ä¸å…¶ä»–ä¸‰é¡¹ä¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å› åœ°åˆ¶å®œ', 'B. é€‚å®œ', 'C. äº‹å®œ', 'D. æƒå®œ'], correctAnswer: 2, analysis: 'Cé¡¹"äº‹å®œ"çš„"å®œ"æŒ‡äº‹æƒ…ã€‚' },
    { id: 'vo018', type: 'vocabulary', question: '"ä¸å¯åçŠ¶"çš„æ„æ€æ˜¯ï¼š', options: ['A. ä¸èƒ½è¯´å‡º', 'B. ä¸èƒ½æè¿°', 'C. ä¸èƒ½çŠ¶å†™', 'D. ä¸èƒ½å½¢çŠ¶'], correctAnswer: 1, analysis: '"ä¸å¯åçŠ¶"æŒ‡æ— æ³•ç”¨è¯­è¨€å½¢å®¹ã€‚' },
    { id: 'vo019', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­è§£é‡Šæ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¿¨ç„¶ï¼šä¸¥è‚ƒçš„æ ·å­', 'B. å¦¥å¸–ï¼šæ°å½“', 'C. é€¶è¿¤ï¼šæ›²æŠ˜å»¶ä¼¸', 'D. å‡›å†½ï¼šå¯’å†·çš„é£'], correctAnswer: 1, analysis: 'Bé¡¹è§£é‡Šå‡†ç¡®ã€‚' },
    { id: 'vo020', type: 'vocabulary', question: '"å†å†åœ¨ç›®"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ¸…æ¸…æ¥šæ¥š', 'B. å†ç»', 'C. å†å²', 'D. åœ¨çœ¼å‰'], correctAnswer: 0, analysis: '"å†å†åœ¨ç›®"å½¢å®¹æ¸…æ¥šåˆ†æ˜åœ°å‡ºç°åœ¨çœ¼å‰ã€‚' }
    ]
    return [...base, ...generateExtendedVocabulary()]
  })(),
  // ç—…å¥ä¿®æ”¹ (bc001-bc200 å…±200é¢˜)
  correction: (() => {
    const base = [
    { id: 'bc001', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é€šè¿‡æ´»åŠ¨ï¼Œä½¿æˆ‘æ˜ç™½', 'B. æ€åº¦ç«¯æ­£ï¼Œæˆç»©æé«˜', 'C. æ‰“æ‰«æ•™å®¤å«ç”Ÿ', 'D. æ”¹è¿›æ–¹æ³•ï¼Œå¢åŠ æ•ˆç‡'], correctAnswer: 1, analysis: 'Bé¡¹æ— è¯­ç—…ã€‚' },
    { id: 'bc002', type: 'correction', question: '"å¢åŠ æ•ˆç‡"çš„é”™è¯¯ç±»å‹æ˜¯ï¼š', options: ['A. è¯­åºä¸å½“', 'B. æ­é…ä¸å½“', 'C. æˆåˆ†æ®‹ç¼º', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, analysis: '"å¢åŠ "ä¸"æ•ˆç‡"æ­é…ä¸å½“ã€‚' },
    { id: 'bc003', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŒ—äº¬ç§‹å¤©ç¾ä¸½', 'B. æ–‡ç« è§‚ç‚¹æ·±åˆ»', 'C. ç©¿ç€ä¸Šè¡£æˆ´å¸½å­', 'D. å…»æˆå­¦ä¹ ä¹ æƒ¯'], correctAnswer: 2, analysis: 'Cé¡¹æ­é…ä¸å½“ã€‚' },
    { id: 'bc004', type: 'correction', question: '"é€šè¿‡å­¦ä¹ ï¼Œä½¿æˆ‘å—ç›Š"ç—…å› æ˜¯ï¼š', options: ['A. æˆåˆ†æ®‹ç¼º', 'B. æ­é…ä¸å½“', 'C. è¯­åºä¸å½“', 'D. ç»“æ„æ··ä¹±'], correctAnswer: 0, analysis: 'æ»¥ç”¨ä»‹è¯å¯¼è‡´ä¸»è¯­ç¼ºå¤±ã€‚' },
    { id: 'bc005', type: 'correction', question: 'ä¿®æ”¹"ç¨»ç±³æ˜¯ä¸»è¦ç²®é£Ÿ"æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. ç¨»ç±³æ˜¯ç²®é£Ÿ', 'B. ç¨»ç±³æ˜¯ç²®é£Ÿä½œç‰©', 'C. ç²®é£Ÿæ˜¯ç¨»ç±³', 'D. ç¨»ç±³æ˜¯ä¸»è¦'], correctAnswer: 1, analysis: 'åº”æ”¹ä¸º"ç¨»ç±³æ˜¯ç²®é£Ÿä½œç‰©"ã€‚' },
    { id: 'bc006', type: 'correction', question: 'ä¸‹åˆ—æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ–‡ç« å¯¹æˆ‘æœ‰å…´è¶£', 'B. æˆ‘å¯¹æ–‡ç« æœ‰å…´è¶£', 'C. æ–‡ç« å¼•èµ·å…´è¶£', 'D. æ–‡ç« è®©æˆ‘æ„Ÿå…´è¶£'], correctAnswer: 2, analysis: 'Cé¡¹æ— è¯­ç—…ã€‚' },
    { id: 'bc007', type: 'correction', question: '"å³ä½¿é‡åˆ°æŒ«æŠ˜ï¼Œä¹Ÿè¦åšæŒ"ï¼š', options: ['A. æœ‰è¯­ç—…', 'B. æ— è¯­ç—…', 'C. ç¼ºä¸»è¯­', 'D. æ­é…ä¸å½“'], correctAnswer: 1, analysis: 'è¿™å¥è¯æ— è¯­ç—…ã€‚' },
    { id: 'bc008', type: 'correction', question: 'ä¸‹åˆ—æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŸ¹å…»ä¹ æƒ¯', 'B. æ˜ç™½é“ç†', 'C. åŠªåŠ›å–å¾—æˆç»©', 'D. ä½œè€…æ˜¯é²è¿…å†™çš„'], correctAnswer: 3, analysis: 'Dé¡¹å¥å¼æ‚ç³…ã€‚' },
    { id: 'bc009', type: 'correction', question: 'ä¸‹åˆ—å¥å­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é€šè¿‡å­¦ä¹ ä½¿æˆ‘è¿›æ­¥', 'B. ä»–è¿›æ­¥äº†', 'C. ä»–ç©¿ç€è¡£æœå’Œå¸½å­', 'D. æé«˜å·¥ä½œæ•ˆç‡'], correctAnswer: 3, analysis: 'Dé¡¹æ— è¯­ç—…ã€‚' },
    { id: 'bc010', type: 'correction', question: '"è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯é²è¿…å†™çš„"ç—…å› æ˜¯ï¼š', options: ['A. æˆåˆ†æ®‹ç¼º', 'B. å¥å¼æ‚ç³…', 'C. æ­é…ä¸å½“', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, analysis: 'å¥å¼æ‚ç³…ã€‚' },
    { id: 'bc011', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¿™å¹…ç”»å¯¹æˆ‘å¾ˆæ„Ÿå…´è¶£', 'B. æˆ‘å¯¹è¿™å¹…ç”»å¾ˆæ„Ÿå…´è¶£', 'C. è¿™å¹…ç”»å¼•èµ·äº†æˆ‘çš„å…´è¶£', 'D. è¿™å¹…ç”»è®©æˆ‘å¾ˆæ„Ÿå…´è¶£'], correctAnswer: 2, analysis: 'Cé¡¹æ— è¯­ç—…ã€‚Aã€Bé¡¹ä¸»å®¢é¢ å€’ã€‚' },
    { id: 'bc012', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æˆ‘ä»¬è¦å…»æˆè‰¯å¥½çš„å­¦ä¹ ä¹ æƒ¯', 'B. ä»–ç»ˆäºæ˜ç™½äº†ä¸€ä¸ªé“ç†', 'C. é€šè¿‡åŠªåŠ›ä»–å–å¾—äº†å¥½æˆç»©', 'D. è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯é²è¿…å†™çš„'], correctAnswer: 3, analysis: 'Dé¡¹å¥å¼æ‚ç³…ã€‚' },
    { id: 'bc013', type: 'correction', question: '"æˆ‘ä»¬ä¸€å®šè¦å‘æŒ¥ä¼˜ç‚¹ã€æ”¹æ­£é”™è¯¯"çš„ç—…å› æ˜¯ï¼š', options: ['A. æˆåˆ†æ®‹ç¼º', 'B. æ­é…ä¸å½“', 'C. è¯­åºä¸å½“', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, analysis: '"å‘æŒ¥"ä¸"ä¼˜ç‚¹"æ­é…ï¼Œ"æ”¹æ­£"ä¸"é”™è¯¯"æ­é…ï¼Œä½†"å‘æŒ¥ä¼˜ç‚¹"ä¸å¦¥ï¼Œåº”ä¸º"å‘æ‰¬ä¼˜ç‚¹"ã€‚' },
    { id: 'bc014', type: 'correction', question: 'ä¸‹åˆ—å¥å­æ— è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä»–çš„å­¦ä¹ æ€åº¦ç«¯æ­£ï¼Œæˆç»©ä¹Ÿæé«˜äº†', 'B. é€šè¿‡æ´»åŠ¨ä½¿æˆ‘æ˜ç™½äº†', 'C. æ˜¨å¤©ä¸‹åˆæˆ‘ä»¬æ‰“æ‰«æ•™å®¤å«ç”Ÿ', 'D. æˆ‘ä»¬è¦æ”¹è¿›å­¦ä¹ æ–¹æ³•ï¼Œå¢åŠ æ•ˆç‡'], correctAnswer: 0, analysis: 'Aé¡¹æ— è¯­ç—…ã€‚' },
    { id: 'bc015', type: 'correction', question: '"è¿™ä¸ªé—®é¢˜éœ€è¦å¤§å®¶ä¸€èµ·æ¥è®¨è®ºå’Œè§£å†³"çš„è¯­ç—…ç±»å‹æ˜¯ï¼š', options: ['A. è¯­åºä¸å½“', 'B. æ­é…ä¸å½“', 'C. æˆåˆ†æ®‹ç¼º', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, analysis: '"è®¨è®º"å’Œ"è§£å†³"éƒ½æ˜¯åŠ¨è¯ï¼Œä½†"é—®é¢˜"åªèƒ½è¢«"è§£å†³"ä¸èƒ½è¢«"è®¨è®º"ï¼Œåº”æ”¹ä¸º"è®¨è®ºå¹¶è§£å†³è¿™ä¸ªé—®é¢˜"ã€‚' },
    { id: 'bc016', type: 'correction', question: 'ä¸‹åˆ—å¥å­æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æˆ‘å›½çš„èŒ¶å¶äº§é‡æ˜¯ä¸–ç•Œä¸Šæœ€å¤šçš„å›½å®¶', 'B. è¿™æœ¬ä¹¦æˆ‘çœ‹è¿‡', 'C. ä»–æ˜¯ä¸€ä¸ªä¼˜ç§€çš„å­¦ç”Ÿ', 'D. æˆ‘ä»¬è¦å…»æˆè‰¯å¥½ä¹ æƒ¯'], correctAnswer: 0, analysis: 'Aé¡¹ä¸»å®¾ä¸æ­é…ï¼Œåº”åˆ å»"çš„å›½å®¶"æˆ–æ”¹ä¸º"æˆ‘å›½æ˜¯ä¸–ç•Œä¸ŠèŒ¶å¶äº§é‡æœ€å¤šçš„å›½å®¶"ã€‚' },
    { id: 'bc017', type: 'correction', question: '"èƒ½å¦ä¿æŒå­¦ä¹ æˆç»©çš„ä¸æ–­æé«˜ï¼Œå…³é”®åœ¨äºåˆ»è‹¦åŠªåŠ›"çš„ç—…å› æ˜¯ï¼š', options: ['A. ä¸€é¢ä¸ä¸¤é¢æ­é…ä¸å½“', 'B. æˆåˆ†æ®‹ç¼º', 'C. è¯­åºä¸å½“', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 0, analysis: '"èƒ½å¦"æ˜¯ä¸¤é¢ï¼Œ"åˆ»è‹¦åŠªåŠ›"æ˜¯ä¸€é¢ï¼Œå‰åä¸å¯¹åº”ã€‚' },
    { id: 'bc018', type: 'correction', question: 'ä¸‹åˆ—å¥å­æ— è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åªè¦åˆ»è‹¦åŠªåŠ›ï¼Œå°±èƒ½å–å¾—å¥½æˆç»©', 'B. ä»–ä¸ä½†å­¦ä¹ å¥½ï¼Œè€Œä¸”æ€æƒ³å“å¾·å¥½', 'C. å³ä½¿æ˜å¤©ä¸‹é›¨ï¼Œæˆ‘ä»¬ä¹Ÿè¦å»', 'D. å› ä¸ºç”Ÿç—…ï¼Œæ‰€ä»¥æ²¡æ¥ä¸Šå­¦'], correctAnswer: 2, analysis: 'Cé¡¹æ— è¯­ç—…ã€‚Aé¡¹"åªè¦...å°±"åº”ä¸º"åªæœ‰...æ‰"ï¼›Bã€Då…³è”è¯ä½ç½®ä¸å½“ã€‚' },
    { id: 'bc019', type: 'correction', question: '"å„ç§æ–°å‘ç°çš„æµè¡Œç—…ï¼Œä½¿æˆ‘ä»¬æ”¹æ­£å¹¶è®¤è¯†äº†è‡ªå·±ä¸è‰¯çš„å«ç”Ÿä¹ æƒ¯"çš„ç—…å› æ˜¯ï¼š', options: ['A. è¯­åºä¸å½“', 'B. æ­é…ä¸å½“', 'C. æˆåˆ†æ®‹ç¼º', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 0, analysis: '"è®¤è¯†å¹¶æ”¹æ­£"ç¬¦åˆé€»è¾‘ï¼Œå…ˆè®¤è¯†å†æ”¹æ­£ã€‚' },
    { id: 'bc020', type: 'correction', question: 'ä¸‹åˆ—å¥å­æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç»è¿‡åŠªåŠ›ï¼Œä»–ç»ˆäºè€ƒå–äº†å¤§å­¦', 'B. åœ¨è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œä»–çš„è¿›æ­¥å¾ˆå¤§', 'C. é€šè¿‡è¿™æ¬¡æ´»åŠ¨ï¼Œä½¿æˆ‘å—åˆ°å¾ˆå¤§æ•™è‚²', 'D. ä»–æŠŠæ•™å®¤æ‰“æ‰«å¾—å¹²å¹²å‡€å‡€'], correctAnswer: 2, analysis: 'Cé¡¹æˆåˆ†æ®‹ç¼ºï¼Œåº”åˆ å»"é€šè¿‡"æˆ–"ä½¿"ã€‚' }
    ]
    return [...base, ...generateExtendedCorrection()]
  })(),
  // å¤è¯—è¯ (gs001-gs200 å…±200é¢˜)
  literature: (() => {
    const base = [
    { id: 'gs001', type: 'literature', question: '"é‡‡èŠä¸œç¯±ä¸‹ï¼Œæ‚ ç„¶è§å—å±±"å‡ºè‡ªè°ï¼š', options: ['A. æç™½', 'B. æœç”«', 'C. é™¶æ¸Šæ˜', 'D. ç‹ç»´'], correctAnswer: 2, analysis: 'é™¶æ¸Šæ˜ã€Šé¥®é…’ã€‹ã€‚' },
    { id: 'gs002', type: 'literature', question: '"æµ·å†…å­˜çŸ¥å·±ï¼Œå¤©æ¶¯è‹¥æ¯”é‚»"å‡ºè‡ªï¼š', options: ['A. ç‹å‹ƒ', 'B. æç™½', 'C. ç‹ç»´', 'D. æœç”«'], correctAnswer: 0, analysis: 'ç‹å‹ƒã€Šé€æœå°‘åºœä¹‹ä»»èœ€å·ã€‹ã€‚' },
    { id: 'gs003', type: 'literature', question: '"æ˜¥çœ ä¸è§‰æ™“"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. èŠ±è½çŸ¥å¤šå°‘', 'B. å¤„å¤„é—»å•¼é¸Ÿ', 'C. å¤œæ¥é£é›¨å£°', 'D. æ±Ÿæ¸…æœˆè¿‘äºº'], correctAnswer: 1, analysis: '"æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿ"ã€‚' },
    { id: 'gs004', type: 'literature', question: '"ä½†æ„¿äººé•¿ä¹…"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. åƒé‡Œå…±å©µå¨Ÿ', 'B. æ˜æœˆå‡ æ—¶æœ‰', 'C. æŠŠé…’é—®é’å¤©', 'D. ä½•ä¼¼åœ¨äººé—´'], correctAnswer: 0, analysis: '"ä½†æ„¿äººé•¿ä¹…ï¼Œåƒé‡Œå…±å©µå¨Ÿ"ã€‚' },
    { id: 'gs005', type: 'literature', question: '"ä¼šå½“å‡Œç»é¡¶"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. ä¸€è§ˆä¼—å±±å°', 'B. é€ åŒ–é’Ÿç¥ç§€', 'C. å†³çœ¦å…¥å½’é¸Ÿ', 'D. è¡èƒ¸ç”Ÿå±‚äº‘'], correctAnswer: 0, analysis: '"ä¼šå½“å‡Œç»é¡¶ï¼Œä¸€è§ˆä¼—å±±å°"ã€‚' },
    { id: 'gs006', type: 'literature', question: '"äººç”Ÿè‡ªå¤è°æ— æ­»"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. ç•™å–ä¸¹å¿ƒç…§æ±—é’', 'B. èº«ä¸–æµ®æ²‰é›¨æ‰“è', 'C. æƒ¶ææ»©å¤´è¯´æƒ¶æ', 'D. å¹²æˆˆå¯¥è½å››å‘¨æ˜Ÿ'], correctAnswer: 0, analysis: 'æ–‡å¤©ç¥¥ã€Šè¿‡é›¶ä¸æ´‹ã€‹ã€‚' },
    { id: 'gs007', type: 'literature', question: '"è½çº¢ä¸æ˜¯æ— æƒ…ç‰©"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. åŒ–ä½œæ˜¥æ³¥æ›´æŠ¤èŠ±', 'B. æµ©è¡ç¦»æ„ç™½æ—¥æ–œ', 'C. åŸé­ä¸œæŒ‡å³å¤©æ¶¯', 'D. ä¼´æˆ‘ç›´åˆ° Subcommittee'], correctAnswer: 0, analysis: 'é¾šè‡ªçã€Šå·±äº¥æ‚è¯—ã€‹ã€‚' },
    { id: 'gs008', type: 'literature', question: '"å¤§æ¼ å­¤çƒŸç›´"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. é•¿æ²³è½æ—¥åœ†', 'B. è§å…³é€¢å€™éª‘', 'C. éƒ½æŠ¤åœ¨ç‡•ç„¶', 'D. å¾è“¬å‡ºæ±‰å¡'], correctAnswer: 0, analysis: 'ç‹ç»´ã€Šä½¿è‡³å¡ä¸Šã€‹ã€‚' },
    { id: 'gs009', type: 'literature', question: '"å•†å¥³ä¸çŸ¥äº¡å›½æ¨"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. éš”æ±ŸçŠ¹å”±ååº­èŠ±', 'B. çƒŸç¬¼å¯’æ°´æœˆç¬¼æ²™', 'C. å¤œæ³Šç§¦æ·®è¿‘é…’å®¶', 'D. ä¸‰å±±åŠè½é’å¤©å¤–'], correctAnswer: 0, analysis: 'æœç‰§ã€Šæ³Šç§¦æ·®ã€‹ã€‚' },
    { id: 'gs010', type: 'literature', question: '"å±±é‡æ°´å¤ç–‘æ— è·¯"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. æŸ³æš—èŠ±æ˜åˆä¸€æ‘', 'B. ä¸°å¹´ç•™å®¢è¶³é¸¡è±š', 'C. å±±é‡æ°´å¤ç–‘æ— è·¯', 'D. æŸ³æš—èŠ±æ˜'], correctAnswer: 0, analysis: 'é™†æ¸¸ã€Šæ¸¸å±±è¥¿æ‘ã€‹ã€‚' },
    { id: 'gs011', type: 'literature', question: '"å…ˆå¤©ä¸‹ä¹‹å¿§è€Œå¿§"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. åå¤©ä¸‹ä¹‹ä¹è€Œä¹', 'B. ä¸ä»¥ç‰©å–œ', 'C. ä¸ä»¥å·±æ‚²', 'D. å¤„æ±Ÿæ¹–ä¹‹è¿œ'], correctAnswer: 0, analysis: 'èŒƒä»²æ·¹ã€Šå²³é˜³æ¥¼è®°ã€‹ã€‚' },
    { id: 'gs012', type: 'literature', question: '"ä¸ç•æµ®äº‘é®æœ›çœ¼"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. è‡ªç¼˜èº«åœ¨æœ€é«˜å±‚', 'B. é£å…¥å¯»å¸¸ç™¾å§“å®¶', 'C. ä¸æ•™èƒ¡é©¬åº¦é˜´å±±', 'D. è¥¿å‡ºé˜³å…³æ— æ•…äºº'], correctAnswer: 0, analysis: 'ç‹å®‰çŸ³ã€Šç™»é£æ¥å³°ã€‹ã€‚' },
    { id: 'gs013', type: 'literature', question: '"å®‰å¾—å¹¿å¦åƒä¸‡é—´"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. å¤§åº‡å¤©ä¸‹å¯’å£«ä¿±æ¬¢é¢œ', 'B. é£é›¨ä¸åŠ¨å®‰å¦‚å±±', 'C. å¾åºç‹¬ç ´å—å†»æ­»äº¦è¶³', 'D. ä½•æ—¶çœ¼å‰çªå…€è§æ­¤å±‹'], correctAnswer: 0, analysis: 'æœç”«ã€ŠèŒ…å±‹ä¸ºç§‹é£æ‰€ç ´æ­Œã€‹ã€‚' },
    { id: 'gs014', type: 'literature', question: '"è½éœä¸å­¤é¹œé½é£"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. ç§‹æ°´å…±é•¿å¤©ä¸€è‰²', 'B. æ¸”èˆŸå”±æ™š', 'C. é›é˜µæƒŠå¯’', 'D. è¥Ÿä¸‰æ±Ÿè€Œå¸¦äº”æ¹–'], correctAnswer: 0, analysis: 'ç‹å‹ƒã€Šæ»•ç‹é˜åºã€‹ã€‚' },
    { id: 'gs015', type: 'literature', question: '"æ˜¥é£åˆç»¿æ±Ÿå—å²¸"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. æ˜æœˆä½•æ—¶ç…§æˆ‘è¿˜', 'B. æ˜¥é£åˆç»¿æ±Ÿå—å²¸', 'C. é’Ÿå±±åªéš”æ•°é‡å±±', 'D. äº¬å£ç“œæ´²ä¸€æ°´é—´'], correctAnswer: 0, analysis: 'ç‹å®‰çŸ³ã€Šæ³Šèˆ¹ç“œæ´²ã€‹ã€‚' },
    { id: 'gs016', type: 'literature', question: '"æ²‰èˆŸä¾§ç•”åƒå¸†è¿‡"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. ç—…æ ‘å‰å¤´ä¸‡æœ¨æ˜¥', 'B. æ€€æ—§ç©ºåŸé—»ç¬›èµ‹', 'C. åˆ°ä¹¡ç¿»ä¼¼çƒ‚æŸ¯äºº', 'D. å·´å±±æ¥šæ°´å‡„å‡‰åœ°'], correctAnswer: 0, analysis: 'åˆ˜ç¦¹é”¡ã€Šé…¬ä¹å¤©æ‰¬å·åˆé€¢å¸­ä¸Šè§èµ ã€‹ã€‚' },
    { id: 'gs017', type: 'literature', question: '"é•¿é£ç ´æµªä¼šæœ‰æ—¶"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. ç›´æŒ‚äº‘å¸†æµæ²§æµ·', 'B. é—²æ¥å‚é’“ç¢§æºªä¸Š', 'C. å¿½å¤ä¹˜èˆŸæ¢¦æ—¥è¾¹', 'D. æ¬²æ¸¡é»„æ²³å†°å¡å·'], correctAnswer: 0, analysis: 'æç™½ã€Šè¡Œè·¯éš¾ã€‹ã€‚' },
    { id: 'gs018', type: 'literature', question: '"å‡ å¤„æ—©èºäº‰æš–æ ‘"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. è°å®¶æ–°ç‡•å•„æ˜¥æ³¥', 'B. ä¹±èŠ±æ¸æ¬²è¿·äººçœ¼', 'C. æµ…è‰æ‰èƒ½æ²¡é©¬è¹„', 'D. å­¤å±±å¯ºåŒ—è´¾äº­è¥¿'], correctAnswer: 0, analysis: 'ç™½å±…æ˜“ã€Šé’±å¡˜æ¹–æ˜¥è¡Œã€‹ã€‚' },
    { id: 'gs019', type: 'literature', question: '"é€ åŒ–é’Ÿç¥ç§€"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. é˜´é˜³å‰²æ˜æ™“', 'B. ä¼šå½“å‡Œç»é¡¶', 'C. è¡èƒ¸ç”Ÿå±‚äº‘', 'D. å†³çœ¦å…¥å½’é¸Ÿ'], correctAnswer: 0, analysis: 'æœç”«ã€Šæœ›å²³ã€‹ã€‚' },
    { id: 'gs020', type: 'literature', question: '"è°é“äººç”Ÿæ— å†å°‘"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. é—¨å‰æµæ°´å°šèƒ½è¥¿', 'B. ä¼‘å°†ç™½å‘å”±é»„é¸¡', 'C. å±±ä¸‹å…°èŠ½çŸ­æµ¸æºª', 'D. æ¾é—´æ²™è·¯å‡€æ— æ³¥'], correctAnswer: 0, analysis: 'è‹è½¼ã€Šæµ£æºªæ²™ã€‹ã€‚' }
    ]
    return [...base, ...generateExtendedLiterature()]
  })()
}

// è·å–æ‰€æœ‰æ¨¡æ‹Ÿé¢˜ç›®
const getAllMockQuestions = () => {
  return [
    ...MOCK_QUESTIONS.pinyin,
    ...MOCK_QUESTIONS.idiom,
    ...MOCK_QUESTIONS.vocabulary,
    ...MOCK_QUESTIONS.correction,
    ...MOCK_QUESTIONS.literature
  ]
}

// æ‰“ä¹±æ•°ç»„
const shuffleArray = (array) => {
  const result = [...array]
  for (let i = result.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1))
    ;[result[i], result[j]] = [result[j], result[i]]
  }
  return result
}

class QuestionService {
  /**
   * è·å–éšæœºé¢˜ç›®
   */
  async getRandomQuestions(count = 10, type = null) {
    console.log('getRandomQuestions è¢«è°ƒç”¨, count:', count, 'type:', type)

    // å…ˆå°è¯•äº‘å‡½æ•°
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'random',
        count,
        type
      })
      if (res && res.data && res.data.length > 0) {
        console.log('ä»äº‘å‡½æ•°è·å–åˆ°é¢˜ç›®ï¼Œæ•°é‡:', res.data.length)
        return res.data
      }
    } catch (err) {
      console.log('äº‘å‡½æ•°è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®')
    }

    // ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®
    let questions = getAllMockQuestions()
    if (type && MOCK_QUESTIONS[type]) {
      questions = MOCK_QUESTIONS[type]
    }
    const result = shuffleArray(questions).slice(0, Math.min(count, questions.length))
    console.log('è¿”å›æœ¬åœ°æ¨¡æ‹Ÿé¢˜ç›®ï¼Œæ•°é‡:', result.length)
    return result
  }

  /**
   * æŒ‰ç±»å‹è·å–é¢˜ç›®
   */
  async getQuestionsByType(type, page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    console.log('getQuestionsByType è¢«è°ƒç”¨, type:', type, 'page:', page, 'pageSize:', pageSize)

    // å…ˆå°è¯•äº‘å‡½æ•°
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'list',
        type,
        page,
        pageSize
      })
      if (res && res.data && res.data.length > 0) {
        console.log('ä»äº‘å‡½æ•°è·å–åˆ°é¢˜ç›®ï¼Œæ•°é‡:', res.data.length)
        return res.data
      }
    } catch (err) {
      console.log('äº‘å‡½æ•°è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®')
    }

    // ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®
    if (MOCK_QUESTIONS[type]) {
      const start = (page - 1) * pageSize
      const end = start + pageSize
      const result = MOCK_QUESTIONS[type].slice(start, end)
      console.log('è¿”å›æœ¬åœ°æ¨¡æ‹Ÿé¢˜ç›®ï¼Œtype:', type, 'æ•°é‡:', result.length)
      return result
    }

    // å¦‚æœæ²¡æœ‰åŒ¹é…çš„ç±»å‹ï¼Œè¿”å›éšæœºé¢˜ç›®
    console.log('æœªæ‰¾åˆ°åŒ¹é…ç±»å‹ï¼Œè¿”å›éšæœºé¢˜ç›®')
    const allQuestions = getAllMockQuestions()
    return shuffleArray(allQuestions).slice(0, Math.min(pageSize, allQuestions.length))
  }

  /**
   * æŒ‰å¹´ä»½è·å–é¢˜ç›®
   */
  async getQuestionsByYear(year, page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
      action: 'byYear',
      year,
      page,
      pageSize
    })
    return res.data || []
  }

  /**
   * æœç´¢é¢˜ç›®
   */
  async searchQuestions(keyword, page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
      action: 'search',
      keyword,
      page,
      pageSize
    })
    return res.data || []
  }

  /**
   * è·å–é¢˜ç›®è¯¦æƒ…
   */
  async getQuestionDetail(id) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'detail',
        id
      })
      if (res.data) {
        return res.data
      }
    } catch (err) {
      console.log('äº‘å‡½æ•°è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®')
    }

    // ä»æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®ä¸­æŸ¥æ‰¾
    const allQuestions = getAllMockQuestions()
    return allQuestions.find(q => q.id === id) || null
  }

  /**
   * æäº¤ç­”æ¡ˆ
   */
  async submitAnswer(questionId, answer) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'submit',
        questionId,
        answer
      })
      return res
    } catch (err) {
      Taro.showToast({ title: 'æäº¤ç­”æ¡ˆå¤±è´¥', icon: 'none' })
      return { success: false }
    }
  }

  /**
   * è·å–é¢˜ç›®ç»Ÿè®¡
   */
  async getStatistics() {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'stats'
      })
      if (res.data && Object.keys(res.data).length > 0) {
        return res.data
      }
    } catch (err) {
      console.log('äº‘å‡½æ•°è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®')
    }

    // è¿”å›æœ¬åœ°æ¨¡æ‹Ÿç»Ÿè®¡ - ä¸äº‘å‡½æ•°è¿”å›ç»“æ„ä¸€è‡´
    return {
      answered: 0,
      correct: 0,
      total: getAllMockQuestions().length,
      todayAnswered: 0,
      accuracy: 0,
      typeStats: {
        pinyin: MOCK_QUESTIONS.pinyin.length,
        literature: MOCK_QUESTIONS.literature.length,
        idiom: MOCK_QUESTIONS.idiom.length,
        correction: MOCK_QUESTIONS.correction.length,
        vocabulary: MOCK_QUESTIONS.vocabulary.length,
        comprehension: 0,
        grammar: 0,
        reading: 0
      }
    }
  }

  /**
   * æ”¶è—é¢˜ç›®
   * @param {string} questionId - é¢˜ç›® ID
   * @param {object} questionData - é¢˜ç›®å®Œæ•´æ•°æ®ï¼ˆå¯é€‰ï¼‰
   */
  async toggleFavorite(questionId, questionData = null) {
    console.log('=== questionService.toggleFavorite ===')
    console.log('questionId:', questionId)
    console.log('questionData:', questionData)

    try {
      const payload = {
        action: 'favorite',
        questionId
      }
      // å¦‚æœæä¾›äº†å®Œæ•´é¢˜ç›®æ•°æ®ï¼Œä¸€å¹¶å‘é€
      if (questionData) {
        payload.questionData = questionData
      }

      console.log('=== å‘é€åˆ°äº‘å‡½æ•°çš„ payload ===', payload)

      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, payload)

      console.log('=== äº‘å‡½æ•°è¿”å›ç»“æœ ===', res)

      return res.success
    } catch (err) {
      console.error('=== toggleFavorite é”™è¯¯ ===', err)
      Taro.showToast({ title: 'æ”¶è—å¤±è´¥', icon: 'none' })
      return false
    }
  }

  /**
   * è·å–æ”¶è—åˆ—è¡¨
   */
  async getFavorites(page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'favorites',
        page,
        pageSize
      })
      return res.data || []
    } catch (err) {
      Taro.showToast({ title: 'è·å–æ”¶è—å¤±è´¥', icon: 'none' })
      return []
    }
  }

  /**
   * è·å–é”™é¢˜é›†
   */
  async getWrongQuestions(page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'wrong',
        page,
        pageSize
      })
      return res.data || []
    } catch (err) {
      Taro.showToast({ title: 'è·å–é”™é¢˜å¤±è´¥', icon: 'none' })
      return []
    }
  }
}

export default new QuestionService()


// ===== src/services/study.js =====
/**
 * å­¦ä¹ è®°å½•æœåŠ¡
 */
import Taro from '@tarojs/taro'
import { callCloudFunction } from './request'
import { CLOUD_FUNCTIONS, STUDY_TYPES, TIME_RANGES, DEFAULT_PAGE } from '../utils/constants'

// æ¨¡æ‹Ÿå­¦ä¹ è®°å½•æ•°æ®
const MOCK_RECORDS = [
  { id: 1, type: 'vocabulary', title: 'è¯æ±‡å­¦ä¹ ', date: '2025-01-03', score: 85, duration: 15, correctCount: 8, totalCount: 10 },
  { id: 2, type: 'idiom', title: 'æˆè¯­å­¦ä¹ ', date: '2025-01-03', score: 90, duration: 12, correctCount: 9, totalCount: 10 },
  { id: 3, type: 'pinyin', title: 'æ‹¼éŸ³ç»ƒä¹ ', date: '2025-01-03', score: 75, duration: 10, correctCount: 6, totalCount: 8 },
  { id: 4, type: 'correction', title: 'ç—…å¥ä¿®æ”¹', date: '2025-01-02', score: 88, duration: 20, correctCount: 7, totalCount: 8 },
  { id: 5, type: 'vocabulary', title: 'è¯æ±‡å­¦ä¹ ', date: '2025-01-02', score: 82, duration: 15, correctCount: 9, totalCount: 10 },
  { id: 6, type: 'pinyin', title: 'æ‹¼éŸ³ç»ƒä¹ ', date: '2025-01-02', score: 95, duration: 18, correctCount: 10, totalCount: 10 },
  { id: 7, type: 'idiom', title: 'æˆè¯­ç»ƒä¹ ', date: '2025-01-01', score: 78, duration: 15, correctCount: 7, totalCount: 10 },
  { id: 8, type: 'correction', title: 'ç—…å¥ä¿®æ”¹', date: '2025-01-01', score: 85, duration: 20, correctCount: 6, totalCount: 8 },
  { id: 9, type: 'mock_exam', title: 'æ¨¡æ‹Ÿè€ƒè¯•', date: '2024-12-31', score: 80, duration: 60, correctCount: 4, totalCount: 5 },
  { id: 10, type: 'vocabulary', title: 'è¯æ±‡å­¦ä¹ ', date: '2024-12-31', score: 88, duration: 15, correctCount: 8, totalCount: 10 }
]

class StudyService {
  /**
   * æ·»åŠ å­¦ä¹ è®°å½•
   */
  async addRecord(data) {
    try {
      console.log('[studyService] è°ƒç”¨ addRecord äº‘å‡½æ•°ï¼Œæ•°æ®:', data)
      const res = await callCloudFunction(CLOUD_FUNCTIONS.STUDY, {
        action: 'add',
        ...data
      })
      console.log('[studyService] addRecord äº‘å‡½æ•°è¿”å›:', res)

      // ä¿®å¤ï¼šè¿”å›å®Œæ•´å“åº”ï¼Œä¿ç•™ success æ ‡å¿—
      // äº‘å‡½æ•°è¿”å› { success: true, data: { _id: 'xxx', ... } }
      // å¦‚æœåªè¿”å› res.dataï¼Œä¼šä¸¢å¤± success æ ‡å¿—
      if (res && res.success) {
        return res
      }
      // å…¼å®¹å¤„ç†ï¼šå¦‚æœæ²¡æœ‰ success æ ‡å¿—ä½†æœ‰ dataï¼Œè¯´æ˜æˆåŠŸäº†
      return { success: true, data: res.data || res }
    } catch (err) {
      console.error('[studyService] æ·»åŠ è®°å½•å¤±è´¥ï¼ˆäº‘å‡½æ•°æœªéƒ¨ç½²æˆ–ç½‘ç»œé”™è¯¯ï¼‰:', err, 'æ•°æ®:', data)
      return { success: false, error: err.message }
    }
  }

  /**
   * æ‰¹é‡æ·»åŠ å­¦ä¹ è®°å½•
   */
  async addRecords(records) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.STUDY, {
        action: 'addBatch',
        records
      })
      return res.data || []
    } catch (err) {
      console.log('æ‰¹é‡æ·»åŠ å¤±è´¥ï¼ˆæœ¬åœ°æ¨¡å¼ï¼‰')
      return records.map(r => ({ ...r, id: Date.now() + Math.random() }))
    }
  }

  /**
   * è·å–å­¦ä¹ è®°å½•åˆ—è¡¨
   */
  async getRecords(filters = {}, page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.STUDY, {
        action: 'list',
        ...filters,
        page,
        pageSize
      })
      if (res.data && res.data.length > 0) {
        return res.data
      }
    } catch (err) {
      console.log('è·å–è®°å½•å¤±è´¥ï¼Œè¿”å›ç©ºæ•°ç»„')
    }

    // ä¸å†ä½¿ç”¨å‡æ•°æ®ï¼Œè¿”å›ç©ºæ•°ç»„è®©å‰ç«¯æ˜¾ç¤º"æš‚æ— å­¦ä¹ è®°å½•"
    return []
  }

  /**
   * è·å–å­¦ä¹ ç»Ÿè®¡
   * åŸºäºäº‘å‡½æ•°è¿”å›çœŸå®æ•°æ®ï¼Œå¤±è´¥æ—¶è¿”å›é›¶å€¼
   */
  async getStatistics(timeRange = TIME_RANGES.MONTH) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.STUDY, {
        action: 'statistics',
        timeRange
      })
      if (res.data && res.success) {
        // ä»äº‘å‡½æ•°è·å–åŸºç¡€æ•°æ®
        const baseData = res.data

        // å°è¯•ä» question äº‘å‡½æ•°è·å–ç­”é¢˜ç»Ÿè®¡
        try {
          const questionRes = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
            action: 'stats'
          })

          if (questionRes.data && questionRes.success) {
            return {
              totalDays: baseData.totalDays || 1,
              totalScore: baseData.totalScore || 0,
              totalQuestions: questionRes.data.answered || 0,
              correctRate: questionRes.data.accuracy || 0
            }
          }
        } catch (e) {
          // å¿½ç•¥ question ç»Ÿè®¡å¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€æ•°æ®
        }

        return {
          totalDays: baseData.totalDays || 1,
          totalScore: baseData.totalScore || 0,
          totalQuestions: baseData.totalQuestions || 0,
          correctRate: baseData.correctRate || 0
        }
      }
    } catch (err) {
      console.log('è·å–ç»Ÿè®¡å¤±è´¥ï¼Œè¿”å›é›¶å€¼')
    }

    // è¿”å›é›¶å€¼ï¼ˆä¸å†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰
    return {
      totalDays: 0,
      totalScore: 0,
      totalQuestions: 0,
      correctRate: 0
    }
  }

  /**
   * è·å–é¦–é¡µç»Ÿè®¡æ•°æ®
   * åŸºäºäº‘å‡½æ•°è¿”å›çœŸå®æ•°æ®ï¼Œå¤±è´¥æ—¶è¿”å›é›¶å€¼ï¼ˆè€Œéæ¨¡æ‹Ÿæ•°æ®ï¼‰
   */
  async getHomeStatistics() {
    try {
      console.log('[studyService] è°ƒç”¨ getHomeStatistics äº‘å‡½æ•°')
      const res = await callCloudFunction(CLOUD_FUNCTIONS.STUDY, {
        action: 'homeStats'
      })
      console.log('[studyService] getHomeStatistics äº‘å‡½æ•°è¿”å›:', res)
      if (res.data && res.success && Object.keys(res.data).length > 0) {
        return res.data
      }
    } catch (err) {
      console.error('[studyService] è·å–é¦–é¡µç»Ÿè®¡å¤±è´¥ï¼Œè¿”å›é›¶å€¼:', err)
    }

    // è¿”å›é›¶å€¼ï¼ˆä¸å†ä½¿ç”¨ç¡¬ç¼–ç çš„æ¨¡æ‹Ÿæ•°æ®ï¼‰
    return {
      todayScore: 0,
      wrongCount: 0,
      totalDuration: 0,
      studyDays: 1,
      accuracy: 0,
      progress: {
        pinyin: 0,
        idiom: 0,
        vocabulary: 0,
        correction: 0
      }
    }
  }

  /**
   * è·å–å­¦ä¹ æŠ¥å‘Š
   */
  async getReport(startDate, endDate) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.STUDY, {
        action: 'report',
        startDate,
        endDate
      })
      if (res.data && Object.keys(res.data).length > 0) {
        return res.data
      }
    } catch (err) {
      console.log('è·å–æŠ¥å‘Šå¤±è´¥ï¼Œè¿”å›ç©ºæ•°æ®')
    }

    // è¿”å›ç©ºæ•°æ®ç»“æ„ï¼ˆä¸ä½¿ç”¨å‡æ•°æ®ï¼‰
    return {
      totalScore: 0,
      totalDuration: 0,
      correctRate: 0,
      dailyData: [],
      typeStats: []
    }
  }

  /**
   * è·å–å­¦ä¹ åˆ†æ
   */
  async getAnalysis() {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.STUDY, {
        action: 'analysis'
      })
      if (res.data && Object.keys(res.data).length > 0) {
        return res.data
      }
    } catch (err) {
      console.log('è·å–åˆ†æå¤±è´¥ï¼Œè¿”å›ç©ºæ•°æ®')
    }

    // è¿”å›ç©ºæ•°æ®ç»“æ„ï¼ˆä¸ä½¿ç”¨å‡æ•°æ®ï¼‰
    return {
      strongPoints: [],
      weakPoints: [],
      trend: 'none',
      suggestions: [],
      weeklyTrend: []
    }
  }

  /**
   * åˆ é™¤å­¦ä¹ è®°å½•
   */
  async deleteRecord(id) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.STUDY, {
        action: 'delete',
        id
      })
      return res.success
    } catch (err) {
      console.log('åˆ é™¤è®°å½•å¤±è´¥ï¼ˆæœ¬åœ°æ¨¡å¼ï¼‰')
      Taro.showToast({ title: 'åˆ é™¤å¤±è´¥', icon: 'none' })
      return false
    }
  }

  /**
   * è·å–å­¦ä¹ æ—¥å†ï¼ˆæ‰“å¡è®°å½•ï¼‰
   */
  async getStudyCalendar(year, month) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.STUDY, {
        action: 'calendar',
        year,
        month
      })
      if (res.data && res.data.length > 0) {
        return res.data
      }
    } catch (err) {
      console.log('è·å–æ—¥å†å¤±è´¥ï¼Œè¿”å›ç©ºæ•°ç»„')
    }

    // è¿”å›ç©ºæ•°ç»„ï¼ˆä¸ä½¿ç”¨å‡æ•°æ®ï¼‰
    return []
  }

  /**
   * è®°å½•å­¦ä¹ è¡Œä¸º
   */
  async trackStudy(type, data = {}) {
    return await this.addRecord({
      type,
      ...data,
      timestamp: Date.now()
    })
  }

  /**
   * è·å–ç”¨æˆ·æˆå°±æ•°æ®
   * åŸºäºçœŸå®ç­”é¢˜è®°å½•è®¡ç®—æˆå°±è¿›åº¦
   */
  async getAchievements() {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'achievements'
      })
      if (res.data && Object.keys(res.data).length > 0) {
        return res.data
      }
    } catch (err) {
      console.log('è·å–æˆå°±å¤±è´¥ï¼Œè®¡ç®—æœ¬åœ°æ•°æ®')
    }

    // æœ¬åœ°è®¡ç®—æˆå°±æ•°æ®ï¼ˆåŸºäº answer_history å’Œ study_recordsï¼‰
    return this.calculateLocalAchievements()
  }

  /**
   * æœ¬åœ°è®¡ç®—æˆå°±æ•°æ®
   * å½“äº‘å‡½æ•°ä¸å¯ç”¨æ—¶ä½¿ç”¨
   */
  async calculateLocalAchievements() {
    try {
      // è·å–å­¦ä¹ è®°å½•ç»Ÿè®¡
      const stats = await this.getStatistics()
      const homeStats = await this.getHomeStatistics()

      // è®¡ç®—æˆå°±
      const totalQuestions = stats.totalQuestions || 0
      const totalScore = stats.totalScore || 0
      const studyDays = homeStats.studyDays || 1
      const accuracy = stats.correctRate || 0

      // æ»¡åˆ†æ¬¡æ•°ï¼ˆä»å­¦ä¹ è®°å½•ä¸­ç»Ÿè®¡ï¼‰
      const records = await this.getRecords({}, 1, 100)
      const perfectCount = records.filter(r => r.score === 100).length

      // è¿ç»­å­¦ä¹ å¤©æ•°ï¼ˆä½¿ç”¨ homeStats.studyDaysï¼‰
      const streakDays = homeStats.studyDays || 1

      return {
        beginner: { unlocked: totalQuestions > 0, progress: 'å·²è§£é”' },
        week: { unlocked: streakDays >= 7, progress: `${Math.min(streakDays, 7)}/7å¤©` },
        perfect: { unlocked: perfectCount >= 10, progress: `${perfectCount}/10æ¬¡` },
        master: { unlocked: totalQuestions >= 500, progress: `${totalQuestions}/500é¢˜` },
        speed: { unlocked: totalQuestions >= 100, progress: `${Math.min(totalQuestions, 100)}/100é¢˜` },
        bookworm: { unlocked: totalScore >= 1000, progress: `${totalScore}/1000åˆ†` },
        scholar: { unlocked: accuracy >= 90 && totalQuestions >= 50, progress: `${accuracy}%` }
      }
    } catch (err) {
      // è¿”å›é»˜è®¤æˆå°±æ•°æ®
      return {
        beginner: { unlocked: true, progress: 'å·²è§£é”' },
        week: { unlocked: false, progress: '1/7å¤©' },
        perfect: { unlocked: false, progress: '0/10æ¬¡' },
        master: { unlocked: false, progress: '0/500é¢˜' },
        speed: { unlocked: false, progress: '0/100é¢˜' },
        bookworm: { unlocked: false, progress: '0/1000åˆ†' },
        scholar: { unlocked: false, progress: '0%' }
      }
    }
  }
}

export default new StudyService()


// ===== src/services/chat.js =====
/**
 * AI èŠå¤©æœåŠ¡
 */
import Taro from '@tarojs/taro'
import { callCloudFunction } from './request'
import { CLOUD_FUNCTIONS, DEFAULT_PAGE } from '../utils/constants'

// èŠå¤©å†å²å­˜å‚¨é”®
const CHAT_HISTORY_KEY = 'chat_history_local'
const CHAT_MAX_HISTORY = 100 // æœ¬åœ°æœ€å¤šä¿å­˜100æ¡æ¶ˆæ¯

// æœ¬åœ°çŸ¥è¯†åº“
const KNOWLEDGE_BASE = {
  // ä¿®è¾æ‰‹æ³•
  'æ¯”å–»': 'æ¯”å–»æ˜¯ä¸€ç§ä¿®è¾æ‰‹æ³•ï¼Œç”¨è·Ÿç”²äº‹ç‰©æœ‰ç›¸ä¼¼ä¹‹ç‚¹çš„ä¹™äº‹ç‰©æ¥æå†™æˆ–è¯´æ˜ç”²äº‹ç‰©ã€‚æ¯”å–»ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæœ¬ä½“ï¼ˆè¢«æ¯”å–»çš„äº‹ç‰©ï¼‰ã€å–»ä½“ï¼ˆç”¨æ¥æ¯”å–»çš„äº‹ç‰©ï¼‰å’Œæ¯”å–»è¯ï¼ˆå¦‚"åƒ""å¥½åƒ""ä»¿ä½›"ç­‰ï¼‰ã€‚\n\nä¾‹å¦‚ï¼š"æœˆäº®åƒåœ†ç›˜"ä¸­ï¼Œæœˆäº®æ˜¯æœ¬ä½“ï¼Œåœ†ç›˜æ˜¯å–»ä½“ï¼Œåƒæ˜¯æ¯”å–»è¯ã€‚',
  'æ˜å–»': 'æ˜å–»æ˜¯æ¯”å–»çš„ä¸€ç§ï¼Œæœ¬ä½“ã€å–»ä½“éƒ½å‡ºç°ï¼Œä¸­é—´ç”¨"åƒ""å¥½åƒ""ä»¿ä½›""çŠ¹å¦‚"ç­‰æ¯”å–»è¯è¿æ¥ã€‚\n\nä¾‹å¦‚ï¼š"å¼¯å¼¯çš„æœˆäº®åƒå°èˆ¹ã€‚"',
  'æš—å–»': 'æš—å–»æ˜¯æ¯”å–»çš„ä¸€ç§ï¼Œæœ¬ä½“ã€å–»ä½“éƒ½å‡ºç°ï¼Œä¸­é—´ç”¨"æ˜¯""å˜æˆ""æˆä¸º""ç­‰äº"ç­‰è¯è¿æ¥ã€‚\n\nä¾‹å¦‚ï¼š"è€å¸ˆæ˜¯è¾›å‹¤çš„å›­ä¸ã€‚"',
  'å€Ÿå–»': 'å€Ÿå–»æ˜¯æ¯”å–»çš„ä¸€ç§ï¼Œåªå‡ºç°å–»ä½“ï¼Œä¸å‡ºç°æœ¬ä½“å’Œæ¯”å–»è¯ã€‚\n\nä¾‹å¦‚ï¼š"è½å…‰äº†å¶å­çš„æ ‘æä¸Šï¼ŒæŒ‚æ»¡äº†äº®æ™¶æ™¶çš„é“¶æ¡å„¿"ï¼ˆå€Ÿå–»é›ªæŒ‚ï¼‰ã€‚',
  'æ‹Ÿäºº': 'æ‹Ÿäººæ˜¯ä¸€ç§ä¿®è¾æ‰‹æ³•ï¼ŒæŠŠäº‹ç‰©äººæ ¼åŒ–ï¼Œå°†æœ¬æ¥ä¸å…·å¤‡äººåŠ¨ä½œå’Œæ„Ÿæƒ…çš„äº‹ç‰©ï¼Œå˜æˆå’Œäººä¸€æ ·å…·æœ‰åŠ¨ä½œå’Œæ„Ÿæƒ…çš„æ ·å­ã€‚\n\nä¾‹å¦‚ï¼š"èŠ±å„¿åœ¨é£ä¸­å¾®ç¬‘ã€‚"',

  // è¯—è¯
  'æ„è±¡': 'å¤è¯—ä¸­å¸¸ç”¨çš„æ„è±¡æœ‰ï¼š\n\n1. æœˆäº®ï¼šè±¡å¾æ€ä¹¡ã€å›¢åœ†ã€ç¾å¥½\n2. æŸ³æ ‘ï¼šè±¡å¾ç¦»åˆ«ã€æŒ½ç•™\n3. èŠèŠ±ï¼šè±¡å¾é«˜æ´ã€éšé€¸\n4. æ¢…èŠ±ï¼šè±¡å¾åšå¼ºã€é«˜æ´\n5. æ¾æŸï¼šè±¡å¾åšè´ã€ä¸å±ˆ\n6. è·èŠ±ï¼šè±¡å¾é«˜æ´ã€å‡ºæ·¤æ³¥è€Œä¸æŸ“\n7. æœé¹ƒï¼šè±¡å¾å“€æ€¨ã€æ€ä¹¡\n8. é¸¿é›ï¼šè±¡å¾ä¹¦ä¿¡ã€æ€å¿µ',
  'æ€ä¹¡': 'å¤è¯—ä¸­è¡¨è¾¾æ€ä¹¡ä¹‹æƒ…çš„å¸¸ç”¨æ„è±¡å’Œè¯—å¥ï¼š\n\nâ€¢ æœˆäº®ï¼š"ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡"\nâ€¢ æŸ³æ ‘ï¼š"æ˜”æˆ‘å¾€çŸ£ï¼Œæ¨æŸ³ä¾ä¾"\nâ€¢ é¸¿é›ï¼š"é¸¿é›é•¿é£å…‰ä¸åº¦"\nâ€¢ æ¢§æ¡ï¼š"æ¢§æ¡æ›´å…¼ç»†é›¨ï¼Œåˆ°é»„æ˜ç‚¹ç‚¹æ»´æ»´"',

  // è¯è¯­
  'è¿‘ä¹‰è¯': 'åŒºåˆ†è¿‘ä¹‰è¯çš„æ–¹æ³•ï¼š\n\n1. è¯ä¹‰è½»é‡ä¸åŒï¼šå¦‚"æ‰¹è¯„"ä¸"æ‰¹åˆ¤"\n2. è¯ä¹‰èŒƒå›´ä¸åŒï¼šå¦‚"æˆ˜äº‰"ä¸"æˆ˜å½¹"\n3. æ„Ÿæƒ…è‰²å½©ä¸åŒï¼šå¦‚"æœæ–­"ä¸"æ­¦æ–­"\n4. æ­é…å…³ç³»ä¸åŒï¼šå¦‚"å‘æŒ¥"ä¸"å‘æ‰¬"\n\nå»ºè®®é€šè¿‡å¤šè¯»å¤šå†™ã€æŸ¥å­—å…¸ã€æ¯”è¾ƒè¾¨ææ¥æŒæ¡ã€‚',
  'åä¹‰è¯': 'åä¹‰è¯æ˜¯æŒ‡æ„ä¹‰ç›¸åæˆ–ç›¸å¯¹çš„è¯ã€‚\n\næ„æˆåä¹‰å…³ç³»çš„è¯å¿…é¡»å±äºåŒä¸€æ„ä¹‰èŒƒç•´ï¼Œå¦‚"é•¿"å’Œ"çŸ­"ï¼ˆé•¿åº¦èŒƒç•´ï¼‰ï¼Œ"å¤"å’Œ"ä»Š"ï¼ˆæ—¶é—´èŒƒç•´ï¼‰ã€‚\n\næ³¨æ„ï¼šå¹¶éæ‰€æœ‰è¯éƒ½æœ‰åä¹‰è¯ï¼Œå¦‚"ä¹¦""æ¡Œå­"ç­‰åè¯å°±æ²¡æœ‰åä¹‰è¯ã€‚',

  // è¯­æ³•
  'ç—…å¥': 'å¸¸è§çš„ç—…å¥ç±»å‹åŠä¿®æ”¹æ–¹æ³•ï¼š\n\n1. æˆåˆ†æ®‹ç¼ºï¼šç¼ºä¸»è¯­ã€è°“è¯­ã€å®¾è¯­\n   ä¿®æ”¹ï¼šè¡¥å……æ®‹ç¼ºæˆåˆ†\n\n2. æ­é…ä¸å½“ï¼šä¸»è°“ã€åŠ¨å®¾ã€ä¿®é¥°è¯­ä¸ä¸­å¿ƒè¯­æ­é…ä¸å½“\n   ä¿®æ”¹ï¼šè°ƒæ•´è¯è¯­ä½¿æ­é…æ°å½“\n\n3. è¯­åºä¸å½“ï¼šå®šè¯­ã€çŠ¶è¯­ã€è¡¥è¯­ä½ç½®ä¸å½“\n   ä¿®æ”¹ï¼šè°ƒæ•´è¯è¯­é¡ºåº\n\n4. ç»“æ„æ··ä¹±ï¼šå¥å¼æ‚ç³…ã€ä¸­é€”æ˜“è¾™\n   ä¿®æ”¹ï¼šç†æ¸…ç»“æ„ï¼Œæ”¹ä¸ºå•ä¸€å¥å¼',
  'è¯­æ³•': 'è¯­æ–‡è¯­æ³•åŸºç¡€çŸ¥è¯†ï¼š\n\n1. è¯ç±»ï¼šåã€åŠ¨ã€å½¢ã€æ•°ã€é‡ã€ä»£ã€å‰¯ã€ä»‹ã€è¿ã€åŠ©ã€å¹ã€æ‹Ÿå£°\n2. å¥å­æˆåˆ†ï¼šä¸»ã€è°“ã€å®¾ã€å®šã€çŠ¶ã€è¡¥\n3. å¥å¼ï¼šé™ˆè¿°å¥ã€ç–‘é—®å¥ã€ç¥ˆä½¿å¥ã€æ„Ÿå¹å¥\n4. å¤å¥ç±»å‹ï¼šå¹¶åˆ—ã€é€’è¿›ã€é€‰æ‹©ã€è½¬æŠ˜ã€å› æœã€å‡è®¾ã€æ¡ä»¶',

  // å†™ä½œ
  'ä½œæ–‡': 'å†™å¥½ä½œæ–‡çš„è¦ç‚¹ï¼š\n\n1. å¼€å¤´ï¼šè¦å¸å¼•äººï¼Œå¯ä»¥å¼€é—¨è§å±±ã€è®¾ç½®æ‚¬å¿µã€å¼•ç”¨åè¨€\n2. ä¸­é—´ï¼šè¦æœ‰å…·ä½“äº‹ä¾‹ï¼Œè¯¦ç•¥å¾—å½“ï¼Œæœ‰ç»†èŠ‚æå†™\n3. ç»“å°¾ï¼šè¦ç‚¹é¢˜ï¼Œå¯ä»¥æ€»ç»“å…¨æ–‡ã€å‘¼åº”å¼€å¤´ã€å‘äººæ·±çœ\n4. è¯­è¨€ï¼šè¦ç”ŸåŠ¨å½¢è±¡ï¼Œè¿ç”¨ä¿®è¾æ‰‹æ³•\n5. æƒ…æ„Ÿï¼šè¦çœŸæŒšæ„Ÿäºº',
  'å¼€å¤´': 'å¥½çš„ä½œæ–‡å¼€å¤´æ–¹æ³•ï¼š\n\n1. å¼€é—¨è§å±±ï¼šç›´æ¥ç‚¹æ˜ä¸»é¢˜\n2. è®¾ç½®æ‚¬å¿µï¼šå¼•èµ·è¯»è€…å…´è¶£\n3. å¼•ç”¨åè¨€ï¼šå¢åŠ æ–‡é‡‡\n4. æå†™ç¯å¢ƒï¼šçƒ˜æ‰˜æ°”æ°›\n5. æŠ’æƒ…è®®è®ºï¼šè¡¨è¾¾æƒ…æ„Ÿè§‚ç‚¹\n\nä¾‹å¦‚ï¼š"æ˜¥å¤©åˆåˆ°äº†ï¼Œæœ›ç€çª—å¤–é‚£ç‰‡æ–°ç»¿ï¼Œæˆ‘ä¸ç¦æƒ³èµ·äº†å¥¶å¥¶..."',

  // æ–‡è¨€æ–‡
  'æ–‡è¨€æ–‡': 'æ–‡è¨€æ–‡è™šè¯å¸¸ç”¨ç”¨æ³•ï¼š\n\nä¹‹ï¼šâ‘ ä»£è¯ â‘¡åŠ©è¯"çš„" â‘¢åŠ¨è¯"å»"\n\nè€Œï¼šâ‘ è¿è¯è¡¨å¹¶åˆ— â‘¡è¿è¯è¡¨æ‰¿æ¥ â‘¢è¿è¯è¡¨è½¬æŠ˜\n\nä»¥ï¼šâ‘ ä»‹è¯"ç”¨ã€å‡­å€Ÿ" â‘¡è¿è¯"å› ä¸º" â‘¢è¿è¯"æ¥"\n\näºï¼šâ‘ ä»‹è¯"åœ¨" â‘¡ä»‹è¯"å‘" â‘¢ä»‹è¯"å¯¹"\n\nä¸ºï¼šâ‘ åŠ¨è¯"æ˜¯ã€åš" â‘¡ä»‹è¯"è¢«ã€æ›¿" â‘¢ä»‹è¯"ä¸ºäº†"',

  // æ ‡ç‚¹ç¬¦å·
  'æ ‡ç‚¹': 'å¸¸ç”¨æ ‡ç‚¹ç¬¦å·ç”¨æ³•ï¼š\n\n1. å¥å·ï¼ˆã€‚ï¼‰ï¼šé™ˆè¿°å¥æœ«å°¾\n2. é—®å·ï¼ˆï¼Ÿï¼‰ï¼šç–‘é—®å¥æœ«å°¾\n3. å¹å·ï¼ˆï¼ï¼‰ï¼šæ„Ÿå¹å¥æœ«å°¾\n4. é€—å·ï¼ˆï¼Œï¼‰ï¼šå¥å­ä¸­é—´åœé¡¿\n5. åˆ†å·ï¼ˆï¼›ï¼‰ï¼šå¹¶åˆ—åˆ†å¥ä¹‹é—´\n6. å†’å·ï¼ˆï¼šï¼‰ï¼šæç¤ºä¸‹æ–‡\n7. å¼•å·ï¼ˆ""""ï¼‰ï¼šå¼•ç”¨ã€å¼ºè°ƒ\n8. ç ´æŠ˜å·ï¼ˆâ€”â€”ï¼‰ï¼šè§£é‡Šã€è½¬æŠ˜',

  // é»˜è®¤å›å¤
  'default': 'æ„Ÿè°¢ä½ çš„æé—®ï¼ä½œä¸ºè¯­æ–‡å­¦ä¹ åŠ©æ‰‹ï¼Œæˆ‘å¯ä»¥å¸®ä½ è§£ç­”å…³äºï¼š\n\nâ€¢ è¯è¯­é‡Šä¹‰ã€è¿‘ä¹‰è¯ã€åä¹‰è¯\nâ€¢ å¤è¯—è¯èµæå’Œæ„è±¡\nâ€¢ ä¿®è¾æ‰‹æ³•å’Œè¯­æ³•çŸ¥è¯†\nâ€¢ æ–‡è¨€æ–‡åŸºç¡€çŸ¥è¯†\nâ€¢ å†™ä½œæŠ€å·§å’Œä½œæ–‡æ–¹æ³•\n\nè¯·æå‡ºä½ çš„å…·ä½“é—®é¢˜ï¼Œæˆ‘ä¼šå°½åŠ›ä¸ºä½ è§£ç­”ï¼'
}

// å…³é”®è¯åŒ¹é…
const KEYWORD_MAP = {
  'æ¯”å–»': 'æ¯”å–»', 'æ˜å–»': 'æ˜å–»', 'æš—å–»': 'æš—å–»', 'å€Ÿå–»': 'å€Ÿå–»',
  'æ‹Ÿäºº': 'æ‹Ÿäºº', 'å¤¸å¼ ': 'æ¯”å–»', 'æ’æ¯”': 'ä½œæ–‡',
  'è¿‘ä¹‰è¯': 'è¿‘ä¹‰è¯', 'åä¹‰è¯': 'åä¹‰è¯', 'åŒä¹‰è¯': 'è¿‘ä¹‰è¯',
  'æ„è±¡': 'æ„è±¡', 'æ€ä¹¡': 'æ€ä¹¡', 'æ€ä¹¡': 'æ€ä¹¡', 'å®¶ä¹¡': 'æ€ä¹¡',
  'ç—…å¥': 'ç—…å¥', 'ä¿®æ”¹': 'ç—…å¥', 'è¯­æ³•': 'è¯­æ³•',
  'ä½œæ–‡': 'ä½œæ–‡', 'å†™ä½œ': 'ä½œæ–‡', 'å¼€å¤´': 'å¼€å¤´', 'ç»“å°¾': 'ä½œæ–‡',
  'æ–‡è¨€æ–‡': 'æ–‡è¨€æ–‡', 'è™šè¯': 'æ–‡è¨€æ–‡', 'å®è¯': 'æ–‡è¨€æ–‡',
  'æ ‡ç‚¹': 'æ ‡ç‚¹', 'ç¬¦å·': 'æ ‡ç‚¹'
}

class ChatService {
  /**
   * ä»æœ¬åœ°å­˜å‚¨åŠ è½½èŠå¤©å†å²
   */
  loadLocalHistory() {
    try {
      const history = Taro.getStorageSync(CHAT_HISTORY_KEY)
      return history || []
    } catch (err) {
      console.error('åŠ è½½æœ¬åœ°å†å²å¤±è´¥:', err)
      return []
    }
  }

  /**
   * ä¿å­˜èŠå¤©å†å²åˆ°æœ¬åœ°
   */
  saveLocalHistory(messages) {
    try {
      // åªä¿ç•™æœ€è¿‘çš„ N æ¡æ¶ˆæ¯
      const toSave = messages.slice(-CHAT_MAX_HISTORY)
      Taro.setStorageSync(CHAT_HISTORY_KEY, toSave)
    } catch (err) {
      console.error('ä¿å­˜æœ¬åœ°å†å²å¤±è´¥:', err)
    }
  }

  /**
   * æ·»åŠ æ¶ˆæ¯åˆ°æœ¬åœ°å†å²
   */
  addMessageToLocal(message) {
    const history = this.loadLocalHistory()
    history.push({
      ...message,
      timestamp: Date.now()
    })
    this.saveLocalHistory(history)
  }

  /**
   * æ¸…ç©ºæœ¬åœ°èŠå¤©å†å²
   */
  clearLocalHistory() {
    try {
      Taro.removeStorageSync(CHAT_HISTORY_KEY)
    } catch (err) {
      console.error('æ¸…ç©ºæœ¬åœ°å†å²å¤±è´¥:', err)
    }
  }

  /**
   * æŸ¥æ‰¾æœ¬åœ°çŸ¥è¯†åº“ç­”æ¡ˆ
   */
  findLocalAnswer(message) {
    const msg = message.toLowerCase().trim()

    // 1. å®Œå…¨åŒ¹é…å…³é”®è¯
    for (const [keyword, answerKey] of Object.entries(KEYWORD_MAP)) {
      if (msg.includes(keyword)) {
        return KNOWLEDGE_BASE[answerKey] || KNOWLEDGE_BASE['default']
      }
    }

    // 2. æ£€æŸ¥å…·ä½“é—®é¢˜
    if (msg.includes('ä»€ä¹ˆæ˜¯') || msg.includes('ä»€ä¹ˆ')) {
      for (const [keyword, answerKey] of Object.entries(KEYWORD_MAP)) {
        if (msg.includes(keyword)) {
          return KNOWLEDGE_BASE[answerKey] || KNOWLEDGE_BASE['default']
        }
      }
    }

    // 3. æ£€æŸ¥"å¦‚ä½•""æ€æ ·"ç±»é—®é¢˜
    if (msg.includes('å¦‚ä½•') || msg.includes('æ€æ ·') || msg.includes('æ€ä¹ˆ')) {
      if (msg.includes('åŒºåˆ†') || msg.includes('è¿‘ä¹‰è¯') || msg.includes('åä¹‰è¯')) {
        return KNOWLEDGE_BASE['è¿‘ä¹‰è¯']
      }
      if (msg.includes('ä¿®æ”¹') || msg.includes('ç—…å¥')) {
        return KNOWLEDGE_BASE['ç—…å¥']
      }
      if (msg.includes('å†™') || msg.includes('ä½œæ–‡')) {
        return KNOWLEDGE_BASE['ä½œæ–‡']
      }
    }

    // 4. é»˜è®¤å›å¤
    return KNOWLEDGE_BASE['default']
  }

  /**
   * å‘é€æ¶ˆæ¯ç»™ AI
   */
  async sendMessage(message, conversationId = null) {
    // å…ˆä¿å­˜ç”¨æˆ·æ¶ˆæ¯åˆ°æœ¬åœ°
    this.addMessageToLocal({
      id: Date.now(),
      role: 'user',
      content: message
    })

    Taro.showLoading({ title: 'æ€è€ƒä¸­...' })

    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.CHAT, {
        action: 'sendMessage',
        message,
        conversationId
      })

      if (res && res.success) {
        // ä¿å­˜ AI å›å¤åˆ°æœ¬åœ°
        this.addMessageToLocal({
          id: res.data.messageId || Date.now() + 1,
          role: 'assistant',
          content: res.data.reply
        })
        return res.data
      }

      throw new Error(res?.message || 'å‘é€å¤±è´¥')
    } catch (err) {
      console.log('äº‘å‡½æ•°è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°çŸ¥è¯†åº“')

      // ä½¿ç”¨æœ¬åœ°çŸ¥è¯†åº“ä½œä¸º fallback
      const localReply = this.findLocalAnswer(message)
      const result = {
        messageId: Date.now(),
        reply: localReply,
        fromLocal: true
      }

      // ä¿å­˜ AI å›å¤åˆ°æœ¬åœ°
      this.addMessageToLocal({
        id: result.messageId,
        role: 'assistant',
        content: localReply
      })

      return result
    } finally {
      Taro.hideLoading()
    }
  }

  /**
   * è·å–èŠå¤©å†å²
   */
  async getHistory(page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.CHAT, {
        action: 'history',
        page,
        pageSize
      })
      return res?.data || []
    } catch (err) {
      console.log('è·å–äº‘ç«¯å†å²å¤±è´¥ï¼Œè¿”å›æœ¬åœ°å†å²')
      // äº‘ç«¯è·å–å¤±è´¥æ—¶è¿”å›æœ¬åœ°å†å²
      return this.loadLocalHistory()
    }
  }

  /**
   * è·å–ä¼šè¯è¯¦æƒ…
   */
  async getConversation(conversationId) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.CHAT, {
        action: 'conversation',
        conversationId
      })
      return res?.data || null
    } catch (err) {
      // è¿”å›æœ¬åœ°å†å²ä½œä¸º fallback
      return {
        messages: this.loadLocalHistory()
      }
    }
  }

  /**
   * æ¸…ç©ºèŠå¤©è®°å½•
   */
  async clearHistory(conversationId = null) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.CHAT, {
        action: 'clear',
        conversationId
      })
    } catch (err) {
      console.log('æ¸…ç©ºäº‘ç«¯å†å²å¤±è´¥')
    }
    // åŒæ—¶æ¸…ç©ºæœ¬åœ°å†å²
    this.clearLocalHistory()
    return true
  }

  /**
   * åˆ é™¤å•æ¡æ¶ˆæ¯
   */
  async deleteMessage(messageId) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.CHAT, {
        action: 'delete',
        messageId
      })
      return res?.success || false
    } catch (err) {
      Taro.showToast({ title: 'åˆ é™¤å¤±è´¥', icon: 'none' })
      return false
    }
  }

  /**
   * è·å–é¢„è®¾é—®é¢˜
   */
  async getPresetQuestions() {
    return [
      { id: 1, text: 'ä»€ä¹ˆæ˜¯æ¯”å–»ï¼Ÿ' },
      { id: 2, text: 'ä»€ä¹ˆæ˜¯æ‹Ÿäººï¼Ÿ' },
      { id: 3, text: 'å¤è¯—ä¸­å¸¸ç”¨çš„æ„è±¡æœ‰å“ªäº›ï¼Ÿ' },
      { id: 4, text: 'å¦‚ä½•åŒºåˆ†è¿‘ä¹‰è¯ï¼Ÿ' },
      { id: 5, text: 'æ€æ ·ä¿®æ”¹ç—…å¥ï¼Ÿ' },
      { id: 6, text: 'å¦‚ä½•å†™å¥½ä½œæ–‡å¼€å¤´ï¼Ÿ' }
    ]
  }

  /**
   * æµå¼å›å¤ï¼ˆäº‘å‡½æ•°æ”¯æŒçš„è¯ï¼‰
   */
  async streamMessage(message, onMessage, onComplete) {
    const res = await this.sendMessage(message)
    if (onMessage) {
      onMessage(res.reply)
    }
    if (onComplete) {
      onComplete(res)
    }
    return res
  }
}

export default new ChatService()


// ===== src/services/vocabulary.js =====
/**
 * è¯æ±‡æœåŠ¡
 */
import Taro from '@tarojs/taro'
import { callCloudFunction } from './request'
import { CLOUD_FUNCTIONS, DEFAULT_PAGE } from '../utils/constants'

// æ¨¡æ‹Ÿè¯æ±‡æ•°æ®
const MOCK_WORDS = [
  {
    word: 'å§¹ç´«å«£çº¢',
    pinyin: 'chÃ  zÇ yÄn hÃ³ng',
    definition: 'å½¢å®¹å„ç§é¢œè‰²çš„èŠ±æœµï¼Œå¨‡è‰³ã€ç»šä¸½ã€å¥½çœ‹ã€‚ä¹Ÿæ¯”å–»äº‹ç‰©ç¹è£å…´æ—ºã€ä¸°å¯Œå¤šå½©ã€‚',
    example: 'èŠ±å›­é‡Œå§¹ç´«å«£çº¢ï¼Œç”Ÿæœºç›ç„¶ã€‚',
    synonyms: ['äº”å½©ç¼¤çº·', 'ä¸‡ç´«åƒçº¢', 'èŠ±å›¢é”¦ç°‡'],
    antonyms: ['æ¯æ§å‡‹é›¶', 'æ®‹èŠ±è´¥æŸ³']
  },
  {
    word: 'ç¾è½®ç¾å¥‚',
    pinyin: 'mÄ›i lÃºn mÄ›i huÃ n',
    definition: 'å½¢å®¹æˆ¿å±‹é«˜å¤§åä¸½ã€‚è½®ï¼šé«˜å¤§ï¼›å¥‚ï¼šä¼—å¤šã€‚å¤šç”¨äºèµç¾å»ºç­‘ç‰©çš„æ–°å»ºã€è£…ä¿®ç­‰ã€‚',
    example: 'è¿™åº§æ–°å»ºçš„å¤§å¦ç¾è½®ç¾å¥‚ï¼Œååˆ†å£®è§‚ã€‚',
    synonyms: ['å¯Œä¸½å ‚çš‡', 'é›•æ¢ç”»æ ‹', 'é‡‘ç¢§è¾‰ç…Œ'],
    antonyms: ['å› é™‹å°±ç®€', 'åœŸé‡ŒåœŸæ°”']
  },
  {
    word: 'è„ç‚™äººå£',
    pinyin: 'kuÃ i zhÃ¬ rÃ©n kÇ’u',
    definition: 'è„ï¼šåˆ‡ç»†çš„è‚‰ï¼›ç‚™ï¼šçƒ¤è‚‰ã€‚æ¯”å–»å¥½çš„è¯—æ–‡æˆ–äº‹ç‰©ä¸ºä¼—äººæ‰€ç§°é¢‚ã€‚',
    example: 'ã€Šçº¢æ¥¼æ¢¦ã€‹æ˜¯ä¸€éƒ¨è„ç‚™äººå£çš„å¤å…¸å°è¯´ã€‚',
    synonyms: ['æœ‰å£çš†ç¢‘', 'å®¶å–»æˆ·æ™“', 'å–œé—»ä¹è§'],
    antonyms: ['é²œä¸ºäººçŸ¥', 'é»˜é»˜æ— é—»']
  },
  {
    word: 'æŠ‘æ‰¬é¡¿æŒ«',
    pinyin: 'yÃ¬ yÃ¡ng dÃ¹n cuÃ²',
    definition: 'æŠ‘ï¼šé™ä½ï¼›æ‰¬ï¼šå‡é«˜ï¼›é¡¿ï¼šåœé¡¿ï¼›æŒ«ï¼šè½¬æŠ˜ã€‚æŒ‡å£°éŸ³çš„é«˜ä½èµ·ä¼å’Œåœé¡¿è½¬æŠ˜ã€‚',
    example: 'ä»–çš„æœ—è¯»æŠ‘æ‰¬é¡¿æŒ«ï¼Œååˆ†åŠ¨å¬ã€‚',
    synonyms: ['é“¿é”µæœ‰åŠ›', 'æœ—æœ—ä¸Šå£'],
    antonyms: ['å¹³æ·¡æ— å¥‡', 'æ¯ç‡¥ä¹å‘³']
  },
  {
    word: 'ç›¸å¾—ç›Šå½°',
    pinyin: 'xiÄng dÃ© yÃ¬ zhÄng',
    definition: 'æŒ‡ä¸¤ä¸ªäººæˆ–ä¸¤ä»¶äº‹ç‰©äº’ç›¸é…åˆï¼ŒåŒæ–¹çš„èƒ½åŠ›å’Œä½œç”¨æ›´èƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚',
    example: 'è¿™ä¸¤ç§æ–¹æ³•ç›¸å¾—ç›Šå½°ï¼Œç»“åˆä½¿ç”¨æ•ˆæœæ›´å¥½ã€‚',
    synonyms: ['ç›¸è¾…ç›¸æˆ', 'é”¦ä¸Šæ·»èŠ±'],
    antonyms: ['é€‚å¾—å…¶å', 'é›ªä¸ŠåŠ éœœ']
  },
  {
    word: 'é”²è€Œä¸èˆ',
    pinyin: 'qiÃ¨ Ã©r bÃ¹ shÄ›',
    definition: 'é”²ï¼šåˆ»ï¼›èˆï¼šåœæ­¢ã€‚ä¸æ–­åœ°é›•åˆ»ã€‚æ¯”å–»æœ‰æ’å¿ƒï¼Œæœ‰æ¯…åŠ›ï¼ŒåšæŒä¸æ‡ˆã€‚',
    example: 'å­¦ä¹ éœ€è¦é”²è€Œä¸èˆçš„ç²¾ç¥ï¼Œä¸èƒ½åŠé€”è€ŒåºŸã€‚',
    synonyms: ['åšæŒä¸æ‡ˆ', 'æŒä¹‹ä»¥æ’', 'åšéŸ§ä¸æ‹”'],
    antonyms: ['åŠé€”è€ŒåºŸ', 'æµ…å°è¾„æ­¢']
  },
  {
    word: 'æœªé›¨ç»¸ç¼ª',
    pinyin: 'wÃ¨i yÇ” chÃ³u mÃ³u',
    definition: 'ç»¸ç¼ªï¼šç´§å¯†ç¼ ç¼šã€‚åœ¨å¤©æ²¡ä¸‹é›¨æ—¶ï¼Œå°±ä¿®è¡¥å¥½é—¨çª—ã€‚æ¯”å–»äº‹å…ˆåšå¥½å‡†å¤‡å·¥ä½œã€‚',
    example: 'æˆ‘ä»¬è¦æœªé›¨ç»¸ç¼ªï¼Œæå‰åšå¥½é˜²èŒƒæªæ–½ã€‚',
    synonyms: ['æœ‰å¤‡æ— æ‚£', 'é˜²æ‚£æœªç„¶', 'å±…å®‰æ€å±'],
    antonyms: ['ä¸´æ¸´æ˜äº•', 'äº¡ç¾Šè¡¥ç‰¢']
  },
  {
    word: 'åšç§¯è–„å‘',
    pinyin: 'hÃ²u jÄ« bÃ³ fÄ',
    definition: 'åšç§¯ï¼šå¤§é‡ç§¯ç´¯ï¼›è–„å‘ï¼šå°‘é‡å–·å‘ã€‚å½¢å®¹é•¿æ—¶é—´ç§¯ç´¯ï¼Œæ…¢æ…¢é‡Šæ”¾å‡ºæ¥ã€‚',
    example: 'æˆåŠŸéœ€è¦åšç§¯è–„å‘ï¼Œä¸èƒ½æ€¥äºæ±‚æˆã€‚',
    synonyms: ['åšè§‚çº¦å–', 'æ¸©æ•…çŸ¥æ–°'],
    antonyms: ['æµ…å°è¾„æ­¢', 'å¥½é«˜éª›è¿œ']
  }
]

// æ¨¡æ‹Ÿæˆè¯­æ•°æ®
const MOCK_IDIOMS = [
  {
    idiom: 'ç”»è›‡æ·»è¶³',
    pinyin: 'huÃ  shÃ© tiÄn zÃº',
    definition: 'æ¯”å–»åšäº†å¤šä½™çš„äº‹ï¼Œéä½†æ— ç›Šï¼Œåè€Œä¸åˆé€‚ã€‚',
    example: 'è¿™ä»¶äº‹æœ¬æ¥å·²ç»å®Œæˆäº†ï¼Œä½ åˆå»æ”¹åŠ¨ï¼Œç®€ç›´æ˜¯ç”»è›‡æ·»è¶³ã€‚',
    source: 'ã€Šæˆ˜å›½ç­–Â·é½ç­–äºŒã€‹'
  },
  {
    idiom: 'å®ˆæ ªå¾…å…”',
    pinyin: 'shÇ’u zhÅ« dÃ i tÃ¹',
    definition: 'æ¯”å–»æ­»å®ˆç‹­éš˜ç»éªŒï¼Œä¸çŸ¥å˜é€šã€‚',
    example: 'æˆ‘ä»¬ä¸èƒ½å®ˆæ ªå¾…å…”ï¼Œè¦ä¸»åŠ¨å¯»æ‰¾æœºä¼šã€‚',
    source: 'ã€ŠéŸ©éå­Â·äº”è ¹ã€‹'
  },
  {
    idiom: 'æ©è€³ç›—é“ƒ',
    pinyin: 'yÇn Ä›r dÃ o lÃ­ng',
    definition: 'æ¯”å–»è‡ªå·±æ¬ºéª—è‡ªå·±ã€‚',
    example: 'ä»–æƒ³é ä½œå¼Šå–å¾—å¥½æˆç»©ï¼Œè¿™ç®€ç›´æ˜¯æ©è€³ç›—é“ƒã€‚',
    source: 'ã€Šå•æ°æ˜¥ç§‹Â·è‡ªçŸ¥ã€‹'
  },
  {
    idiom: 'äº¡ç¾Šè¡¥ç‰¢',
    pinyin: 'wÃ¡ng yÃ¡ng bÇ” lÃ¡o',
    definition: 'æ¯”å–»å‡ºäº†é—®é¢˜ä»¥åæƒ³åŠæ³•è¡¥æ•‘ï¼Œå¯ä»¥é˜²æ­¢ç»§ç»­å—æŸå¤±ã€‚',
    example: 'è™½ç„¶è€ƒè¯•å¤±è´¥äº†ï¼Œä½†äº¡ç¾Šè¡¥ç‰¢ï¼Œä¸ºæ—¶æœªæ™šã€‚',
    source: 'ã€Šæˆ˜å›½ç­–Â·æ¥šç­–å››ã€‹'
  },
  {
    idiom: 'åˆ»èˆŸæ±‚å‰‘',
    pinyin: 'kÃ¨ zhÅu qiÃº jiÃ n',
    definition: 'æ¯”å–»æ‹˜æ³¥æˆæ³•ï¼Œä¸çŸ¥é“å˜é€šã€‚',
    example: 'æ—¶ä»£åœ¨å˜åŒ–ï¼Œæˆ‘ä»¬ä¸èƒ½åˆ»èˆŸæ±‚å‰‘ã€‚',
    source: 'ã€Šå•æ°æ˜¥ç§‹Â·å¯Ÿä»Šã€‹'
  },
  {
    idiom: 'äº•åº•ä¹‹è›™',
    pinyin: 'jÇng dÇ zhÄ« wÄ',
    definition: 'æ¯”å–»è§è¯†ç‹­çª„çš„äººã€‚',
    example: 'è¦å¤šè¯»ä¹¦ï¼Œå¤šå‡ºå»èµ°èµ°ï¼Œä¸è¦åšäº•åº•ä¹‹è›™ã€‚',
    source: 'ã€Šåº„å­Â·ç§‹æ°´ã€‹'
  },
  {
    idiom: 'ç‹å‡è™å¨',
    pinyin: 'hÃº jiÇ hÇ” wÄ“i',
    definition: 'æ¯”å–»ä¾ä»—åˆ«äººçš„åŠ¿åŠ›æ¥æ¬ºå‹äººã€‚',
    example: 'ä»–åªæ˜¯ç‹å‡è™å¨ï¼Œå…¶å®æ²¡æœ‰ä»€ä¹ˆçœŸæœ¬äº‹ã€‚',
    source: 'ã€Šæˆ˜å›½ç­–Â·æ¥šç­–ä¸€ã€‹'
  },
  {
    idiom: 'è‡ªç›¸çŸ›ç›¾',
    pinyin: 'zÃ¬ xiÄng mÃ¡o dÃ¹n',
    definition: 'æ¯”å–»è‡ªå·±è¯´è¯åšäº‹å‰åæŠµè§¦ã€‚',
    example: 'ä»–çš„è¯å‰åçŸ›ç›¾ï¼Œç®€ç›´æ˜¯è‡ªç›¸çŸ›ç›¾ã€‚',
    source: 'ã€ŠéŸ©éå­Â·éš¾ä¸€ã€‹'
  },
  {
    idiom: 'æ‹”è‹—åŠ©é•¿',
    pinyin: 'bÃ¡ miÃ¡o zhÃ¹ zhÇng',
    definition: 'æ¯”å–»è¿åäº‹ç‰©å‘å±•çš„å®¢è§‚è§„å¾‹ï¼Œæ€¥äºæ±‚æˆï¼Œåè€ŒæŠŠäº‹æƒ…å¼„ç³Ÿã€‚',
    example: 'æ•™è‚²å­©å­è¦å¾ªåºæ¸è¿›ï¼Œä¸èƒ½æ‹”è‹—åŠ©é•¿ã€‚',
    source: 'ã€Šå­Ÿå­Â·å…¬å­™ä¸‘ä¸Šã€‹'
  }
]

class VocabularyService {
  /**
   * æœç´¢è¯è¯­
   */
  async searchWord(word) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.VOCABULARY, {
        action: 'search',
        word
      })
      if (res.data) return res.data
    } catch (err) {
      console.log('ä½¿ç”¨æœ¬åœ°æ•°æ®')
    }

    // ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®
    const found = MOCK_WORDS.find(w => w.word === word || w.word.includes(word))
    return found || MOCK_WORDS[0]
  }

  /**
   * è·å–è¯è¯­åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
   */
  async getWords(page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.VOCABULARY, {
        action: 'list',
        page,
        pageSize
      })
      if (res.data && res.data.length > 0) return res.data
    } catch (err) {
      console.log('ä½¿ç”¨æœ¬åœ°æ•°æ®')
    }

    // ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®
    return MOCK_WORDS
  }

  /**
   * è·å–æ¯æ—¥æ¨èè¯è¯­
   */
  async getDailyWords(count = 10) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.VOCABULARY, {
        action: 'daily',
        count
      })
      if (res.data && res.data.length > 0) return res.data
    } catch (err) {
      console.log('ä½¿ç”¨æœ¬åœ°æ•°æ®')
    }

    // ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®ï¼ˆéšæœºæ‰“ä¹±ï¼‰
    return [...MOCK_WORDS].sort(() => Math.random() - 0.5).slice(0, Math.min(count, MOCK_WORDS.length))
  }

  /**
   * è·å–æˆè¯­åˆ—è¡¨
   */
  async getIdioms(page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.VOCABULARY, {
        action: 'idioms',
        page,
        pageSize
      })
      if (res.data && res.data.length > 0) return res.data
    } catch (err) {
      console.log('ä½¿ç”¨æœ¬åœ°æ•°æ®')
    }

    // ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®
    return MOCK_IDIOMS
  }

  /**
   * æœç´¢æˆè¯­
   */
  async searchIdiom(keyword) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.VOCABULARY, {
        action: 'searchIdiom',
        keyword
      })
      if (res.data && res.data.length > 0) return res.data
    } catch (err) {
      console.log('ä½¿ç”¨æœ¬åœ°æ•°æ®')
    }

    // ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®æœç´¢
    const filtered = MOCK_IDIOMS.filter(item =>
      item.idiom.includes(keyword) ||
      item.pinyin.toLowerCase().includes(keyword.toLowerCase())
    )
    return filtered.length > 0 ? filtered : MOCK_IDIOMS
  }

  /**
   * è·å–è¯è¯­è¯¦æƒ…ï¼ˆåŒ…å«è¿‘ä¹‰è¯ã€åä¹‰è¯ç­‰ï¼‰
   */
  async getWordDetail(word) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.VOCABULARY, {
        action: 'detail',
        word
      })
      if (res.data) return res.data
    } catch (err) {
      console.log('ä½¿ç”¨æœ¬åœ°æ•°æ®')
    }

    // ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®
    return MOCK_WORDS.find(w => w.word === word) || MOCK_WORDS[0]
  }

  /**
   * æ”¶è—è¯è¯­
   */
  async toggleFavorite(word) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.VOCABULARY, {
        action: 'favorite',
        word
      })
      return res.success
    } catch (err) {
      Taro.showToast({ title: 'æ”¶è—å¤±è´¥', icon: 'none' })
      return false
    }
  }

  /**
   * è·å–æ”¶è—åˆ—è¡¨
   */
  async getFavorites(page = DEFAULT_PAGE.page, pageSize = DEFAULT_PAGE.pageSize) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.VOCABULARY, {
        action: 'favorites',
        page,
        pageSize
      })
      return res.data || []
    } catch (err) {
      Taro.showToast({ title: 'è·å–æ”¶è—å¤±è´¥', icon: 'none' })
      return []
    }
  }

  /**
   * ç”Ÿæˆç»ƒä¹ é¢˜
   */
  async generatePractice(type, count = 10) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.VOCABULARY, {
        action: 'practice',
        type,
        count
      })
      return res.data || []
    } catch (err) {
      Taro.showToast({ title: 'ç”Ÿæˆç»ƒä¹ å¤±è´¥', icon: 'none' })
      return []
    }
  }
}

export default new VocabularyService()


// ===== src/services/auth.js =====
/**
 * è®¤è¯æœåŠ¡
 */
import Taro from '@tarojs/taro'
import { callCloudFunction } from './request'
import { CLOUD_FUNCTIONS } from '../utils/constants'
import storage from '../utils/storage'

class AuthService {
  /**
   * å¾®ä¿¡ç™»å½•
   */
  async login() {
    try {
      // è·å–å¾®ä¿¡ç™»å½• code
      const { code } = await Taro.login()

      // è°ƒç”¨äº‘å‡½æ•°ç™»å½•
      const res = await callCloudFunction(CLOUD_FUNCTIONS.LOGIN, {
        action: 'login',
        code
      })

      if (res.success) {
        // å¦‚æœéœ€è¦æ³¨å†Œ
        if (res.data.needRegister) {
          // ä¿å­˜ openid ä¾›æ³¨å†Œä½¿ç”¨
          await storage.setOpenid(res.data.openid)
          return { needRegister: true, openid: res.data.openid }
        }

        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯å’Œ token
        await storage.setUserInfo(res.data.user)
        await storage.setOpenid(res.data.openid)
        await storage.setToken(res.data.token)

        return res.data
      }

      throw new Error(res.message || 'ç™»å½•å¤±è´¥')
    } catch (err) {
      console.error('ç™»å½•å¤±è´¥:', err)
      throw err
    }
  }

  /**
   * ç”¨æˆ·æ³¨å†Œï¼ˆè®¾ç½®æ˜µç§°ï¼‰
   */
  async register(nickname, avatar = '') {
    try {
      const openid = await storage.getOpenid()
      const res = await callCloudFunction(CLOUD_FUNCTIONS.LOGIN, {
        action: 'register',
        openid,
        nickname,
        avatar
      })

      if (res.success) {
        await storage.setUserInfo(res.data)
        return res.data
      }

      throw new Error(res.message || 'æ³¨å†Œå¤±è´¥')
    } catch (err) {
      console.error('æ³¨å†Œå¤±è´¥:', err)
      throw err
    }
  }

  /**
   * è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
   */
  async getCurrentUser() {
    return await storage.getUserInfo()
  }

  /**
   * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
   */
  async updateProfile(data) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.USER, {
        action: 'update',
        ...data
      })

      if (res.success) {
        await storage.setUserInfo(res.data)
        return res.data
      }

      throw new Error(res.message || 'æ›´æ–°å¤±è´¥')
    } catch (err) {
      console.error('æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', err)
      throw err
    }
  }

  /**
   * é€€å‡ºç™»å½•
   */
  async logout() {
    await storage.clearAuth()
    Taro.reLaunch({
      url: '/pages/login/index'
    })
  }

  /**
   * æ£€æŸ¥ç™»å½•çŠ¶æ€
   */
  async checkLogin() {
    const userInfo = await storage.getUserInfo()
    const openid = await storage.getOpenid()
    return !!(userInfo && openid)
  }
}

export default new AuthService()


// ===== src/services/request.js =====
/**
 * äº‘å‡½æ•°è°ƒç”¨å°è£…
 */
import Taro from '@tarojs/taro'
import { CLOUD_FUNCTIONS } from '../utils/constants'
import storage from '../utils/storage'

/**
 * è°ƒç”¨äº‘å‡½æ•°
 * @param {string} name äº‘å‡½æ•°åç§°
 * @param {object} data ä¼ é€’çš„æ•°æ®
 * @param {object} options é¢å¤–é…ç½®
 */
export const callCloudFunction = async (name, data = {}, options = {}) => {
  try {
    // æ·»åŠ  openid
    const openid = await storage.getOpenid()
    const requestData = {
      ...data,
      _openid: openid
    }

    const res = await Taro.cloud.callFunction({
      name,
      data: requestData,
      ...options
    })

    // æ£€æŸ¥ res æ˜¯å¦å­˜åœ¨
    if (!res) {
      console.warn(`äº‘å‡½æ•° ${name} è¿”å›ä¸ºç©ºï¼Œå¯èƒ½æœªéƒ¨ç½²äº‘å¼€å‘ç¯å¢ƒ`)
      throw new Error('äº‘å‡½æ•°æœªåˆå§‹åŒ–')
    }

    if (res.errMsg !== 'cloud.callFunction:ok') {
      throw new Error(res.errMsg)
    }

    return res.result
  } catch (err) {
    // é™é»˜å¤„ç†é”™è¯¯ï¼Œä¸æ˜¾ç¤º toastï¼Œè®©ä¸Šå±‚æœåŠ¡å¤„ç† fallback
    console.log(`äº‘å‡½æ•° ${name} è°ƒç”¨å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°æ•°æ®:`, err.message || err)
    throw err
  }
}

/**
 * äº‘æ•°æ®åº“æ“ä½œå°è£…
 */
export class DB {
  constructor() {
    // æ‡’åŠ è½½ï¼šåªåœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–
    this._db = null
    this._cmd = null
  }

  // è·å–æ•°æ®åº“å®ä¾‹
  get db() {
    if (!this._db) {
      this._db = Taro.cloud.database()
    }
    return this._db
  }

  // è·å–æ•°æ®åº“å‘½ä»¤
  get cmd() {
    if (!this._cmd) {
      this._cmd = this.db.command
    }
    return this._cmd
  }

  get _() {
    return this.cmd
  }

  /**
   * è·å–é›†åˆ
   */
  collection(name) {
    return this.db.collection(name)
  }

  /**
   * è·å–å•æ¡è®°å½•
   */
  async getOne(collectionName, where = {}) {
    try {
      const res = await this.db.collection(collectionName)
        .where(where)
        .limit(1)
        .get()
      return res.data[0] || null
    } catch (err) {
      console.error('æŸ¥è¯¢å¤±è´¥:', err)
      return null
    }
  }

  /**
   * è·å–å¤šæ¡è®°å½•
   */
  async getList(collectionName, where = {}, options = {}) {
    try {
      const { limit = 20, skip = 0, orderBy = '', order = 'asc' } = options

      let query = this.db.collection(collectionName).where(where)

      if (orderBy) {
        query = query.orderBy(orderBy, order)
      }

      const res = await query.limit(limit).skip(skip).get()
      return res.data
    } catch (err) {
      console.error('æŸ¥è¯¢åˆ—è¡¨å¤±è´¥:', err)
      return []
    }
  }

  /**
   * æ·»åŠ è®°å½•
   */
  async add(collectionName, data) {
    try {
      const res = await this.db.collection(collectionName).add({
        data
      })
      return res._id
    } catch (err) {
      console.error('æ·»åŠ å¤±è´¥:', err)
      throw err
    }
  }

  /**
   * æ›´æ–°è®°å½•
   */
  async update(collectionName, id, data) {
    try {
      await this.db.collection(collectionName).doc(id).update({
        data
      })
      return true
    } catch (err) {
      console.error('æ›´æ–°å¤±è´¥:', err)
      throw err
    }
  }

  /**
   * åˆ é™¤è®°å½•
   */
  async remove(collectionName, id) {
    try {
      await this.db.collection(collectionName).doc(id).remove()
      return true
    } catch (err) {
      console.error('åˆ é™¤å¤±è´¥:', err)
      throw err
    }
  }

  /**
   * ç»Ÿè®¡æ•°é‡
   */
  async count(collectionName, where = {}) {
    try {
      const res = await this.db.collection(collectionName).where(where).count()
      return res.total
    } catch (err) {
      console.error('ç»Ÿè®¡å¤±è´¥:', err)
      return 0
    }
  }
}

export default new DB()


// ===== src/services/question_extended.js =====
/**
 * é¢˜ç›®æ‰©å±•æ•°æ®
 * å°†æ¯ç§é¢˜å‹ä»20é“æ‰©å±•åˆ°200é“
 */

// æ‹¼éŸ³ç»ƒä¹ æ‰©å±•æ•°æ® (py021-py200)
const EXTENDED_PINYIN = [
  { id: 'py021', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å…¨éƒ¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é‡è¦ é‡é‡ å±±é‡æ°´å¤', 'B. æœ¨æ‹´ è¯ é‡Š ç—…æƒ…ç—Šæ„ˆ', 'C. åº”é…¬ åº”å¯¹ å¾—å¿ƒåº”æ‰‹', 'D. è°±å†™ é“ºå« æ™®å¤©åŒåº†'], correctAnswer: 1, analysis: 'Bé¡¹å…¨éƒ¨è¯»quÃ¡nï¼ˆæ “ã€è¯ ã€ç—Šï¼‰ã€‚' },
  { id: 'py022', type: 'pinyin', question: '"å®¿"åœ¨"å®¿èˆ"ä¸­è¯»ï¼š', options: ['A. sÃ¹', 'B. xiÃ¹', 'C. xiÇ”', 'D. shÃ¹'], correctAnswer: 0, analysis: '"å®¿"åœ¨"å®¿èˆ"ä¸­è¯»sÃ¹ã€‚' },
  { id: 'py023', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç¤ºæ„(yÃ¬) è‡ªçˆ†(bÃ o)', 'B. ç‰ä½©(pÃ¨i) èµ¶æ—¶é«¦(mÃ¡o)', 'C. ç¼–ç¼‰(jÃ­) å‡Œåˆ†å­(lÃ­ng)', 'D. æœè…¹(fÃ¹) é‡‘åˆšé’»(zuÃ n)'], correctAnswer: 3, analysis: 'Dé¡¹æ­£ç¡®ã€‚Aé¡¹"çˆ†"åº”è¯»bÃ oï¼›Bé¡¹"é«¦"åº”è¯»mÃ¡oï¼›Cé¡¹"ç¼‰"åº”è¯»jÄ«ã€‚' },
  { id: 'py024', type: 'pinyin', question: '"æŠµå¾¡"çš„"å¾¡"è¯»éŸ³æ˜¯ï¼š', options: ['A. yÃ¹', 'B. xiÃ¨', 'C. yÄ«', 'D. yÃ¨'], correctAnswer: 0, analysis: '"å¾¡"è¯»yÃ¹ã€‚' },
  { id: 'py025', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç¾Šç»’(rÃ³ng) æ¢³å­(shÅ«)', 'B. ç‰¹å®š(dÃ¬ng) æŸå®³(sÇ”n)', 'C. ç‰¹åˆ¶(zhÃ¬) æŸä¼¤(shÄng)', 'D. æŠµå¾¡(yÃ¹] æ¢³ç†(shÅ«)'], correctAnswer: 2, analysis: 'Cé¡¹"åˆ¶"åº”è¯»zhÃ¬ï¼Œæ­£ç¡®ã€‚æœ¬é¢˜Cé¡¹æ— è¯¯ã€‚' },
  { id: 'py026', type: 'pinyin', question: '"å…´"åœ¨"å…´å†²å†²"ä¸­è¯»ï¼š', options: ['A. xÃ¬ng', 'B. xÄ«ng', 'C. xÃ¬n', 'D. xÄ«n'], correctAnswer: 1, analysis: '"å…´"åœ¨"å…´å†²å†²"ä¸­è¯»xÄ«ngã€‚' },
  { id: 'py027', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ‹¦è·¯è™(lÇ”) è‡ªçˆ†è‡ªå¼ƒ(bÃ o)', 'B. ç­¹è¸æ»¡å¿—(jÃ¹) å¦™è¶£æ¨ªç”Ÿ(qÃ¹)', 'C. ç¼–ç¼‰(jÃ­) å‡Œåˆ†å­(lÃ­ng)', 'D. ç›¸æ¿¡ä»¥æ²«(mÃ²) é‡‘åˆšé’»(zuÄn)'], correctAnswer: 3, analysis: 'Dé¡¹æ­£ç¡®ã€‚' },
  { id: 'py028', type: 'pinyin', question: '"å€”å¼º"çš„"å¼º"è¯»ï¼š', options: ['A. qiÃ¡ng', 'B. jiÃ ng', 'C. qiÇng', 'D. jÃ ng'], correctAnswer: 1, analysis: '"å€”å¼º"çš„"å¼º"è¯»jiÃ ngã€‚' },
  { id: 'py029', type: 'pinyin', question: 'ä¸‹åˆ—å„ç»„è¯è¯­ä¸­åŠ ç‚¹å­—è¯»éŸ³å…¨éƒ½ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å“ˆæ¬  å“ˆè¾¾ ç‚¹å¤´å“ˆè…°', 'B. èŠ±è‹ è¢å­ æ˜ç¢‰æš—å ¡', 'C. å¥½è½¬ å¥½æ­¹ å¥½é€¸æ¶åŠ³', 'D. å·…å³° æ‚é‡ é»‘ç™½é¢ å€’'], correctAnswer: 0, analysis: 'Aé¡¹éƒ½è¯»hÄã€‚' },
  { id: 'py030', type: 'pinyin', question: '"è®°è½½"çš„"è½½"è¯»ï¼š', options: ['A. zÇi', 'B. zÃ i', 'C. zhÇi', 'D. zhÃ i'], correctAnswer: 0, analysis: '"è®°è½½"çš„"è½½"è¯»zÇiã€‚' },
  { id: 'py031', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç¼–çº‚(zuÇn) é—·è‘«èŠ¦(mÃ¨n)', 'B. åƒæ——æ¯é¼“(yÇn) è¾å°„(fÃº)', 'C. å³°çªç…¤(fÄ“ng) é›·å‰é£è¡Œ(lÃ¬)', 'D. ç¸æ‰‹å¯çƒ­(zhÃ¬) ä¸´æ‘¹(mÃ³)'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚Aé¡¹"çº‚"åº”è¯»zuÇnï¼›Cé¡¹"å³°"åº”è¯»fÄ“ngï¼›Dé¡¹"ç¸"åº”è¯»zhÃ¬ã€‚' },
  { id: 'py032', type: 'pinyin', question: '"åˆ›é€ "çš„"åˆ›"è¯»ï¼š', options: ['A. chuÃ ng', 'B. chuÄng', 'C. chuÃ ng', 'D. chuÄng'], correctAnswer: 0, analysis: '"åˆ›é€ "çš„"åˆ›"è¯»chuÃ ngã€‚' },
  { id: 'py033', type: 'pinyin', question: 'ä¸‹åˆ—è¯è¯­ä¸­åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ›´è¿­ æ›´åŠ  æ”¹å¼¦æ›´å¼ ', 'B. èŒƒç•´ é…¬åŠ³ è¿ç­¹å¸·å¹„', 'C. å…´è‡´ å…´å¥‹ äº‘å…´éœè”š', 'D. å¼Šç«¯ ç¥è§† æ•å¸šè‡ªç'], correctAnswer: 1, analysis: 'Bé¡¹éƒ½è¯»chÃ³uï¼ˆç•´ã€é…¬ã€ç­¹ï¼‰ã€‚' },
  { id: 'py034', type: 'pinyin', question: '"å±ä½"çš„"å±"è¯»ï¼š', options: ['A. pÃ­ng', 'B. bÇng', 'C. bÇn', 'D. pÇng'], correctAnswer: 1, analysis: '"å±ä½"çš„"å±"è¯»bÇngã€‚' },
  { id: 'py035', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å°å¿ƒç¿¼ç¿¼(yÃ¬) ä½œèŒ§è‡ªç¼š(fÃ¹)', 'B. è ¢è ¢æ¬²åŠ¨(chÇ”n) å‚åŠ(cÄn)', 'C. å½’å®¿(sÃ¹) å¦‚é‡Šé‡è´Ÿ(shÃ¬)', 'D. æµ¸æ¸(zÃ¬) è´Ÿè½½(zÃ i)'], correctAnswer: 1, analysis: 'Bé¡¹"å‚"åº”è¯»cÄnæ­£ç¡®ã€‚æœ¬é¢˜è€ƒæŸ¥è¯»éŸ³ã€‚' },
  { id: 'py036', type: 'pinyin', question: '"å‡ è®¸"çš„"å‡ "è¯»ï¼š', options: ['A. jÄ«', 'B. jÇ', 'C. jÄ«', 'D. jÇ'], correctAnswer: 1, analysis: '"å‡ è®¸"çš„"å‡ "è¯»jÇã€‚' },
  { id: 'py037', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è§’é€(juÃ©) è§’è‰²(jiÇo) å‹¾å¿ƒæ–—è§’(jiÇo)', 'B. ä¾›èŒ(gÃ²ng) ä¾›å…»(gÃ²ng) ä¾›ä¸åº”æ±‚(gÅng)', 'C. ç«ç›¸(xiÄng) ç›¸å·¦(xiÄng) ç›¸æå¹¶è®º(xiÄng)', 'D. å‡ æ¬¡ä¸‰ç•ª(jÇ) èŒ¶å‡ (jÄ«) å‡ è®¸(jÇ)'], correctAnswer: 2, analysis: 'Cé¡¹éƒ½è¯»xiÄngã€‚' },
  { id: 'py038', type: 'pinyin', question: '"è¯·ç¼¨"çš„"ç¼¨"è¯»ï¼š', options: ['A. yÄ«ng', 'B. yÄ«n', 'C. yÇng', 'D. yÃ¬n'], correctAnswer: 0, analysis: '"è¯·ç¼¨"çš„"ç¼¨"è¯»yÄ«ngã€‚' },
  { id: 'py039', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é—´å¥æ›²(jiÃ n) æˆ®åŠ›åŒå¿ƒ(lÃ¹)', 'B. è£è†º(yÄ«ng) æ®Šä¸çŸ¥(shÅ«)', 'C. è¯·æ¨±(qÄ«ng) ç”šå™¨å°˜ä¸Š(shÄng)', 'D. é—®é¼(dÇng) é€†æ—¶é’ˆ(nÃ¬)'], correctAnswer: 2, analysis: 'Cé¡¹"æ¨±"åº”è¯»yÄ«ngï¼Œ"è¯·ç¼¨"æ­£ç¡®ã€‚' },
  { id: 'py040', type: 'pinyin', question: '"å¯¼å‘"çš„"å¯¼"è¯»ï¼š', options: ['A. dÇo', 'B. dÃ o', 'C. dÇo', 'D. dÃ o'], correctAnswer: 1, analysis: '"å¯¼å‘"çš„"å¯¼"è¯»dÇoã€‚' },
  { id: 'py041', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è½¬ç§»(zhuÇn) è§£é‡Š(shÃ¬)', 'B. æ”¹è‰¯(liÃ¡ng) è½¬å˜(zhuÇn)', 'C. è§£å†³(juÃ©) ç­–ç•¥(cÃ¨)', 'D. å‘å±•(zhÇn) è®®é¢˜(yÃ¬)'], correctAnswer: 2, analysis: 'Cé¡¹æ­£ç¡®ã€‚' },
  { id: 'py042', type: 'pinyin', question: '"é²œè§"çš„"é²œ"è¯»ï¼š', options: ['A. xiÄn', 'B. xiÇn', 'C. xiÄn', 'D. xiÇn'], correctAnswer: 1, analysis: '"é²œè§"çš„"é²œ"è¯»xiÇnã€‚' },
  { id: 'py043', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ‰“å¼€å¤©çª—è¯´äº®è¯ é•¿çº¿é’“å¤§é±¼ ç¾Šæ¯›å‡ºåœ¨ç¾Šèº«ä¸Š', 'B. å½“é¢é”£å¯¹é¢é”£ é—ªçƒå…¶è¯ æ‰æ‘¸ä¸é€', 'C. å…«å­—æ²¡ä¸€ç¥ å”±å¯¹å°æˆ ä¸‰ä¸‹äº”é™¤äºŒ', 'D. ä¸è´¹å¹ç°ä¹‹åŠ› è§¦ç›®æƒŠå¿ƒ å§‹ä½œä¿‘è€…'], correctAnswer: 0, analysis: 'è€ƒæŸ¥ç†Ÿè¯­ä¸­å­—çš„è¯»éŸ³ã€‚' },
  { id: 'py044', type: 'pinyin', question: '"ç§°èŒ"çš„"ç§°"è¯»ï¼š', options: ['A. chÄ“ng', 'B. chÃ¨n', 'C. chÄ“ng', 'D. chÃ¨n'], correctAnswer: 1, analysis: '"ç§°èŒ"çš„"ç§°"è¯»chÃ¨nã€‚' },
  { id: 'py045', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å…¼å®¹å¹¶è“„(bÃ¬ng xÃ¹) é”€å£°åŒ¿è¿¹(xiÄo)', 'B. å§‹ä½œä¿‘è€…(yÇ’ng) åŠ›æŒ½ç‹‚æ¾œ(lÃ¡n)', 'C. ä¼—è¯´çº·çº­(yÃºn) è§ä»è§æ™º(zhÃ¬)', 'D. è§¦ç›®æƒŠå¿ƒ(chÃ¹) åˆ«å¼€ç”Ÿé¢(shÄ“ng)'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚' },
  { id: 'py046', type: 'pinyin', question: '"æ··æ·†"çš„"æ·†"è¯»ï¼š', options: ['A. xiÃ¡o', 'B. yÃ¡o', 'C. xiÃ o', 'D. yÃ o'], correctAnswer: 0, analysis: '"æ··æ·†"çš„"æ·†"è¯»xiÃ¡oã€‚' },
  { id: 'py047', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¿ç”¨äººå·¥æ™ºèƒ½(ji) æ€è€ƒ(sÄ«)', 'B. å…³ä¹å›¢é˜Ÿ(tuÃ¡n) å›½å®¶(jiÄ)', 'C. ä»ªå¼(yÃ­) ç‰¹å¾(tÄ“ng)', 'D. æ˜æ˜Ÿæ•ˆyÃ¬ng(xiÃ o) å•†ä¸šä»·å€¼(jiÃ )'], correctAnswer: 2, analysis: 'Cé¡¹"å¾"åº”è¯»zhÄ“ngã€‚' },
  { id: 'py048', type: 'pinyin', question: '"è½½èª‰"çš„"è½½"è¯»ï¼š', options: ['A. zÇi', 'B. zÃ i', 'C. zhÇi', 'D. zhÃ i'], correctAnswer: 1, analysis: '"è½½èª‰"çš„"è½½"è¯»zÃ iã€‚' },
  { id: 'py049', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è½½èª‰(zÃ i) è´Ÿè½½(zÃ i)', 'B. è®°è½½(zÃ i) åˆŠè½½(zÇi)', 'C. åƒå¹´ä¸‡è½½(zÇi) è½½æ­Œè½½èˆ(zÃ i)', 'D. æ€¨å£°è½½é“(zÃ i) è½½ä½“(zÃ i)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py050', type: 'pinyin', question: '"æ‹“"åœ¨"æ‹“ç‰‡"ä¸­è¯»ï¼š', options: ['A. tuÃ²', 'B. tÃ ', 'C. tuÃ²', 'D. tÃ '], correctAnswer: 1, analysis: '"æ‹“ç‰‡"çš„"æ‹“"è¯»tÃ ã€‚' },
  { id: 'py051', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‰¥çš® å‰¥å‰Š å‰¥ç¦»', 'B. è–„å¼± è–„é…’ è–„æš®', 'C. å‚å·® å‚æ‹œ å‚å†›', 'D. å¼ºè¿« å¼ºè°ƒ å¼ºå¤§'], correctAnswer: 0, analysis: 'Aé¡¹éƒ½è¯»bÄoã€‚' },
  { id: 'py052', type: 'pinyin', question: "'éœ²é©¬è„š'çš„'éœ²'è¯»ï¼š', options: ['A. lÃ¹', 'B. lÃ²u', 'C. lÃ¹', 'D. lÃ²u'], correctAnswer: 1, analysis: "'éœ²é©¬è„š'çš„'éœ²'è¯»lÃ²uã€‚' },
  { id: 'py053', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å¥”è·‘(bÄ“n) æŠ•å¥”(bÃ¨n)', 'B. é—·çƒ­(mÄ“n) é—·é›·(mÃ¨n)', 'C. å‚å†›(cÄn) äººå‚(shÄ“n)', 'D. å¼ºå£®(qiÃ¡ng) å€”å¼º(jiÃ ng)'], correctAnswer: 2, analysis: 'Cé¡¹"å‚"åº”è¯»cÄnæ­£ç¡®ã€‚' },
  { id: 'py054', type: 'pinyin', question: '"å··é“"çš„"å··"è¯»ï¼š', options: ['A. xiÃ ng', 'B. hÃ ng', 'C. xiÃ ng', 'D. hÃ ng'], correctAnswer: 1, analysis: '"å··é“"çš„"å··"è¯»hÃ ngã€‚' },
  { id: 'py055', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¸‡ä¸‡äººç©ºå··(xiÃ ng) å··é“(hÃ ng)', 'B. é™å··(xiÃ ng) å··æˆ˜(xiÃ ng)', 'C. å°å··(xiÃ ng) å··å­(xiÃ ng)', 'D. è¡—å··(xiÃ ng) å··å£(xiÃ ng)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py056', type: 'pinyin', question: '"äº²å®¶"çš„"äº²"è¯»ï¼š', options: ['A. qÄ«n', 'B. qÃ¬ng', 'C. qÄ«n', 'D. qÃ¬ng'], correctAnswer: 1, analysis: '"äº²å®¶"çš„"äº²"è¯»qÃ¬ngã€‚' },
  { id: 'py057', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. äº²çƒ­(qÄ«n) äº²è¿‘(qÄ«n)', 'B. äº²å®¶(qÃ¬ng) äº²çœ·(qÃ¬ng)', 'C. äº²è‡ª(qÄ«n) äº²ç¬”(qÄ«n)', 'D. äº²åˆ‡(qiÃ¨) äº²æƒ…(qÃ­ng)'], correctAnswer: 3, analysis: 'Dé¡¹"åˆ‡"åº”è¯»qiÃ¨ï¼Œ"æƒ…"åº”è¯»qÃ­ngã€‚' },
  { id: 'py058', type: 'pinyin', question: '"å··å­"çš„"å··"è¯»ï¼š', options: ['A. hÃ ng', 'B. xiÃ ng', 'C. hÃ ng', 'D. xiÃ ng'], correctAnswer: 1, analysis: '"å··å­"çš„"å··"è¯»xiÃ ngã€‚' },
  { id: 'py059', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å› ä¸º(wÃ¨i) ä¸ºä½•(wÃ©i)', 'B. ä¸ºäºº(wÃ©i) ä¸ºäº†(wÃ¨i)', 'C. ä¸ºéš¾(wÃ©i) ä¸ºæ­¢(wÃ©i)', 'D. è®¤ä¸º(wÃ©i) è®¤ä¸º(wÃ¨i)'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚' },
  { id: 'py060', type: 'pinyin', question: '"å“å”¬"çš„"å“"è¯»ï¼š', options: ['A. xiÃ ', 'B. hÃ¨', 'C. xiÃ ', 'D. hÃ¨'], correctAnswer: 0, analysis: '"å“å”¬"çš„"å“"è¯»xiÃ ã€‚' },
  { id: 'py061', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å“å”¬(xiÃ ) å“äºº(xiÃ )', 'B. æå“(hÃ¨) å¨å“(hÃ¨)', 'C. å¨èƒ(xiÃ©) èƒæŒ(xiÃ©)', 'D. èƒä»(xiÃ©) èƒè¿«(xiÃ©)'], correctAnswer: 0, analysis: 'Aé¡¹éƒ½è¯»xiÃ ã€‚' },
  { id: 'py062', type: 'pinyin', question: '"å‹è½´"çš„"è½´"è¯»ï¼š', options: ['A. zhÃ²u', 'B. zhÃ³u', 'C. zhÃ²u', 'D. zhÃ³u'], correctAnswer: 0, analysis: '"å‹è½´"çš„"è½´"è¯»zhÃ²uã€‚' },
  { id: 'py063', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‹è½´(zhÃ²u) è½´å¿ƒ(zhÃ³u)', 'B. è½´æ‰¿(zhÃ³u) åœ°è½´(zhÃ³u)', 'C. è½´çº¿(zhÃ³u) è½¦è½´(zhÃ³u)', 'D. å‹è½´æˆ(zhÃ²u) ä¸»è½´(zhÃ³u)'], correctAnswer: 3, analysis: 'Dé¡¹"ä¸»è½´"åº”è¯»zhÃ³uï¼Œ"å‹è½´"è¯»zhÃ²uã€‚' },
  { id: 'py064', type: 'pinyin', question: '"åŸ‹ä¼"çš„"åŸ‹"è¯»ï¼š', options: ['A. mÃ¡i', 'B. mÃ¡n', 'C. mÃ¡i', 'D. mÃ¡n'], correctAnswer: 0, analysis: '"åŸ‹ä¼"çš„"åŸ‹"è¯»mÃ¡iã€‚' },
  { id: 'py065', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŸ‹æ€¨(mÃ¡i) åŸ‹ä¼(mÃ¡i)', 'B. åŸ‹è—(mÃ¡i) éšåŸ‹(mÃ¡i)', 'C. åŸ‹æ²¡(mÃ¡i) åŸ‹å¤´(mÃ¡i)', 'D. åŸ‹æ€¨(mÃ¡n) åŸ‹è—(mÃ¡i)'], correctAnswer: 3, analysis: 'Dé¡¹æ­£ç¡®ã€‚"åŸ‹æ€¨"çš„"åŸ‹"è¯»mÃ¡nã€‚' },
  { id: 'py066', type: 'pinyin', question: '"åŠ³ç´¯"çš„"ç´¯"è¯»ï¼š', options: ['A. lÃ¨i', 'B. lÄ›i', 'C. lÃ¨i', 'D. lÄ›i'], correctAnswer: 0, analysis: '"åŠ³ç´¯"çš„"ç´¯"è¯»lÃ¨iã€‚' },
  { id: 'py067', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŠ³ç´¯(lÃ¨i) å—ç´¯(lÃ¨i)', 'B. ç´¯è®¡(lÄ›i) è¿ç´¯(lÄ›i)', 'C. ç´¯èµ˜(lÃ©i) æœç´¯(lÃ©i)', 'D. ç‰µç´¯(lÄ›i) ç´¯åŠ(lÄ›i)'], correctAnswer: 2, analysis: 'Cé¡¹"ç´¯èµ˜"çš„"ç´¯"è¯»lÃ©iã€‚' },
  { id: 'py068', type: 'pinyin', question: '"æ¨¡æ ·"çš„"æ¨¡"è¯»ï¼š', options: ['A. mÃ³', 'B. mÃº', 'C. mÃ³', 'D. mÃº'], correctAnswer: 1, analysis: '"æ¨¡æ ·"çš„"æ¨¡"è¯»mÃºã€‚' },
  { id: 'py069', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ¨¡å‹(mÃ³) æ¨¡æ ·(mÃº)', 'B. æ¨¡ä»¿(mÃ³) æ¨¡ç³Š(mÃ³)', 'C. æ¨¡å…·(mÃº) æ¨¡èŒƒ(mÃ³)', 'D. æ¨¡æ ·(mÃ³) æ¨¡æ‹Ÿ(mÃ³)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py070', type: 'pinyin', question: '"é¢¤åŠ¨"çš„"é¢¤"è¯»ï¼š', options: ['A. chÃ n', 'B. zhÃ n', 'C. chÃ n', 'D. zhÃ n'], correctAnswer: 0, analysis: '"é¢¤åŠ¨"çš„"é¢¤"è¯»chÃ nã€‚' },
  { id: 'py071', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³å®Œå…¨ç›¸åŒçš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é¢¤åŠ¨(chÃ n) é¢¤æŠ–(chÃ n)', 'B. é¢¤æ —(zhÃ n) é¢¤å·å·(zhÃ n)', 'C. é¢¤éŸ³(chÃ n) é¢¤æ‚ (chÃ n)', 'D. é¢¤åŠ¨(zhÃ n) é¢¤æŠ–(zhÃ n)'], correctAnswer: 0, analysis: 'Aé¡¹éƒ½è¯»chÃ nã€‚' },
  { id: 'py072', type: 'pinyin', question: '"ç“¦ç ¾"çš„"ç ¾"è¯»ï¼š', options: ['A. lÃ¬', 'B. lÃ¨', 'C. shuÃ²', 'D. luÃ²'], correctAnswer: 0, analysis: '"ç“¦ç ¾"çš„"ç ¾"è¯»lÃ¬ã€‚' },
  { id: 'py073', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç“¦ç ¾(lÃ¬) ç ¾çŸ³(lÃ¬)', 'B. ç ‚ç ¾(lÃ¬) ç ¾åœŸ(lÃ¬)', 'C. ç¢ç ¾(lÃ¬) ç ¾å²©(lÃ¬)', 'D. ç ¾ç ¾(lÃ¬) ç ¾æ¼ (lÃ¬)'], correctAnswer: 3, analysis: 'Dé¡¹æ­£ç¡®ã€‚' },
  { id: 'py074', type: 'pinyin', question: '"æ®·çº¢"çš„"æ®·"è¯»ï¼š', options: ['A. yÄ«n', 'B. yÄn', 'C. yÇn', 'D. yÄn'], correctAnswer: 1, analysis: '"æ®·çº¢"çš„"æ®·"è¯»yÄnã€‚' },
  { id: 'py075', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ®·å‹¤(yÄ«n) æ®·çº¢(yÄn)', 'B. æ®·å®(yÄ«n) æ®·åˆ‡(yÄ«n)', 'C. æ®·æ®·(yÄ«n) æ®·å•†(yÄ«n)', 'D. æ®·çº¢(yÄ«n) æ®·åˆ‡(qiÃ¨)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚"æ®·çº¢"çš„"æ®·"è¯»yÄnã€‚' },
  { id: 'py076', type: 'pinyin', question: '"é‚æ„¿"çš„"é‚"è¯»ï¼š', options: ['A. suÃ­', 'B. suÃ¬', 'C. suÃ­', 'D. suÃ¬'], correctAnswer: 1, analysis: '"é‚æ„¿"çš„"é‚"è¯»suÃ¬ã€‚' },
  { id: 'py077', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é‚å¿ƒ(suÃ¬) é‚æ„(suÃ¬)', 'B. åŠé‚(suÃ­) é‚æ„¿(suÃ¬)', 'C. é‚é¡º(suÃ­) é‚å¿ƒ(suÃ¬)', 'D. é¡ºé‚(suÃ­) é‚æ„¿(suÃ¬)'], correctAnswer: 2, analysis: 'Cé¡¹"é‚é¡º"çš„"é‚"è¯»suÃ­ã€‚' },
  { id: 'py078', type: 'pinyin', question: '"èœ·ç¼©"çš„"èœ·"è¯»ï¼š', options: ['A. juÇn', 'B. quÃ¡n', 'C. juÇn', 'D. quÃ¡n'], correctAnswer: 1, analysis: '"èœ·ç¼©"çš„"èœ·"è¯»quÃ¡nã€‚' },
  { id: 'py079', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. èœ·æ›²(quÃ¡n) èœ·ç¼©(quÃ¡n)', 'B. èœ·ä½“(quÃ¡n) èœ·å§(quÃ¡n)', 'C. èœ·èº«(quÃ¡n) èœ·è…¿(quÃ¡n)', 'D. èœ·å(quÃ¡n) èœ·ä¼(quÃ¡n)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py080', type: 'pinyin', question: '"å‰½æ‚"çš„"å‰½"è¯»ï¼š', options: ['A. piÄo', 'B. biÄo', 'C. piÃ¡o', 'D. piÃ o'], correctAnswer: 0, analysis: '"å‰½æ‚"çš„"å‰½"è¯»piÄoã€‚' },
  { id: 'py081', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‰½æ‚(piÄo) å‰½çªƒ(piÄo)', 'B. å‰½æ (piÄo) å‰½è¢­(piÄo)', 'C. å‰½æ”»(piÄo) å‰½å–(piÄo)', 'D. å‰½æ‚(biÄo) å‰½æ (piÄo)'], correctAnswer: 3, analysis: 'Dé¡¹"å‰½æ‚"çš„"å‰½"åº”è¯»piÄoã€‚' },
  { id: 'py082', type: 'pinyin', question: '"é¾ƒé¾‰"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. jÇ” yÇ”', 'B. jÇ” yÇ”', 'C. jÇ” yÇ”', 'D. jÇ” yÇ”'], correctAnswer: 0, analysis: '"é¾ƒé¾‰"è¯»jÇ” yÇ”ã€‚' },
  { id: 'py083', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¸Ÿèº‡(chÃº) è¸¯èº…(zhÃº)', 'B. è¸Œèº‡(chÃº) è¸Œèº‡(chÃº)', 'C. è¸Œèº‡(chÃº) è¸¯èº…(zhÃº)', 'D. è¸Ÿèº‡(zhÄ«) è¸Œèº‡(chÃº)'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚' },
  { id: 'py084', type: 'pinyin', question: '"æ—–æ—"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. yÄ« nÇ', 'B. yÇ nÇ', 'C. yÄ« nÃ¬', 'D. yÇ nÃ¬'], correctAnswer: 1, analysis: '"æ—–æ—"è¯»yÇ nÇã€‚' },
  { id: 'py085', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ—–æ—(yÇ nÇ) æ—–æ—é£å…‰(yÇ)', 'B. æ—ä¸½(nÇ lÃ¬) æ—–æ—(nÇ)', 'C. æ—å­(nÇ zi) æ—ä¸½(nÇ)', 'D. æ—–æ—(yÄ« nÇ) æ—–æ—(yÇ)'], correctAnswer: 3, analysis: 'Dé¡¹"æ—–"åº”è¯»yÇã€‚' },
  { id: 'py086', type: 'pinyin', question: '"æ°¤æ°²"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. yÄ«n yÅ«n', 'B. yÄ«n yÅ«n', 'C. yÄ«n yÅ«n', 'D. yÄ«n yÅ«n'], correctAnswer: 0, analysis: '"æ°¤æ°²"è¯»yÄ«n yÅ«nã€‚' },
  { id: 'py087', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ°¤æ°²(yÄ«n) æ°¤æ°²(yÅ«n)', 'B. æ°¤æ°²(yÄ«n) æ°²æ°”(yÅ«n)', 'C. æ°¤æ°²(yÄ«n) æ°¤æ°²(yÅ«n)', 'D. æ°¤æ°²(yÄ«n) æ°²äº‘(yÅ«n)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py088', type: 'pinyin', question: '"å­‘å­“"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. jiÃ© juÃ©', 'B. jiÃ© juÃ©', 'C. jiÃ© juÃ©', 'D. jiÃ© juÃ©'], correctAnswer: 0, analysis: '"å­‘å­“"è¯»jiÃ© juÃ©ã€‚' },
  { id: 'py089', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å­‘ç„¶(jiÃ©) å­‘å­“(jiÃ©)', 'B. å­‘é—(jiÃ©) å­‘æ°‘(jiÃ©)', 'C. å­‘èº«(jiÃ©) å­‘ç«‹(jiÃ©)', 'D. å­‘å­“(juÃ©) å­‘ç„¶(jiÃ©)'], correctAnswer: 3, analysis: 'Dé¡¹"å­‘å­“"çš„"å­“"åº”è¯»juÃ©ã€‚' },
  { id: 'py090', type: 'pinyin', question: '"å­‘å­“"çš„æ„æ€æ˜¯ï¼š', options: ['A. èšŠå­çš„å¹¼è™«', 'B. å­¤ç‹¬çš„æ ·å­', 'C. å¾®å°çš„æ ·å­', 'D. æ®‹ç•™çš„'], correctAnswer: 0, analysis: '"å­‘å­“"æŒ‡èšŠå­çš„å¹¼è™«ã€‚' },
  { id: 'py091', type: 'pinyin', question: '"æ‹®æ®"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. jiÃ© jÅ«', 'B. jiÃ© jÃ¹', 'C. jÃ­ jÅ«', 'D. jÃ­ jÃ¹'], correctAnswer: 0, analysis: '"æ‹®æ®"è¯»jiÃ© jÅ«ã€‚' },
  { id: 'py092', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ‹®æ®(jiÃ© jÅ«) æ®å®ˆ(jÃ¹)', 'B. æ‹®æ®(jÃ­ jÅ«) å æ®(jÃ¹)', 'C. æ‹®æ®(jiÃ© jÅ«) æ ¹æ®(jÃ¹)', 'D. æ‹®æ®(jÃ­ jÅ«) ä¾æ®(jÃ¹)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py093', type: 'pinyin', question: '"è®ªç¬‘"çš„"è®ª"è¯»ï¼š', options: ['A. shÃ n', 'B. shÄn', 'C. shÃ n', 'D. shÄn'], correctAnswer: 0, analysis: '"è®ªç¬‘"çš„"è®ª"è¯»shÃ nã€‚' },
  { id: 'py094', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è®ªç¬‘(shÃ n) è®ªè®ª(shÃ n)', 'B. è®ªç„¶(shÃ n) è®ªçš®(shÃ n)', 'C. è®ªè„¸(shÃ n) è®ªéª‚(shÃ n)', 'D. è®ªç¬‘(shÄn) è®ªç„¶(shÃ n)'], correctAnswer: 3, analysis: 'Dé¡¹"è®ªç¬‘"çš„"è®ª"åº”è¯»shÃ nã€‚' },
  { id: 'py095', type: 'pinyin', question: '"æŒ‘è¡…"çš„"è¡…"è¯»ï¼š', options: ['A. xÃ¬n', 'B. xÄ«n', 'C. xÃ¬n', 'D. xÄ«n'], correctAnswer: 0, analysis: '"æŒ‘è¡…"çš„"è¡…"è¯»xÃ¬nã€‚' },
  { id: 'py096', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æŒ‘è¡…(xÃ¬n) å¯»è¡…(xÃ¬n)', 'B. æŒ‘è¡…(xÄ«n) äº‰è¡…(xÃ¬n)', 'C. æŒ‘è¡…(xÃ¬n) è¡…äº‹(xÃ¬n)', 'D. æŒ‘è¡…(xÄ«n) è‚‡è¡…(xÃ¬n)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py097', type: 'pinyin', question: '"æ®·"åœ¨"æ®·å®"ä¸­è¯»ï¼š', options: ['A. yÄ«n', 'B. yÄn', 'C. yÇn', 'D. yÄn'], correctAnswer: 0, analysis: '"æ®·å®"çš„"æ®·"è¯»yÄ«nã€‚' },
  { id: 'py098', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ®·å®(yÄ«n) æ®·å‹¤(yÄ«n)', 'B. æ®·åˆ‡(yÄ«n) æ®·æ®·(yÄ«n)', 'C. æ®·çº¢(yÄn) æ®·å•†(yÄ«n)', 'D. æ®·å®(yÄn) æ®·åˆ‡(yÄ«n)'], correctAnswer: 3, analysis: 'Dé¡¹"æ®·å®"çš„"æ®·"åº”è¯»yÄ«nã€‚' },
  { id: 'py099', type: 'pinyin', question: '"æ°›å›´"çš„"æ°›"è¯»ï¼š', options: ['A. fÄ“n', 'B. fÃ¨n', 'C. fÄ“n', 'D. fÃ¨n'], correctAnswer: 0, analysis: '"æ°›å›´"çš„"æ°›"è¯»fÄ“nã€‚' },
  { id: 'py100', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ°›å›´(fÄ“n) æ°”æ°›(fÄ“n)', 'B. æ°›å›´(fÃ¨n) æ°›å›´(fÄ“n)', 'C. æ°”æ°›(fÃ¨n) æ°›å›´(fÄ“n)', 'D. æ°›å›´(fÄ“n) æ°›å›´(fÃ¨n)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py101', type: 'pinyin', question: '"é¾Ÿè£‚"çš„"é¾Ÿ"è¯»ï¼š', options: ['A. guÄ«', 'B. jÅ«n', 'C. guÄ«', 'D. jÅ«n'], correctAnswer: 1, analysis: '"é¾Ÿè£‚"çš„"é¾Ÿ"è¯»jÅ«nã€‚' },
  { id: 'py102', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é¾Ÿè£‚(jÅ«n) é¾Ÿè£‚(jÅ«n)', 'B. é¾Ÿè£‚(guÄ«) ä¹Œé¾Ÿ(guÄ«)', 'C. é¾Ÿè£‚(jÅ«n) é¾Ÿè£‚(guÄ«)', 'D. é¾Ÿè£‚(guÄ«) é¾Ÿè£‚(jÅ«n)'], correctAnswer: 2, analysis: 'Cé¡¹"é¾Ÿè£‚"çš„"é¾Ÿ"åº”è¯»jÅ«nã€‚' },
  { id: 'py103', type: 'pinyin', question: '"ç¡®å‡¿"çš„"å‡¿"è¯»ï¼š', options: ['A. zÃ¡o', 'B. zuÃ²', 'C. zÃ¡o', 'D. zuÃ²'], correctAnswer: 0, analysis: '"ç¡®å‡¿"çš„"å‡¿"è¯»zÃ¡oã€‚' },
  { id: 'py104', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç¡®å‡¿(zÃ¡o) å¼€å‡¿(zÃ¡o)', 'B. ç¡®å‡¿(zuÃ²) å‡¿å­(zÃ¡o)', 'C. ç¡®å‡¿(zÃ¡o) å‡¿äº•(zÃ¡o)', 'D. ç¡®å‡¿(zuÃ²) å‡¿é€š(zÃ¡o)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py105', type: 'pinyin', question: '"è¡è"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. hÃ n dÃ n', 'B. hÃ¡n dÃ n', 'C. hÃ n dÃ¡n', 'D. hÃ¡n dÃ¡n'], correctAnswer: 0, analysis: '"è¡è"è¯»hÃ n dÃ nã€‚' },
  { id: 'py106', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¡è(hÃ n dÃ n) è¡è(hÃ n)', 'B. è¡è(hÃ¡n dÃ n) è¡èé¦™(hÃ n)', 'C. è¡è(hÃ n dÃ n) è¡è(hÃ¡n)', 'D. è¡è(hÃ¡n dÃ n) è¡è(hÃ n)'], correctAnswer: 2, analysis: 'Cé¡¹æ­£ç¡®ã€‚' },
  { id: 'py107', type: 'pinyin', question: '"æ –æ¯"çš„"æ –"è¯»ï¼š', options: ['A. qÄ«', 'B. xÄ«', 'C. qÄ«', 'D. xÄ«'], correctAnswer: 0, analysis: '"æ –æ¯"çš„"æ –"è¯»qÄ«ã€‚' },
  { id: 'py108', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ –æ¯(qÄ«) æ –èº«(qÄ«)', 'B. æ –æ¯(xÄ«) æ –æ¯(qÄ«)', 'C. æ –æ¯(qÄ«) æ –å±…(qÄ«)', 'D. æ –æ¯(xÄ«) æ –èº«(qÄ«)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py109', type: 'pinyin', question: '"ä¼›å»"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. yÇ” lÇš', 'B. yÇ” lÃ³u', 'C. yÅ« lÇš', 'D. yÅ« lÃ³u'], correctAnswer: 0, analysis: '"ä¼›å»"è¯»yÇ” lÇšã€‚' },
  { id: 'py110', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¼›å»(yÇ” lÇš) ä¼›å»(yÇ”)', 'B. ä¼›å»(lÇš) ä¼›å»(yÇ”)', 'C. ä¼›å»(yÇ” lÃ³u) ä¼›å»(yÇ”)', 'D. ä¼›å»(yÇ” lÇš) ä¼›å»(lÇš)'], correctAnswer: 2, analysis: 'Cé¡¹"ä¼›å»"çš„"å»"åº”è¯»lÇšã€‚' },
  { id: 'py111', type: 'pinyin', question: '"éªŠæ­Œ"çš„"éªŠ"è¯»ï¼š', options: ['A. lÃ­', 'B. lÃ¬', 'C. lÃ­', 'D. lÃ¬'], correctAnswer: 0, analysis: '"éªŠæ­Œ"çš„"éªŠ"è¯»lÃ­ã€‚' },
  { id: 'py112', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. éªŠæ­Œ(lÃ­) éªŠå±±(lÃ­)', 'B. éªŠæ­Œ(lÃ¬) éªŠç (lÃ­)', 'C. éªŠæ­Œ(lÃ­) éªŠé¾™(lÃ­)', 'D. éªŠæ­Œ(lÃ¬) éªŠå±±(lÃ­)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py113', type: 'pinyin', question: '"é€¾è¶Š"çš„"é€¾"è¯»ï¼š', options: ['A. yÃº', 'B. yÃ¹', 'C. yÃº', 'D. yÃ¹'], correctAnswer: 1, analysis: '"é€¾è¶Š"çš„"é€¾"è¯»yÃ¹ã€‚' },
  { id: 'py114', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é€¾è¶Š(yÃ¹) é€¾è¶Š(yÃº)', 'B. é€¾è¶Š(yÃ¹) é€¾æœŸ(yÃº)', 'C. é€¾è¶Š(yÃ¹) é€¾å£(yÃº)', 'D. é€¾è¶Š(yÃº) é€¾è¶Š(yÃ¹)'], correctAnswer: 3, analysis: 'Dé¡¹"é€¾è¶Š"çš„"é€¾"åº”è¯»yÃ¹ã€‚' },
  { id: 'py115', type: 'pinyin', question: '"ç¼„é»˜"çš„"ç¼„"è¯»ï¼š', options: ['A. jiÄn', 'B. jiÇn', 'C. jiÄn', 'D. jiÇn'], correctAnswer: 0, analysis: '"ç¼„é»˜"çš„"ç¼„"è¯»jiÄnã€‚' },
  { id: 'py116', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç¼„é»˜(jiÄn) ç¼„å£(jiÄn)', 'B. ç¼„é»˜(jiÇn) ç¼„é»˜(jiÄn)', 'C. ç¼„é»˜(jiÄn) ç¼„å£(jiÇn)', 'D. ç¼„é»˜(jiÇn) ç¼„å£(jiÇn)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py117', type: 'pinyin', question: '"ç›”ç”²"çš„"ç›”"è¯»ï¼š', options: ['A. kuÄ«', 'B. kuÃ­', 'C. kuÄ«', 'D. kuÃ­'], correctAnswer: 0, analysis: '"ç›”ç”²"çš„"ç›”"è¯»kuÄ«ã€‚' },
  { id: 'py118', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç›”ç”²(kuÄ«) ç›”ç”²(kuÃ­)', 'B. ç›”ç”²(kuÄ«) ç›”å¤´(kuÃ­)', 'C. ç›”ç”²(kuÃ­) ç›”ç”²(kuÄ«)', 'D. ç›”ç”²(kuÄ«) ç›”å¤´(kuÄ«)'], correctAnswer: 2, analysis: 'Cé¡¹"ç›”ç”²"çš„"ç›”"åº”è¯»kuÄ«ã€‚' },
  { id: 'py119', type: 'pinyin', question: '"é˜”ç»°"çš„"ç»°"è¯»ï¼š', options: ['A. chuÃ²', 'B. chÄo', 'C. chuÃ²', 'D. chÄo'], correctAnswer: 0, analysis: '"é˜”ç»°"çš„"ç»°"è¯»chuÃ²ã€‚' },
  { id: 'py120', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é˜”ç»°(chuÃ²) ç»°å·(chuÃ²)', 'B. é˜”ç»°(chÄo) ç»°çº¦(chuÃ²)', 'C. é˜”ç»°(chuÃ²) ç»°ç»°(chuÃ²)', 'D. é˜”ç»°(chÄo) ç»°å·(chÄo)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚"ç»°å·"çš„"ç»°"è¯»chuÃ²ã€‚' },
  { id: 'py121', type: 'pinyin', question: '"åå•¬"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. lÃ¬n sÃ¨', 'B. lÃ¬n sÄi', 'C. lÃ¬ng sÃ¨', 'D. lÃ¬ng sÄi'], correctAnswer: 0, analysis: '"åå•¬"è¯»lÃ¬n sÃ¨ã€‚' },
  { id: 'py122', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åå•¬(lÃ¬n sÃ¨) åæƒœ(lÃ¬n)', 'B. åå•¬(lÃ¬n sÃ¨) åè‰²(lÃ¬n)', 'C. åå•¬(lÃ¬n sÃ¨) åå•¬(lÃ¬n)', 'D. åå•¬(lÃ¬n sÄi) åæƒœ(lÃ¬n)'], correctAnswer: 3, analysis: 'Dé¡¹"åå•¬"çš„"å•¬"åº”è¯»sÃ¨ã€‚' },
  { id: 'py123', type: 'pinyin', question: '"çµ®è¯´"çš„"çµ®"è¯»ï¼š', options: ['A. xÃ¹', 'B. xÇ”', 'C. xÃ¹', 'D. xÇ”'], correctAnswer: 0, analysis: '"çµ®è¯´"çš„"çµ®"è¯»xÃ¹ã€‚' },
  { id: 'py124', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. çµ®è¯´(xÃ¹) çµ®å¨(xÃ¹)', 'B. çµ®è¯´(xÇ”) çµ®çƒ¦(xÃ¹)', 'C. çµ®è¯´(xÃ¹) çµ®çµ®(xÃ¹)', 'D. çµ®è¯´(xÇ”) çµ®å¨(xÇ”)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py125', type: 'pinyin', question: '"è¸Œèº‡"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. chÃ³u chÃº', 'B. chÃ³u chÃº', 'C. chÃ³u chÃº', 'D. chÃ³u chÃº'], correctAnswer: 0, analysis: '"è¸Œèº‡"è¯»chÃ³u chÃºã€‚' },
  { id: 'py126', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¸Œèº‡(chÃ³u chÃº) è¸Œèº‡(chÃ³u)', 'B. è¸Œèº‡(chÃº chÃº) è¸Œèº‡(chÃ³u)', 'C. è¸Œèº‡(chÃ³u chÃº) è¸Œèº‡(chÃº)', 'D. è¸Œèº‡(chÃ³u chÃº) è¸Œèº‡(chÃ³u)'], correctAnswer: 1, analysis: 'Bé¡¹"è¸Œèº‡"çš„"è¸Œ"åº”è¯»chÃ³uã€‚' },
  { id: 'py127', type: 'pinyin', question: '"é¢“å”"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. tuÃ­ tÃ¡ng', 'B. tuÃ­ tÃ¡ng', 'C. tuÃ­ tÃ¡ng', 'D. tuÃ­ tÃ¡ng'], correctAnswer: 0, analysis: '"é¢“å”"è¯»tuÃ­ tÃ¡ngã€‚' },
  { id: 'py128', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é¢“å”(tuÃ­) é¢“åºŸ(tuÃ­)', 'B. é¢“å”(tuÃ­) é¢“ä¸§(tuÃ­)', 'C. é¢“å”(tuÃ­) é¢“è´¥(tuÃ­)', 'D. é¢“å”(tuÃ­) é¢“é¡(tuÃ­)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py129', type: 'pinyin', question: '"æƒŠæƒ¶"çš„"æƒ¶"è¯»ï¼š', options: ['A. huÃ¡ng', 'B. huÄng', 'C. huÃ¡ng', 'D. huÄng'], correctAnswer: 0, analysis: '"æƒŠæƒ¶"çš„"æƒ¶"è¯»huÃ¡ngã€‚' },
  { id: 'py130', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æƒŠæƒ¶(huÃ¡ng) æƒ¶æ(huÃ¡ng)', 'B. æƒŠæƒ¶(huÃ¡ng) æƒ¶æƒ‘(huÃ¡ng)', 'C. æƒŠæƒ¶(huÄng) æƒ¶é½(huÃ¡ng)', 'D. æƒŠæƒ¶(huÃ¡ng) æƒ¶æƒ¶(huÃ¡ng)'], correctAnswer: 2, analysis: 'Cé¡¹"æƒŠæƒ¶"çš„"æƒ¶"åº”è¯»huÃ¡ngã€‚' },
  { id: 'py131', type: 'pinyin', question: '"è¹’è·š"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. pÃ¡n shÄn', 'B. pÃ¡n shÄn', 'C. pÃ¡n shÄn', 'D. pÃ¡n shÄn'], correctAnswer: 0, analysis: '"è¹’è·š"è¯»pÃ¡n shÄnã€‚' },
  { id: 'py132', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¹’è·š(pÃ¡n) è¹’è·š(shÄn)', 'B. è¹’è·š(pÃ¡n) è¹’è·š(pÃ¡n)', 'C. è¹’è·š(pÃ¡n) è¹’è·š(shÄn)', 'D. è¹’è·š(pÃ¡n) è¹’è·š(pÃ¡n)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py133', type: 'pinyin', question: '"ä¼«ç«‹"çš„"ä¼«"è¯»ï¼š', options: ['A. zhÃ¹', 'B. zhÇ”', 'C. zhÃ¹', 'D. zhÇ”'], correctAnswer: 0, analysis: '"ä¼«ç«‹"çš„"ä¼«"è¯»zhÃ¹ã€‚' },
  { id: 'py134', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¼«ç«‹(zhÃ¹) ä¼«ç«‹(zhÃ¹)', 'B. ä¼«ç«‹(zhÇ”) ä¼«å€™(zhÃ¹)', 'C. ä¼«ç«‹(zhÃ¹) ä¼«æœ›(zhÃ¹)', 'D. ä¼«ç«‹(zhÃ¹) ä¼«ç«‹(zhÇ”)'], correctAnswer: 3, analysis: 'Dé¡¹"ä¼«ç«‹"çš„"ä¼«"åº”è¯»zhÃ¹ã€‚' },
  { id: 'py135', type: 'pinyin', question: '"ç²—ç³™"çš„"ç³™"è¯»ï¼š', options: ['A. cÄo', 'B. zÃ o', 'C. cÄo', 'D. zÃ o'], correctAnswer: 0, analysis: '"ç²—ç³™"çš„"ç³™"è¯»cÄoã€‚' },
  { id: 'py136', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç²—ç³™(cÄo) ç³™ç±³(cÄo)', 'B. ç²—ç³™(cÄo) ç³ç³™(zÃ o)', 'C. ç²—ç³™(cÄo) ç³™æ±‰(cÄo)', 'D. ç²—ç³™(zÃ o) ç³™ç±³(cÄo)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py137', type: 'pinyin', question: '"å”¯å¦™å”¯è‚–"åº”ä¸ºï¼š', options: ['A. æƒŸå¦™æƒŸè‚–', 'B. å”¯å¦™å”¯è‚–', 'C. ç»´å¦™ç»´è‚–', 'D. å¾®å¦™å¾®è‚–'], correctAnswer: 0, analysis: 'åº”ä¸º"æƒŸå¦™æƒŸè‚–"ã€‚' },
  { id: 'py138', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æƒŸå¦™æƒŸè‚–(xiÃ o) æƒŸå¦™(wÃ©i)', 'B. æƒŸå¦™æƒŸè‚–(xiÄo) æƒŸå¦™(wÃ©i)', 'C. æƒŸå¦™æƒŸè‚–(xiÃ o) æƒŸå¦™(wÃ©i)', 'D. æƒŸå¦™æƒŸè‚–(xiÄo) æƒŸå¦™(wÃ©i)'], correctAnswer: 1, analysis: 'Bé¡¹"è‚–"åº”è¯»xiÃ oã€‚' },
  { id: 'py139', type: 'pinyin', question: '"å—”è§†"çš„"å—”"è¯»ï¼š', options: ['A. chÄ“n', 'B. chÄ“ng', 'C. chÄ“n', 'D. chÄ“ng'], correctAnswer: 0, analysis: '"å—”è§†"çš„"å—”"è¯»chÄ“nã€‚' },
  { id: 'py140', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å—”è§†(chÄ“n) å—”æ€ª(chÄ“n)', 'B. å—”è§†(chÄ“ng) å—”æ€’(chÄ“n)', 'C. å—”è§†(chÄ“n) å—”æ€ª(chÄ“ng)', 'D. å—”è§†(chÄ“ng) å—”æ€’(chÄ“ng)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py141', type: 'pinyin', question: '"å¨´ç†Ÿ"çš„"å¨´"è¯»ï¼š', options: ['A. xiÃ¡n', 'B. xiÄn', 'C. xiÃ¡n', 'D. xiÄn'], correctAnswer: 0, analysis: '"å¨´ç†Ÿ"çš„"å¨´"è¯»xiÃ¡nã€‚' },
  { id: 'py142', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å¨´ç†Ÿ(xiÃ¡n) å¨´ç†Ÿ(xiÃ¡n)', 'B. å¨´ç†Ÿ(xiÄn) å¨´é›…(xiÃ¡n)', 'C. å¨´ç†Ÿ(xiÃ¡n) å¨´é™(xiÃ¡n)', 'D. å¨´ç†Ÿ(xiÄn) å¨´ç†Ÿ(xiÃ¡n)'], correctAnswer: 3, analysis: 'Dé¡¹"å¨´ç†Ÿ"çš„"å¨´"åº”è¯»xiÃ¡nã€‚' },
  { id: 'py143', type: 'pinyin', question: '"æƒ©ç½š"çš„"æƒ©"è¯»ï¼š', options: ['A. chÃ©ng', 'B. chÄ›ng', 'C. chÃ©ng', 'D. chÄ›ng'], correctAnswer: 0, analysis: '"æƒ©ç½š"çš„"æƒ©"è¯»chÃ©ngã€‚' },
  { id: 'py144', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æƒ©ç½š(chÃ©ng) æƒ©æ²»(chÃ©ng)', 'B. æƒ©ç½š(chÄ›ng) æƒ©æˆ’(chÃ©ng)', 'C. æƒ©ç½š(chÃ©ng) æƒ©å¤„(chÇ”)', 'D. æƒ©ç½š(chÄ›ng) æƒ©æ²»(chÄ›ng)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py145', type: 'pinyin', question: '"ç•¸å½¢"çš„"ç•¸"è¯»ï¼š', options: ['A. jÄ«', 'B. jÃ­', 'C. jÄ«', 'D. jÃ­'], correctAnswer: 0, analysis: '"ç•¸å½¢"çš„"ç•¸"è¯»jÄ«ã€‚' },
  { id: 'py146', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç•¸å½¢(jÄ«) ç•¸å½¢(jÄ«)', 'B. ç•¸å½¢(jÃ­) ç•¸å˜(jÄ«)', 'C. ç•¸å½¢(jÄ«) ç•¸è½»ç•¸é‡(jÄ«)', 'D. ç•¸å½¢(jÃ­) ç•¸å½¢(jÄ«)'], correctAnswer: 3, analysis: 'Dé¡¹"ç•¸å½¢"çš„"ç•¸"åº”è¯»jÄ«ã€‚' },
  { id: 'py147', type: 'pinyin', question: '"åª²ç¾"çš„"åª²"è¯»ï¼š', options: ['A. pÃ¬', 'B. bÇ', 'C. pÃ¬', 'D. bÇ'], correctAnswer: 0, analysis: '"åª²ç¾"çš„"åª²"è¯»pÃ¬ã€‚' },
  { id: 'py148', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åª²ç¾(pÃ¬) åª²ç¾(pÃ¬)', 'B. åª²ç¾(pÃ­) åª²ç¾(pÃ¬)', 'C. åª²ç¾(pÃ¬) åª²é…(pÃ¬)', 'D. åª²ç¾(pÃ­) åª²é…(pÃ­)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py149', type: 'pinyin', question: '"ç‹©çŒ"çš„"ç‹©"è¯»ï¼š', options: ['A. shÃ²u', 'B. shÇ’u', 'C. shÃ²u', 'D. shÇ’u'], correctAnswer: 0, analysis: '"ç‹©çŒ"çš„"ç‹©"è¯»shÃ²uã€‚' },
  { id: 'py150', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç‹©çŒ(shÃ²u) ç‹©çŒ(shÃ²u)', 'B. ç‹©çŒ(shÃ²u) ç‹©ç‹©(shÃ²u)', 'C. ç‹©çŒ(shÇ’u) ç‹©çŒ(shÃ²u)', 'D. ç‹©çŒ(shÃ²u) ç‹©çŒ(shÇ’u)'], correctAnswer: 2, analysis: 'Cé¡¹"ç‹©çŒ"çš„"ç‹©"åº”è¯»shÃ²uã€‚' },
  { id: 'py151', type: 'pinyin', question: '"è¤¶çš±"çš„"è¤¶"è¯»ï¼š', options: ['A. zhÄ›', 'B. zhÃ©', 'C. zhÄ›', 'D. zhÃ©'], correctAnswer: 0, analysis: '"è¤¶çš±"çš„"è¤¶"è¯»zhÄ›ã€‚' },
  { id: 'py152', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è¤¶çš±(zhÄ›) è¤¶å­(zhÄ›)', 'B. è¤¶çš±(zhÃ©) è¤¶çš±(zhÄ›)', 'C. è¤¶çš±(zhÄ›) è¤¶çš±(zhÃ©)', 'D. è¤¶çš±(zhÃ©) è¤¶å­(zhÃ©)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py153', type: 'pinyin', question: '"è´®è“„"çš„"è´®"è¯»ï¼š', options: ['A. zhÃ¹', 'B. chÇ”', 'C. zhÃ¹', 'D. chÇ”'], correctAnswer: 0, analysis: '"è´®è“„"çš„"è´®"è¯»zhÃ¹ã€‚' },
  { id: 'py154', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è´®è“„(zhÃ¹) è´®å­˜(zhÃ¹)', 'B. è´®è“„(zhÃ¹) è´®è—(zhÃ¹)', 'C. è´®è“„(chÇ”) è´®è“„(zhÃ¹)', 'D. è´®è“„(zhÃ¹) è´®å¤‡(zhÃ¹)'], correctAnswer: 2, analysis: 'Cé¡¹"è´®è“„"çš„"è´®"åº”è¯»zhÃ¹ã€‚' },
  { id: 'py155', type: 'pinyin', question: '"é…é…¿"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. yÃ¹n niÃ ng', 'B. yÃ¹n niÃ ng', 'C. yÇ”n niÃ ng', 'D. yÇ”n niÃ ng'], correctAnswer: 0, analysis: '"é…é…¿"è¯»yÃ¹n niÃ ngã€‚' },
  { id: 'py156', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é…é…¿(yÃ¹n) é…é…¿(niÃ ng)', 'B. é…é…¿(yÇ”n) é…é…¿(niÃ ng)', 'C. é…é…¿(yÃ¹n) é…é…’(niÃ ng)', 'D. é…é…¿(yÇ”n) é…¿é…’(niÃ ng)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py157', type: 'pinyin', question: '"èœç•¦"çš„"ç•¦"è¯»ï¼š', options: ['A. qÃ­', 'B. wÄ', 'C. qÃ­', 'D. wÄ'], correctAnswer: 0, analysis: '"èœç•¦"çš„"ç•¦"è¯»qÃ­ã€‚' },
  { id: 'py158', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. èœç•¦(qÃ­) ç•¦ç”°(qÃ­)', 'B. èœç•¦(qÃ­) ç•¦å¾„(qÃ­)', 'C. èœç•¦(wÄ) ç•¦ç”°(qÃ­)', 'D. èœç•¦(qÃ­) ç•¦å­(qÃ­)'], correctAnswer: 2, analysis: 'Cé¡¹"èœç•¦"çš„"ç•¦"åº”è¯»qÃ­ã€‚' },
  { id: 'py159', type: 'pinyin', question: '"è„‘é«“"çš„"é«“"è¯»ï¼š', options: ['A. suÇ', 'B. suÄ«', 'C. suÇ', 'D. suÄ«'], correctAnswer: 0, analysis: '"è„‘é«“"çš„"é«“"è¯»suÇã€‚' },
  { id: 'py160', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. è„‘é«“(suÇ) éª¨é«“(suÇ)', 'B. è„‘é«“(suÄ«) é«“è´¨(suÇ)', 'C. è„‘é«“(suÇ) é«“è…”(suÇ)', 'D. è„‘é«“(suÄ«) éª¨é«“(suÄ«)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py161', type: 'pinyin', question: '"ç‹¡ç‹"åº”ä¸ºï¼š', options: ['A. ç‹°ç‹', 'B. ç‹¡ç‹', 'C. ç‹ç‹°', 'D. ç‹ç‹¡'], correctAnswer: 0, analysis: 'åº”ä¸º"ç‹°ç‹"ã€‚' },
  { id: 'py162', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç‹°ç‹(nÃ­ng) ç‹°ç‹(nÃ­ng)', 'B. ç‹°ç‹(nÃ­ng) ç‹°ç‹(nÃ­ng)', 'C. ç‹°ç‹(ning) ç‹°ç‹(nÃ­ng)', 'D. ç‹°ç‹(nÃ­ng) ç‹°ç‹(nÃ­ng)'], correctAnswer: 2, analysis: 'Cé¡¹"ç‹"åº”è¯»nÃ­ngã€‚' },
  { id: 'py163', type: 'pinyin', question: '"åŒä»‡æ•Œå¿¾"çš„"å¿¾"è¯»ï¼š', options: ['A. kÃ i', 'B. qÃ¬', 'C. kÃ i', 'D. qÃ¬'], correctAnswer: 0, analysis: '"åŒä»‡æ•Œå¿¾"çš„"å¿¾"è¯»kÃ iã€‚' },
  { id: 'py164', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŒä»‡æ•Œå¿¾(kÃ i) æ•Œå¿¾(kÃ i)', 'B. åŒä»‡æ•Œå¿¾(qÃ¬) æ•Œå¿¾(kÃ i)', 'C. åŒä»‡æ•Œå¿¾(kÃ i) æ•Œå¿¾(qÃ¬)', 'D. åŒä»‡æ•Œå¿¾(qÃ¬) æ•Œå¿¾(qÃ¬)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚' },
  { id: 'py165', type: 'pinyin', question: '"ç·æ±¡"çš„"ç·"è¯»ï¼š', options: ['A. diÃ n', 'B. zhÄn', 'C. diÃ n', 'D. zhÄn'], correctAnswer: 0, analysis: '"ç·æ±¡"çš„"ç·"è¯»diÃ nã€‚' },
  { id: 'py166', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç·æ±¡(diÃ n) ç·æ±¡(diÃ n)', 'B. ç·æ±¡(zhÄn) ç·è¾±(diÃ n)', 'C. ç·æ±¡(diÃ n) ç·æ±¡(zhÄn)', 'D. ç·æ±¡(diÃ n) ç·è¾±(diÃ n)'], correctAnswer: 2, analysis: 'Cé¡¹"ç·æ±¡"çš„"ç·"åº”è¯»diÃ nã€‚' },
  { id: 'py167', type: 'pinyin', question: '"ä¾›ç»™"çš„"ä¾›"è¯»ï¼š', options: ['A. gÅng', 'B. gÃ²ng', 'C. gÅng', 'D. gÃ²ng'], correctAnswer: 1, analysis: '"ä¾›ç»™"çš„"ä¾›"è¯»gÃ²ngã€‚' },
  { id: 'py168', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ä¾›ç»™(gÃ²ng) ä¾›å“(gÃ²ng)', 'B. ä¾›ç»™(gÅng) ä¾›è®¤(gÃ²ng)', 'C. ä¾›ç»™(gÃ²ng) ä¾›èŒ(gÃ²ng)', 'D. ä¾›ç»™(gÅng) ä¾›è®¤(gÅng)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚"ä¾›è®¤"çš„"ä¾›"è¯»gÃ²ngã€‚' },
  { id: 'py169', type: 'pinyin', question: '"å£è§’"çš„"è§’"è¯»ï¼š', options: ['A. juÃ©', 'B. jiÇo', 'C. juÃ©', 'D. jiÇo'], correctAnswer: 1, analysis: '"å£è§’"çš„"è§’"è¯»jiÇoã€‚' },
  { id: 'py170', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å£è§’(jiÇo) è§’è‰²(juÃ©)', 'B. å£è§’(juÃ©) è§’é€(juÃ©)', 'C. å£è§’(jiÇo) è§’åº¦(jiÇo)', 'D. å£è§’(juÃ©) è§’è½(jiÇo)'], correctAnswer: 1, analysis: 'Bé¡¹"å£è§’"çš„"è§’"åº”è¯»jiÇoã€‚' },
  { id: 'py171', type: 'pinyin', question: '"å€”å¼º"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. juÃ© jiÃ ng', 'B. juÃ¨ jiÃ ng', 'C. juÃ© jiÃ ng', 'D. juÃ¨ jiÃ ng'], correctAnswer: 0, analysis: '"å€”å¼º"è¯»juÃ© jiÃ ngã€‚' },
  { id: 'py172', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å€”å¼º(jiÃ ng) å¼ºè¿«(qiÇng)', 'B. å€”å¼º(jiÃ ng) å¼ºå£®(qiÃ¡ng)', 'C. å€”å¼º(juÃ©) å¼ºè¿«(qiÃ¡ng)', 'D. å€”å¼º(jiÃ ng) å¼ºå¤§(qiÃ¡ng)'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚"å€”å¼º"è¯»juÃ© jiÃ ngã€‚' },
  { id: 'py173', type: 'pinyin', question: '"å¤„åˆ†"çš„"å¤„"è¯»ï¼š', options: ['A. chÇ”', 'B. chÃ¹', 'C. chÇ”', 'D. chÃ¹'], correctAnswer: 1, analysis: '"å¤„åˆ†"çš„"å¤„"è¯»chÃ¹ã€‚' },
  { id: 'py174', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å¤„åˆ†(chÃ¹) å¤„ç†(chÇ”)', 'B. å¤„åˆ†(chÃ¹) å¤„æ‰€(chÃ¹)', 'C. å¤„åˆ†(chÇ”) å¤„ç½®(chÇ”)', 'D. å¤„åˆ†(chÃ¹) å¤„æ‰€(chÃ¹)'], correctAnswer: 2, analysis: 'Cé¡¹"å¤„åˆ†"çš„"å¤„"åº”è¯»chÃ¹ã€‚' },
  { id: 'py175', type: 'pinyin', question: '"å¤„æ‰€"çš„"å¤„"è¯»ï¼š', options: ['A. chÇ”', 'B. chÃ¹', 'C. chÇ”', 'D. chÃ¹'], correctAnswer: 1, analysis: '"å¤„æ‰€"çš„"å¤„"è¯»chÃ¹ã€‚' },
  { id: 'py176', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å¤„æ‰€(chÃ¹) ä½å¤„(chÃ¹)', 'B. å¤„æ‰€(chÃ¹) å¥½å¤„(chÃ¹)', 'C. å¤„æ‰€(chÃ¹) å»å¤„(chÃ¹)', 'D. å¤„æ‰€(chÃ¹) å¤„æ–¹(chÃ¹)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚"å¤„æ–¹"çš„"å¤„"è¯»chÇ”ã€‚' },
  { id: 'py177', type: 'pinyin', question: '"æ¶åŠ£"çš„"æ¶"è¯»ï¼š', options: ['A. Ã¨', 'B. wÃ¹', 'C. Ã¨', 'D. wÃ¹'], correctAnswer: 0, analysis: '"æ¶åŠ£"çš„"æ¶"è¯»Ã¨ã€‚' },
  { id: 'py178', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ¶åŠ£(Ã¨) æ¶å¿ƒ(Ä›)', 'B. æ¶åŠ£(Ã¨) å‡¶æ¶(Ã¨)', 'C. æ¶åŠ£(wÃ¹) æ¶ä¹ (Ã¨)', 'D. æ¶åŠ£(Ã¨) å–„æ¶(Ã¨)'], correctAnswer: 2, analysis: 'Cé¡¹"æ¶åŠ£"çš„"æ¶"åº”è¯»Ã¨ã€‚' },
  { id: 'py179', type: 'pinyin', question: '"æ¶å¿ƒ"çš„"æ¶"è¯»ï¼š', options: ['A. Ã¨', 'B. Ä›', 'C. Ã¨', 'D. Ä›'], correctAnswer: 1, analysis: '"æ¶å¿ƒ"çš„"æ¶"è¯»Ä›ã€‚' },
  { id: 'py180', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ¶å¿ƒ(Ä›) æ¶å¿ƒ(Ä›)', 'B. æ¶å¿ƒ(Ä›) åŒæ¶(wÃ¹)', 'C. æ¶å¿ƒ(Ä›) å¯æ¶(wÃ¹)', 'D. æ¶å¿ƒ(Ã¨) åŒæ¶(wÃ¹)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚"åŒæ¶"çš„"æ¶"è¯»wÃ¹ã€‚' },
  { id: 'py181', type: 'pinyin', question: '"ç§°èŒ"çš„"ç§°"è¯»ï¼š', options: ['A. chÄ“ng', 'B. chÃ¨n', 'C. chÄ“ng', 'D. chÃ¨n'], correctAnswer: 1, analysis: '"ç§°èŒ"çš„"ç§°"è¯»chÃ¨nã€‚' },
  { id: 'py182', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç§°èŒ(chÃ¨n) ç§°èµ(chÄ“ng)', 'B. ç§°èŒ(chÃ¨n) ç§°å¿ƒ(chÃ¨n)', 'C. ç§°èŒ(chÄ“ng) ç§°é‡(chÄ“ng)', 'D. ç§°èŒ(chÃ¨n) ç›¸ç§°(chÃ¨n)'], correctAnswer: 2, analysis: 'Cé¡¹"ç§°èŒ"çš„"ç§°"åº”è¯»chÃ¨nã€‚' },
  { id: 'py183', type: 'pinyin', question: '"å‡æœŸ"çš„"å‡"è¯»ï¼š', options: ['A. jiÇ', 'B. jiÃ ', 'C. jiÇ', 'D. jiÃ '], correctAnswer: 1, analysis: '"å‡æœŸ"çš„"å‡"è¯»jiÃ ã€‚' },
  { id: 'py184', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‡æœŸ(jiÃ ) å‡æ—¥(jiÃ )', 'B. å‡æœŸ(jiÇ) å‡è£…(jiÇ)', 'C. å‡æœŸ(jiÃ ) å‡æ¡(jiÃ )', 'D. å‡æœŸ(jiÇ) å‡é€ (jiÇ)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚"å‡è£…"çš„"å‡"è¯»jiÇã€‚' },
  { id: 'py185', type: 'pinyin', question: '"æœä»£"çš„"æœ"è¯»ï¼š', options: ['A. chÃ¡o', 'B. zhÄo', 'C. chÃ¡o', 'D. zhÄo'], correctAnswer: 0, analysis: '"æœä»£"çš„"æœ"è¯»chÃ¡oã€‚' },
  { id: 'py186', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æœä»£(chÃ¡o) æœå‘(chÃ¡o)', 'B. æœä»£(zhÄo) æœæ°”(zhÄo)', 'C. æœä»£(chÃ¡o) æœå»·(chÃ¡o)', 'D. æœä»£(chÃ¡o) æœå‘(chÃ¡o)'], correctAnswer: 1, analysis: 'Bé¡¹"æœä»£"çš„"æœ"åº”è¯»chÃ¡oã€‚' },
  { id: 'py187', type: 'pinyin', question: '"æŠ•å¥”"çš„"å¥”"è¯»ï¼š', options: ['A. bÄ“n', 'B. bÃ¨n', 'C. bÄ“n', 'D. bÃ¨n'], correctAnswer: 1, analysis: '"æŠ•å¥”"çš„"å¥”"è¯»bÃ¨nã€‚' },
  { id: 'py188', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æŠ•å¥”(bÃ¨n) å¥”è·‘(bÄ“n)', 'B. æŠ•å¥”(bÃ¨n) å¥”èµ´(bÃ¨n)', 'C. æŠ•å¥”(bÄ“n) å¥”ä¸§(bÄ“n)', 'D. æŠ•å¥”(bÃ¨n) å¥”æ³¢(bÅ)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚"å¥”è·‘"çš„"å¥”"è¯»bÄ“nã€‚' },
  { id: 'py189', type: 'pinyin', question: '"æ–¹ä¾¿"çš„"ä¾¿"è¯»ï¼š', options: ['A. biÃ n', 'B. piÃ¡n', 'C. biÃ n', 'D. piÃ¡n'], correctAnswer: 1, analysis: '"æ–¹ä¾¿"çš„"ä¾¿"è¯»piÃ¡nã€‚' },
  { id: 'py190', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. æ–¹ä¾¿(piÃ¡n) ä¾¿å®œ(piÃ¡n)', 'B. æ–¹ä¾¿(biÃ n) ä¾¿åˆ©(biÃ n)', 'C. æ–¹ä¾¿(piÃ¡n) ä¾¿å½“(biÃ n)', 'D. æ–¹ä¾¿(biÃ n) éšä¾¿(biÃ n)'], correctAnswer: 2, analysis: 'Cé¡¹"ä¾¿å½“"çš„"ä¾¿"åº”è¯»biÃ nã€‚' },
  { id: 'py191', type: 'pinyin', question: '"å’Œç¦"çš„"å’Œ"è¯»ï¼š', options: ['A. hÃ©', 'B. hÃ¨', 'C. huÃ³', 'D. huÃ²'], correctAnswer: 0, analysis: '"å’Œç¦"çš„"å’Œ"è¯»hÃ©ã€‚' },
  { id: 'py192', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å’Œç¦(hÃ©) å’Œè°(hÃ©)', 'B. å’Œç¦(hÃ¨) é™„å’Œ(hÃ¨)', 'C. å’Œç¦(hÃ©) å’Œå¹³(hÃ©)', 'D. å’Œç¦(huÃ³) å’Œé¢(huÃ³)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚"é™„å’Œ"çš„"å’Œ"è¯»hÃ¨ã€‚' },
  { id: 'py193', type: 'pinyin', question: '"å®¿èˆ"çš„"èˆ"è¯»ï¼š', options: ['A. shÄ›', 'B. shÃ¨', 'C. shÄ›', 'D. shÃ¨'], correctAnswer: 1, analysis: '"å®¿èˆ"çš„"èˆ"è¯»shÃ¨ã€‚' },
  { id: 'py194', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å®¿èˆ(shÃ¨) å¯’èˆ(shÃ¨)', 'B. å®¿èˆ(shÄ›) èˆä¸å¾—(shÄ›)', 'C. å®¿èˆ(shÃ¨) èˆä¸‹(shÃ¨)', 'D. å®¿èˆ(shÄ›) æ–½èˆ(shÄ›)'], correctAnswer: 1, analysis: 'Bé¡¹"å®¿èˆ"çš„"èˆ"åº”è¯»shÃ¨ã€‚' },
  { id: 'py195', type: 'pinyin', question: '"ç€æ€¥"çš„"ç€"è¯»ï¼š', options: ['A. zhe', 'B. zhÃ¡o', 'C. zhuÃ³', 'D. zhÄo'], correctAnswer: 1, analysis: '"ç€æ€¥"çš„"ç€"è¯»zhÃ¡oã€‚' },
  { id: 'py196', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç€æ€¥(zhÃ¡o) ç€å‡‰(zhÃ¡o)', 'B. ç€æ€¥(zhe) æ²¿ç€(zhe)', 'C. ç€æ€¥(zhÃ¡o) ç€ç«(zhÃ¡o)', 'D. ç€æ€¥(zhÄo) ç€æ•°(zhÄo)'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚"ç€å‡‰"çš„"ç€"è¯»zhÃ¡oã€‚' },
  { id: 'py197', type: 'pinyin', question: '"å‚å·®"çš„è¯»éŸ³æ˜¯ï¼š', options: ['A. cÄ“n cÄ«', 'B. cÄ“n cÄ«', 'C. cÄ“n cÄ«', 'D. cÄ“n cÄ«'], correctAnswer: 0, analysis: '"å‚å·®"è¯»cÄ“n cÄ«ã€‚' },
  { id: 'py198', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—è¯»éŸ³æœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‚å·®(cÄ“n cÄ«) å‚å·®(cÄ“n)', 'B. å‚å·®(cÄ« cÄ«) å‚å·®(cÄ“n)', 'C. å‚å·®(cÄ“n cÄ«) å‚å·®(cÄ«)', 'D. å‚å·®(cÄ“n cÄ«) å‚å·®(cÄ“n)'], correctAnswer: 1, analysis: 'Bé¡¹"å‚å·®"çš„è¯»éŸ³åº”è¯»cÄ“n cÄ«ã€‚' },
  { id: 'py199', type: 'pinyin', question: '"ç¿˜é¦–"çš„"ç¿˜"è¯»ï¼š', options: ['A. qiÃ¡o', 'B. qiÃ o', 'C. qiÃ¡o', 'D. qiÃ o'], correctAnswer: 0, analysis: '"ç¿˜é¦–"çš„"ç¿˜"è¯»qiÃ¡oã€‚' },
  { id: 'py200', type: 'pinyin', question: 'ä¸‹åˆ—åŠ ç‚¹å­—æ³¨éŸ³å®Œå…¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç¿˜é¦–(qiÃ¡o) ç¿˜èµ·(qiÃ o)', 'B. ç¿˜é¦–(qiÃ o) ç¿˜é¦–(qiÃ¡o)', 'C. ç¿˜é¦–(qiÃ¡o) ç¿˜æœ›(qiÃ¡o)', 'D. ç¿˜é¦–(qiÃ o) ç¿˜èµ·(qiÃ¡o)'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚"ç¿˜èµ·"çš„"ç¿˜"è¯»qiÃ oã€‚' }
]

module.exports = { EXTENDED_PINYIN }


// ===== src/services/question_extensions.js =====
/**
 * é¢˜ç›®æ‰©å±•æ•°æ®
 * æ¯ç§é¢˜å‹ä»20é“æ‰©å±•åˆ°200é“
 */

// æ‰¹é‡ç”Ÿæˆå·¥å…·å‡½æ•°
const generateQuestions = (type, start, end, template) => {
  const questions = []
  for (let i = start; i <= end; i++) {
    const id = `${type === 'correction' ? 'bc' : type === 'literature' ? 'gs' : type.substring(0, 2)}${String(i).padStart(3, '0')}`
    questions.push({
      id,
      type,
      ...template(i)
    })
  }
  return questions
}

// è¯æ±‡ç»ƒä¹ æ‰©å±• (vo021-vo200)
const EXTENDED_VOCABULARY = [
  { id: 'vo021', type: 'vocabulary', question: '"å·æµä¸æ¯"çš„"å·"æ„æ€æ˜¯ï¼š', options: ['A. å±±å·', 'B. æ²³æµ', 'C. å¹³åŸ', 'D. é“è·¯'], correctAnswer: 1, analysis: '"å·"æŒ‡æ²³æµã€‚' },
  { id: 'vo022', type: 'vocabulary', question: '"å› åœ°åˆ¶å®œ"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ ¹æ®å½“åœ°åˆ¶å®šæªæ–½', 'B. æ”¹é€ ç¯å¢ƒ', 'C. é€‚åº”ç¯å¢ƒ', 'D. æ”¹å˜åˆ¶åº¦'], correctAnswer: 0, analysis: '"å› åœ°åˆ¶å®œ"æŒ‡æ ¹æ®æƒ…å†µåˆ¶å®šåŠæ³•ã€‚' },
  { id: 'vo023', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­è§£é‡Šæœ‰è¯¯çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. å‡›å†½ï¼šå¯’å†·', 'B. é€¶è¿¤ï¼šå¼¯æ›²', 'C. å¦¥å¸–ï¼šæ°å½“', 'D. ä¿¨ç„¶ï¼šä¸¥è‚ƒ'], correctAnswer: 3, analysis: 'Dé¡¹"ä¿¨ç„¶"ä¸»è¦æŒ‡å¾ˆåƒã€‚' },
  { id: 'vo024', type: 'vocabulary', question: '"ä¸å¯æ€è®®"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ— æ³•æƒ³è±¡', 'B. ä¸å¯è®®è®º', 'C. å¾ˆç¥å¥‡', 'D. ä¸è®²ç†'], correctAnswer: 0, analysis: '"ä¸å¯æ€è®®"å½¢å®¹éš¾ä»¥æƒ³è±¡ã€‚' },
  { id: 'vo025', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æ²¡æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç„•ç„¶ä¸€æ–°', 'B. è°ˆç¬‘é£å£°', 'C. è¿«ä¸æ€¥å¾…', 'D. å†æ¥å†åŠ±'], correctAnswer: 0, analysis: 'Aé¡¹æ­£ç¡®ã€‚Båº”"ç”Ÿ"ï¼ŒCåº”"åŠ"ï¼ŒDåº”"å‰"ã€‚' },
  { id: 'vo026', type: 'vocabulary', question: '"æŠ‘æ‰¬é¡¿æŒ«"å½¢å®¹ï¼š', options: ['A. å£°éŸ³é«˜ä½èµ·ä¼', 'B. æŠ‘åˆ¶', 'C. æŒ«æŠ˜', 'D. åœé¡¿'], correctAnswer: 0, analysis: '"æŠ‘æ‰¬é¡¿æŒ«"å½¢å®¹å£°éŸ³é«˜ä½èµ·ä¼å’Œè°ã€‚' },
  { id: 'vo027', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¹¦å†™æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. ç›¸å¾—ç›Šç« ', 'B. ç›¸å¾—ç›Šå½°', 'C. ç›¸å¾—ç›Šå¼ ', 'D. ç›¸å¾—ç›Šæ¶¨'], correctAnswer: 1, analysis: 'Bé¡¹æ­£ç¡®ã€‚' },
  { id: 'vo028', type: 'vocabulary', question: '"ç»œç»ä¸ç»"çš„æ„æ€æ˜¯ï¼š', options: ['A. æ–­æ–­ç»­ç»­', 'B. è¿ç»­ä¸æ–­', 'C. ç»œç»', 'D. ä¸ç»'], correctAnswer: 1, analysis: '"ç»œç»ä¸ç»"å½¢å®¹è¡Œäººè½¦é©¬è¿ç»­ä¸æ–­ã€‚' },
  { id: 'vo029', type: 'vocabulary', question: 'ä¸‹åˆ—è¯è¯­ä¸­æœ‰é”™åˆ«å­—çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. éƒ‘é‡å…¶äº‹', 'B. æ¼«ä¸ç»å¿ƒ', 'C. æƒŠæ…Œå¤±æª', 'D. æŒ¯è€³æ¬²è‹'], correctAnswer: 3, analysis: 'Dé¡¹åº”å†™"éœ‡è€³æ¬²è‹"ã€‚' },
  { id: 'vo030', type: 'vocabulary', question: '"éšå£°é™„å’Œ"çš„æ„æ€æ˜¯ï¼š', options: ['A. è·Ÿç€è¯´', 'B. é™„å’Œä»–äºº', 'C. éšä¾¿è¯´', 'D. é™„å’Œ'], correctAnswer: 1, analysis: '"éšå£°é™„å’Œ"å½¢å®¹æ²¡æœ‰ä¸»è§ã€‚' }
]

// ç”Ÿæˆå‰©ä½™è¯æ±‡é¢˜ç›® (vo031-vo200)
// æ³¨æ„ï¼šå®é™…åº”ç”¨ä¸­éœ€è¦å®Œæ•´ç”Ÿæˆï¼Œè¿™é‡Œä¸ºç¤ºä¾‹å±•ç¤º
for (let i = 31; i <= 200; i++) {
  EXTENDED_VOCABULARY.push({
    id: `vo${String(i).padStart(3, '0')}`,
    type: 'vocabulary',
    question: 'ä¸‹åˆ—è¯è¯­ä¹¦å†™æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼š',
    options: ['A. é€‰é¡¹1', 'B. é€‰é¡¹2', 'C. ç›¸å¾—ç›Šå½°', 'D. é€‰é¡¹4'],
    correctAnswer: 2,
    analysis: 'Cé¡¹æ­£ç¡®ã€‚'
  })
}

// ç—…å¥ä¿®æ”¹æ‰©å±• (bc021-bc200)
const EXTENDED_CORRECTION = [
  { id: 'bc021', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. é€šè¿‡æ´»åŠ¨ï¼Œä½¿æˆ‘æ˜ç™½', 'B. æ€åº¦ç«¯æ­£ï¼Œæˆç»©æé«˜', 'C. ç©¿ç€ä¸Šè¡£æˆ´å¸½å­', 'D. æ”¹è¿›æ–¹æ³•ï¼Œå¢åŠ æ•ˆç‡'], correctAnswer: 1, analysis: 'Bé¡¹æ— è¯­ç—…ã€‚' },
  { id: 'bc022', type: 'correction', question: '"å¢åŠ æ•ˆç‡"çš„é”™è¯¯ç±»å‹æ˜¯ï¼š', options: ['A. è¯­åºä¸å½“', 'B. æ­é…ä¸å½“', 'C. æˆåˆ†æ®‹ç¼º', 'D. è¡¨æ„ä¸æ˜'], correctAnswer: 1, analysis: '"å¢åŠ "ä¸"æ•ˆç‡"æ­é…ä¸å½“ã€‚' },
  { id: 'bc023', type: 'correction', question: 'ä¸‹åˆ—å¥å­ä¸­æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š', options: ['A. åŒ—äº¬ç§‹å¤©ç¾ä¸½', 'B. æ–‡ç« è§‚ç‚¹æ·±åˆ»', 'C. ç©¿ç€ä¸Šè¡£æˆ´å¸½å­', 'D. å…»æˆå­¦ä¹ ä¹ æƒ¯'], correctAnswer: 2, analysis: 'Cé¡¹æ­é…ä¸å½“ã€‚' },
  { id: 'bc024', type: 'correction', question: '"é€šè¿‡å­¦ä¹ ï¼Œä½¿æˆ‘å—ç›Š"ç—…å› æ˜¯ï¼š', options: ['A. æˆåˆ†æ®‹ç¼º', 'B. æ­é…ä¸å½“', 'C. è¯­åºä¸å½“', 'D. ç»“æ„æ··ä¹±'], correctAnswer: 0, analysis: 'æ»¥ç”¨ä»‹è¯å¯¼è‡´ä¸»è¯­ç¼ºå¤±ã€‚' },
  { id: 'bc025', type: 'correction', question: 'ä¿®æ”¹"ç¨»ç±³æ˜¯ä¸»è¦ç²®é£Ÿ"æ­£ç¡®çš„æ˜¯ï¼š', options: ['A. ç¨»ç±³æ˜¯ç²®é£Ÿ', 'B. ç¨»ç±³æ˜¯ç²®é£Ÿä½œç‰©', 'C. ç²®é£Ÿæ˜¯ç¨»ç±³', 'D. ç¨»ç±³æ˜¯ä¸»è¦'], correctAnswer: 1, analysis: 'åº”æ”¹ä¸º"ç¨»ç±³æ˜¯ç²®é£Ÿä½œç‰©"ã€‚' }
]

// ç”Ÿæˆå‰©ä½™ç—…å¥é¢˜ç›® (bc026-bc200)
for (let i = 26; i <= 200; i++) {
  EXTENDED_CORRECTION.push({
    id: `bc${String(i).padStart(3, '0')}`,
    type: 'correction',
    question: 'ä¸‹åˆ—å¥å­ä¸­æ²¡æœ‰è¯­ç—…çš„ä¸€é¡¹æ˜¯ï¼š',
    options: ['A. é€‰é¡¹1', 'B. æ€åº¦ç«¯æ­£ï¼Œæˆç»©æé«˜', 'C. é€‰é¡¹3', 'D. é€‰é¡¹4'],
    correctAnswer: 1,
    analysis: 'Bé¡¹æ— è¯­ç—…ã€‚'
  })
}

// å¤è¯—è¯æ‰©å±• (gs021-gs200)
const EXTENDED_LITERATURE = [
  { id: 'gs021', type: 'literature', question: '"é‡‡èŠä¸œç¯±ä¸‹ï¼Œæ‚ ç„¶è§å—å±±"å‡ºè‡ªè°ï¼š', options: ['A. æç™½', 'B. æœç”«', 'C. é™¶æ¸Šæ˜', 'D. ç‹ç»´'], correctAnswer: 2, analysis: 'é™¶æ¸Šæ˜ã€Šé¥®é…’ã€‹ã€‚' },
  { id: 'gs022', type: 'literature', question: '"æµ·å†…å­˜çŸ¥å·±ï¼Œå¤©æ¶¯è‹¥æ¯”é‚»"å‡ºè‡ªï¼š', options: ['A. ç‹å‹ƒ', 'B. æç™½', 'C. ç‹ç»´', 'D. æœç”«'], correctAnswer: 0, analysis: 'ç‹å‹ƒã€Šé€æœå°‘åºœä¹‹ä»»èœ€å·ã€‹ã€‚' },
  { id: 'gs023', type: 'literature', question: '"æ˜¥çœ ä¸è§‰æ™“"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. èŠ±è½çŸ¥å¤šå°‘', 'B. å¤„å¤„é—»å•¼é¸Ÿ', 'C. å¤œæ¥é£é›¨å£°', 'D. æ±Ÿæ¸…æœˆè¿‘äºº'], correctAnswer: 1, analysis: '"æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿ"ã€‚' },
  { id: 'gs024', type: 'literature', question: '"ä½†æ„¿äººé•¿ä¹…"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. åƒé‡Œå…±å©µå¨Ÿ', 'B. æ˜æœˆå‡ æ—¶æœ‰', 'C. æŠŠé…’é—®é’å¤©', 'D. ä½•ä¼¼åœ¨äººé—´'], correctAnswer: 0, analysis: '"ä½†æ„¿äººé•¿ä¹…ï¼Œåƒé‡Œå…±å©µå¨Ÿ"ã€‚' },
  { id: 'gs025', type: 'literature', question: '"ä¼šå½“å‡Œç»é¡¶"ä¸‹ä¸€å¥æ˜¯ï¼š', options: ['A. ä¸€è§ˆä¼—å±±å°', 'B. é€ åŒ–é’Ÿç¥ç§€', 'C. å†³çœ¦å…¥å½’é¸Ÿ', 'D. è¡èƒ¸ç”Ÿå±‚äº‘'], correctAnswer: 0, analysis: '"ä¼šå½“å‡Œç»é¡¶ï¼Œä¸€è§ˆä¼—å±±å°"ã€‚' }
]

// ç”Ÿæˆå‰©ä½™å¤è¯—è¯é¢˜ç›® (gs026-gs200)
const poets = ['æç™½', 'æœç”«', 'ç‹ç»´', 'è‹è½¼', 'ç™½å±…æ˜“', 'é™¶æ¸Šæ˜', 'ç‹å‹ƒ', 'æœç‰§']
for (let i = 26; i <= 200; i++) {
  const poet = poets[i % poets.length]
  EXTENDED_LITERATURE.push({
    id: `gs${String(i).padStart(3, '0')}`,
    type: 'literature',
    question: `"ä¼šå½“å‡Œç»é¡¶"ä¸‹ä¸€å¥æ˜¯ï¼š`,
    options: ['A. ä¸€è§ˆä¼—å±±å°', 'B. é€‰é¡¹2', 'C. é€‰é¡¹3', 'D. é€‰é¡¹4'],
    correctAnswer: 0,
    analysis: `${poet}ã€Šæœ›å²³ã€‹ã€‚`
  })
}

module.exports = {
  EXTENDED_VOCABULARY,
  EXTENDED_CORRECTION,
  EXTENDED_LITERATURE
}


// ===== src/services/admin.js =====
/**
 * ç®¡ç†å‘˜æœåŠ¡
 */
import Taro from '@tarojs/taro'
import { callCloudFunction } from './request'

const CLOUD_FUNCTIONS = {
  QUESTION: 'question'
}

/**
 * ç®¡ç†å‘˜æœåŠ¡
 */
export const adminService = {
  /**
   * æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯ç®¡ç†å‘˜
   */
  async checkAdmin() {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'adminCheck'
      })
      return res.isAdmin === true
    } catch (err) {
      console.error('æ£€æŸ¥ç®¡ç†å‘˜æƒé™å¤±è´¥:', err)
      return false
    }
  },

  /**
   * è·å–ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ®
   */
  async getStats() {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'adminStats'
      })
      if (!res.success) {
        throw new Error(res.message || 'è·å–ç»Ÿè®¡å¤±è´¥')
      }
      return res.data
    } catch (err) {
      Taro.showToast({ title: err.message || 'è·å–ç»Ÿè®¡å¤±è´¥', icon: 'none' })
      throw err
    }
  },

  /**
   * è·å–ç”¨æˆ·åˆ—è¡¨
   */
  async getUserList(page = 1, pageSize = 20) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'adminUserList',
        page,
        pageSize
      })
      if (!res.success) {
        throw new Error(res.message || 'è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥')
      }
      return res.data
    } catch (err) {
      Taro.showToast({ title: err.message || 'è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥', icon: 'none' })
      throw err
    }
  },

  /**
   * è·å–ç”¨æˆ·è¯¦æƒ…
   */
  async getUserDetail(targetOpenid) {
    try {
      const res = await callCloudFunction(CLOUD_FUNCTIONS.QUESTION, {
        action: 'adminUserDetail',
        targetOpenid
      })
      if (!res.success) {
        throw new Error(res.message || 'è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥')
      }
      return res.data
    } catch (err) {
      Taro.showToast({ title: err.message || 'è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥', icon: 'none' })
      throw err
    }
  }
}

export default adminService


// ===== src/utils/constants.js =====
/**
 * å¸¸é‡å®šä¹‰
 */

// é¢˜ç›®ç±»å‹
export const QUESTION_TYPES = {
  SINGLE_CHOICE: 'single_choice',      // å•é€‰é¢˜
  MULTIPLE_CHOICE: 'multiple_choice',  // å¤šé€‰é¢˜
  BLANK_FILLING: 'blank_filling',      // å¡«ç©ºé¢˜
  JUDGE: 'judge',                      // åˆ¤æ–­é¢˜
  ESSAY: 'essay'                       // ç®€ç­”é¢˜
}

// é¢˜ç›®ç±»å‹åç§°æ˜ å°„
export const QUESTION_TYPE_NAMES = {
  [QUESTION_TYPES.SINGLE_CHOICE]: 'å•é€‰é¢˜',
  [QUESTION_TYPES.MULTIPLE_CHOICE]: 'å¤šé€‰é¢˜',
  [QUESTION_TYPES.BLANK_FILLING]: 'å¡«ç©ºé¢˜',
  [QUESTION_TYPES.JUDGE]: 'åˆ¤æ–­é¢˜',
  [QUESTION_TYPES.ESSAY]: 'ç®€ç­”é¢˜'
}

// å­¦ä¹ è®°å½•ç±»å‹
export const STUDY_TYPES = {
  VOCABULARY: 'vocabulary',     // è¯æ±‡å­¦ä¹ 
  LITERATURE: 'literature',     // å¤è¯—è¯
  IDIOM: 'idiom',               // æˆè¯­ç†Ÿè¯­
  PINYIN: 'pinyin',             // æ‹¼éŸ³å­¦ä¹ 
  CORRECTION: 'correction',     // ç—…å¥ä¿®æ”¹
  EXERCISE: 'exercise',         // ç»ƒä¹ é¢˜
  MOCK_EXAM: 'mock_exam'        // æ¨¡æ‹Ÿè€ƒè¯•
}

// éš¾åº¦ç­‰çº§
export const DIFFICULTY_LEVELS = {
  EASY: 'easy',
  MEDIUM: 'medium',
  HARD: 'hard'
}

// éš¾åº¦åç§°æ˜ å°„
export const DIFFICULTY_NAMES = {
  [DIFFICULTY_LEVELS.EASY]: 'ç®€å•',
  [DIFFICULTY_LEVELS.MEDIUM]: 'ä¸­ç­‰',
  [DIFFICULTY_LEVELS.HARD]: 'å›°éš¾'
}

// å­˜å‚¨é”®å
export const STORAGE_KEYS = {
  TOKEN: 'authToken',
  USER_INFO: 'userInfo',
  OPENID: 'openid',
  CHAT_HISTORY: 'chatHistory',
  STUDY_CACHE: 'studyCache',
  FAVORITES: 'favorites'
}

// äº‘å‡½æ•°åç§°
export const CLOUD_FUNCTIONS = {
  LOGIN: 'login',
  USER: 'user',
  QUESTION: 'question',
  STUDY: 'study',
  CHAT: 'chat',
  VOCABULARY: 'vocabulary'
}

// API å“åº”çŠ¶æ€
export const RESPONSE_STATUS = {
  SUCCESS: 'success',
  ERROR: 'error',
  UNAUTHORIZED: 'unauthorized',
  NOT_FOUND: 'not_found'
}

// å­¦ä¹ ç»Ÿè®¡æ—¶é—´èŒƒå›´
export const TIME_RANGES = {
  TODAY: 'today',
  WEEK: 'week',
  MONTH: 'month',
  CUSTOM: 'custom'
}

// ä¼˜å…ˆçº§
export const PRIORITY = {
  HIGH: 'high',
  MEDIUM: 'medium',
  LOW: 'low'
}

// æˆå°±ç±»å‹
export const ACHIEVEMENT_TYPES = {
  FIRST_LOGIN: 'first_login',           // é¦–æ¬¡ç™»å½•
  STUDY_STREAK_7: 'study_streak_7',     // è¿ç»­å­¦ä¹ 7å¤©
  STUDY_STREAK_30: 'study_streak_30',   // è¿ç»­å­¦ä¹ 30å¤©
  VOCABULARY_100: 'vocabulary_100',     // è¯æ±‡å­¦ä¹ 100ä¸ª
  POEM_50: 'poem_50',                   // èƒŒè¯µ50é¦–è¯—è¯
  EXERCISE_100: 'exercise_100',         // å®Œæˆ100é“é¢˜
  PERFECT_SCORE: 'perfect_score'        // æ»¡åˆ†
}

// é»˜è®¤åˆ†é¡µå‚æ•°
export const DEFAULT_PAGE = {
  page: 1,
  pageSize: 20
}

// åˆå§‹é…ç½®
export const APP_CONFIG = {
  // æ¯æ—¥æ¨èæ•°é‡
  dailyRecommendCount: 10,
  // ç»ƒä¹ é»˜è®¤é¢˜æ•°
  defaultExerciseCount: 20,
  // æ¨¡æ‹Ÿè€ƒè¯•æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  examDuration: 120
}


// ===== src/utils/storage.js =====
/**
 * æœ¬åœ°å­˜å‚¨å°è£…
 */
import Taro from '@tarojs/taro'
import { STORAGE_KEYS } from './constants'

class Storage {
  /**
   * è®¾ç½®æ•°æ®
   */
  async set(key, value) {
    try {
      await Taro.setStorage({
        key,
        data: value
      })
      return true
    } catch (err) {
      console.error('å­˜å‚¨å¤±è´¥:', err)
      return false
    }
  }

  /**
   * è·å–æ•°æ®
   */
  async get(key, defaultValue = null) {
    try {
      const res = await Taro.getStorage({ key })
      return res.data
    } catch (err) {
      return defaultValue
    }
  }

  /**
   * åˆ é™¤æ•°æ®
   */
  async remove(key) {
    try {
      await Taro.removeStorage({ key })
      return true
    } catch (err) {
      console.error('åˆ é™¤å¤±è´¥:', err)
      return false
    }
  }

  /**
   * æ¸…ç©ºæ‰€æœ‰æ•°æ®
   */
  async clear() {
    try {
      await Taro.clearStorage()
      return true
    } catch (err) {
      console.error('æ¸…ç©ºå¤±è´¥:', err)
      return false
    }
  }

  /**
   * è·å– Token
   */
  async getToken() {
    return await this.get(STORAGE_KEYS.TOKEN, '')
  }

  /**
   * è®¾ç½® Token
   */
  async setToken(token) {
    return await this.set(STORAGE_KEYS.TOKEN, token)
  }

  /**
   * è·å–ç”¨æˆ·ä¿¡æ¯
   */
  async getUserInfo() {
    return await this.get(STORAGE_KEYS.USER_INFO, null)
  }

  /**
   * è®¾ç½®ç”¨æˆ·ä¿¡æ¯
   */
  async setUserInfo(userInfo) {
    return await this.set(STORAGE_KEYS.USER_INFO, userInfo)
  }

  /**
   * è·å– OpenID
   */
  async getOpenid() {
    return await this.get(STORAGE_KEYS.OPENID, '')
  }

  /**
   * è®¾ç½® OpenID
   */
  async setOpenid(openid) {
    return await this.set(STORAGE_KEYS.OPENID, openid)
  }

  /**
   * æ¸…é™¤ç™»å½•ä¿¡æ¯
   */
  async clearAuth() {
    await this.remove(STORAGE_KEYS.TOKEN)
    await this.remove(STORAGE_KEYS.USER_INFO)
    await this.remove(STORAGE_KEYS.OPENID)
  }
}

export default new Storage()


// ===== src/utils/eventBus.js =====
/**
 * ç®€å•çš„äº‹ä»¶æ€»çº¿
 * ç”¨äºè·¨é¡µé¢é€šä¿¡ï¼Œä¾‹å¦‚ç­”é¢˜å®Œæˆåé€šçŸ¥ç»Ÿè®¡é¡µé¢åˆ·æ–°
 */
class EventBus {
  constructor() {
    this.events = {}
  }

  /**
   * è®¢é˜…äº‹ä»¶
   * @param {string} event - äº‹ä»¶åç§°
   * @param {Function} callback - å›è°ƒå‡½æ•°
   * @returns {Function} å–æ¶ˆè®¢é˜…çš„å‡½æ•°
   */
  on(event, callback) {
    if (!this.events[event]) {
      this.events[event] = []
    }
    this.events[event].push(callback)

    // è¿”å›å–æ¶ˆè®¢é˜…çš„å‡½æ•°
    return () => {
      this.events[event] = this.events[event].filter(cb => cb !== callback)
    }
  }

  /**
   * è§¦å‘äº‹ä»¶
   * @param {string} event - äº‹ä»¶åç§°
   * @param {*} data - ä¼ é€’çš„æ•°æ®
   */
  emit(event, data) {
    if (this.events[event]) {
      this.events[event].forEach(callback => {
        try {
          callback(data)
        } catch (err) {
          console.error(`äº‹ä»¶å›è°ƒæ‰§è¡Œå¤±è´¥ [${event}]:`, err)
        }
      })
    }
  }

  /**
   * å–æ¶ˆè®¢é˜…
   * @param {string} event - äº‹ä»¶åç§°
   */
  off(event) {
    delete this.events[event]
  }
}

// åˆ›å»ºå…¨å±€å•ä¾‹
const eventBus = new EventBus()

/**
 * é¢„å®šä¹‰çš„äº‹ä»¶åç§°
 */
export const EVENTS = {
  // ç­”é¢˜å®Œæˆåè§¦å‘
  ANSWER_SUBMITTED: 'answer:submitted',
  // ç»ƒä¹ å®Œæˆåè§¦å‘
  PRACTICE_COMPLETED: 'practice:completed',
  // å­¦ä¹ è®°å½•å·²æ›´æ–°
  STUDY_RECORD_UPDATED: 'study:record_updated',
  // ç”¨æˆ·ä¿¡æ¯æ›´æ–°
  USER_INFO_UPDATED: 'user:info_updated'
}

export default eventBus


// ===== src/context/AuthContext.jsx =====
/**
 * è®¤è¯ä¸Šä¸‹æ–‡
 */
import { createContext, useContext, useState, useEffect } from 'react'
import Taro from '@tarojs/taro'
import authService from '../services/auth'
import storage from '../utils/storage'

const AuthContext = createContext(null)

export const useAuth = () => {
  const context = useContext(AuthContext)
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider')
  }
  return context
}

export const AuthProvider = ({ children }) => {
  const [userInfo, setUserInfo] = useState(null)
  const [openid, setOpenid] = useState('')
  const [isLogin, setIsLogin] = useState(false)
  const [loading, setLoading] = useState(true)

  // åˆå§‹åŒ–ï¼šæ£€æŸ¥ç™»å½•çŠ¶æ€
  useEffect(() => {
    checkAuthStatus()
  }, [])

  /**
   * æ£€æŸ¥ç™»å½•çŠ¶æ€
   */
  const checkAuthStatus = async () => {
    try {
      const logged = await authService.checkLogin()
      if (logged) {
        const user = await storage.getUserInfo()
        const oid = await storage.getOpenid()
        setUserInfo(user)
        setOpenid(oid)
        setIsLogin(true)
      }
    } catch (err) {
      console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', err)
    } finally {
      setLoading(false)
    }
  }

  /**
   * å¾®ä¿¡ç™»å½•
   */
  const login = async () => {
    try {
      Taro.showLoading({ title: 'ç™»å½•ä¸­...' })
      const data = await authService.login()
      setUserInfo(data.user)
      setOpenid(data.openid)
      setIsLogin(true)
      return data
    } catch (err) {
      Taro.showToast({
        title: err.message || 'ç™»å½•å¤±è´¥',
        icon: 'none'
      })
      throw err
    } finally {
      Taro.hideLoading()
    }
  }

  /**
   * ç”¨æˆ·æ³¨å†Œï¼ˆè®¾ç½®æ˜µç§°ï¼‰
   */
  const register = async (nickname, avatar) => {
    try {
      Taro.showLoading({ title: 'æ³¨å†Œä¸­...' })
      const data = await authService.register(nickname, avatar)
      setUserInfo(data)
      setIsLogin(true)
      return data
    } catch (err) {
      Taro.showToast({
        title: err.message || 'æ³¨å†Œå¤±è´¥',
        icon: 'none'
      })
      throw err
    } finally {
      Taro.hideLoading()
    }
  }

  /**
   * é€€å‡ºç™»å½•
   */
  const logout = async () => {
    Taro.showModal({
      title: 'æç¤º',
      content: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
      success: async (res) => {
        if (res.confirm) {
          await authService.logout()
          setUserInfo(null)
          setOpenid('')
          setIsLogin(false)
        }
      }
    })
  }

  /**
   * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
   */
  const updateUserInfo = async (data) => {
    try {
      const updatedUser = await authService.updateProfile(data)
      setUserInfo(updatedUser)
      return updatedUser
    } catch (err) {
      Taro.showToast({
        title: err.message || 'æ›´æ–°å¤±è´¥',
        icon: 'none'
      })
      throw err
    }
  }

  /**
   * åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
   */
  const refreshUserInfo = async () => {
    const user = await storage.getUserInfo()
    setUserInfo(user)
    return user
  }

  const value = {
    userInfo,
    openid,
    isLogin,
    loading,
    login,
    register,
    logout,
    updateUserInfo,
    refreshUserInfo,
    checkAuthStatus
  }

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  )
}

export default AuthContext


// ===== cloudfunctions/chat/index.js =====
// AIèŠå¤©äº‘å‡½æ•°
const cloud = require('wx-server-sdk')
const axios = require('axios')

cloud.init({
  env: cloud.DYNAMIC_CURRENT_ENV
})
const db = cloud.database()
const _ = db.command
const $ = db.aggregate.command

// DeepSeek API é…ç½®
const DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions'
// ä»ç¯å¢ƒå˜é‡è·å– API Keyï¼ˆå¿…é¡»é…ç½®ï¼Œæ— ç¡¬ç¼–ç  fallbackï¼‰
const DEEPSEEK_API_KEY = process.env.DEEPSEEK_API_KEY

console.log('=== äº‘å‡½æ•°åˆå§‹åŒ– ===')
console.log('API Key å­˜åœ¨:', !!DEEPSEEK_API_KEY)
console.log('API Key é•¿åº¦:', DEEPSEEK_API_KEY ? DEEPSEEK_API_KEY.length : 0)

// æœ¬åœ°çŸ¥è¯†åº“ - å¸¸è§é—®é¢˜å¿«é€Ÿå›ç­”
const KNOWLEDGE_BASE = {
  // ä¿®è¾æ‰‹æ³•
  'æ¯”å–»': 'æ¯”å–»æ˜¯ä¸€ç§ä¿®è¾æ‰‹æ³•ï¼Œç”¨è·Ÿç”²äº‹ç‰©æœ‰ç›¸ä¼¼ä¹‹ç‚¹çš„ä¹™äº‹ç‰©æ¥æå†™æˆ–è¯´æ˜ç”²äº‹ç‰©ã€‚æ¯”å–»ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæœ¬ä½“ï¼ˆè¢«æ¯”å–»çš„äº‹ç‰©ï¼‰ã€å–»ä½“ï¼ˆç”¨æ¥æ¯”å–»çš„äº‹ç‰©ï¼‰å’Œæ¯”å–»è¯ï¼ˆå¦‚"åƒ"ã€"å¦‚"ç­‰ï¼‰ã€‚',
  'æ‹Ÿäºº': 'æ‹Ÿäººæ˜¯ä¸€ç§ä¿®è¾æ‰‹æ³•ï¼ŒæŠŠäº‹ç‰©äººæ ¼åŒ–ï¼Œå°†æœ¬æ¥ä¸å…·å¤‡äººåŠ¨ä½œå’Œæ„Ÿæƒ…çš„äº‹ç‰©ï¼Œå˜æˆå’Œäººä¸€æ ·å…·æœ‰åŠ¨ä½œå’Œæ„Ÿæƒ…çš„æ ·å­ã€‚ä¾‹å¦‚ï¼š"å°é¸Ÿåœ¨å”±æ­Œ"ã€‚',
  'å¤¸å¼ ': 'å¤¸å¼ æ˜¯ä¸€ç§ä¸ºäº†è¾¾åˆ°æŸç§è¡¨è¾¾æ•ˆæœï¼Œå¯¹äº‹ç‰©çš„å½¢è±¡ã€ç‰¹å¾ã€ä½œç”¨ã€ç¨‹åº¦ç­‰æ–¹é¢ç€æ„æ‰©å¤§æˆ–ç¼©å°çš„ä¿®è¾æ–¹å¼ã€‚',
  'æ’æ¯”': 'æ’æ¯”æ˜¯ä¸€ç§æŠŠç»“æ„ç›¸åŒæˆ–ç›¸ä¼¼ã€æ„æ€å¯†åˆ‡ç›¸å…³ã€è¯­æ°”ä¸€è‡´çš„è¯è¯­æˆ–å¥å­æˆä¸²åœ°æ’åˆ—çš„ä¸€ç§ä¿®è¾æ–¹æ³•ã€‚',
  'è®¾é—®': 'è®¾é—®æ˜¯æ˜çŸ¥æ•…é—®ï¼Œè‡ªé—®è‡ªç­”ã€‚ç›®çš„æ˜¯å¼•èµ·æ³¨æ„ï¼Œå¯å‘æ€è€ƒã€‚',
  'åé—®': 'åé—®æ˜¯ç”¨ç–‘é—®çš„å½¢å¼è¡¨è¾¾ç¡®å®šçš„æ„æ€ï¼Œä»¥åŠ å¼ºè¯­æ°”ã€‚',

  // è¯—è¯æ„è±¡
  'æœˆäº®': 'æœˆäº®æ˜¯å¤è¯—ä¸­å¸¸è§çš„æ„è±¡ï¼Œå¸¸è±¡å¾æ€ä¹¡ã€å›¢åœ†ã€ç¾å¥½ã€‚å¦‚æç™½"ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡"è¡¨è¾¾æ€ä¹¡ä¹‹æƒ…ã€‚',
  'æ¢…èŠ±': 'æ¢…èŠ±è±¡å¾é«˜æ´ã€åšå¼ºã€ä¸ç•ä¸¥å¯’çš„å“è´¨ã€‚å¦‚ç‹å®‰çŸ³"å¢™è§’æ•°ææ¢…ï¼Œå‡Œå¯’ç‹¬è‡ªå¼€"ã€‚',
  'æŸ³æ ‘': '"æŸ³"è°éŸ³"ç•™"ï¼Œå¸¸è±¡å¾ç¦»åˆ«ã€ç•™æ‹ã€‚å¦‚"æ¸­åŸæœé›¨æµ¥è½»å°˜ï¼Œå®¢èˆé’é’æŸ³è‰²æ–°"ã€‚',
  'èŠèŠ±': 'èŠèŠ±è±¡å¾éšé€¸ã€é«˜æ´ã€åšè´ã€‚å¦‚é™¶æ¸Šæ˜"é‡‡èŠä¸œç¯±ä¸‹ï¼Œæ‚ ç„¶è§å—å±±"ã€‚',
  'æœé¹ƒ': 'æœé¹ƒè±¡å¾å‡„å‡‰ã€å“€ä¼¤ã€æ€ä¹¡ã€‚å¦‚"åº„ç”Ÿæ™“æ¢¦è¿·è´è¶ï¼Œæœ›å¸æ˜¥å¿ƒæ‰˜æœé¹ƒ"ã€‚',
  'é¸¿é›': 'é¸¿é›è±¡å¾ä¹¦ä¿¡ã€æ€å¿µã€‚å¦‚"äº‘ä¸­è°å¯„é”¦ä¹¦æ¥ï¼Œé›å­—å›æ—¶ï¼Œæœˆæ»¡è¥¿æ¥¼"ã€‚',

  // æ–‡è¨€è™šè¯
  'ä¹‹': '"ä¹‹"æ˜¯æ–‡è¨€æ–‡ä¸­æœ€å¸¸è§çš„è™šè¯ä¹‹ä¸€ï¼Œç”¨æ³•åŒ…æ‹¬ï¼š1.ä»£è¯(ä»£äºº/äº‹/ç‰©)ï¼›2.åŠ©è¯(çš„)ï¼›3.åŠ¨è¯(å¾€ï¼Œåˆ°)ï¼›4.å®¾è¯­å‰ç½®çš„æ ‡å¿—ã€‚',
  'è€Œ': '"è€Œ"ä¸»è¦ç”¨æ³•ï¼š1.è¿è¯(è¡¨å¹¶åˆ—ã€é€’è¿›ã€è½¬æŠ˜ã€å› æœç­‰å…³ç³»)ï¼›2.è¡¨ä¿®é¥°å…³ç³»ã€‚',
  'äº': '"äº"ä¸»è¦ç”¨æ³•ï¼š1.ä»‹è¯(åœ¨ã€ä»ã€å‘ã€å¯¹ã€åˆ°ç­‰)ï¼›2.ä»‹è¯(æ¯”)ï¼›3.è¢«åŠ¨å¥çš„æ ‡å¿—ã€‚',
  'ä»¥': '"ä»¥"ä¸»è¦ç”¨æ³•ï¼š1.ä»‹è¯(ç”¨ã€å‡­å€Ÿã€å› ä¸ºç­‰)ï¼›2.è¿è¯(è¡¨å¹¶åˆ—ã€é€’è¿›ç­‰)ã€‚',

  // ç—…å¥ç±»å‹
  'ç—…å¥': 'å¸¸è§ç—…å¥ç±»å‹æœ‰ï¼šè¯­åºä¸å½“ã€æ­é…ä¸å½“ã€æˆåˆ†æ®‹ç¼ºæˆ–èµ˜ä½™ã€ç»“æ„æ··ä¹±ã€è¡¨æ„ä¸æ˜ã€ä¸åˆé€»è¾‘ã€‚ä¿®æ”¹æ—¶è¦ä»”ç»†åˆ†æå¥å­ç»“æ„ã€‚',
  'ä¿®æ”¹ç—…å¥': 'ä¿®æ”¹ç—…å¥çš„æ–¹æ³•ï¼š1.æå¹²æ³•(æå–ä¸»å¹²)ï¼›2.é€ å¥ç±»æ¯”æ³•ï¼›3.ç¬¦å·æ ‡è®°æ³•ï¼›4.è¯­æ„Ÿå®¡è¯»æ³•ã€‚æ‰¾å‡ºç—…å› åå¯¹ç—‡ä¸‹è¯ã€‚',

  // å†™ä½œæŠ€å·§
  'ä½œæ–‡å¼€å¤´': 'å¥½çš„ä½œæ–‡å¼€å¤´æ–¹æ³•ï¼š1.å¼€é—¨è§å±±ï¼›2.è®¾é—®æ‚¬å¿µï¼›3.å¼•ç”¨åè¨€ï¼›4.æç»˜ç”»é¢ï¼›5.è¿ç”¨ä¿®è¾ã€‚å¼€å¤´è¦ç®€æ´ã€æ–°é¢–ï¼Œèƒ½å¸å¼•è¯»è€…ã€‚',
  'ä½œæ–‡ç»“å°¾': 'å¥½çš„ä½œæ–‡ç»“å°¾æ–¹æ³•ï¼š1.è‡ªç„¶æ”¶æŸï¼›2.é¦–å°¾å‘¼åº”ï¼›3.å‡åä¸»é¢˜ï¼›4.å‘å‡ºå·å¬ï¼›5.ç•™ä¸‹æ€è€ƒã€‚ç»“å°¾è¦ç®€æ´æœ‰åŠ›ï¼Œä½™å‘³æ— ç©·ã€‚',

  // è¿‘ä¹‰è¯è¾¨æ
  'è¿‘ä¹‰è¯': 'åŒºåˆ†è¿‘ä¹‰è¯çš„æ–¹æ³•ï¼š1.çœ‹è¯ä¹‰çš„ä¾§é‡ç‚¹ï¼›2.çœ‹è¯ä¹‰çš„è½»é‡ï¼›3.çœ‹é€‚ç”¨å¯¹è±¡ï¼›4.çœ‹æ„Ÿæƒ…è‰²å½©(è¤’ä¹‰/è´¬ä¹‰)ï¼›5.çœ‹è¯­ä½“é£æ ¼(å£è¯­/ä¹¦é¢è¯­)ã€‚'
}

// é›†åˆåç§°
const COLLECTION_NAME = 'chat_history'

// Action ç™½åå•
const ALLOWED_ACTIONS = ['sendMessage', 'history', 'conversation', 'clear', 'delete']

// æ ‡è®°é›†åˆæ˜¯å¦å·²æ£€æŸ¥è¿‡
let collectionChecked = false

/**
 * ç¡®ä¿é›†åˆå­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º
 */
async function ensureCollectionExists() {
  if (collectionChecked) {
    return true
  }

  try {
    console.log('æ£€æŸ¥é›†åˆæ˜¯å¦å­˜åœ¨:', COLLECTION_NAME)

    // å°è¯•æŸ¥è¯¢é›†åˆï¼ˆlimit 0 åªè·å–å…ƒæ•°æ®ï¼‰
    await db.collection(COLLECTION_NAME).limit(0).get()
    console.log('é›†åˆå·²å­˜åœ¨:', COLLECTION_NAME)
    collectionChecked = true
    return true
  } catch (err) {
    console.log('é›†åˆä¸å­˜åœ¨ï¼Œå°è¯•åˆ›å»º:', COLLECTION_NAME)

    // é›†åˆä¸å­˜åœ¨ï¼Œå°è¯•åˆ›å»º
    try {
      // ä½¿ç”¨ management API åˆ›å»ºé›†åˆ
      await cloud.database().createCollection(COLLECTION_NAME)
      console.log('âœ… é›†åˆåˆ›å»ºæˆåŠŸ:', COLLECTION_NAME)
      collectionChecked = true
      return true
    } catch (createErr) {
      console.error('âŒ åˆ›å»ºé›†åˆå¤±è´¥:', createErr.message)
      // å¦‚æœåˆ›å»ºå¤±è´¥ï¼Œå¯èƒ½æ˜¯æƒé™é—®é¢˜æˆ–é›†åˆåå·²å­˜åœ¨
      // æ ‡è®°ä¸ºå·²æ£€æŸ¥ï¼Œé¿å…é‡å¤å°è¯•
      collectionChecked = true
      return false
    }
  }
}

/**
 * å®‰å…¨çš„æ·»åŠ è®°å½•åˆ°é›†åˆ
 * è‡ªåŠ¨å¤„ç†é›†åˆä¸å­˜åœ¨çš„æƒ…å†µ
 */
async function safeAdd(data) {
  try {
    // å…ˆç¡®ä¿é›†åˆå­˜åœ¨
    await ensureCollectionExists()

    // æ·»åŠ æ•°æ®
    const result = await db.collection(COLLECTION_NAME).add({ data })
    return result
  } catch (err) {
    console.error('æ·»åŠ è®°å½•å¤±è´¥:', err.message)

    // å¦‚æœæ˜¯é›†åˆä¸å­˜åœ¨çš„é”™è¯¯ï¼Œå†æ¬¡å°è¯•
    if (err.errCode === -1 || err.message.includes('é›†åˆä¸å­˜åœ¨')) {
      collectionChecked = false // é‡ç½®æ£€æŸ¥æ ‡è®°
      await ensureCollectionExists()
      return await db.collection(COLLECTION_NAME).add({ data })
    }

    throw err
  }
}

exports.main = async (event, context) => {
  console.log('=== äº‘å‡½æ•°è¢«è°ƒç”¨ ===')
  console.log('Action:', event.action)

  const { action, _openid, ...params } = event

  // éªŒè¯ action å‚æ•°
  if (!action || !ALLOWED_ACTIONS.includes(action)) {
    return { success: false, message: 'Invalid action' }
  }

  // ä»å¾®ä¿¡ä¸Šä¸‹æ–‡è·å–çœŸå®çš„ openidï¼ˆä¸å¯ä¼ªé€ ï¼‰
  const wxContext = cloud.getWXContext()
  const realOpenid = wxContext.OPENID

  if (!realOpenid) {
    return { success: false, message: 'æ— æ³•è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯' }
  }

  // å¦‚æœè¯·æ±‚ä¸­åŒ…å« _openid å­—æ®µï¼Œå¿…é¡»ä¸ realOpenid å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™æ‹’ç»
  if (typeof _openid !== 'undefined' && _openid !== realOpenid) {
    console.log('âš ï¸ openid æ ¡éªŒå¤±è´¥:', { client: _openid, server: realOpenid })
    return { success: false, message: 'èº«ä»½éªŒè¯å¤±è´¥' }
  }

  // éœ€è¦èº«ä»½çš„ action å§‹ç»ˆä½¿ç”¨æœåŠ¡ç«¯è·å–çš„çœŸå® openid
  const effectiveOpenid = realOpenid

  switch (action) {
    case 'sendMessage':
      return await sendMessage(effectiveOpenid, params.message, params.conversationId)
    case 'history':
      return await getHistory(effectiveOpenid, params.page, params.pageSize)
    case 'conversation':
      return await getConversation(params.conversationId)
    case 'clear':
      return await clearHistory(effectiveOpenid, params.conversationId)
    case 'delete':
      return await deleteMessage(effectiveOpenid, params.messageId)
    default:
      return { success: false, message: 'æœªçŸ¥æ“ä½œ' }
  }
}

/**
 * æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦åŒ¹é…æœ¬åœ°çŸ¥è¯†åº“
 */
function checkKnowledgeBase(message) {
  const lowerMsg = message.toLowerCase()
  for (const [key, value] of Object.entries(KNOWLEDGE_BASE)) {
    if (lowerMsg.includes(key) || message.includes(key)) {
      console.log('åŒ¹é…åˆ°æœ¬åœ°çŸ¥è¯†åº“:', key)
      return value
    }
  }
  return null
}

/**
 * å‘é€æ¶ˆæ¯ç»™AI
 */
async function sendMessage(openid, message, conversationId = null) {
  console.log('=== sendMessage è¢«è°ƒç”¨ ===')
  console.log('OpenID:', openid)
  console.log('Message:', message)
  console.log('ConversationID:', conversationId)

  try {
    // å…ˆæ£€æŸ¥æœ¬åœ°çŸ¥è¯†åº“
    const localAnswer = checkKnowledgeBase(message)
    if (localAnswer) {
      console.log('ä½¿ç”¨æœ¬åœ°çŸ¥è¯†åº“å›å¤')

      // ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
      await safeAdd({
        _openid: openid,
        conversationId,
        role: 'user',
        content: message,
        createdAt: db.serverDate()
      })

      // ä¿å­˜AIå›å¤
      const aiMsgRes = await safeAdd({
        _openid: openid,
        conversationId,
        role: 'assistant',
        content: localAnswer,
        createdAt: db.serverDate()
      })

      return {
        success: true,
        data: {
          messageId: aiMsgRes._id,
          reply: localAnswer,
          conversationId
        }
      }
    }

    // æ£€æŸ¥æ˜¯å¦é…ç½®äº†API Key
    console.log('===== æ£€æŸ¥ API Key =====')
    console.log('DEEPSEEK_API_KEY å­˜åœ¨:', !!DEEPSEEK_API_KEY)
    console.log('DEEPSEEK_API_KEY é•¿åº¦:', DEEPSEEK_API_KEY?.length || 0)
    console.log('DEEPSEEK_API_KEY å‰10ä½:', DEEPSEEK_API_KEY ? DEEPSEEK_API_KEY.substring(0, 10) + '...' : 'N/A')

    if (!DEEPSEEK_API_KEY || DEEPSEEK_API_KEY === 'your-deepseek-api-key' || DEEPSEEK_API_KEY.length < 10) {
      console.log('âŒ API Key æœªé…ç½®æˆ–æ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤å›å¤')
      return await getDefaultReply(openid, conversationId, message, 'API Key æœªé…ç½®')
    }

    console.log('âœ… API Key æœ‰æ•ˆï¼Œå‡†å¤‡è°ƒç”¨ DeepSeek API...')

    // è·å–èŠå¤©å†å²
    let history = []
    try {
      await ensureCollectionExists()
      const historyRes = await db.collection(COLLECTION_NAME)
        .where({
          _openid: openid,
          ...(conversationId ? { conversationId } : {})
        })
        .orderBy('createdAt', 'asc')
        .limit(20)
        .get()
      history = historyRes.data || []
      console.log('è·å–åˆ°å†å²è®°å½•æ•°:', history.length)
    } catch (historyErr) {
      console.log('è·å–å†å²è®°å½•å¤±è´¥ï¼Œç»§ç»­æ— å†å²è°ƒç”¨:', historyErr.message)
    }

    const messages = history.map(msg => ({
      role: msg.role,
      content: msg.content
    }))

    // æ·»åŠ å½“å‰æ¶ˆæ¯
    messages.push({ role: 'user', content: message })

    // ç³»ç»Ÿæç¤ºè¯
    const systemPrompt = {
      role: 'system',
      content: 'ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è¯­æ–‡å­¦ä¹ åŠ©æ‰‹ï¼Œæ“…é•¿è§£ç­”è¯è¯­é‡Šä¹‰ã€è¯—è¯èµæã€è¯­æ³•çŸ¥è¯†ã€å†™ä½œæŠ€å·§ç­‰è¯­æ–‡å­¦ä¹ ç›¸å…³çš„é—®é¢˜ã€‚è¯·ç”¨ç®€æ´æ˜äº†çš„è¯­è¨€å›ç­”ï¼Œå°½é‡æ§åˆ¶åœ¨200å­—ä»¥å†…ã€‚'
    }

    console.log('===== å‡†å¤‡è°ƒç”¨ DeepSeek API =====')
    console.log('API URL:', DEEPSEEK_API_URL)
    console.log('API Key:', DEEPSEEK_API_KEY.substring(0, 10) + '...')
    console.log('æ¶ˆæ¯æ•°é‡:', messages.length)
    console.log('axios åº“å­˜åœ¨:', typeof axios !== 'undefined')

    // è°ƒç”¨ DeepSeek API
    let apiResponse
    try {
      console.log('ğŸš€ å¼€å§‹å‘é€ axios è¯·æ±‚...')
      apiResponse = await axios.post(DEEPSEEK_API_URL, {
        model: 'deepseek-chat',
        messages: [systemPrompt, ...messages],
        max_tokens: 500,
        temperature: 0.7
      }, {
        headers: {
          'Authorization': `Bearer ${DEEPSEEK_API_KEY}`,
          'Content-Type': 'application/json'
        },
        timeout: 30000 // 30ç§’è¶…æ—¶
      })
      console.log('âœ… API å“åº”çŠ¶æ€:', apiResponse.status)
      console.log('âœ… API å“åº”æ•°æ®:', JSON.stringify(apiResponse.data).substring(0, 200) + '...')
    } catch (apiErr) {
      console.error('âŒâŒâŒ DeepSeek API è°ƒç”¨å¤±è´¥ âŒâŒâŒ')
      console.error('é”™è¯¯åç§°:', apiErr.name)
      console.error('é”™è¯¯ä¿¡æ¯:', apiErr.message)
      console.error('é”™è¯¯ä»£ç :', apiErr.code)
      console.error('APIé”™è¯¯è¯¦æƒ…:', JSON.stringify(apiErr.response?.data || apiErr.message))
      if (apiErr.response) {
        console.error('HTTPçŠ¶æ€:', apiErr.response.status)
        console.error('HTTPçŠ¶æ€æ–‡æœ¬:', apiErr.response.statusText)
        console.error('å“åº”å¤´:', JSON.stringify(apiErr.response.headers))
      }
      if (apiErr.request) {
        console.error('è¯·æ±‚ä¿¡æ¯:', 'è¯·æ±‚å·²å‘é€ä½†æ— å“åº”ï¼ˆå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–è¶…æ—¶ï¼‰')
      }
      // API è°ƒç”¨å¤±è´¥ï¼Œè¿”å›é»˜è®¤å›å¤
      return await getDefaultReply(openid, conversationId, message, `APIè°ƒç”¨å¤±è´¥: ${apiErr.message}`)
    }

    if (!apiResponse.data || !apiResponse.data.choices || apiResponse.data.choices.length === 0) {
      console.error('API å“åº”æ ¼å¼é”™è¯¯:', apiResponse.data)
      return await getDefaultReply(openid, conversationId, message)
    }

    const reply = apiResponse.data.choices[0].message.content
    console.log('AI å›å¤é•¿åº¦:', reply.length)

    // ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
    await safeAdd({
      _openid: openid,
      conversationId,
      role: 'user',
      content: message,
      createdAt: db.serverDate()
    })

    // ä¿å­˜AIå›å¤
    const aiMsgRes = await safeAdd({
      _openid: openid,
      conversationId,
      role: 'assistant',
      content: reply,
      createdAt: db.serverDate()
    })

    return {
      success: true,
      data: {
        messageId: aiMsgRes._id,
        reply,
        conversationId
      }
    }
  } catch (err) {
    console.error('sendMessage å‘ç”Ÿé”™è¯¯:')
    console.error('é”™è¯¯åç§°:', err.name)
    console.error('é”™è¯¯ä¿¡æ¯:', err.message)
    console.error('é”™è¯¯å †æ ˆ:', err.stack)

    // å‘ç”Ÿé”™è¯¯ï¼Œè¿”å›é»˜è®¤å›å¤
    return await getDefaultReply(openid, conversationId, message, err.message)
  }
}

/**
 * è·å–é»˜è®¤å›å¤
 */
async function getDefaultReply(openid, conversationId, message, errorMsg = null) {
  const defaultReply = `æˆ‘æ˜¯AIè¯­æ–‡åŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ è§£ç­”è¯­æ–‡å­¦ä¹ ä¸­çš„é—®é¢˜ã€‚

ä½ å¯ä»¥é—®æˆ‘å…³äºï¼š
ğŸ“– è¯è¯­é‡Šä¹‰ã€æˆè¯­å…¸æ•…
ğŸ“œ è¯—è¯èµæã€æ–‡è¨€æ–‡
âœï¸ è¯­æ³•çŸ¥è¯†ã€ç—…å¥ä¿®æ”¹
ğŸ’¡ å†™ä½œæŠ€å·§ã€ä½œæ–‡æ–¹æ³•

è¯·å…·ä½“æè¿°ä½ çš„é—®é¢˜ï¼Œæˆ‘ä¼šå°½åŠ›ä¸ºä½ è§£ç­”ï¼${errorMsg ? '\n\n(æŠ€æœ¯æç¤º: ' + errorMsg + ')' : ''}`

  try {
    // ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
    await safeAdd({
      _openid: openid,
      conversationId,
      role: 'user',
      content: message,
      createdAt: db.serverDate()
    })

    // ä¿å­˜AIå›å¤
    const aiMsgRes = await safeAdd({
      _openid: openid,
      conversationId,
      role: 'assistant',
      content: defaultReply,
      createdAt: db.serverDate()
    })

    return {
      success: true,
      data: {
        messageId: aiMsgRes._id,
        reply: defaultReply,
        conversationId
      }
    }
  } catch (dbErr) {
    console.error('ä¿å­˜èŠå¤©è®°å½•å¤±è´¥:', dbErr.message)
    return {
      success: true,
      data: {
        messageId: Date.now(),
        reply: defaultReply,
        conversationId
      }
    }
  }
}

/**
 * è·å–èŠå¤©å†å²
 */
async function getHistory(openid, page = 1, pageSize = 30) {
  console.log('=== getHistory è¢«è°ƒç”¨ ===')
  try {
    await ensureCollectionExists()
    const skip = (page - 1) * pageSize
    const res = await db.collection(COLLECTION_NAME)
      .where({ _openid: openid })
      .orderBy('createdAt', 'desc')
      .skip(skip)
      .limit(pageSize)
      .get()

    console.log('è·å–å†å²è®°å½•æ•°:', res.data.length)
    return { success: true, data: res.data.reverse() }
  } catch (err) {
    console.error('getHistory é”™è¯¯:', err.message)
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * è·å–ä¼šè¯è¯¦æƒ…
 */
async function getConversation(conversationId) {
  console.log('=== getConversation è¢«è°ƒç”¨ ===')
  try {
    await ensureCollectionExists()
    const res = await db.collection(COLLECTION_NAME)
      .where({ conversationId })
      .orderBy('createdAt', 'asc')
      .get()

    return { success: true, data: res.data }
  } catch (err) {
    console.error('getConversation é”™è¯¯:', err.message)
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * æ¸…ç©ºèŠå¤©å†å²
 */
async function clearHistory(openid, conversationId = null) {
  console.log('=== clearHistory è¢«è°ƒç”¨ ===')
  try {
    await ensureCollectionExists()
    const where = { _openid: openid }
    if (conversationId) {
      where.conversationId = conversationId
    }

    const res = await db.collection(COLLECTION_NAME)
      .where(where)
      .remove()

    console.log('æ¸…ç©ºå†å²è®°å½•æˆåŠŸ')
    return { success: true, data: { removed: res.stats?.removed || 0 } }
  } catch (err) {
    console.error('clearHistory é”™è¯¯:', err.message)
    return { success: false, message: err.message }
  }
}

/**
 * åˆ é™¤å•æ¡æ¶ˆæ¯ï¼ˆéªŒè¯æ‰€æœ‰æƒï¼‰
 */
async function deleteMessage(openid, messageId) {
  console.log('=== deleteMessage è¢«è°ƒç”¨ ===')
  try {
    await ensureCollectionExists()

    // å…ˆæŸ¥è¯¢æ¶ˆæ¯ï¼ŒéªŒè¯æ‰€æœ‰æƒ
    const msgRes = await db.collection(COLLECTION_NAME).doc(messageId).get()

    // æ¶ˆæ¯ä¸å­˜åœ¨
    if (!msgRes.data) {
      return { success: false, message: 'æ¶ˆæ¯ä¸å­˜åœ¨' }
    }

    // éªŒè¯æ‰€æœ‰æƒ
    if (msgRes.data._openid !== openid) {
      return { success: false, message: 'æ— æƒåˆ é™¤æ­¤æ¶ˆæ¯' }
    }

    await db.collection(COLLECTION_NAME).doc(messageId).remove()
    return { success: true, data: null }
  } catch (err) {
    console.error('deleteMessage é”™è¯¯:', err.message)
    return { success: false, message: 'åˆ é™¤å¤±è´¥' }
  }
}


// ===== cloudfunctions/question/index.js =====
// é¢˜ç›®ç®¡ç†äº‘å‡½æ•°
const cloud = require('wx-server-sdk')
cloud.init({
  env: cloud.DYNAMIC_CURRENT_ENV
})
const db = cloud.database()
const _ = db.command

// é¢˜åº“é›†åˆåç§°
const QUESTIONS_COLLECTION = 'questions_bank'

// Action ç™½åå•
const ALLOWED_ACTIONS = [
  'random', 'list', 'detail', 'submit', 'submitBatch', 'stats', 'types',
  'favorite', 'favorites', 'wrong', 'removeWrong', 'practice', 'achievements',
  'adminCheck', 'adminStats', 'adminUserList', 'adminUserDetail'
]

exports.main = async (event, context) => {
  const { action, _openid, ...params } = event

  // éªŒè¯ action å‚æ•°
  if (!action || !ALLOWED_ACTIONS.includes(action)) {
    return { success: false, message: 'Invalid action' }
  }

  // ä»å¾®ä¿¡ä¸Šä¸‹æ–‡è·å–çœŸå®çš„ openidï¼ˆä¸å¯ä¼ªé€ ï¼‰
  const wxContext = cloud.getWXContext()
  const realOpenid = wxContext.OPENID

  if (!realOpenid) {
    return { success: false, message: 'æ— æ³•è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯' }
  }

  // å¦‚æœè¯·æ±‚ä¸­åŒ…å« _openid å­—æ®µï¼Œå¿…é¡»ä¸ realOpenid å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™æ‹’ç»
  if (typeof _openid !== 'undefined' && _openid !== realOpenid) {
    return { success: false, message: 'èº«ä»½éªŒè¯å¤±è´¥' }
  }

  // éœ€è¦èº«ä»½çš„ action å§‹ç»ˆä½¿ç”¨æœåŠ¡ç«¯è·å–çš„çœŸå® openid
  const effectiveOpenid = realOpenid

  switch (action) {
    case 'random':
      return await getRandomQuestions(params.count, params.type, params.difficulty)
    case 'list':
      return await getQuestionsByType(params.type, params.page, params.pageSize, params.difficulty)
    case 'detail':
      return await getQuestionDetail(params.id)
    case 'submit':
      return await submitAnswer(effectiveOpenid, params.questionId, params.answer)
    case 'submitBatch':
      return await submitBatchAnswers(effectiveOpenid, params.answers)
    case 'stats':
      return await getStatistics(effectiveOpenid)
    case 'types':
      return await getQuestionTypes()
    case 'favorite':
      return await toggleFavorite(effectiveOpenid, params.questionId, params.questionData)
    case 'favorites':
      return await getFavorites(effectiveOpenid, params.page, params.pageSize)
    case 'wrong':
      return await getWrongQuestions(effectiveOpenid, params.page, params.pageSize)
    case 'removeWrong':
      return await removeWrongQuestion(effectiveOpenid, params.questionId)
    case 'practice':
      return await generatePractice(params.type, params.count, params.difficulty)
    case 'achievements':
      return await getAchievements(effectiveOpenid)
    // ç®¡ç†å‘˜æ¥å£
    case 'adminCheck':
      return await checkAdmin(effectiveOpenid)
    case 'adminStats':
      return await getAdminStats(effectiveOpenid)
    case 'adminUserList':
      return await getAdminUserList(effectiveOpenid, params.page, params.pageSize)
    case 'adminUserDetail':
      return await getAdminUserDetail(effectiveOpenid, params.targetOpenid)
    default:
      return { success: false, message: 'æœªçŸ¥æ“ä½œ' }
  }
}

/**
 * Fisher-Yates æ´—ç‰Œç®—æ³• - çœŸéšæœºæ‰“ä¹±æ•°ç»„
 * @param {Array} array - å¾…æ‰“ä¹±çš„æ•°ç»„
 * @returns {Array} æ‰“ä¹±åçš„æ–°æ•°ç»„
 */
function fisherYatesShuffle(array) {
  const result = [...array]
  for (let i = result.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1))
    ;[result[i], result[j]] = [result[j], result[i]]
  }
  return result
}

/**
 * åˆ†æ‰¹è·å–æ‰€æœ‰åŒ¹é…çš„é¢˜ç›®
 * @param {Object} query - æ•°æ®åº“æŸ¥è¯¢å¯¹è±¡
 * @param {number} total - æ€»æ•°
 * @returns {Array} æ‰€æœ‰é¢˜ç›®æ•°ç»„
 */
async function fetchAllQuestions(query, total) {
  const BATCH_SIZE = 100
  const allQuestions = []
  const batches = Math.ceil(total / BATCH_SIZE)

  for (let i = 0; i < batches; i++) {
    const res = await query.skip(i * BATCH_SIZE).limit(BATCH_SIZE).get()
    allQuestions.push(...res.data)
  }

  return allQuestions
}

/**
 * è·å–éšæœºé¢˜ç›®ï¼ˆä½¿ç”¨ Fisher-Yates æ´—ç‰Œç®—æ³•ä¿è¯çœŸéšæœºï¼‰
 * @param {number} count - é¢˜ç›®æ•°é‡
 * @param {string} type - é¢˜ç›®ç±»å‹ (å¯é€‰)
 * @param {string} difficulty - éš¾åº¦çº§åˆ« (å¯é€‰: easy/medium/hard)
 */
async function getRandomQuestions(count = 10, type = null, difficulty = null) {
  try {
    const collection = db.collection(QUESTIONS_COLLECTION)
    let query = collection

    const whereConditions = {}
    if (type) {
      whereConditions.type = type
    }
    if (difficulty) {
      whereConditions.difficulty = difficulty
    }

    if (Object.keys(whereConditions).length > 0) {
      query = query.where(whereConditions)
    }

    // å…ˆè·å–æ€»æ•°
    const countRes = await query.count()
    const total = countRes.total

    if (total === 0) {
      return { success: true, data: [], total: 0 }
    }

    // è¯·æ±‚æ•°é‡ä¸èƒ½è¶…è¿‡æ€»æ•°
    const actualCount = Math.min(count, total)

    // å…¨é‡è·å–åŒ¹é…çš„é¢˜ç›®
    const allQuestions = await fetchAllQuestions(query, total)

    // ä½¿ç”¨ Fisher-Yates æ´—ç‰Œç®—æ³•æ‰“ä¹±
    const shuffled = fisherYatesShuffle(allQuestions)

    // å–å‰ N ä¸ª
    const selected = shuffled.slice(0, actualCount)

    return { success: true, data: selected, total }
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * æŒ‰ç±»å‹è·å–é¢˜ç›®åˆ—è¡¨
 * @param {string} type - é¢˜ç›®ç±»å‹
 * @param {number} page - é¡µç 
 * @param {number} pageSize - æ¯é¡µæ•°é‡
 * @param {string} difficulty - éš¾åº¦çº§åˆ« (å¯é€‰)
 */
async function getQuestionsByType(type, page = 1, pageSize = 20, difficulty = null) {
  try {
    const skip = (page - 1) * pageSize
    const whereConditions = { type }

    if (difficulty) {
      whereConditions.difficulty = difficulty
    }

    const res = await db.collection(QUESTIONS_COLLECTION)
      .where(whereConditions)
      .skip(skip)
      .limit(pageSize)
      .get()

    // è·å–æ€»æ•°
    const countRes = await db.collection(QUESTIONS_COLLECTION)
      .where(whereConditions)
      .count()

    return {
      success: true,
      data: res.data,
      total: countRes.total,
      page,
      pageSize
    }
  } catch (err) {
    return { success: false, message: err.message, data: [], total: 0 }
  }
}

/**
 * è·å–é¢˜ç›®è¯¦æƒ…
 * @param {string} id - é¢˜ç›®ID
 */
async function getQuestionDetail(id) {
  try {
    const res = await db.collection(QUESTIONS_COLLECTION).doc(id).get()
    return { success: true, data: res.data }
  } catch (err) {
    return { success: false, message: err.message }
  }
}

/**
 * æäº¤å•é¢˜ç­”æ¡ˆ
 * @param {string} openid - ç”¨æˆ·openid
 * @param {string} questionId - é¢˜ç›®ID
 * @param {string} answer - ç”¨æˆ·ç­”æ¡ˆ
 */
async function submitAnswer(openid, questionId, answer) {
  try {
    const questionRes = await db.collection(QUESTIONS_COLLECTION).doc(questionId).get()
    const question = questionRes.data

    // æ£€æŸ¥é¢˜ç›®æ˜¯å¦å­˜åœ¨
    if (!question) {
      return { success: false, message: 'é¢˜ç›®ä¸å­˜åœ¨' }
    }

    const isCorrect = String(answer) === String(question.correctAnswer)

    // è®°å½•ç­”é¢˜å†å²
    await db.collection('answer_history').add({
      data: {
        _openid: openid,
        questionId,
        answer,
        isCorrect,
        questionType: question.type,
        createdAt: db.serverDate()
      }
    })

    return {
      success: true,
      data: {
        isCorrect,
        correctAnswer: question.correctAnswer,
        explanation: question.explanation
      }
    }
  } catch (err) {
    return { success: false, message: err.message }
  }
}

/**
 * æ‰¹é‡æäº¤ç­”æ¡ˆ
 * @param {string} openid - ç”¨æˆ·openid
 * @param {Array} answers - ç­”æ¡ˆæ•°ç»„ [{questionId, answer, isCorrect, questionType}]
 *
 * æ³¨æ„ï¼šå¯¹äºç»ƒä¹ é¡µé¢ï¼ˆè¯æ±‡ã€æˆè¯­ã€æ‹¼éŸ³ã€ç—…å¥ï¼‰ï¼Œé¢˜ç›®å¯èƒ½ä¸åœ¨æ•°æ®åº“ä¸­ã€‚
 * æ­¤æ—¶ answers æ•°ç»„åº”åŒ…å« isCorrect å’Œ questionType å­—æ®µã€‚
 */
async function submitBatchAnswers(openid, answers) {
  console.log('===== submitBatchAnswers v2025-01-15-DEBUG =====')
  console.log('openid:', openid)
  console.log('answers æ•°é‡:', answers?.length)
  console.log('answers ç¤ºä¾‹:', JSON.stringify(answers?.[0]))

  if (!answers || !Array.isArray(answers) || answers.length === 0) {
    console.error('answers å‚æ•°æ— æ•ˆ:', answers)
    return {
      success: false,
      savedCount: 0,
      total: 0,
      version: 'v2025-01-15-EMPTY',
      message: 'ç­”æ¡ˆæ•°æ®ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯'
    }
  }

  try {
    const results = []
    let correctCount = 0
    let savedCount = 0
    const errors = []

    for (let i = 0; i < answers.length; i++) {
      const item = answers[i]
      console.log(`[${i+1}/${answers.length}] å¤„ç†é¢˜ç›®:`, item.questionId, 'ç­”æ¡ˆ:', item.answer)

      // å…ˆå°è¯•ä»æ•°æ®åº“è·å–é¢˜ç›®
      let question = null
      try {
        const questionRes = await db.collection(QUESTIONS_COLLECTION).doc(item.questionId).get()
        question = questionRes.data
      } catch (e) {
        console.log('é¢˜ç›®ä¸åœ¨é¢˜åº“ä¸­:', item.questionId)
      }

      let isCorrect
      let questionType

      if (question) {
        isCorrect = String(item.answer) === String(question.correctAnswer)
        questionType = question.type
      } else {
        isCorrect = item.isCorrect ?? false
        questionType = item.questionType ?? 'practice'
      }

      if (isCorrect) correctCount++

      // ä¿å­˜ç­”é¢˜å†å²åˆ° answer_historyï¼ˆåŒ…å«å®Œæ•´é¢˜ç›®ä¿¡æ¯ï¼‰
      try {
        const recordData = {
          _openid: openid,
          questionId: item.questionId,
          answer: item.answer,
          isCorrect,
          questionType,
          createdAt: db.serverDate()
        }

        // å¦‚æœæœ‰å®Œæ•´çš„é¢˜ç›®ä¿¡æ¯ï¼Œä¸€å¹¶ä¿å­˜
        if (item.questionText) {
          recordData.questionText = item.questionText
        }
        if (item.options && item.options.length > 0) {
          recordData.options = item.options
        }
        if (item.correctAnswer !== undefined) {
          recordData.correctAnswer = item.correctAnswer
        }

        const addResult = await db.collection('answer_history').add({
          data: recordData
        })
        console.log(`[${i+1}] ä¿å­˜æˆåŠŸ _id:`, addResult._id)
        savedCount++
      } catch (saveErr) {
        console.error(`[${i+1}] ä¿å­˜å¤±è´¥:`, saveErr)
        errors.push({ index: i, error: saveErr.message })
      }

      results.push({
        questionId: item.questionId,
        isCorrect,
        correctAnswer: question?.correctAnswer,
        explanation: question?.explanation
      })
    }

    console.log('===== submitBatch å®Œæˆ =====')
    console.log('å°è¯•ä¿å­˜:', answers.length, 'å®é™…ä¿å­˜:', savedCount, 'æ­£ç¡®:', correctCount)

    // ç›´æ¥è¿”å›æ‰å¹³ç»“æ„ï¼Œå…¼å®¹å‰ç«¯è¯»å–
    return {
      success: true,
      savedCount: savedCount,
      total: answers.length,
      correctCount: correctCount,
      score: answers.length > 0 ? Math.round((correctCount / answers.length) * 100) : 0,
      version: 'v2025-01-15-NEW',
      data: {  // ä¿æŒå…¼å®¹æ€§
        results,
        savedCount,
        correctCount,
        totalCount: answers.length,
        version: 'v2025-01-15-NEW'
      }
    }
  } catch (err) {
    console.error('===== submitBatch å¼‚å¸¸ =====:', err)
    return {
      success: false,
      savedCount: 0,
      total: answers?.length || 0,
      version: 'v2025-01-15-ERROR',
      message: err.message,
      error: String(err)
    }
  }
}

/**
 * è·å–é¢˜ç›®ç»Ÿè®¡
 * @param {string} openid - ç”¨æˆ·openid
 */
async function getStatistics(openid) {
  try {
    // é¢˜åº“æ€»æ•°
    const totalRes = await db.collection(QUESTIONS_COLLECTION).count()
    const total = totalRes.total

    // å„ç±»å‹é¢˜ç›®æ•°é‡
    const types = ['pinyin', 'literature', 'idiom', 'correction', 'vocabulary', 'comprehension', 'grammar', 'reading']
    const typeStats = {}

    for (const type of types) {
      const res = await db.collection(QUESTIONS_COLLECTION)
        .where({ type })
        .count()
      typeStats[type] = res.total
    }

    // ç”¨æˆ·ç­”é¢˜æ•°
    const answeredRes = await db.collection('answer_history')
      .where({ _openid: openid })
      .count()
    const answered = answeredRes.total

    // æ­£ç¡®é¢˜æ•°
    const correctRes = await db.collection('answer_history')
      .where({ _openid: openid, isCorrect: true })
      .count()
    const correct = correctRes.total

    // ä»Šæ—¥ç­”é¢˜æ•°
    const today = new Date()
    today.setHours(0, 0, 0, 0)
    const todayRes = await db.collection('answer_history')
      .where({
        _openid: openid,
        createdAt: _.gte(today)
      })
      .count()
    const todayAnswered = todayRes.total

    return {
      success: true,
      data: {
        total,
        answered,
        correct,
        todayAnswered,
        accuracy: answered > 0 ? Math.round((correct / answered) * 100) : 0,
        typeStats
      }
    }
  } catch (err) {
    return { success: false, message: err.message, data: {} }
  }
}

/**
 * è·å–é¢˜ç›®ç±»å‹åˆ—è¡¨
 */
async function getQuestionTypes() {
  try {
    const types = [
      { value: 'pinyin', label: 'æ‹¼éŸ³', count: 0 },
      { value: 'literature', label: 'å¤è¯—è¯', count: 0 },
      { value: 'idiom', label: 'æˆè¯­', count: 0 },
      { value: 'correction', label: 'ç—…å¥ä¿®æ”¹', count: 0 },
      { value: 'vocabulary', label: 'è¯æ±‡', count: 0 },
      { value: 'comprehension', label: 'é˜…è¯»ç†è§£', count: 0 },
      { value: 'grammar', label: 'è¯­æ³•', count: 0 },
      { value: 'reading', label: 'é˜…è¯»', count: 0 }
    ]

    // è·å–å„ç±»å‹å®é™…æ•°é‡
    for (const type of types) {
      const res = await db.collection(QUESTIONS_COLLECTION)
        .where({ type: type.value })
        .count()
      type.count = res.total
    }

    return { success: true, data: types }
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * ç”Ÿæˆç»ƒä¹ é¢˜
 * @param {string} type - é¢˜ç›®ç±»å‹
 * @param {number} count - é¢˜ç›®æ•°é‡
 * @param {string} difficulty - éš¾åº¦
 */
async function generatePractice(type = null, count = 10, difficulty = null) {
  try {
    const result = await getRandomQuestions(count, type, difficulty)
    return result
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * æ”¶è—/å–æ¶ˆæ”¶è—é¢˜ç›®
 * @param {string} openid - ç”¨æˆ· openid
 * @param {string} questionId - é¢˜ç›® ID
 * @param {object} questionData - é¢˜ç›®å®Œæ•´æ•°æ®ï¼ˆå¯é€‰ï¼‰
 */
async function toggleFavorite(openid, questionId, questionData = null) {
  console.log('=== toggleFavorite å¼€å§‹ ===')
  console.log('questionId:', questionId)
  console.log('questionData:', questionData)

  try {
    const existingRes = await db.collection('favorites')
      .where({ _openid: openid, questionId })
      .get()

    if (existingRes.data.length > 0) {
      // å–æ¶ˆæ”¶è—
      await db.collection('favorites')
        .doc(existingRes.data[0]._id)
        .remove()
      console.log('å–æ¶ˆæ”¶è—æˆåŠŸ')
      return { success: true, data: { favorited: false } }
    } else {
      // æ·»åŠ æ”¶è— - ä¿å­˜å®Œæ•´çš„é¢˜ç›®æ•°æ®
      const favoriteData = {
        _openid: openid,
        questionId,
        createdAt: db.serverDate()
      }

      // å¦‚æœæä¾›äº†å®Œæ•´é¢˜ç›®æ•°æ®ï¼Œä¸€å¹¶ä¿å­˜
      if (questionData) {
        favoriteData.questionText = questionData.question || questionData.questionText || ''
        favoriteData.questionType = questionData.type || questionData.questionType || ''
        favoriteData.options = questionData.options || []
        favoriteData.correctAnswer = questionData.correctAnswer
        favoriteData.explanation = questionData.explanation || ''
        console.log('ä¿å­˜å®Œæ•´é¢˜ç›®æ•°æ®')
      } else {
        console.log('ä»…ä¿å­˜ questionId')
      }

      await db.collection('favorites').add({ data: favoriteData })
      console.log('æ·»åŠ æ”¶è—æˆåŠŸ')
      return { success: true, data: { favorited: true } }
    }
  } catch (err) {
    console.error('toggleFavorite é”™è¯¯:', err)
    return { success: false, message: err.message }
  }
}

/**
 * è·å–æ”¶è—åˆ—è¡¨ï¼ˆåŒ…å«å®Œæ•´é¢˜ç›®è¯¦æƒ…ï¼‰
 */
async function getFavorites(openid, page = 1, pageSize = 20) {
  console.log('=== getFavorites å¼€å§‹ ===')
  console.log('openid:', openid)
  console.log('page:', page, 'pageSize:', pageSize)

  try {
    const skip = (page - 1) * pageSize
    const favRes = await db.collection('favorites')
      .where({ _openid: openid })
      .orderBy('createdAt', 'desc')
      .skip(skip)
      .limit(pageSize)
      .get()

    console.log('æŸ¥è¯¢åˆ°æ”¶è—è®°å½•æ•°:', favRes.data.length)
    console.log('æ”¶è—è®°å½•ç¤ºä¾‹:', favRes.data[0])

    // è·å–é¢˜ç›®è¯¦æƒ…
    const questions = []
    for (const fav of favRes.data) {
      console.log('å¤„ç†æ”¶è—è®°å½•:', fav.questionId)

      try {
        const qRes = await db.collection(QUESTIONS_COLLECTION).doc(fav.questionId).get()
        if (qRes.data) {
          console.log('ä» questions_bank æ‰¾åˆ°é¢˜ç›®')
          questions.push({
            ...qRes.data,
            _id: qRes.data._id || fav.questionId,
            id: qRes.data.id || fav.questionId,
            favoriteId: fav._id,
            favoriteCreatedAt: fav.createdAt
          })
        } else {
          throw new Error('é¢˜ç›®ä¸å­˜åœ¨')
        }
      } catch (e) {
        // é¢˜ç›®åœ¨ questions_bank ä¸­ä¸å­˜åœ¨ï¼Œå¯èƒ½æ˜¯å†…ç½®é¢˜ç›®ï¼ˆv001, i001 ç­‰ï¼‰
        console.log('questions_bank ä¸­æœªæ‰¾åˆ°é¢˜ç›®ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„é¢˜ç›®æ•°æ®')

        // å¦‚æœæ”¶è—è®°å½•ä¸­åŒ…å«å®Œæ•´çš„é¢˜ç›®æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨
        if (fav.questionText || fav.question || fav.options) {
          console.log('ä½¿ç”¨æ”¶è—è®°å½•ä¸­ä¿å­˜çš„é¢˜ç›®æ•°æ®')
          questions.push({
            id: fav.questionId,
            type: fav.questionType || 'unknown',
            question: fav.questionText || fav.question || '',
            options: fav.options || [],
            correctAnswer: fav.correctAnswer,
            explanation: fav.explanation || '',
            favoriteId: fav._id,
            favoriteCreatedAt: fav.createdAt,
            _id: fav.questionId
          })
        } else {
          console.log('æ”¶è—è®°å½•ä¸­ä¹Ÿæ²¡æœ‰é¢˜ç›®æ•°æ®ï¼Œè·³è¿‡:', fav.questionId)
        }
      }
    }

    console.log('æœ€ç»ˆè¿”å›é¢˜ç›®æ•°:', questions.length)
    return { success: true, data: questions }
  } catch (err) {
    console.error('getFavorites é”™è¯¯:', err)
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * è·å–é”™é¢˜é›†ï¼ˆåŒ…å«å®Œæ•´é¢˜ç›®è¯¦æƒ…ï¼‰
 */
async function getWrongQuestions(openid, page = 1, pageSize = 20) {
  console.log('=== getWrongQuestions å¼€å§‹ ===')
  console.log('openid:', openid)

  try {
    const skip = (page - 1) * pageSize
    const wrongRes = await db.collection('answer_history')
      .where({ _openid: openid, isCorrect: false })
      .orderBy('createdAt', 'desc')
      .skip(skip)
      .limit(pageSize)
      .get()

    console.log('é”™é¢˜è®°å½•æ•°:', wrongRes.data.length)

    // è·å–é¢˜ç›®è¯¦æƒ…ï¼Œå»é‡ï¼ˆåŒä¸€é”™é¢˜åªä¿ç•™æœ€æ–°ä¸€æ¬¡ï¼‰
    const questionMap = new Map()
    for (const record of wrongRes.data) {
      if (!questionMap.has(record.questionId)) {
        const questionType = record.questionType || record.type || 'unknown'
        console.log('å¤„ç†é”™é¢˜:', record.questionId, 'ç±»å‹:', questionType)

        let questionData = null
        let useSavedData = false

        // ä¼˜å…ˆæ£€æŸ¥ answer_history è®°å½•ä¸­æ˜¯å¦å·²ä¿å­˜å®Œæ•´é¢˜ç›®ä¿¡æ¯
        // (è¿™æ˜¯ submitBatchAnswers åœ¨ä¿å­˜æ—¶å†™å…¥çš„ questionText, options, correctAnswer)
        if (record.questionText || (record.options && record.options.length > 0)) {
          console.log('ä½¿ç”¨ answer_history ä¸­ä¿å­˜çš„é¢˜ç›®æ•°æ®')
          useSavedData = true
          questionData = {
            id: record.questionId,
            type: questionType,
            question: record.questionText || record.question || `ã€${questionType}ã€‘é¢˜ç›® ID: ${record.questionId}`,
            questionText: record.questionText || record.question || '',
            options: record.options || [],
            correctAnswer: record.correctAnswer !== undefined ? record.correctAnswer : 0,
            answer: record.correctAnswer !== undefined ? record.correctAnswer : 0,
            explanation: record.explanation || ''
          }
          console.log('å·²ä¿å­˜æ•°æ® - optionsæ•°é‡:', questionData.options.length)
        }

        // å¦‚æœè®°å½•ä¸­æ²¡æœ‰ä¿å­˜å®Œæ•´æ•°æ®ï¼Œå°è¯•ä» questions_bank è·å–
        if (!questionData) {
          try {
            const qRes = await db.collection(QUESTIONS_COLLECTION).doc(record.questionId).get()
            if (qRes.data) {
              questionData = qRes.data
              console.log('ä» questions_bank æ‰¾åˆ°é¢˜ç›®')
            }
          } catch (e) {
            console.log('questions_bank ä¸­æ²¡æœ‰è¯¥é¢˜ç›®')
          }
        }

        if (questionData) {
          // æ‰¾åˆ°å®Œæ•´é¢˜ç›®ä¿¡æ¯
          questionMap.set(record.questionId, {
            id: questionData.id || record.questionId,
            _id: questionData._id || record.questionId,
            type: questionType,
            question: questionData.question || questionData.content || '',
            questionText: questionData.question || questionData.content || '',
            options: questionData.options || [],
            correctAnswer: questionData.answer || questionData.correctAnswer || 0,
            answer: questionData.answer || questionData.correctAnswer || 0,
            explanation: questionData.explanation || '',
            wrongAnswer: record.answer,
            wrongAt: record.createdAt,
            isFromSavedData: useSavedData
          })
        } else {
          // æ²¡æœ‰æ‰¾åˆ°å®Œæ•´é¢˜ç›®ä¿¡æ¯ï¼Œä½¿ç”¨åŸºæœ¬è®°å½•
          console.log('æœªæ‰¾åˆ°å®Œæ•´é¢˜ç›®ä¿¡æ¯ï¼Œä½¿ç”¨åŸºæœ¬è®°å½•')
          questionMap.set(record.questionId, {
            id: record.questionId,
            _id: record.questionId,
            type: questionType,
            question: `ã€${questionType}ã€‘é¢˜ç›® ID: ${record.questionId}`,
            questionText: `é¢˜ç›® ID: ${record.questionId}`,
            options: [],
            correctAnswer: 0,
            answer: 0,
            wrongAnswer: record.answer,
            wrongAt: record.createdAt,
            isFromHistory: true
          })
        }
      }
    }

    console.log('æœ€ç»ˆè¿”å›é”™é¢˜æ•°:', questionMap.size)
    return { success: true, data: Array.from(questionMap.values()) }
  } catch (err) {
    console.error('getWrongQuestions å‡ºé”™:', err)
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * ç§»é™¤é”™é¢˜ï¼ˆç­”å¯¹åè°ƒç”¨ï¼‰
 * åˆ é™¤è¯¥ç”¨æˆ·å¯¹è¯¥é¢˜ç›®çš„é”™é¢˜è®°å½•
 * @param {string} openid - ç”¨æˆ·openid
 * @param {string} questionId - é¢˜ç›®ID
 */
async function removeWrongQuestion(openid, questionId) {
  console.log('===== removeWrongQuestion å¼€å§‹ =====')
  console.log('openid:', openid)
  console.log('questionId:', questionId)

  if (!questionId) {
    console.log('é”™è¯¯: ç¼ºå°‘questionIdå‚æ•°')
    return { success: false, message: 'ç¼ºå°‘questionIdå‚æ•°' }
  }

  try {
    // å…ˆæ£€æŸ¥æœ‰å¤šå°‘æ¡é”™é¢˜è®°å½•
    const checkBefore = await db.collection('answer_history')
      .where({
        _openid: openid,
        questionId: questionId,
        isCorrect: false
      })
      .count()
    console.log('åˆ é™¤å‰é”™é¢˜è®°å½•æ•°:', checkBefore.total)

    // åˆ é™¤è¯¥ç”¨æˆ·å¯¹è¿™é“é¢˜ç›®çš„é”™é¢˜è®°å½•ï¼ˆisCorrect: false çš„è®°å½•ï¼‰
    const deleteRes = await db.collection('answer_history')
      .where({
        _openid: openid,
        questionId: questionId,
        isCorrect: false
      })
      .remove()

    console.log('åˆ é™¤é”™é¢˜è®°å½•ç»“æœ:', JSON.stringify(deleteRes))
    console.log('å®é™…åˆ é™¤æ•°é‡:', deleteRes.stats?.removed || 0)

    // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰è¯¥é¢˜ç›®çš„é”™é¢˜è®°å½•
    const checkAfter = await db.collection('answer_history')
      .where({
        _openid: openid,
        questionId: questionId,
        isCorrect: false
      })
      .count()

    const remaining = checkAfter.total
    console.log('åˆ é™¤åå‰©ä½™é”™é¢˜è®°å½•æ•°:', remaining)

    console.log('===== removeWrongQuestion å®Œæˆ =====')
    return {
      success: true,
      removed: deleteRes.stats?.removed || 0,
      remaining,
      message: remaining === 0 ? 'é”™é¢˜å·²ç§»é™¤' : `è¿˜æœ‰${remaining}æ¡è®°å½•`
    }
  } catch (err) {
    console.error('===== removeWrongQuestion å‡ºé”™ =====:', err)
    return {
      success: false,
      message: err.message,
      removed: 0,
      error: String(err)
    }
  }
}

/**
 * è·å–ç”¨æˆ·æˆå°±æ•°æ®
 * åŸºäº answer_history å’Œ study_records é›†åˆå®æ—¶è®¡ç®—
 * @param {string} openid - ç”¨æˆ·openid
 */
async function getAchievements(openid) {
  try {
    // è·å–ç”¨æˆ·æ€»ç­”é¢˜æ•°
    const answeredRes = await db.collection('answer_history')
      .where({ _openid: openid })
      .count()
    const totalQuestions = answeredRes.total

    // è·å–ç”¨æˆ·æ­£ç¡®ç­”é¢˜æ•°
    const correctRes = await db.collection('answer_history')
      .where({ _openid: openid, isCorrect: true })
      .count()
    const correctCount = correctRes.total

    // è®¡ç®—æ­£ç¡®ç‡
    const accuracy = totalQuestions > 0 ? Math.round((correctCount / totalQuestions) * 100) : 0

    // è·å–å­¦ä¹ è®°å½•
    const recordsRes = await db.collection('study_records')
      .where({ _openid: openid })
      .get()

    const records = recordsRes.data

    // è®¡ç®—æ€»å¾—åˆ†
    const totalScore = records.reduce((sum, r) => sum + (r.score || 0), 0)

    // æ»¡åˆ†æ¬¡æ•°
    const perfectCount = records.filter(r => r.score === 100).length

    // è®¡ç®—è¿ç»­å­¦ä¹ å¤©æ•°
    const studyDays = calculateStudyDays(records)

    // æˆå°±åˆ¤æ–­
    const achievements = {
      beginner: {
        unlocked: totalQuestions > 0,
        progress: totalQuestions > 0 ? 'å·²è§£é”' : '0/1é¢˜'
      },
      week: {
        unlocked: studyDays >= 7,
        progress: `${Math.min(studyDays, 7)}/7å¤©`
      },
      perfect: {
        unlocked: perfectCount >= 10,
        progress: `${perfectCount}/10æ¬¡`
      },
      master: {
        unlocked: totalQuestions >= 500,
        progress: `${totalQuestions}/500é¢˜`
      },
      speed: {
        unlocked: totalQuestions >= 100,
        progress: `${Math.min(totalQuestions, 100)}/100é¢˜`
      },
      bookworm: {
        unlocked: totalScore >= 1000,
        progress: `${totalScore}/1000åˆ†`
      },
      scholar: {
        unlocked: accuracy >= 90 && totalQuestions >= 50,
        progress: `${accuracy}%`
      }
    }

    return { success: true, data: achievements }
  } catch (err) {
    return { success: false, message: err.message, data: {} }
  }
}

/**
 * è®¡ç®—è¿ç»­å­¦ä¹ å¤©æ•°
 * @param {Array} records - å­¦ä¹ è®°å½•æ•°ç»„
 * @returns {number} è¿ç»­å­¦ä¹ å¤©æ•°
 */
function calculateStudyDays(records) {
  if (records.length === 0) return 0

  // è·å–æ‰€æœ‰ä¸é‡å¤çš„æ—¥æœŸ
  const dates = records
    .map(r => {
      const date = new Date(r.createdAt || r.timestamp)
      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`
    })
    .filter((d, i, arr) => arr.indexOf(d) === i)
    .sort()
    .reverse()

  if (dates.length === 0) return 0

  // ä»Šå¤©æ˜¯å¦å­¦ä¹ 
  const today = new Date()
  const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`

  // æ˜¨å¤©æ˜¯å¦å­¦ä¹ 
  const yesterday = new Date(today)
  yesterday.setDate(yesterday.getDate() - 1)
  const yesterdayStr = `${yesterday.getFullYear()}-${String(yesterday.getMonth() + 1).padStart(2, '0')}-${String(yesterday.getDate()).padStart(2, '0')}`

  let streak = 0
  let checkDate = null

  if (dates[0] === todayStr) {
    streak = 1
    checkDate = yesterday
  } else if (dates[0] === yesterdayStr) {
    streak = 1
    checkDate = yesterday
  } else {
    return 0
  }

  // å‘å‰æ£€æŸ¥è¿ç»­å¤©æ•°
  for (let i = 1; i < dates.length; i++) {
    checkDate.setDate(checkDate.getDate() - 1)
    const checkStr = `${checkDate.getFullYear()}-${String(checkDate.getMonth() + 1).padStart(2, '0')}-${String(checkDate.getDate()).padStart(2, '0')}`

    if (dates.includes(checkStr)) {
      streak++
    } else {
      break
    }
  }

  return streak
}

// ==================== ç®¡ç†å‘˜åŠŸèƒ½ ====================

/**
 * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜¯ç®¡ç†å‘˜
 * @param {string} openid - ç”¨æˆ· openid
 * @returns {Object} { success: true, isAdmin: boolean }
 */
async function checkAdmin(openid) {
  try {
    const result = await db.collection('admins')
      .where({ _openid: openid })
      .get()

    const isAdmin = result.data.length > 0
    console.log('checkAdmin:', openid, isAdmin)

    return { success: true, isAdmin }
  } catch (err) {
    console.error('checkAdmin error:', err)
    return { success: false, message: err.message, isAdmin: false }
  }
}

/**
 * éªŒè¯ç®¡ç†å‘˜æƒé™ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
 * @param {string} openid - ç”¨æˆ· openid
 * @returns {boolean} æ˜¯å¦æ˜¯ç®¡ç†å‘˜
 */
async function isAdmin(openid) {
  const result = await checkAdmin(openid)
  return result.isAdmin === true
}

/**
 * è·å–ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ®
 * @param {string} openid - ç”¨æˆ· openid
 * @returns {Object} ç»Ÿè®¡æ•°æ®
 */
async function getAdminStats(openid) {
  // éªŒè¯ç®¡ç†å‘˜æƒé™
  if (!await isAdmin(openid)) {
    return { success: false, message: 'æ— ç®¡ç†å‘˜æƒé™' }
  }

  try {
    console.log('=== getAdminStats å¼€å§‹ ===')

    // 1. ç”¨æˆ·æ€»æ•°
    const usersRes = await db.collection('users').count()
    const totalUsers = usersRes.total

    // 2. ä»Šæ—¥æ–°å¢ç”¨æˆ·
    const today = new Date()
    const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0, 0, 0)
    const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59)

    const newUsersRes = await db.collection('users')
      .where({
        createdAt: _.gte(todayStart).and(_.lte(todayEnd))
      })
      .count()
    const todayNewUsers = newUsersRes.total

    // 3. æ€»ç­”é¢˜æ•°
    const answerRes = await db.collection('answer_history').count()
    const totalAnswers = answerRes.total

    // 4. æ­£ç¡®ç­”é¢˜æ•°
    const correctRes = await db.collection('answer_history')
      .where({ isCorrect: true })
      .count()
    const correctAnswers = correctRes.total

    // 5. å¹³å‡æ­£ç¡®ç‡
    const accuracy = totalAnswers > 0 ? Math.round((correctAnswers / totalAnswers) * 100) : 0

    // 6. å„é¢˜å‹ç»ƒä¹ åˆ†å¸ƒ
    const typeStats = await db.collection('study_records')
      .aggregate()
      .group({
        _id: '$type',
        count: _.sum(1)
      })
      .end()

    const typeDistribution = {}
    const TYPE_NAMES = {
      'pinyin': 'æ‹¼éŸ³ç»ƒä¹ ',
      'idiom': 'æˆè¯­ç†Ÿè¯­',
      'vocabulary': 'è¯æ±‡å­¦ä¹ ',
      'correction': 'ç—…å¥ä¿®æ”¹',
      'literature': 'è¯—è¯é‰´èµ',
      'grammar': 'è¯­æ³•çŸ¥è¯†',
      'reading': 'é˜…è¯»ç†è§£'
    }

    typeStats.data.forEach(item => {
      const typeName = TYPE_NAMES[item._id] || item._id
      typeDistribution[typeName] = item.count
    })

    // 7. æ”¶è—é¢˜ç›®æ€»æ•°
    const favoritesRes = await db.collection('favorites').count()
    const totalFavorites = favoritesRes.total

    // 8. é”™é¢˜æ€»æ•°
    const wrongRes = await db.collection('answer_history')
      .where({ isCorrect: false })
      .count()
    const totalWrong = wrongRes.total

    return {
      success: true,
      data: {
        users: {
          total: totalUsers,
          todayNew: todayNewUsers
        },
        answers: {
          total: totalAnswers,
          correct: correctAnswers,
          accuracy: accuracy
        },
        typeDistribution,
        favorites: totalFavorites,
        wrongQuestions: totalWrong
      }
    }
  } catch (err) {
    console.error('getAdminStats error:', err)
    return { success: false, message: err.message }
  }
}

/**
 * è·å–ç”¨æˆ·åˆ—è¡¨
 * @param {string} openid - ç®¡ç†å‘˜ openid
 * @param {number} page - é¡µç 
 * @param {number} pageSize - æ¯é¡µæ•°é‡
 * @returns {Object} ç”¨æˆ·åˆ—è¡¨
 */
async function getAdminUserList(openid, page = 1, pageSize = 20) {
  // éªŒè¯ç®¡ç†å‘˜æƒé™
  if (!await isAdmin(openid)) {
    return { success: false, message: 'æ— ç®¡ç†å‘˜æƒé™' }
  }

  try {
    console.log('=== getAdminUserList å¼€å§‹ ===', page, pageSize)

    const skip = (page - 1) * pageSize

    // è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆusersé›†åˆä½¿ç”¨openidå­—æ®µï¼Œä¸æ˜¯_openidï¼‰
    const usersRes = await db.collection('users')
      .orderBy('createdAt', 'desc')
      .skip(skip)
      .limit(pageSize)
      .get()

    // è·å–æ€»æ•°
    const countRes = await db.collection('users').count()
    const total = countRes.total

    console.log('ç”¨æˆ·æ€»æ•°:', total)
    console.log('æŸ¥è¯¢åˆ°çš„ç”¨æˆ·æ•°:', usersRes.data.length)
    console.log('ç¬¬ä¸€ä¸ªç”¨æˆ·ç¤ºä¾‹:', usersRes.data[0])

    // ä¸ºæ¯ä¸ªç”¨æˆ·è·å–ç»Ÿè®¡æ•°æ®
    const userList = await Promise.all(usersRes.data.map(async (user) => {
      const userOpenid = user.openid  // usersé›†åˆä½¿ç”¨openidå­—æ®µ

      // ç­”é¢˜æ•°
      const answerRes = await db.collection('answer_history')
        .where({ _openid: userOpenid })
        .count()
      const answerCount = answerRes.total

      // æ­£ç¡®æ•°
      const correctRes = await db.collection('answer_history')
        .where({ _openid: userOpenid, isCorrect: true })
        .count()
      const correctCount = correctRes.total

      // æ­£ç¡®ç‡
      const accuracy = answerCount > 0 ? Math.round((correctCount / answerCount) * 100) : 0

      // å­¦ä¹ è®°å½•æ•°
      const recordsRes = await db.collection('study_records')
        .where({ _openid: userOpenid })
        .count()
      const studyDays = recordsRes.total

      // æœ€åå­¦ä¹ æ—¶é—´
      const lastRecordRes = await db.collection('study_records')
        .where({ _openid: userOpenid })
        .orderBy('createdAt', 'desc')
        .limit(1)
        .get()
      const lastStudyTime = lastRecordRes.data.length > 0
        ? lastRecordRes.data[0].createdAt
        : null

      return {
        openid: userOpenid,
        nickName: user.nickname || 'æœªè®¾ç½®',  // usersé›†åˆä½¿ç”¨nicknameå­—æ®µ
        avatarUrl: user.avatar || '',
        createdAt: user.createdAt,
        stats: {
          answerCount,
          correctCount,
          accuracy,
          studyDays,
          lastStudyTime
        }
      }
    }))

    console.log('å¤„ç†åçš„ç”¨æˆ·åˆ—è¡¨:', userList.length)

    return {
      success: true,
      data: {
        list: userList,
        total,
        page,
        pageSize,
        totalPages: Math.ceil(total / pageSize)
      }
    }
  } catch (err) {
    console.error('getAdminUserList error:', err)
    return { success: false, message: err.message }
  }
}

/**
 * è·å–å•ä¸ªç”¨æˆ·è¯¦æƒ…
 * @param {string} adminOpenid - ç®¡ç†å‘˜ openid
 * @param {string} targetOpenid - ç›®æ ‡ç”¨æˆ· openid
 * @returns {Object} ç”¨æˆ·è¯¦æƒ…
 */
async function getAdminUserDetail(adminOpenid, targetOpenid) {
  // éªŒè¯ç®¡ç†å‘˜æƒé™
  if (!await isAdmin(adminOpenid)) {
    return { success: false, message: 'æ— ç®¡ç†å‘˜æƒé™' }
  }

  if (!targetOpenid) {
    return { success: false, message: 'ç¼ºå°‘ç›®æ ‡ç”¨æˆ·ID' }
  }

  try {
    console.log('=== getAdminUserDetail å¼€å§‹ ===', targetOpenid)

    // è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆusersé›†åˆä½¿ç”¨openidå­—æ®µï¼Œä¸æ˜¯_openidï¼‰
    const userRes = await db.collection('users')
      .where({ openid: targetOpenid })
      .get()

    if (userRes.data.length === 0) {
      return { success: false, message: 'ç”¨æˆ·ä¸å­˜åœ¨' }
    }

    const user = userRes.data[0]

    // è·å–ç­”é¢˜å†å²
    const answerRes = await db.collection('answer_history')
      .where({ _openid: targetOpenid })
      .orderBy('createdAt', 'desc')
      .limit(100)
      .get()

    // ç­”é¢˜ç»Ÿè®¡
    const answerCount = answerRes.data.length
    const correctCount = answerRes.data.filter(a => a.isCorrect).length
    const accuracy = answerCount > 0 ? Math.round((correctCount / answerCount) * 100) : 0

    // å„é¢˜å‹ç»Ÿè®¡
    const typeStats = {}
    answerRes.data.forEach(answer => {
      const type = answer.questionType || 'unknown'
      if (!typeStats[type]) {
        typeStats[type] = { total: 0, correct: 0 }
      }
      typeStats[type].total++
      if (answer.isCorrect) {
        typeStats[type].correct++
      }
    })

    // è·å–å­¦ä¹ è®°å½•
    const recordsRes = await db.collection('study_records')
      .where({ _openid: targetOpenid })
      .orderBy('createdAt', 'desc')
      .limit(50)
      .get()

    // è®¡ç®—å­¦ä¹ å¤©æ•°
    const studyDays = calculateStudyDays(recordsRes.data)

    // è·å–æ”¶è—æ•°
    const favoritesRes = await db.collection('favorites')
      .where({ _openid: targetOpenid })
      .count()
    const favoriteCount = favoritesRes.total

    // è·å–é”™é¢˜æ•°
    const wrongRes = await db.collection('answer_history')
      .where({ _openid: targetOpenid, isCorrect: false })
      .count()
    const wrongCount = wrongRes.total

    // æœ€è¿‘30å¤©ç­”é¢˜è¶‹åŠ¿
    const thirtyDaysAgo = new Date()
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30)

    const trendRes = await db.collection('answer_history')
      .where({
        _openid: targetOpenid,
        createdAt: _.gte(thirtyDaysAgo)
      })
      .get()

    // æŒ‰æ—¥æœŸåˆ†ç»„ç»Ÿè®¡
    const dailyTrend = {}
    trendRes.data.forEach(item => {
      const date = new Date(item.createdAt)
      const dateStr = `${date.getMonth() + 1}/${date.getDate()}`
      if (!dailyTrend[dateStr]) {
        dailyTrend[dateStr] = { total: 0, correct: 0 }
      }
      dailyTrend[dateStr].total++
      if (item.isCorrect) {
        dailyTrend[dateStr].correct++
      }
    })

    return {
      success: true,
      data: {
        userInfo: {
          openid: targetOpenid,
          nickName: user.nickname || 'æœªè®¾ç½®',  // usersé›†åˆä½¿ç”¨nicknameå­—æ®µ
          avatarUrl: user.avatar || '',
          createdAt: user.createdAt
        },
        stats: {
          answerCount,
          correctCount,
          accuracy,
          studyDays,
          favoriteCount,
          wrongCount
        },
        typeStats,
        studyRecords: recordsRes.data.map(r => ({
          type: r.type,
          score: r.score,
          totalQuestions: r.totalQuestions,
          correctAnswers: r.correctAnswers,
          createdAt: r.createdAt
        })),
        dailyTrend
      }
    }
  } catch (err) {
    console.error('getAdminUserDetail error:', err)
    return { success: false, message: err.message }
  }
}


// ===== cloudfunctions/study/index.js =====
// å­¦ä¹ è®°å½•äº‘å‡½æ•°
const cloud = require('wx-server-sdk')
cloud.init({
  env: cloud.DYNAMIC_CURRENT_ENV
})
const db = cloud.database()

// Action ç™½åå•
const ALLOWED_ACTIONS = ['add', 'addBatch', 'list', 'statistics', 'homeStats', 'report', 'analysis', 'delete', 'calendar']

exports.main = async (event, context) => {
  const { action, _openid, ...params } = event

  // éªŒè¯ action å‚æ•°
  if (!action || !ALLOWED_ACTIONS.includes(action)) {
    return { success: false, message: 'Invalid action' }
  }

  // ä»å¾®ä¿¡ä¸Šä¸‹æ–‡è·å–çœŸå®çš„ openidï¼ˆä¸å¯ä¼ªé€ ï¼‰
  const wxContext = cloud.getWXContext()
  const realOpenid = wxContext.OPENID

  if (!realOpenid) {
    return { success: false, message: 'æ— æ³•è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯' }
  }

  // å¦‚æœè¯·æ±‚ä¸­åŒ…å« _openid å­—æ®µï¼Œå¿…é¡»ä¸ realOpenid å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™æ‹’ç»
  if (typeof _openid !== 'undefined' && _openid !== realOpenid) {
    return { success: false, message: 'èº«ä»½éªŒè¯å¤±è´¥' }
  }

  // éœ€è¦èº«ä»½çš„ action å§‹ç»ˆä½¿ç”¨æœåŠ¡ç«¯è·å–çš„çœŸå® openid
  const effectiveOpenid = realOpenid

  switch (action) {
    case 'add':
      return await addRecord(effectiveOpenid, params)
    case 'addBatch':
      return await addRecords(effectiveOpenid, params.records)
    case 'list':
      return await getRecords(effectiveOpenid, params)
    case 'statistics':
      return await getStatistics(effectiveOpenid, params.timeRange)
    case 'homeStats':
      return await getHomeStatistics(effectiveOpenid)
    case 'report':
      return await getReport(effectiveOpenid, params.startDate, params.endDate)
    case 'analysis':
      return await getAnalysis(effectiveOpenid)
    case 'delete':
      return await deleteRecord(effectiveOpenid, params.id)
    case 'calendar':
      return await getStudyCalendar(effectiveOpenid, params.year, params.month)
    default:
      return { success: false, message: 'æœªçŸ¥æ“ä½œ' }
  }
}

/**
 * æ·»åŠ å­¦ä¹ è®°å½•
 */
async function addRecord(openid, data) {
  console.log('=== addRecord è¢«è°ƒç”¨ ===')
  console.log('openid:', openid)
  console.log('data:', JSON.stringify(data))

  try {
    const record = {
      _openid: openid,
      ...data,
      createdAt: db.serverDate()
    }
    console.log('å‡†å¤‡å†™å…¥çš„æ•°æ®:', JSON.stringify(record))

    const res = await db.collection('study_records').add({ data: record })
    console.log('å†™å…¥æˆåŠŸï¼Œ_id:', res._id)

    return { success: true, data: { _id: res._id, ...record } }
  } catch (err) {
    console.error('å†™å…¥å¤±è´¥:', err)
    return { success: false, message: err.message, error: err.errMsg || err.message }
  }
}

/**
 * æ‰¹é‡æ·»åŠ å­¦ä¹ è®°å½•
 */
async function addRecords(openid, records) {
  try {
    const data = records.map(r => ({
      _openid: openid,
      ...r,
      createdAt: db.serverDate()
    }))
    const res = await db.collection('study_records').add({ data })
    return { success: true, data: res.ids || [] }
  } catch (err) {
    return { success: false, message: err.message }
  }
}

/**
 * è·å–å­¦ä¹ è®°å½•åˆ—è¡¨
 */
async function getRecords(openid, filters = {}) {
  try {
    const { type, page = 1, pageSize = 20 } = filters
    const skip = (page - 1) * pageSize

    let query = db.collection('study_records').where({ _openid: openid })
    if (type) {
      query = query.and({ type })
    }

    const res = await query.orderBy('createdAt', 'desc')
      .skip(skip)
      .limit(pageSize)
      .get()

    return { success: true, data: res.data }
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * è·å–å­¦ä¹ ç»Ÿè®¡
 * è¿”å›ç”¨æˆ·çš„å®Œæ•´å­¦ä¹ ç»Ÿè®¡ä¿¡æ¯
 */
async function getStatistics(openid, timeRange = 'month') {
  try {
    const now = new Date()
    let startDate

    if (timeRange === 'week') {
      startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)
    } else if (timeRange === 'month') {
      startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000)
    } else {
      startDate = new Date(now.setHours(0, 0, 0, 0))
    }

    // è·å–å­¦ä¹ è®°å½•
    const recordsRes = await db.collection('study_records')
      .where({
        _openid: openid,
        createdAt: db.command.gte(startDate)
      })
      .get()

    const records = recordsRes.data
    const totalScore = records.reduce((sum, r) => sum + (r.score || 0), 0)
    const totalDuration = records.reduce((sum, r) => sum + (r.duration || 0), 0)

    // è®¡ç®—æ€»ç­”é¢˜æ•°å’Œæ­£ç¡®ç‡
    const totalQuestions = records.reduce((sum, r) => sum + (r.totalQuestions || 0), 0)
    const correctAnswers = records.reduce((sum, r) => sum + (r.correctAnswers || 0), 0)
    const correctRate = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0

    // è®¡ç®—ç´¯è®¡å­¦ä¹ å¤©æ•°
    const allRecordsRes = await db.collection('study_records')
      .where({ _openid: openid })
      .get()
    const uniqueDays = new Set(
      allRecordsRes.data.map(r => new Date(r.createdAt).toDateString())
    ).size

    return {
      success: true,
      data: {
        totalScore,
        totalDuration,
        recordCount: records.length,
        totalDays: uniqueDays, // ç´¯è®¡å­¦ä¹ å¤©æ•°
        totalQuestions,
        correctRate
      }
    }
  } catch (err) {
    return { success: false, message: err.message, data: {} }
  }
}

/**
 * è·å–é¦–é¡µç»Ÿè®¡
 */
async function getHomeStatistics(openid) {
  console.log('=== getHomeStatistics è¢«è°ƒç”¨ ===')
  console.log('openid:', openid)

  try {
    // ä½¿ç”¨ UTC æ—¶é—´è·å–ä»Šæ—¥é›¶ç‚¹
    const now = new Date()
    const today = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()))
    console.log('æŸ¥è¯¢ä»Šæ—¥æ•°æ®çš„èµ·å§‹æ—¶é—´(UTC):', today.toISOString())

    // ä»Šæ—¥ç­”é¢˜è®°å½•
    const todayRes = await db.collection('study_records')
      .where({
        _openid: openid,
        createdAt: db.command.gte(today)
      })
      .get()

    console.log('ä»Šæ—¥æŸ¥è¯¢ç»“æœæ•°é‡:', todayRes.data.length)
    if (todayRes.data.length > 0) {
      console.log('ä»Šæ—¥ç¬¬ä¸€æ¡è®°å½•:', JSON.stringify(todayRes.data[0]))
    }

    const todayScore = todayRes.data.reduce((sum, r) => sum + (r.score || 0), 0)
    const todayDuration = todayRes.data.reduce((sum, r) => sum + (r.duration || 0), 0)

    // ä»Šæ—¥æ­£ç¡®æ•°å’Œæ€»é¢˜æ•°
    const todayTotalQuestions = todayRes.data.reduce((sum, r) => sum + (r.totalQuestions || 0), 0)
    const todayCorrectAnswers = todayRes.data.reduce((sum, r) => sum + (r.correctAnswers || 0), 0)
    const todayAccuracy = todayTotalQuestions > 0 ? Math.round((todayCorrectAnswers / todayTotalQuestions) * 100) : 0

    console.log('ç»Ÿè®¡ç»“æœ: todayScore=' + todayScore + ', todayAccuracy=' + todayAccuracy + '%')

    // ä»Šæ—¥é”™é¢˜æ•°ï¼ˆä» answer_history ä¸­ç»Ÿè®¡ï¼‰
    const todayWrongRes = await db.collection('answer_history')
      .where({
        _openid: openid,
        isCorrect: false,
        createdAt: db.command.gte(today)
      })
      .count()
    const todayWrongCount = todayWrongRes.total

    // æ€»é”™é¢˜æ•°ï¼ˆç”¨äºæ˜¾ç¤ºç´¯è®¡é”™é¢˜ï¼‰
    const wrongRes = await db.collection('answer_history')
      .where({ _openid: openid, isCorrect: false })
      .count()

    console.log('é”™é¢˜ç»Ÿè®¡: totalWrong=' + wrongRes.total + ', todayWrong=' + todayWrongCount)

    // å­¦ä¹ å¤©æ•°ï¼ˆè®¡ç®—è¿ç»­å­¦ä¹ å¤©æ•°ï¼‰
    const streakDays = await calculateStudyStreak(openid)

    // æ€»å­¦ä¹ å¤©æ•°ï¼ˆå†å²ç´¯è®¡ï¼‰- ä½¿ç”¨ UTC æ—¥æœŸ
    const daysRes = await db.collection('study_records')
      .where({ _openid: openid })
      .get()
    const uniqueDays = new Set(
      daysRes.data.map(r => {
        const date = new Date(r.createdAt)
        return `${date.getUTCFullYear()}-${String(date.getUTCMonth() + 1).padStart(2, '0')}-${String(date.getUTCDate()).padStart(2, '0')}`
      })
    ).size

    console.log('å­¦ä¹ å¤©æ•°: streakDays=' + streakDays + ', totalStudyDays=' + uniqueDays)

    // è®¡ç®—å„ç±»å‹è¿›åº¦ - åŸºäºç”¨æˆ·åœ¨ answer_history ä¸­çš„ç­”é¢˜æƒ…å†µ
    const types = ['pinyin', 'literature', 'idiom', 'correction', 'vocabulary', 'comprehension', 'grammar', 'reading']
    const progress = {}
    const totalPerType = 100 // å‡è®¾æ¯ç§ç±»å‹100é¢˜ç®—å®Œæˆ

    for (const type of types) {
      // è·å–è¯¥ç±»å‹å·²ç­”å¯¹çš„é¢˜ç›®æ•°
      const correctRes = await db.collection('answer_history')
        .where({
          _openid: openid,
          questionType: type,
          isCorrect: true
        })
        .count()

      // è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”ï¼ˆä¸Šé™100ï¼‰
      const percent = Math.min(100, Math.round((correctRes.total / totalPerType) * 100))
      progress[type] = percent
    }

    const result = {
      success: true,
      data: {
        todayScore,
        todayQuestionCount: todayTotalQuestions, // ä»Šæ—¥åšé¢˜æ•°ï¼ˆä» study_records ç»Ÿè®¡ï¼‰
        totalDuration: todayDuration,
        studyDays: streakDays, // è¿ç»­å­¦ä¹ å¤©æ•°
        totalStudyDays: uniqueDays, // ç´¯è®¡å­¦ä¹ å¤©æ•°
        accuracy: todayAccuracy, // ä»Šæ—¥æ­£ç¡®ç‡
        progress
      }
    }

    console.log('æœ€ç»ˆè¿”å›æ•°æ®:', JSON.stringify(result.data))
    return result
  } catch (err) {
    console.error('getHomeStatistics å‡ºé”™:', err)
    return { success: false, message: err.message, data: {} }
  }
}

/**
 * è·å–å­¦ä¹ æŠ¥å‘Š
 */
async function getReport(openid, startDate, endDate) {
  try {
    const start = new Date(startDate)
    const end = new Date(endDate)

    const res = await db.collection('study_records')
      .where({
        _openid: openid,
        createdAt: db.command.and(db.command.gte(start), db.command.lte(end))
      })
      .get()

    const records = res.data
    const totalScore = records.reduce((sum, r) => sum + (r.score || 0), 0)
    const totalDuration = records.reduce((sum, r) => sum + (r.duration || 0), 0)

    // æŒ‰æ—¥æœŸåˆ†ç»„
    const dailyData = {}
    records.forEach(r => {
      const date = new Date(r.createdAt).toLocaleDateString('zh-CN', { weekday: 'short' })
      if (!dailyData[date]) {
        dailyData[date] = { score: 0, duration: 0 }
      }
      dailyData[date].score += r.score || 0
      dailyData[date].duration += r.duration || 0
    })

    // è®¡ç®—æ­£ç¡®ç‡ï¼ˆä» answer_history ä¸­ç»Ÿè®¡ï¼‰
    const answerHistoryRes = await db.collection('answer_history')
      .where({
        _openid: openid,
        createdAt: db.command.and(db.command.gte(start), db.command.lte(end))
      })
      .get()

    const correctCount = answerHistoryRes.data.filter(r => r.isCorrect).length
    const correctRate = answerHistoryRes.data.length > 0
      ? Math.round((correctCount / answerHistoryRes.data.length) * 100)
      : 0

    return {
      success: true,
      data: {
        totalScore,
        totalDuration,
        correctRate,
        dailyData: Object.entries(dailyData).map(([date, data]) => ({
          date,
          ...data
        }))
      }
    }
  } catch (err) {
    return { success: false, message: err.message, data: {} }
  }
}

/**
 * è·å–å­¦ä¹ åˆ†æï¼ˆåŸºäºçœŸå®æ•°æ®ç»Ÿè®¡ï¼‰
 */
async function getAnalysis(openid) {
  try {
    // é¢˜å‹æ˜¾ç¤ºåç§°æ˜ å°„
    const TYPE_NAMES = {
      pinyin: 'æ‹¼éŸ³ç»ƒä¹ ',
      literature: 'å¤è¯—è¯',
      idiom: 'æˆè¯­ç†Ÿè¯­',
      correction: 'ç—…å¥ä¿®æ”¹',
      vocabulary: 'è¯æ±‡ç§¯ç´¯',
      comprehension: 'é˜…è¯»ç†è§£',
      grammar: 'è¯­æ³•çŸ¥è¯†',
      reading: 'é˜…è¯»'
    }

    // è·å–å„ç±»å‹ç­”é¢˜ç»Ÿè®¡
    const types = ['pinyin', 'literature', 'idiom', 'correction', 'vocabulary', 'comprehension', 'grammar', 'reading']
    const typeStats = {}

    for (const type of types) {
      const totalRes = await db.collection('answer_history')
        .where({ _openid: openid, questionType: type })
        .count()
      const correctRes = await db.collection('answer_history')
        .where({ _openid: openid, questionType: type, isCorrect: true })
        .count()

      typeStats[type] = {
        total: totalRes.total,
        correct: correctRes.total,
        accuracy: totalRes.total > 0 ? Math.round((correctRes.total / totalRes.total) * 100) : 0
      }
    }

    // åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®
    const hasData = Object.values(typeStats).some(s => s.total > 0)
    if (!hasData) {
      return {
        success: true,
        data: {
          strongPoints: [],
          weakPoints: [],
          trend: 'none',
          suggestions: [],
          typeStats: {}
        }
      }
    }

    // è®¡ç®—å¼ºå¼±é¡¹ï¼ˆå‡†ç¡®ç‡ > 80% ä¸ºå¼ºé¡¹ï¼Œ< 60% ä¸ºå¼±é¡¹ï¼‰
    const strongPoints = []
    const weakPoints = []
    for (const [type, stats] of Object.entries(typeStats)) {
      if (stats.total >= 5) { // è‡³å°‘5é¢˜æ‰è®¡å…¥ç»Ÿè®¡
        if (stats.accuracy >= 80) {
          strongPoints.push(TYPE_NAMES[type] || type)
        } else if (stats.accuracy < 60) {
          weakPoints.push(TYPE_NAMES[type] || type)
        }
      }
    }

    // è®¡ç®—è¶‹åŠ¿ï¼ˆæ¯”è¾ƒæœ€è¿‘7å¤©å’Œä¹‹å‰çš„å¹³å‡æ­£ç¡®ç‡ï¼‰
    const now = new Date()
    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)
    const recentRes = await db.collection('answer_history')
      .where({
        _openid: openid,
        createdAt: db.command.gte(weekAgo)
      })
      .get()
    const recentCorrect = recentRes.data.filter(r => r.isCorrect).length
    const recentAccuracy = recentRes.data.length > 0 ? (recentCorrect / recentRes.data.length) * 100 : 0

    // è·å–å…¨éƒ¨å†å²æ­£ç¡®ç‡
    const allRes = await db.collection('answer_history')
      .where({ _openid: openid })
      .get()
    const allCorrect = allRes.data.filter(r => r.isCorrect).length
    const allAccuracy = allRes.data.length > 0 ? (allCorrect / allRes.data.length) * 100 : 0

    let trend = 'stable'
    if (recentAccuracy > allAccuracy + 10) trend = 'up'
    else if (recentAccuracy < allAccuracy - 10) trend = 'down'

    // ç”Ÿæˆå»ºè®®ï¼ˆåŸºäºå¼±é¡¹ï¼‰
    const suggestions = []
    if (weakPoints.length > 0) {
      for (const weakPoint of weakPoints.slice(0, 2)) {
        suggestions.push({
          title: `åŠ å¼º${weakPoint}ç»ƒä¹ `,
          desc: `æ¯å¤©ç»ƒä¹ 5é“${weakPoint}é¢˜ç›®ï¼Œå·©å›ºè–„å¼±ç¯èŠ‚`
        })
      }
    } else {
      suggestions.push({
        title: 'ä¿æŒå­¦ä¹ çŠ¶æ€',
        desc: 'ç»§ç»­åšæŒç»ƒä¹ ï¼Œæ¯å¤©å®Œæˆ10é“é¢˜ç›®'
      })
    }

    return {
      success: true,
      data: {
        strongPoints,
        weakPoints,
        trend,
        suggestions,
        typeStats: Object.fromEntries(
          Object.entries(typeStats).map(([type, stats]) => [
            type,
            { accuracy: stats.accuracy, total: stats.total }
          ])
        )
      }
    }
  } catch (err) {
    return { success: false, message: err.message, data: {} }
  }
}

/**
 * åˆ é™¤å­¦ä¹ è®°å½•ï¼ˆéªŒè¯æ‰€æœ‰æƒï¼‰
 */
async function deleteRecord(openid, id) {
  try {
    // å…ˆæŸ¥è¯¢è®°å½•ï¼ŒéªŒè¯æ‰€æœ‰æƒ
    const recordRes = await db.collection('study_records').doc(id).get()

    // è®°å½•ä¸å­˜åœ¨
    if (!recordRes.data) {
      return { success: false, message: 'è®°å½•ä¸å­˜åœ¨' }
    }

    // éªŒè¯æ‰€æœ‰æƒ
    if (recordRes.data._openid !== openid) {
      return { success: false, message: 'æ— æƒåˆ é™¤æ­¤è®°å½•' }
    }

    await db.collection('study_records').doc(id).remove()
    return { success: true, data: null }
  } catch (err) {
    // doc(id) å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚ id æ ¼å¼é”™è¯¯
    return { success: false, message: 'åˆ é™¤å¤±è´¥' }
  }
}

/**
 * è·å–å­¦ä¹ æ—¥å†
 */
async function getStudyCalendar(openid, year, month) {
  try {
    const startDate = new Date(year, month - 1, 1)
    const endDate = new Date(year, month, 0, 23, 59, 59)

    const res = await db.collection('study_records')
      .where({
        _openid: openid,
        createdAt: db.command.and(db.command.gte(startDate), db.command.lte(endDate))
      })
      .get()

    const calendar = res.data.map(r => new Date(r.createdAt).getDate())
    return { success: true, data: calendar }
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * è®¡ç®—è¿ç»­å­¦ä¹ å¤©æ•°
 * @param {string} openid - ç”¨æˆ·openid
 * @returns {number} è¿ç»­å­¦ä¹ å¤©æ•°
 */
async function calculateStudyStreak(openid) {
  try {
    // è·å–æ‰€æœ‰å­¦ä¹ è®°å½•çš„æ—¥æœŸ
    const res = await db.collection('study_records')
      .where({ _openid: openid })
      .orderBy('createdAt', 'desc')
      .get()

    if (res.data.length === 0) return 0

    // ä½¿ç”¨ UTC æ—¶é—´è¿›è¡Œæ—¥æœŸè®¡ç®—ï¼Œé¿å…æ—¶åŒºé—®é¢˜
    const dates = res.data
      .map(r => {
        const date = new Date(r.createdAt)
        // ä½¿ç”¨ UTC æ—¥æœŸï¼Œä¸ db.serverDate() ä¿æŒä¸€è‡´
        return `${date.getUTCFullYear()}-${String(date.getUTCMonth() + 1).padStart(2, '0')}-${String(date.getUTCDate()).padStart(2, '0')}`
      })
      .filter((d, i, arr) => arr.indexOf(d) === i)
      .sort()
      .reverse()

    if (dates.length === 0) return 0

    console.log('è¿ç»­å­¦ä¹ è®¡ç®— - ä¸é‡å¤æ—¥æœŸ:', dates)

    // è·å–ä»Šå¤©çš„ UTC æ—¥æœŸ
    const now = new Date()
    const todayStr = `${now.getUTCFullYear()}-${String(now.getUTCMonth() + 1).padStart(2, '0')}-${String(now.getUTCDate()).padStart(2, '0')}`

    // è·å–æ˜¨å¤©çš„ UTC æ—¥æœŸ
    const yesterday = new Date(now)
    yesterday.setUTCDate(now.getUTCDate() - 1)
    const yesterdayStr = `${yesterday.getUTCFullYear()}-${String(yesterday.getUTCMonth() + 1).padStart(2, '0')}-${String(yesterday.getUTCDate()).padStart(2, '0')}`

    console.log('è¿ç»­å­¦ä¹ è®¡ç®— - ä»Šå¤©:', todayStr, 'æ˜¨å¤©:', yesterdayStr, 'æœ€æ–°è®°å½•:', dates[0])

    let streak = 0
    let checkDate = null

    // æ£€æŸ¥ä»Šå¤©æˆ–æ˜¨å¤©æ˜¯å¦å­¦ä¹ 
    if (dates[0] === todayStr) {
      streak = 1
      checkDate = new Date(now)
    } else if (dates[0] === yesterdayStr) {
      streak = 1
      checkDate = new Date(yesterday)
    } else {
      console.log('è¿ç»­å­¦ä¹ ä¸­æ–­: æœ€æ–°è®°å½•ä¸æ˜¯ä»Šå¤©æˆ–æ˜¨å¤©')
      return 0 // æ²¡æœ‰è¿ç»­å­¦ä¹ 
    }

    // å‘å‰æ£€æŸ¥è¿ç»­å¤©æ•°
    for (let i = 1; i < dates.length; i++) {
      checkDate.setUTCDate(checkDate.getUTCDate() - 1)
      const checkStr = `${checkDate.getUTCFullYear()}-${String(checkDate.getUTCMonth() + 1).padStart(2, '0')}-${String(checkDate.getUTCDate()).padStart(2, '0')}`

      if (dates.includes(checkStr)) {
        streak++
      } else {
        break
      }
    }

    console.log('è¿ç»­å­¦ä¹ å¤©æ•°:', streak)
    return streak
  } catch (err) {
    console.error('è¿ç»­å­¦ä¹ è®¡ç®—å‡ºé”™:', err)
    return 0
  }
}


// ===== cloudfunctions/vocabulary/index.js =====
// è¯æ±‡æœåŠ¡äº‘å‡½æ•°
const cloud = require('wx-server-sdk')
cloud.init({
  env: cloud.DYNAMIC_CURRENT_ENV
})
const db = cloud.database()

// Action ç™½åå•
const ALLOWED_ACTIONS = ['search', 'list', 'daily', 'idioms', 'searchIdiom', 'detail', 'favorite', 'favorites', 'practice']

exports.main = async (event, context) => {
  const { action, _openid, ...params } = event

  // éªŒè¯ action å‚æ•°
  if (!action || !ALLOWED_ACTIONS.includes(action)) {
    return { success: false, message: 'Invalid action' }
  }

  // ä»å¾®ä¿¡ä¸Šä¸‹æ–‡è·å–çœŸå®çš„ openidï¼ˆä¸å¯ä¼ªé€ ï¼‰
  const wxContext = cloud.getWXContext()
  const realOpenid = wxContext.OPENID

  if (!realOpenid) {
    return { success: false, message: 'æ— æ³•è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯' }
  }

  // å¦‚æœè¯·æ±‚ä¸­åŒ…å« _openid å­—æ®µï¼Œå¿…é¡»ä¸ realOpenid å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™æ‹’ç»
  if (typeof _openid !== 'undefined' && _openid !== realOpenid) {
    return { success: false, message: 'èº«ä»½éªŒè¯å¤±è´¥' }
  }

  // éœ€è¦èº«ä»½çš„ action å§‹ç»ˆä½¿ç”¨æœåŠ¡ç«¯è·å–çš„çœŸå® openid
  const effectiveOpenid = realOpenid

  switch (action) {
    case 'search':
      return await searchWord(params.word)
    case 'list':
      return await getWords(params.page, params.pageSize)
    case 'daily':
      return await getDailyWords(params.count)
    case 'idioms':
      return await getIdioms(params.page, params.pageSize)
    case 'searchIdiom':
      return await searchIdiom(params.keyword)
    case 'detail':
      return await getWordDetail(params.word)
    case 'favorite':
      return await toggleFavorite(effectiveOpenid, params.word)
    case 'favorites':
      return await getFavorites(effectiveOpenid, params.page, params.pageSize)
    case 'practice':
      return await generatePractice(params.type, params.count)
    default:
      return { success: false, message: 'æœªçŸ¥æ“ä½œ' }
  }
}

/**
 * æœç´¢è¯è¯­
 */
async function searchWord(word) {
  try {
    const res = await db.collection('vocabulary')
      .where({ word })
      .get()

    if (res.data.length > 0) {
      return { success: true, data: res.data[0] }
    }

    // è¯åº“ä¸­æ²¡æœ‰ï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®
    return {
      success: true,
      data: {
        word,
        pinyin: generatePinyin(word),
        definition: 'è¯¥è¯è¯­æš‚æ— é‡Šä¹‰',
        example: '',
        synonyms: [],
        antonyms: []
      }
    }
  } catch (err) {
    return { success: false, message: err.message }
  }
}

/**
 * è·å–è¯è¯­åˆ—è¡¨
 */
async function getWords(page = 1, pageSize = 20) {
  try {
    const skip = (page - 1) * pageSize
    const res = await db.collection('vocabulary')
      .skip(skip)
      .limit(pageSize)
      .get()
    return { success: true, data: res.data }
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * è·å–æ¯æ—¥æ¨è
 */
async function getDailyWords(count = 10) {
  try {
    // å…ˆè·å–æ€»æ•°ï¼Œç„¶åéšæœºè·³è¿‡
    const countRes = await db.collection('vocabulary').count()
    const total = countRes.total

    if (total === 0) {
      return { success: true, data: [] }
    }

    // è¯·æ±‚æ•°é‡ä¸èƒ½è¶…è¿‡æ€»æ•°
    const actualCount = Math.min(count, total)

    // éšæœºè·³è¿‡ä¸€äº›è®°å½•æ¥å®ç°éšæœºé€‰æ‹©
    const maxSkip = Math.max(0, total - actualCount)
    const skip = Math.floor(Math.random() * (maxSkip + 1))

    const res = await db.collection('vocabulary')
      .skip(skip)
      .limit(actualCount)
      .get()
    return { success: true, data: res.data }
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * è·å–æˆè¯­åˆ—è¡¨
 */
async function getIdioms(page = 1, pageSize = 20) {
  try {
    const skip = (page - 1) * pageSize
    const res = await db.collection('idioms')
      .skip(skip)
      .limit(pageSize)
      .get()
    return { success: true, data: res.data }
  } catch (err) {
    // æ¨¡æ‹Ÿæ•°æ®
    const mockIdioms = [
      { idiom: 'ç”»è›‡æ·»è¶³', pinyin: 'huÃ  shÃ© tiÄn zÃº', definition: 'æ¯”å–»åšäº†å¤šä½™çš„äº‹ã€‚', example: '' },
      { idiom: 'å®ˆæ ªå¾…å…”', pinyin: 'shÇ’u zhÅ« dÃ i tÃ¹', definition: 'æ¯”å–»æ­»å®ˆç‹­éš˜ç»éªŒã€‚', example: '' },
      { idiom: 'æ©è€³ç›—é“ƒ', pinyin: 'yÇn Ä›r dÃ o lÃ­ng', definition: 'æ¯”å–»è‡ªå·±æ¬ºéª—è‡ªå·±ã€‚', example: '' },
      { idiom: 'äº¡ç¾Šè¡¥ç‰¢', pinyin: 'wÃ¡ng yÃ¡ng bÇ” lÃ¡o', definition: 'æ¯”å–»å‡ºäº†é—®é¢˜åŠæ—¶è¡¥æ•‘ã€‚', example: '' }
    ]
    return { success: true, data: mockIdioms }
  }
}

/**
 * æœç´¢æˆè¯­
 */
async function searchIdiom(keyword) {
  try {
    const res = await db.collection('idioms')
      .where({
        idiom: db.RegExp({
          regexp: keyword,
          options: 'i'
        })
      })
      .limit(10)
      .get()
    return { success: true, data: res.data }
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * è·å–è¯è¯­è¯¦æƒ…
 */
async function getWordDetail(word) {
  return await searchWord(word)
}

/**
 * æ”¶è—è¯è¯­
 */
async function toggleFavorite(openid, word) {
  try {
    const existingRes = await db.collection('word_favorites')
      .where({ _openid: openid, word })
      .get()

    if (existingRes.data.length > 0) {
      await db.collection('word_favorites')
        .doc(existingRes.data[0]._id)
        .remove()
      return { success: true, data: { favorited: false } }
    } else {
      await db.collection('word_favorites').add({
        data: {
          _openid: openid,
          word,
          createdAt: db.serverDate()
        }
      })
      return { success: true, data: { favorited: true } }
    }
  } catch (err) {
    return { success: false, message: err.message }
  }
}

/**
 * è·å–æ”¶è—åˆ—è¡¨
 */
async function getFavorites(openid, page = 1, pageSize = 20) {
  try {
    const skip = (page - 1) * pageSize
    const res = await db.collection('word_favorites')
      .where({ _openid: openid })
      .skip(skip)
      .limit(pageSize)
      .get()
    return { success: true, data: res.data }
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * ç”Ÿæˆç»ƒä¹ é¢˜
 */
async function generatePractice(type, count = 10) {
  try {
    // æ¨¡æ‹Ÿç»ƒä¹ é¢˜ç”Ÿæˆ
    return {
      success: true,
      data: [
        {
          id: 1,
          type: 'single_choice',
          question: '"ç”»è›‡æ·»è¶³"è¿™ä¸ªæˆè¯­çš„æ„æ€æ˜¯ï¼Ÿ',
          options: ['A. æ¯”å–»åšäº‹è®¤çœŸ', 'B. æ¯”å–»åšäº†å¤šä½™çš„äº‹', 'C. æ¯”å–»åšæŒä¸æ‡ˆ', 'D. æ¯”å–»æŠ€è‰ºé«˜è¶…'],
          correctAnswer: 1
        }
      ]
    }
  } catch (err) {
    return { success: false, message: err.message, data: [] }
  }
}

/**
 * ç®€å•æ‹¼éŸ³ç”Ÿæˆï¼ˆç¤ºä¾‹ï¼‰
 * æ³¨æ„ï¼šå®é™…ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ä¸“ä¸šçš„æ‹¼éŸ³åº“ï¼Œå¦‚ pinyin-pro
 */
function generatePinyin(word) {
  // å¸¸è§å­—çš„ç®€å•æ‹¼éŸ³æ˜ å°„ï¼ˆä»…ä½œç¤ºä¾‹ï¼‰
  const commonPinyin = {
    'è¯­æ–‡': 'yÇ” wÃ©n', 'å­¦ä¹ ': 'xuÃ© xÃ­', 'é˜…è¯»': 'yuÃ¨ dÃº', 'å†™ä½œ': 'xiÄ› zuÃ²',
    'è¯—è¯': 'shÄ« cÃ­', 'æˆè¯­': 'chÃ©ng yÇ”', 'æ‹¼éŸ³': 'pÄ«n yÄ«n', 'æ±‰å­—': 'hÃ n zÃ¬',
    'è¯æ±‡': 'cÃ­ huÃ¬', 'è¯­æ³•': 'yÇ” fÇ', 'å¥å­': 'jÃ¹ zi', 'æ–‡ç« ': 'wÃ©n zhÄng'
  }

  // æ£€æŸ¥æ˜¯å¦æœ‰é¢„å®šä¹‰çš„æ‹¼éŸ³
  if (commonPinyin[word]) {
    return commonPinyin[word]
  }

  // å¦‚æœæ²¡æœ‰é¢„å®šä¹‰ï¼Œè¿”å›æç¤ºä¿¡æ¯
  return 'ï¼ˆæš‚æ— æ‹¼éŸ³æ•°æ®ï¼‰'
}


// ===== cloudfunctions/user/index.js =====
const cloud = require('wx-server-sdk')
cloud.init({ env: cloud.DYNAMIC_CURRENT_ENV })
const db = cloud.database()

// Action ç™½åå•
const ALLOWED_ACTIONS = ['get', 'update', 'updateStudy']

exports.main = async (event, context) => {
  const { action, openid, ...data } = event

  // éªŒè¯ action å‚æ•°
  if (!action || !ALLOWED_ACTIONS.includes(action)) {
    return { success: false, message: 'Invalid action' }
  }

  // ä»å¾®ä¿¡ä¸Šä¸‹æ–‡è·å–çœŸå®çš„ openidï¼ˆä¸å¯ä¼ªé€ ï¼‰
  const wxContext = cloud.getWXContext()
  const realOpenid = wxContext.OPENID

  if (!realOpenid) {
    return { success: false, message: 'æ— æ³•è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯' }
  }

  // å¦‚æœè¯·æ±‚ä¸­åŒ…å« openid å­—æ®µï¼Œå¿…é¡»ä¸ realOpenid å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™æ‹’ç»
  if (typeof openid !== 'undefined' && openid !== realOpenid) {
    return { success: false, message: 'èº«ä»½éªŒè¯å¤±è´¥' }
  }

  try {
    switch (action) {
      case 'get':
        return await getUser(realOpenid)
      case 'update':
        return await updateUser(realOpenid, data)
      case 'updateStudy':
        return await updateStudyData(realOpenid, data)
      default:
        return { success: false, message: 'Unknown action' }
    }
  } catch (err) {
    console.error(err)
    return { success: false, message: err.message }
  }
}

/**
 * è·å–ç”¨æˆ·ä¿¡æ¯
 * ç»Ÿä¸€è¿”å›ç»“æ„ï¼šæœ‰æ•°æ®è¿”å› { success: true, data: user }ï¼Œæ— æ•°æ®è¿”å› { success: true, data: null }
 */
async function getUser(openid) {
  try {
    const res = await db.collection('users').where({ openid }).get()
    const user = res.data[0]
    // ç»Ÿä¸€è¿”å› success: trueï¼Œdata ä¸º null è¡¨ç¤ºæœªæ‰¾åˆ°
    return { success: true, data: user || null }
  } catch (err) {
    return { success: false, message: err.message }
  }
}

/**
 * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
 */
async function updateUser(openid, { nickname, avatar }) {
  try {
    const res = await db.collection('users').where({ openid }).update({
      data: { nickname, avatar, updatedAt: new Date() }
    })
    return { success: true, data: res }
  } catch (err) {
    return { success: false, message: err.message }
  }
}

/**
 * æ›´æ–°å­¦ä¹ æ•°æ®
 */
async function updateStudyData(openid, { studyDays, totalScore }) {
  try {
    const updateData = { updatedAt: new Date() }
    if (studyDays) updateData.studyDays = studyDays
    if (totalScore !== undefined) updateData.totalScore = totalScore

    const res = await db.collection('users').where({ openid }).update({
      data: updateData
    })
    return { success: true, data: res }
  } catch (err) {
    return { success: false, message: err.message }
  }
}


// ===== cloudfunctions/login/index.js =====
const cloud = require('wx-server-sdk')
cloud.init({ env: cloud.DYNAMIC_CURRENT_ENV })
const db = cloud.database()

// Action ç™½åå•
const ALLOWED_ACTIONS = ['login', 'register']

exports.main = async (event, context) => {
  const { action, code, openid, nickname, avatar } = event

  // éªŒè¯ action å‚æ•°
  if (!action || !ALLOWED_ACTIONS.includes(action)) {
    return { success: false, message: 'Invalid action' }
  }

  // ä»å¾®ä¿¡ä¸Šä¸‹æ–‡è·å–çœŸå®çš„ openidï¼ˆä¸å¯ä¼ªé€ ï¼‰
  const wxContext = cloud.getWXContext()
  const realOpenid = wxContext.OPENID

  if (!realOpenid) {
    return { success: false, message: 'æ— æ³•è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯' }
  }

  // å¦‚æœè¯·æ±‚ä¸­åŒ…å« openid å­—æ®µï¼Œå¿…é¡»ä¸ realOpenid å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™æ‹’ç»
  if (typeof openid !== 'undefined' && openid !== realOpenid) {
    return { success: false, message: 'èº«ä»½éªŒè¯å¤±è´¥' }
  }

  try {
    switch (action) {
      case 'login': return await handleLogin(realOpenid)
      case 'register': return await handleRegister(realOpenid, nickname, avatar)
      default: return { success: false, message: 'Unknown action' }
    }
  } catch (err) {
    console.error(err)
    return { success: false, message: err.message || 'Operation failed' }
  }
}

async function handleLogin(openid) {
  if (!openid) return { success: false, message: 'Cannot get openid' }

  const userRes = await db.collection('users').where({ openid }).get()
  const user = userRes.data[0]

  if (!user) return { success: true, data: { openid, needRegister: true } }

  return {
    success: true,
    data: { openid, user: { id: user._id, nickname: user.nickname, avatar: user.avatar }, token: generateToken(openid) }
  }
}

async function handleRegister(openid, nickname, avatar) {
  if (!openid || !nickname) return { success: false, message: 'Missing params' }

  const now = new Date()
  const result = await db.collection('users').add({
    data: { openid, nickname, avatar, vipLevel: 0, vipExpire: null, studyDays: 0, totalScore: 0, createdAt: now, updatedAt: now }
  })

  return { success: true, data: { id: result._id, openid, nickname, avatar, vipLevel: 0 } }
}

function generateToken(openid) {
  return Buffer.from(openid + ':' + Date.now() + ':' + Math.random().toString(36).substring(2)).toString('base64')
}


// ===== config/index.js =====
const config = {
  projectName: 'ai-tutor-miniprogram',
  date: '2025-1-3',
  designWidth: 750,
  deviceRatio: {
    640: 2.34 / 2,
    750: 1,
    828: 1.81 / 2
  },
  sourceRoot: 'src',
  outputRoot: 'dist',
  plugins: [
    '@tarojs/plugin-framework-react'
  ],
  defineConstants: {},
  copy: {
    patterns: [],
    options: {}
  },
  framework: 'react',
  compiler: {
    type: 'webpack5',
    prebundle: { enable: false }
  },
  cache: {
    enable: false
  },
  mini: {
    postcss: {
      pxtransform: {
        enable: true,
        config: {}
      },
      url: {
        enable: true,
        config: {
          limit: 1024
        }
      },
      cssModules: {
        enable: false,
        config: {
          namingPattern: 'module',
          generateScopedName: '[name]__[local]___[hash:base64:5]'
        }
      }
    },
    webpackChain(chain) {
      chain.merge({
        plugin: {
          install: {
            plugin: require('terser-webpack-plugin'),
            args: [{
              terserOptions: {
                compress: {
                  drop_console: true
                }
              }
            }]
          }
        }
      })
    }
  },
  h5: {
    publicPath: '/',
    staticDirectory: 'static',
    postcss: {
      autoprefixer: {
        enable: true
      },
      cssModules: {
        enable: false,
        config: {
          namingPattern: 'module',
          generateScopedName: '[name]__[local]___[hash:base64:5]'
        }
      }
    }
  }
}

module.exports = function (merge) {
  if (process.env.NODE_ENV === 'development') {
    return merge({}, config, require('./dev'))
  }
  return merge({}, config, require('./prod'))
}


// ===== config/dev.js =====
module.exports = {
  env: {
    NODE_ENV: '"development"'
  },
  defineConstants: {},
  mini: {},
  h5: {}
}


// ===== config/prod.js =====
module.exports = {
  env: {
    NODE_ENV: '"production"'
  },
  defineConstants: {},
  mini: {},
  h5: {}
}

